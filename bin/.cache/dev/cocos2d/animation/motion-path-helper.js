
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'engine-dev/cocos2d/animation/motion-path-helper.js';
                    var __require = nodeEnv ? function (request) {
                        return require(request);
                    } : function (request) {
                        return __quick_compile_engine__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_engine__.registerModule(__filename, module);}"use strict";

/****************************************************************************
 Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.

 https://www.cocos.com/

 Permission is hereby granted, free of charge, to any person obtaining a copy
 of this software and associated engine source code (the "Software"), a limited,
 worldwide, royalty-free, non-assignable, revocable and non-exclusive license
 to use Cocos Creator solely to develop games on your target platforms. You shall
 not use Cocos Creator software for developing other software or tools that's
 used for developing games. You are not granted to publish, distribute,
 sublicense, and/or sell copies of Cocos Creator.

 The software or tools in this License Agreement are licensed, not sold.
 Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.

 THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 THE SOFTWARE.
 ****************************************************************************/
var DynamicAnimCurve = require('./animation-curves').DynamicAnimCurve;

var computeRatioByType = require('./animation-curves').computeRatioByType;

var bezier = require('./bezier').bezier;

var binarySearch = require('../core/utils/binary-search').binarySearchEpsilon;

var v2 = cc.v2;

function Curve(points) {
  this.points = points || [];
  this.beziers = [];
  this.ratios = [];
  this.progresses = [];
  this.length = 0;
  this.computeBeziers();
}

Curve.prototype.computeBeziers = function () {
  this.beziers.length = 0;
  this.ratios.length = 0;
  this.progresses.length = 0;
  this.length = 0;
  var bezier;

  for (var i = 1; i < this.points.length; i++) {
    var startPoint = this.points[i - 1];
    var endPoint = this.points[i];
    bezier = new Bezier();
    bezier.start = startPoint.pos;
    bezier.startCtrlPoint = startPoint.out;
    bezier.end = endPoint.pos;
    bezier.endCtrlPoint = endPoint["in"];
    this.beziers.push(bezier);
    this.length += bezier.getLength();
  }

  var current = 0;

  for (var i = 0; i < this.beziers.length; i++) {
    bezier = this.beziers[i];
    this.ratios[i] = bezier.getLength() / this.length;
    this.progresses[i] = current = current + this.ratios[i];
  }

  return this.beziers;
};

function Bezier() {
  this.start = v2();
  this.end = v2();
  this.startCtrlPoint = v2(); // cp0, cp1

  this.endCtrlPoint = v2(); // cp2, cp3
} // Get point at relative position in curve according to arc length
// - u [0 .. 1]


Bezier.prototype.getPointAt = function (u) {
  var t = this.getUtoTmapping(u);
  return this.getPoint(t);
}; // Get point at time t
//  - t [0 .. 1]


Bezier.prototype.getPoint = function (t) {
  var x = bezier(this.start.x, this.startCtrlPoint.x, this.endCtrlPoint.x, this.end.x, t);
  var y = bezier(this.start.y, this.startCtrlPoint.y, this.endCtrlPoint.y, this.end.y, t);
  return new v2(x, y);
}; // Get total curve arc length


Bezier.prototype.getLength = function () {
  var lengths = this.getLengths();
  return lengths[lengths.length - 1];
}; // Get list of cumulative segment lengths


Bezier.prototype.getLengths = function (divisions) {
  if (!divisions) divisions = this.__arcLengthDivisions ? this.__arcLengthDivisions : 200;

  if (this.cacheArcLengths && this.cacheArcLengths.length === divisions + 1) {
    //console.log( "cached", this.cacheArcLengths );
    return this.cacheArcLengths;
  }

  var cache = [];
  var current,
      last = this.getPoint(0),
      vector = v2();
  var p,
      sum = 0;
  cache.push(0);

  for (p = 1; p <= divisions; p++) {
    current = this.getPoint(p / divisions);
    vector.x = last.x - current.x;
    vector.y = last.y - current.y;
    sum += vector.mag();
    cache.push(sum);
    last = current;
  }

  this.cacheArcLengths = cache;
  return cache; // { sums: cache, sum:sum }; Sum is in the last element.
};

Bezier.prototype.getUtoTmapping = function (u, distance) {
  var arcLengths = this.getLengths();
  var i = 0,
      il = arcLengths.length;
  var targetArcLength; // The targeted u distance value to get

  if (distance) {
    targetArcLength = distance;
  } else {
    targetArcLength = u * arcLengths[il - 1];
  } //var time = Date.now();
  // binary search for the index with largest value smaller than target u distance


  var low = 0,
      high = il - 1,
      comparison;

  while (low <= high) {
    i = Math.floor(low + (high - low) / 2); // less likely to overflow, though probably not issue here, JS doesn't really have integers, all numbers are floats

    comparison = arcLengths[i] - targetArcLength;

    if (comparison < 0) {
      low = i + 1;
      continue;
    } else if (comparison > 0) {
      high = i - 1;
      continue;
    } else {
      high = i;
      break; // DONE
    }
  }

  i = high; //console.log('b' , i, low, high, Date.now()- time);

  if (arcLengths[i] === targetArcLength) {
    var t = i / (il - 1);
    return t;
  } // we could get finer grain at lengths, or use simple interpolatation between two points


  var lengthBefore = arcLengths[i];
  var lengthAfter = arcLengths[i + 1];
  var segmentLength = lengthAfter - lengthBefore; // determine where we are between the 'before' and 'after' points

  var segmentFraction = (targetArcLength - lengthBefore) / segmentLength; // add that fractional amount to t

  var t = (i + segmentFraction) / (il - 1);
  return t;
};

function checkMotionPath(motionPath) {
  if (!Array.isArray(motionPath)) return false;

  for (var i = 0, l = motionPath.length; i < l; i++) {
    var controls = motionPath[i];
    if (!Array.isArray(controls) || controls.length !== 6) return false;
  }

  return true;
}

function sampleMotionPaths(motionPaths, data, duration, fps, target) {
  function createControlPoints(array) {
    if (array instanceof cc.Vec2) {
      return {
        "in": array,
        pos: array,
        out: array
      };
    } else if (Array.isArray(array) && array.length === 6) {
      return {
        "in": v2(array[2], array[3]),
        pos: v2(array[0], array[1]),
        out: v2(array[4], array[5])
      };
    }

    return {
      "in": cc.Vec2.ZERO,
      pos: cc.Vec2.ZERO,
      out: cc.Vec2.ZERO
    };
  }

  var values = data.values = data.values.map(function (value) {
    if (Array.isArray(value)) {
      value = value.length === 2 ? cc.v2(value[0], value[1]) : cc.v3(value[0], value[1], value[2]);
    }

    return value;
  });

  if (motionPaths.length === 0 || values.length === 0) {
    return;
  }

  var motionPathValid = false;

  for (var _i = 0; _i < motionPaths.length; _i++) {
    var _motionPath = motionPaths[_i];

    if (_motionPath && !checkMotionPath(_motionPath)) {
      cc.errorID(3904, target ? target.name : '', 'position', _i);
      _motionPath = null;
    }

    if (_motionPath && _motionPath.length > 0) {
      motionPathValid = true;
      break;
    }
  }

  if (!motionPathValid) {
    return;
  }

  if (values.length === 1) {
    return;
  }

  var types = data.types;
  var ratios = data.ratios;
  var newValues = data.values = [];
  var newTypes = data.types = [];
  var newRatios = data.ratios = [];

  function addNewDatas(value, type, ratio) {
    newValues.push(value);
    newTypes.push(type);
    newRatios.push(ratio);
  } // ensure every ratio section's length is the same


  var startRatioOffset = 0;
  var EPSILON = 1e-6;
  var newType = DynamicAnimCurve.Linear; // do not need to compute last path

  for (var i = 0, l = motionPaths.length; i < l - 1; i++) {
    var motionPath = motionPaths[i];
    var ratio = ratios[i];
    var nextRatio = ratios[i + 1];
    var betweenRatio = nextRatio - ratio;
    var value = values[i];
    var nextValue = values[i + 1];
    var type = types[i];
    var results = [];
    var progress = startRatioOffset / betweenRatio;
    var speed = 1 / (betweenRatio * duration * fps);
    var finalProgress;

    if (motionPath && motionPath.length > 0) {
      var points = [];
      points.push(createControlPoints(value));

      for (var j = 0, l2 = motionPath.length; j < l2; j++) {
        var controlPoints = createControlPoints(motionPath[j]);
        points.push(controlPoints);
      }

      points.push(createControlPoints(nextValue)); // create Curve to compute beziers

      var curve = new Curve(points);
      curve.computeBeziers(); // sample beziers

      var progresses = curve.progresses;

      while (1 - progress > EPSILON) {
        finalProgress = progress;
        finalProgress = computeRatioByType(finalProgress, type);
        var pos, bezier, normal, length;

        if (finalProgress < 0) {
          bezier = curve.beziers[0];
          length = (0 - finalProgress) * bezier.getLength();
          normal = bezier.start.sub(bezier.endCtrlPoint).normalize();
          pos = bezier.start.add(normal.mul(length));
        } else if (finalProgress > 1) {
          bezier = curve.beziers[curve.beziers.length - 1];
          length = (finalProgress - 1) * bezier.getLength();
          normal = bezier.end.sub(bezier.startCtrlPoint).normalize();
          pos = bezier.end.add(normal.mul(length));
        } else {
          var bezierIndex = binarySearch(progresses, finalProgress);
          if (bezierIndex < 0) bezierIndex = ~bezierIndex;
          finalProgress -= bezierIndex > 0 ? progresses[bezierIndex - 1] : 0;
          finalProgress = finalProgress / curve.ratios[bezierIndex];
          pos = curve.beziers[bezierIndex].getPointAt(finalProgress);
        }

        results.push(pos);
        progress += speed;
      }
    } else {
      while (1 - progress > EPSILON) {
        finalProgress = progress;
        finalProgress = computeRatioByType(finalProgress, type);
        results.push(value.lerp(nextValue, finalProgress));
        progress += speed;
      }
    }

    newType = type === 'constant' ? type : DynamicAnimCurve.Linear;

    for (var j = 0, l2 = results.length; j < l2; j++) {
      var newRatio = ratio + startRatioOffset + speed * j * betweenRatio;
      addNewDatas(results[j], newType, newRatio);
    }

    if (Math.abs(progress - 1) > EPSILON) // progress > 1
      startRatioOffset = (progress - 1) * betweenRatio;else startRatioOffset = 0;
  }

  if (ratios[ratios.length - 1] !== newRatios[newRatios.length - 1]) {
    addNewDatas(values[values.length - 1], newType, ratios[ratios.length - 1]);
  }
}

if (CC_TEST) {
  cc._Test.sampleMotionPaths = sampleMotionPaths;
}

module.exports = {
  sampleMotionPaths: sampleMotionPaths,
  Curve: Curve,
  Bezier: Bezier
};
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_engine__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImVuZ2luZS1kZXZcXGNvY29zMmRcXGFuaW1hdGlvblxcbW90aW9uLXBhdGgtaGVscGVyLmpzIl0sIm5hbWVzIjpbIkR5bmFtaWNBbmltQ3VydmUiLCJyZXF1aXJlIiwiY29tcHV0ZVJhdGlvQnlUeXBlIiwiYmV6aWVyIiwiYmluYXJ5U2VhcmNoIiwiYmluYXJ5U2VhcmNoRXBzaWxvbiIsInYyIiwiY2MiLCJDdXJ2ZSIsInBvaW50cyIsImJlemllcnMiLCJyYXRpb3MiLCJwcm9ncmVzc2VzIiwibGVuZ3RoIiwiY29tcHV0ZUJlemllcnMiLCJwcm90b3R5cGUiLCJpIiwic3RhcnRQb2ludCIsImVuZFBvaW50IiwiQmV6aWVyIiwic3RhcnQiLCJwb3MiLCJzdGFydEN0cmxQb2ludCIsIm91dCIsImVuZCIsImVuZEN0cmxQb2ludCIsInB1c2giLCJnZXRMZW5ndGgiLCJjdXJyZW50IiwiZ2V0UG9pbnRBdCIsInUiLCJ0IiwiZ2V0VXRvVG1hcHBpbmciLCJnZXRQb2ludCIsIngiLCJ5IiwibGVuZ3RocyIsImdldExlbmd0aHMiLCJkaXZpc2lvbnMiLCJfX2FyY0xlbmd0aERpdmlzaW9ucyIsImNhY2hlQXJjTGVuZ3RocyIsImNhY2hlIiwibGFzdCIsInZlY3RvciIsInAiLCJzdW0iLCJtYWciLCJkaXN0YW5jZSIsImFyY0xlbmd0aHMiLCJpbCIsInRhcmdldEFyY0xlbmd0aCIsImxvdyIsImhpZ2giLCJjb21wYXJpc29uIiwiTWF0aCIsImZsb29yIiwibGVuZ3RoQmVmb3JlIiwibGVuZ3RoQWZ0ZXIiLCJzZWdtZW50TGVuZ3RoIiwic2VnbWVudEZyYWN0aW9uIiwiY2hlY2tNb3Rpb25QYXRoIiwibW90aW9uUGF0aCIsIkFycmF5IiwiaXNBcnJheSIsImwiLCJjb250cm9scyIsInNhbXBsZU1vdGlvblBhdGhzIiwibW90aW9uUGF0aHMiLCJkYXRhIiwiZHVyYXRpb24iLCJmcHMiLCJ0YXJnZXQiLCJjcmVhdGVDb250cm9sUG9pbnRzIiwiYXJyYXkiLCJWZWMyIiwiWkVSTyIsInZhbHVlcyIsIm1hcCIsInZhbHVlIiwidjMiLCJtb3Rpb25QYXRoVmFsaWQiLCJlcnJvcklEIiwibmFtZSIsInR5cGVzIiwibmV3VmFsdWVzIiwibmV3VHlwZXMiLCJuZXdSYXRpb3MiLCJhZGROZXdEYXRhcyIsInR5cGUiLCJyYXRpbyIsInN0YXJ0UmF0aW9PZmZzZXQiLCJFUFNJTE9OIiwibmV3VHlwZSIsIkxpbmVhciIsIm5leHRSYXRpbyIsImJldHdlZW5SYXRpbyIsIm5leHRWYWx1ZSIsInJlc3VsdHMiLCJwcm9ncmVzcyIsInNwZWVkIiwiZmluYWxQcm9ncmVzcyIsImoiLCJsMiIsImNvbnRyb2xQb2ludHMiLCJjdXJ2ZSIsIm5vcm1hbCIsInN1YiIsIm5vcm1hbGl6ZSIsImFkZCIsIm11bCIsImJlemllckluZGV4IiwibGVycCIsIm5ld1JhdGlvIiwiYWJzIiwiQ0NfVEVTVCIsIl9UZXN0IiwibW9kdWxlIiwiZXhwb3J0cyJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7OztBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBLElBQUlBLGdCQUFnQixHQUFHQyxPQUFPLENBQUMsb0JBQUQsQ0FBUCxDQUE4QkQsZ0JBQXJEOztBQUNBLElBQUlFLGtCQUFrQixHQUFHRCxPQUFPLENBQUMsb0JBQUQsQ0FBUCxDQUE4QkMsa0JBQXZEOztBQUVBLElBQUlDLE1BQU0sR0FBR0YsT0FBTyxDQUFDLFVBQUQsQ0FBUCxDQUFvQkUsTUFBakM7O0FBQ0EsSUFBSUMsWUFBWSxHQUFHSCxPQUFPLENBQUMsNkJBQUQsQ0FBUCxDQUF1Q0ksbUJBQTFEOztBQUVBLElBQUlDLEVBQUUsR0FBR0MsRUFBRSxDQUFDRCxFQUFaOztBQUVBLFNBQVNFLEtBQVQsQ0FBZ0JDLE1BQWhCLEVBQXdCO0FBQ3BCLE9BQUtBLE1BQUwsR0FBY0EsTUFB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WUFBcEMsQ0FESixLQUdJTCxnQkFBZ0IsR0FBRyxDQUFuQjtBQUNQOztBQUVELE1BQUkvRSxNQUFNLENBQUNBLE1BQU0sQ0FBQ0UsTUFBUCxHQUFnQixDQUFqQixDQUFOLEtBQThCeUUsU0FBUyxDQUFDQSxTQUFTLENBQUN6RSxNQUFWLEdBQWtCLENBQW5CLENBQTNDLEVBQWtFO0FBQzlEMEUsSUFBQUEsV0FBVyxDQUFDWCxNQUFNLENBQUNBLE1BQU0sQ0FBQy9ELE1BQVAsR0FBZ0IsQ0FBakIsQ0FBUCxFQUE0QitFLE9BQTVCLEVBQXFDakYsTUFBTSxDQUFDQSxNQUFNLENBQUNFLE1BQVAsR0FBZ0IsQ0FBakIsQ0FBM0MsQ0FBWDtBQUNIO0FBQ0o7O0FBRUQsSUFBSXFHLE9BQUosRUFBYTtBQUNUM0csRUFBQUEsRUFBRSxDQUFDNEcsS0FBSCxDQUFTakQsaUJBQVQsR0FBNkJBLGlCQUE3QjtBQUNIOztBQUVEa0QsTUFBTSxDQUFDQyxPQUFQLEdBQWlCO0FBQ2JuRCxFQUFBQSxpQkFBaUIsRUFBRUEsaUJBRE47QUFFYjFELEVBQUFBLEtBQUssRUFBRUEsS0FGTTtBQUdiVyxFQUFBQSxNQUFNLEVBQUVBO0FBSEssQ0FBakIiLCJzb3VyY2VzQ29udGVudCI6WyIvKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKlxyXG4gQ29weXJpZ2h0IChjKSAyMDE3LTIwMTggWGlhbWVuIFlhamkgU29mdHdhcmUgQ28uLCBMdGQuXHJcblxyXG4gaHR0cHM6Ly93d3cuY29jb3MuY29tL1xyXG5cclxuIFBlcm1pc3Npb24gaXMgaGVyZWJ5IGdyYW50ZWQsIGZyZWUgb2YgY2hhcmdlLCB0byBhbnkgcGVyc29uIG9idGFpbmluZyBhIGNvcHlcclxuIG9mIHRoaXMgc29mdHdhcmUgYW5kIGFzc29jaWF0ZWQgZW5naW5lIHNvdXJjZSBjb2RlICh0aGUgXCJTb2Z0d2FyZVwiKSwgYSBsaW1pdGVkLFxyXG4gd29ybGR3aWRlLCByb3lhbHR5LWZyZWUsIG5vbi1hc3NpZ25hYmxlLCByZXZvY2FibGUgYW5kIG5vbi1leGNsdXNpdmUgbGljZW5zZVxyXG4gdG8gdXNlIENvY29zIENyZWF0b3Igc29sZWx5IHRvIGRldmVsb3AgZ2FtZXMgb24geW91ciB0YXJnZXQgcGxhdGZvcm1zLiBZb3Ugc2hhbGxcclxuIG5vdCB1c2UgQ29jb3MgQ3JlYXRvciBzb2Z0d2FyZSBmb3IgZGV2ZWxvcGluZyBvdGhlciBzb2Z0d2FyZSBvciB0b29scyB0aGF0J3NcclxuIHVzZWQgZm9yIGRldmVsb3BpbmcgZ2FtZXMuIFlvdSBhcmUgbm90IGdyYW50ZWQgdG8gcHVibGlzaCwgZGlzdHJpYnV0ZSxcclxuIHN1YmxpY2Vuc2UsIGFuZC9vciBzZWxsIGNvcGllcyBvZiBDb2NvcyBDcmVhdG9yLlxyXG5cclxuIFRoZSBzb2Z0d2FyZSBvciB0b29scyBpbiB0aGlzIExpY2Vuc2UgQWdyZWVtZW50IGFyZSBsaWNlbnNlZCwgbm90IHNvbGQuXHJcbiBYaWFtZW4gWWFqaSBTb2Z0d2FyZSBDby4sIEx0ZC4gcmVzZXJ2ZXMgYWxsIHJpZ2h0cyBub3QgZXhwcmVzc2x5IGdyYW50ZWQgdG8geW91LlxyXG5cclxuIFRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCBcIkFTIElTXCIsIFdJVEhPVVQgV0FSUkFOVFkgT0YgQU5ZIEtJTkQsIEVYUFJFU1MgT1JcclxuIElNUExJRUQsIElOQ0xVRElORyBCVVQgTk9UIExJTUlURUQgVE8gVEhFIFdBUlJBTlRJRVMgT0YgTUVSQ0hBTlRBQklMSVRZLFxyXG4gRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UgQU5EIE5PTklORlJJTkdFTUVOVC4gSU4gTk8gRVZFTlQgU0hBTEwgVEhFXHJcbiBBVVRIT1JTIE9SIENPUFlSSUdIVCBIT0xERVJTIEJFIExJQUJMRSBGT1IgQU5ZIENMQUlNLCBEQU1BR0VTIE9SIE9USEVSXHJcbiBMSUFCSUxJVFksIFdIRVRIRVIgSU4gQU4gQUNUSU9OIE9GIENPTlRSQUNULCBUT1JUIE9SIE9USEVSV0lTRSwgQVJJU0lORyBGUk9NLFxyXG4gT1VUIE9GIE9SIElOIENPTk5FQ1RJT04gV0lUSCBUSEUgU09GVFdBUkUgT1IgVEhFIFVTRSBPUiBPVEhFUiBERUFMSU5HUyBJTlxyXG4gVEhFIFNPRlRXQVJFLlxyXG4gKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi9cclxuXHJcbnZhciBEeW5hbWljQW5pbUN1cnZlID0gcmVxdWlyZSgnLi9hbmltYXRpb24tY3VydmVzJykuRHluYW1pY0FuaW1DdXJ2ZTtcclxudmFyIGNvbXB1dGVSYXRpb0J5VHlwZSA9IHJlcXVpcmUoJy4vYW5pbWF0aW9uLWN1cnZlcycpLmNvbXB1dGVSYXRpb0J5VHlwZTtcclxuXHJcbnZhciBiZXppZXIgPSByZXF1aXJlKCcuL2JlemllcicpLmJlemllcjtcclxudmFyIGJpbmFyeVNlYXJjaCA9IHJlcXVpcmUoJy4uL2NvcmUvdXRpbHMvYmluYXJ5LXNlYXJjaCcpLmJpbmFyeVNlYXJjaEVwc2lsb247XHJcblxyXG52YXIgdjIgPSBjYy52MjtcclxuXHJcbmZ1bmN0aW9uIEN1cnZlIChwb2ludHMpIHtcclxuICAgIHRoaXMucG9pbnRzID0gcG9pbnRzIHx8IFtdO1xyXG4gICAgdGhpcy5iZXppZXJzID0gW107XHJcbiAgICB0aGlzLnJhdGlvcyA9IFtdO1xyXG4gICAgdGhpcy5wcm9ncmVzc2VzID0gW107XHJcblxyXG4gICAgdGhpcy5sZW5ndGggPSAwO1xyXG5cclxuICAgIHRoaXMuY29tcHV0ZUJlemllcnMoKTtcclxufVxyXG5DdXJ2ZS5wcm90b3R5cGUuY29tcHV0ZUJlemllcnMgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICB0aGlzLmJlemllcnMubGVuZ3RoID0gMDtcclxuICAgIHRoaXMucmF0aW9zLmxlbmd0aCA9IDA7XHJcbiAgICB0aGlzLnByb2dyZXNzZXMubGVuZ3RoID0gMDtcclxuICAgIHRoaXMubGVuZ3RoID0gMDtcclxuXHJcbiAgICB2YXIgYmV6aWVyO1xyXG5cclxuICAgIGZvciAodmFyIGkgPSAxOyBpIDwgdGhpcy5wb2ludHMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICB2YXIgc3RhcnRQb2ludCA9IHRoaXMucG9pbnRzW2kgLSAxXTtcclxuICAgICAgICB2YXIgZW5kUG9pbnQgPSB0aGlzLnBvaW50c1tpXTtcclxuICAgICAgICBiZXppZXIgPSBuZXcgQmV6aWVyKCk7XHJcbiAgICAgICAgYmV6aWVyLnN0YXJ0ID0gc3RhcnRQb2ludC5wb3M7XHJcbiAgICAgICAgYmV6aWVyLnN0YXJ0Q3RybFBvaW50ID0gc3RhcnRQb2ludC5vdXQ7XHJcbiAgICAgICAgYmV6aWVyLmVuZCA9IGVuZFBvaW50LnBvcztcclxuICAgICAgICBiZXppZXIuZW5kQ3RybFBvaW50ID0gZW5kUG9pbnQuaW47XHJcbiAgICAgICAgdGhpcy5iZXppZXJzLnB1c2goYmV6aWVyKTtcclxuXHJcbiAgICAgICAgdGhpcy5sZW5ndGggKz0gYmV6aWVyLmdldExlbmd0aCgpO1xyXG4gICAgfVxyXG5cclxuICAgIHZhciBjdXJyZW50ID0gMDtcclxuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5iZXppZXJzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgYmV6aWVyID0gdGhpcy5iZXppZXJzW2ldO1xyXG4gICAgICAgIHRoaXMucmF0aW9zW2ldID0gYmV6aWVyLmdldExlbmd0aCgpIC8gdGhpcy5sZW5ndGg7XHJcbiAgICAgICAgdGhpcy5wcm9ncmVzc2VzW2ldID0gY3VycmVudCA9IGN1cnJlbnQgKyB0aGlzLnJhdGlvc1tpXTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gdGhpcy5iZXppZXJzO1xyXG59O1xyXG5cclxuZnVuY3Rpb24gQmV6aWVyICgpIHtcclxuICAgIHRoaXMuc3RhcnQgPSB2MigpO1xyXG4gICAgdGhpcy5lbmQgPSB2MigpO1xyXG4gICAgdGhpcy5zdGFydEN0cmxQb2ludCA9IHYyKCk7IC8vIGNwMCwgY3AxXHJcbiAgICB0aGlzLmVuZEN0cmxQb2ludCA9IHYyKCk7ICAgLy8gY3AyLCBjcDNcclxufVxyXG5cclxuLy8gR2V0IHBvaW50IGF0IHJlbGF0aXZlIHBvc2l0aW9uIGluIGN1cnZlIGFjY29yZGluZyB0byBhcmMgbGVuZ3RoXHJcbi8vIC0gdSBbMCAuLiAxXVxyXG5CZXppZXIucHJvdG90eXBlLmdldFBvaW50QXQgPSBmdW5jdGlvbiAoIHUgKSB7XHJcbiAgICB2YXIgdCA9IHRoaXMuZ2V0VXRvVG1hcHBpbmcoIHUgKTtcclxuICAgIHJldHVybiB0aGlzLmdldFBvaW50KCB0ICk7XHJcbn07XHJcblxyXG5cclxuLy8gR2V0IHBvaW50IGF0IHRpbWUgdFxyXG4vLyAgLSB0IFswIC4uIDFdXHJcbkJlemllci5wcm90b3R5cGUuZ2V0UG9pbnQgPSBmdW5jdGlvbiAoIHQgKSB7XHJcbiAgICB2YXIgeCA9IGJlemllcih0aGlzLnN0YXJ0LngsIHRoaXMuc3RhcnRDdHJsUG9pbnQueCwgdGhpcy5lbmRDdHJsUG9pbnQueCwgdGhpcy5lbmQueCwgdCk7XHJcbiAgICB2YXIgeSA9IGJlemllcih0aGlzLnN0YXJ0LnksIHRoaXMuc3RhcnRDdHJsUG9pbnQueSwgdGhpcy5lbmRDdHJsUG9pbnQueSwgdGhpcy5lbmQueSwgdCk7XHJcblxyXG4gICAgcmV0dXJuIG5ldyB2Mih4LCB5KTtcclxufTtcclxuXHJcbi8vIEdldCB0b3RhbCBjdXJ2ZSBhcmMgbGVuZ3RoXHJcbkJlemllci5wcm90b3R5cGUuZ2V0TGVuZ3RoID0gZnVuY3Rpb24gKCkge1xyXG5cclxuICAgIHZhciBsZW5ndGhzID0gdGhpcy5nZXRMZW5ndGhzKCk7XHJcbiAgICByZXR1cm4gbGVuZ3Roc1sgbGVuZ3Rocy5sZW5ndGggLSAxIF07XHJcblxyXG59O1xyXG5cclxuLy8gR2V0IGxpc3Qgb2YgY3VtdWxhdGl2ZSBzZWdtZW50IGxlbmd0aHNcclxuQmV6aWVyLnByb3RvdHlwZS5nZXRMZW5ndGhzID0gZnVuY3Rpb24gKCBkaXZpc2lvbnMgKSB7XHJcblxyXG4gICAgaWYgKCAhIGRpdmlzaW9ucyApIGRpdmlzaW9ucyA9ICh0aGlzLl9fYXJjTGVuZ3RoRGl2aXNpb25zKSA/ICh0aGlzLl9fYXJjTGVuZ3RoRGl2aXNpb25zKTogMjAwO1xyXG5cclxuICAgIGlmICggdGhpcy5jYWNoZUFyY0xlbmd0aHNcclxuICAgICAgICAmJiAoIHRoaXMuY2FjaGVBcmNMZW5ndGhzLmxlbmd0aCA9PT0gZGl2aXNpb25zICsgMSApKSB7XHJcblxyXG4gICAgICAgIC8vY29uc29sZS5sb2coIFwiY2FjaGVkXCIsIHRoaXMuY2FjaGVBcmNMZW5ndGhzICk7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuY2FjaGVBcmNMZW5ndGhzO1xyXG5cclxuICAgIH1cclxuXHJcbiAgICB2YXIgY2FjaGUgPSBbXTtcclxuICAgIHZhciBjdXJyZW50LCBsYXN0ID0gdGhpcy5nZXRQb2ludCggMCApLCB2ZWN0b3IgPSB2MigpO1xyXG4gICAgdmFyIHAsIHN1bSA9IDA7XHJcblxyXG4gICAgY2FjaGUucHVzaCggMCApO1xyXG5cclxuICAgIGZvciAoIHAgPSAxOyBwIDw9IGRpdmlzaW9uczsgcCArKyApIHtcclxuXHJcbiAgICAgICAgY3VycmVudCA9IHRoaXMuZ2V0UG9pbnQgKCBwIC8gZGl2aXNpb25zICk7XHJcbiAgICAgICAgdmVjdG9yLnggPSBsYXN0LnggLSBjdXJyZW50Lng7XHJcbiAgICAgICAgdmVjdG9yLnkgPSBsYXN0LnkgLSBjdXJyZW50Lnk7XHJcbiAgICAgICAgc3VtICs9IHZlY3Rvci5tYWcoKTtcclxuICAgICAgICBjYWNoZS5wdXNoKCBzdW0gKTtcclxuICAgICAgICBsYXN0ID0gY3VycmVudDtcclxuXHJcbiAgICB9XHJcblxyXG4gICAgdGhpcy5jYWNoZUFyY0xlbmd0aHMgPSBjYWNoZTtcclxuXHJcbiAgICByZXR1cm4gY2FjaGU7IC8vIHsgc3VtczogY2FjaGUsIHN1bTpzdW0gfTsgU3VtIGlzIGluIHRoZSBsYXN0IGVsZW1lbnQuXHJcbn07XHJcblxyXG5CZXppZXIucHJvdG90eXBlLmdldFV0b1RtYXBwaW5nID0gZnVuY3Rpb24gKCB1LCBkaXN0YW5jZSApIHtcclxuXHJcbiAgICB2YXIgYXJjTGVuZ3RocyA9IHRoaXMuZ2V0TGVuZ3RocygpO1xyXG5cclxuICAgIHZhciBpID0gMCwgaWwgPSBhcmNMZW5ndGhzLmxlbmd0aDtcclxuXHJcbiAgICB2YXIgdGFyZ2V0QXJjTGVuZ3RoOyAvLyBUaGUgdGFyZ2V0ZWQgdSBkaXN0YW5jZSB2YWx1ZSB0byBnZXRcclxuXHJcbiAgICBpZiAoIGRpc3RhbmNlICkge1xyXG4gICAgICAgIHRhcmdldEFyY0xlbmd0aCA9IGRpc3RhbmNlO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgICB0YXJnZXRBcmNMZW5ndGggPSB1ICogYXJjTGVuZ3Roc1sgaWwgLSAxIF07XHJcbiAgICB9XHJcblxyXG4gICAgLy92YXIgdGltZSA9IERhdGUubm93KCk7XHJcblxyXG4gICAgLy8gYmluYXJ5IHNlYXJjaCBmb3IgdGhlIGluZGV4IHdpdGggbGFyZ2VzdCB2YWx1ZSBzbWFsbGVyIHRoYW4gdGFyZ2V0IHUgZGlzdGFuY2VcclxuXHJcbiAgICB2YXIgbG93ID0gMCwgaGlnaCA9IGlsIC0gMSwgY29tcGFyaXNvbjtcclxuXHJcbiAgICB3aGlsZSAoIGxvdyA8PSBoaWdoICkge1xyXG5cclxuICAgICAgICBpID0gTWF0aC5mbG9vciggbG93ICsgKCBoaWdoIC0gbG93ICkgLyAyICk7IC8vIGxlc3MgbGlrZWx5IHRvIG92ZXJmbG93LCB0aG91Z2ggcHJvYmFibHkgbm90IGlzc3VlIGhlcmUsIEpTIGRvZXNuJ3QgcmVhbGx5IGhhdmUgaW50ZWdlcnMsIGFsbCBudW1iZXJzIGFyZSBmbG9hdHNcclxuXHJcbiAgICAgICAgY29tcGFyaXNvbiA9IGFyY0xlbmd0aHNbIGkgXSAtIHRhcmdldEFyY0xlbmd0aDtcclxuXHJcbiAgICAgICAgaWYgKCBjb21wYXJpc29uIDwgMCApIHtcclxuXHJcbiAgICAgICAgICAgIGxvdyA9IGkgKyAxO1xyXG4gICAgICAgICAgICBjb250aW51ZTtcclxuXHJcbiAgICAgICAgfSBlbHNlIGlmICggY29tcGFyaXNvbiA+IDAgKSB7XHJcblxyXG4gICAgICAgICAgICBoaWdoID0gaSAtIDE7XHJcbiAgICAgICAgICAgIGNvbnRpbnVlO1xyXG5cclxuICAgICAgICB9IGVsc2Uge1xyXG5cclxuICAgICAgICAgICAgaGlnaCA9IGk7XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAgICAgLy8gRE9ORVxyXG5cclxuICAgICAgICB9XHJcblxyXG4gICAgfVxyXG5cclxuICAgIGkgPSBoaWdoO1xyXG5cclxuICAgIC8vY29uc29sZS5sb2coJ2InICwgaSwgbG93LCBoaWdoLCBEYXRlLm5vdygpLSB0aW1lKTtcclxuXHJcbiAgICBpZiAoIGFyY0xlbmd0aHNbIGkgXSA9PT0gdGFyZ2V0QXJjTGVuZ3RoICkge1xyXG5cclxuICAgICAgICB2YXIgdCA9IGkgLyAoIGlsIC0gMSApO1xyXG4gICAgICAgIHJldHVybiB0O1xyXG5cclxuICAgIH1cclxuXHJcbiAgICAvLyB3ZSBjb3VsZCBnZXQgZmluZXIgZ3JhaW4gYXQgbGVuZ3Rocywgb3IgdXNlIHNpbXBsZSBpbnRlcnBvbGF0YXRpb24gYmV0d2VlbiB0d28gcG9pbnRzXHJcblxyXG4gICAgdmFyIGxlbmd0aEJlZm9yZSA9IGFyY0xlbmd0aHNbIGkgXTtcclxuICAgIHZhciBsZW5ndGhBZnRlciA9IGFyY0xlbmd0aHNbIGkgKyAxIF07XHJcblxyXG4gICAgdmFyIHNlZ21lbnRMZW5ndGggPSBsZW5ndGhBZnRlciAtIGxlbmd0aEJlZm9yZTtcclxuXHJcbiAgICAvLyBkZXRlcm1pbmUgd2hlcmUgd2UgYXJlIGJldHdlZW4gdGhlICdiZWZvcmUnIGFuZCAnYWZ0ZXInIHBvaW50c1xyXG5cclxuICAgIHZhciBzZWdtZW50RnJhY3Rpb24gPSAoIHRhcmdldEFyY0xlbmd0aCAtIGxlbmd0aEJlZm9yZSApIC8gc2VnbWVudExlbmd0aDtcclxuXHJcbiAgICAvLyBhZGQgdGhhdCBmcmFjdGlvbmFsIGFtb3VudCB0byB0XHJcblxyXG4gICAgdmFyIHQgPSAoIGkgKyBzZWdtZW50RnJhY3Rpb24gKSAvICggaWwgLTEgKTtcclxuXHJcbiAgICByZXR1cm4gdDtcclxufTtcclxuXHJcblxyXG5mdW5jdGlvbiBjaGVja01vdGlvblBhdGgobW90aW9uUGF0aCkge1xyXG4gICAgaWYgKCFBcnJheS5pc0FycmF5KG1vdGlvblBhdGgpKSByZXR1cm4gZmFsc2U7XHJcblxyXG4gICAgZm9yIChsZXQgaSA9IDAsIGwgPSBtb3Rpb25QYXRoLmxlbmd0aDsgaSA8IGw7IGkrKykge1xyXG4gICAgICAgIGxldCBjb250cm9scyA9IG1vdGlvblBhdGhbaV07XHJcblxyXG4gICAgICAgIGlmICghQXJyYXkuaXNBcnJheShjb250cm9scykgfHwgY29udHJvbHMubGVuZ3RoICE9PSA2KSByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHRydWU7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHNhbXBsZU1vdGlvblBhdGhzIChtb3Rpb25QYXRocywgZGF0YSwgZHVyYXRpb24sIGZwcywgdGFyZ2V0KSB7XHJcblxyXG4gICAgZnVuY3Rpb24gY3JlYXRlQ29udHJvbFBvaW50cyhhcnJheSkge1xyXG4gICAgICAgIGlmIChhcnJheSBpbnN0YW5jZW9mIGNjLlZlYzIpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgICAgIGluOiBhcnJheSxcclxuICAgICAgICAgICAgICAgIHBvczogYXJyYXksXHJcbiAgICAgICAgICAgICAgICBvdXQ6IGFycmF5XHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2UgaWYgKEFycmF5LmlzQXJyYXkoYXJyYXkpICYmIGFycmF5Lmxlbmd0aCA9PT0gNikge1xyXG4gICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAgICAgaW46IHYyKGFycmF5WzJdLCBhcnJheVszXSksXHJcbiAgICAgICAgICAgICAgICBwb3M6IHYyKGFycmF5WzBdLCBhcnJheVsxXSksXHJcbiAgICAgICAgICAgICAgICBvdXQ6IHYyKGFycmF5WzRdLCBhcnJheVs1XSlcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIGluOiBjYy5WZWMyLlpFUk8sXHJcbiAgICAgICAgICAgIHBvczogY2MuVmVjMi5aRVJPLFxyXG4gICAgICAgICAgICBvdXQ6IGNjLlZlYzIuWkVST1xyXG4gICAgICAgIH07XHJcbiAgICB9XHJcblxyXG4gICAgbGV0IHZhbHVlcyA9IGRhdGEudmFsdWVzID0gZGF0YS52YWx1ZXMubWFwKGZ1bmN0aW9uICh2YWx1ZSkge1xyXG4gICAgICAgIGlmIChBcnJheS5pc0FycmF5KHZhbHVlKSkge1xyXG4gICAgICAgICAgICB2YWx1ZSA9IHZhbHVlLmxlbmd0aCA9PT0gMiA/IGNjLnYyKHZhbHVlWzBdLCB2YWx1ZVsxXSkgOiBjYy52Myh2YWx1ZVswXSwgdmFsdWVbMV0sIHZhbHVlWzJdKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHZhbHVlO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaWYgKG1vdGlvblBhdGhzLmxlbmd0aCA9PT0gMCB8fCB2YWx1ZXMubGVuZ3RoID09PSAwKSB7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG5cclxuICAgIGxldCBtb3Rpb25QYXRoVmFsaWQgPSBmYWxzZTtcclxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbW90aW9uUGF0aHMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICBsZXQgbW90aW9uUGF0aCA9IG1vdGlvblBhdGhzW2ldO1xyXG4gICAgICAgIGlmIChtb3Rpb25QYXRoICYmICFjaGVja01vdGlvblBhdGgobW90aW9uUGF0aCkpIHtcclxuICAgICAgICAgICAgY2MuZXJyb3JJRCgzOTA0LCB0YXJnZXQgPyB0YXJnZXQubmFtZSA6ICcnLCAncG9zaXRpb24nLCBpKTtcclxuICAgICAgICAgICAgbW90aW9uUGF0aCA9IG51bGw7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChtb3Rpb25QYXRoICYmIG1vdGlvblBhdGgubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICBtb3Rpb25QYXRoVmFsaWQgPSB0cnVlO1xyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKCFtb3Rpb25QYXRoVmFsaWQpIHtcclxuICAgICAgICByZXR1cm47XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKHZhbHVlcy5sZW5ndGggPT09IDEpIHtcclxuICAgICAgICByZXR1cm47XHJcbiAgICB9XHJcblxyXG4gICAgdmFyIHR5cGVzID0gZGF0YS50eXBlcztcclxuICAgIHZhciByYXRpb3MgPSBkYXRhLnJhdGlvcztcclxuXHJcbiAgICB2YXIgbmV3VmFsdWVzID0gZGF0YS52YWx1ZXMgPSBbXTtcclxuICAgIHZhciBuZXdUeXBlcyA9IGRhdGEudHlwZXMgPSBbXTtcclxuICAgIHZhciBuZXdSYXRpb3MgPSBkYXRhLnJhdGlvcyA9IFtdO1xyXG5cclxuICAgIGZ1bmN0aW9uIGFkZE5ld0RhdGFzICh2YWx1ZSwgdHlwZSwgcmF0aW8pIHtcclxuICAgICAgICBuZXdWYWx1ZXMucHVzaCh2YWx1ZSk7XHJcbiAgICAgICAgbmV3VHlwZXMucHVzaCh0eXBlKTtcclxuICAgICAgICBuZXdSYXRpb3MucHVzaChyYXRpbyk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gZW5zdXJlIGV2ZXJ5IHJhdGlvIHNlY3Rpb24ncyBsZW5ndGggaXMgdGhlIHNhbWVcclxuICAgIHZhciBzdGFydFJhdGlvT2Zmc2V0ID0gMDtcclxuXHJcbiAgICB2YXIgRVBTSUxPTiA9IDFlLTY7XHJcbiAgICB2YXIgbmV3VHlwZSA9IER5bmFtaWNBbmltQ3VydmUuTGluZWFyO1xyXG5cclxuICAgIC8vIGRvIG5vdCBuZWVkIHRvIGNvbXB1dGUgbGFzdCBwYXRoXHJcbiAgICBmb3IgKHZhciBpID0gMCwgbCA9IG1vdGlvblBhdGhzLmxlbmd0aDsgaSA8IGwtMTsgaSsrKSB7XHJcbiAgICAgICAgdmFyIG1vdGlvblBhdGggPSBtb3Rpb25QYXRoc1tpXTtcclxuXHJcbiAgICAgICAgdmFyIHJhdGlvID0gcmF0aW9zW2ldO1xyXG4gICAgICAgIHZhciBuZXh0UmF0aW8gPSByYXRpb3NbaSArIDFdO1xyXG4gICAgICAgIHZhciBiZXR3ZWVuUmF0aW8gPSBuZXh0UmF0aW8gLSByYXRpbztcclxuXHJcbiAgICAgICAgdmFyIHZhbHVlID0gdmFsdWVzW2ldO1xyXG4gICAgICAgIHZhciBuZXh0VmFsdWUgPSB2YWx1ZXNbaSArIDFdO1xyXG5cclxuICAgICAgICB2YXIgdHlwZSA9IHR5cGVzW2ldO1xyXG5cclxuICAgICAgICB2YXIgcmVzdWx0cyA9IFtdO1xyXG4gICAgICAgIHZhciBwcm9ncmVzcyA9IHN0YXJ0UmF0aW9PZmZzZXQgLyBiZXR3ZWVuUmF0aW87XHJcbiAgICAgICAgdmFyIHNwZWVkID0gMSAvIChiZXR3ZWVuUmF0aW8gKiBkdXJhdGlvbiAqIGZwcyk7XHJcbiAgICAgICAgdmFyIGZpbmFsUHJvZ3Jlc3M7XHJcblxyXG4gICAgICAgIGlmIChtb3Rpb25QYXRoICYmIG1vdGlvblBhdGgubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICB2YXIgcG9pbnRzID0gW107XHJcbiAgICAgICAgICAgIHBvaW50cy5wdXNoKGNyZWF0ZUNvbnRyb2xQb2ludHModmFsdWUpKTtcclxuXHJcbiAgICAgICAgICAgIGZvciAodmFyIGogPSAwLCBsMiA9IG1vdGlvblBhdGgubGVuZ3RoOyBqIDwgbDI7IGorKykge1xyXG4gICAgICAgICAgICAgICAgdmFyIGNvbnRyb2xQb2ludHMgPSBjcmVhdGVDb250cm9sUG9pbnRzKG1vdGlvblBhdGhbal0pO1xyXG4gICAgICAgICAgICAgICAgcG9pbnRzLnB1c2goY29udHJvbFBvaW50cyk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHBvaW50cy5wdXNoKGNyZWF0ZUNvbnRyb2xQb2ludHMobmV4dFZhbHVlKSk7XHJcblxyXG4gICAgICAgICAgICAvLyBjcmVhdGUgQ3VydmUgdG8gY29tcHV0ZSBiZXppZXJzXHJcbiAgICAgICAgICAgIHZhciBjdXJ2ZSA9IG5ldyBDdXJ2ZShwb2ludHMpO1xyXG4gICAgICAgICAgICBjdXJ2ZS5jb21wdXRlQmV6aWVycygpO1xyXG5cclxuICAgICAgICAgICAgLy8gc2FtcGxlIGJlemllcnNcclxuICAgICAgICAgICAgdmFyIHByb2dyZXNzZXMgPSBjdXJ2ZS5wcm9ncmVzc2VzO1xyXG5cclxuICAgICAgICAgICAgd2hpbGUgKCAxIC0gcHJvZ3Jlc3MgPiBFUFNJTE9OKSB7XHJcbiAgICAgICAgICAgICAgICBmaW5hbFByb2dyZXNzID0gcHJvZ3Jlc3M7XHJcblxyXG4gICAgICAgICAgICAgICAgZmluYWxQcm9ncmVzcyA9IGNvbXB1dGVSYXRpb0J5VHlwZShmaW5hbFByb2dyZXNzLCB0eXBlKTtcclxuXHJcbiAgICAgICAgICAgICAgICB2YXIgcG9zLCBiZXppZXIsIG5vcm1hbCwgbGVuZ3RoO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmIChmaW5hbFByb2dyZXNzIDwgMCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGJlemllciA9IGN1cnZlLmJlemllcnNbMF07XHJcbiAgICAgICAgICAgICAgICAgICAgbGVuZ3RoID0gICgwIC0gZmluYWxQcm9ncmVzcykgKiBiZXppZXIuZ2V0TGVuZ3RoKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgbm9ybWFsID0gYmV6aWVyLnN0YXJ0LnN1YihiZXppZXIuZW5kQ3RybFBvaW50KS5ub3JtYWxpemUoKTtcclxuICAgICAgICAgICAgICAgICAgICBwb3MgPSBiZXppZXIuc3RhcnQuYWRkKG5vcm1hbC5tdWwobGVuZ3RoKSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIGlmIChmaW5hbFByb2dyZXNzID4gMSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGJlemllciA9IGN1cnZlLmJlemllcnNbY3VydmUuYmV6aWVycy5sZW5ndGggLSAxXTtcclxuICAgICAgICAgICAgICAgICAgICBsZW5ndGggPSAgKGZpbmFsUHJvZ3Jlc3MgLSAxKSAqIGJlemllci5nZXRMZW5ndGgoKTtcclxuICAgICAgICAgICAgICAgICAgICBub3JtYWwgPSBiZXppZXIuZW5kLnN1YihiZXppZXIuc3RhcnRDdHJsUG9pbnQpLm5vcm1hbGl6ZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIHBvcyA9IGJlemllci5lbmQuYWRkKG5vcm1hbC5tdWwobGVuZ3RoKSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgYmV6aWVySW5kZXggPSBiaW5hcnlTZWFyY2gocHJvZ3Jlc3NlcywgZmluYWxQcm9ncmVzcyk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGJlemllckluZGV4IDwgMCkgYmV6aWVySW5kZXggPSB+YmV6aWVySW5kZXg7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGZpbmFsUHJvZ3Jlc3MgLT0gYmV6aWVySW5kZXggPiAwID8gcHJvZ3Jlc3Nlc1tiZXppZXJJbmRleCAtIDFdIDogMDtcclxuICAgICAgICAgICAgICAgICAgICBmaW5hbFByb2dyZXNzID0gZmluYWxQcm9ncmVzcyAvIGN1cnZlLnJhdGlvc1tiZXppZXJJbmRleF07XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHBvcyA9IGN1cnZlLmJlemllcnNbYmV6aWVySW5kZXhdLmdldFBvaW50QXQoZmluYWxQcm9ncmVzcyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgcmVzdWx0cy5wdXNoKHBvcyk7XHJcbiAgICAgICAgICAgICAgICBwcm9ncmVzcyArPSBzcGVlZDtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHdoaWxlICggMSAtIHByb2dyZXNzID4gRVBTSUxPTikge1xyXG4gICAgICAgICAgICAgICAgZmluYWxQcm9ncmVzcyA9IHByb2dyZXNzO1xyXG5cclxuICAgICAgICAgICAgICAgIGZpbmFsUHJvZ3Jlc3MgPSBjb21wdXRlUmF0aW9CeVR5cGUoZmluYWxQcm9ncmVzcywgdHlwZSk7XHJcblxyXG4gICAgICAgICAgICAgICAgcmVzdWx0cy5wdXNoKHZhbHVlLmxlcnAobmV4dFZhbHVlLCBmaW5hbFByb2dyZXNzKSk7XHJcblxyXG4gICAgICAgICAgICAgICAgcHJvZ3Jlc3MgKz0gc3BlZWQ7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIG5ld1R5cGUgPSB0eXBlID09PSAnY29uc3RhbnQnID8gdHlwZSA6IER5bmFtaWNBbmltQ3VydmUuTGluZWFyO1xyXG5cclxuICAgICAgICBmb3IgKHZhciBqID0gMCwgbDIgPSByZXN1bHRzLmxlbmd0aDsgaiA8IGwyOyBqKyspIHtcclxuICAgICAgICAgICAgdmFyIG5ld1JhdGlvID0gcmF0aW8gKyBzdGFydFJhdGlvT2Zmc2V0ICsgc3BlZWQgKiBqICogYmV0d2VlblJhdGlvO1xyXG4gICAgICAgICAgICBhZGROZXdEYXRhcyhyZXN1bHRzW2pdLCBuZXdUeXBlLCBuZXdSYXRpbyk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAoTWF0aC5hYnMocHJvZ3Jlc3MgLSAxKSA+IEVQU0lMT04pIC8vIHByb2dyZXNzID4gMVxyXG4gICAgICAgICAgICBzdGFydFJhdGlvT2Zmc2V0ID0gKHByb2dyZXNzIC0gMSkgKiBiZXR3ZWVuUmF0aW87XHJcbiAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICBzdGFydFJhdGlvT2Zmc2V0ID0gMDtcclxuICAgIH1cclxuXHJcbiAgICBpZiAocmF0aW9zW3JhdGlvcy5sZW5ndGggLSAxXSAhPT0gbmV3UmF0aW9zW25ld1JhdGlvcy5sZW5ndGggLTFdKSB7XHJcbiAgICAgICAgYWRkTmV3RGF0YXModmFsdWVzW3ZhbHVlcy5sZW5ndGggLSAxXSwgbmV3VHlwZSwgcmF0aW9zW3JhdGlvcy5sZW5ndGggLSAxXSk7XHJcbiAgICB9XHJcbn1cclxuXHJcbmlmIChDQ19URVNUKSB7XHJcbiAgICBjYy5fVGVzdC5zYW1wbGVNb3Rpb25QYXRocyA9IHNhbXBsZU1vdGlvblBhdGhzO1xyXG59XHJcblxyXG5tb2R1bGUuZXhwb3J0cyA9IHtcclxuICAgIHNhbXBsZU1vdGlvblBhdGhzOiBzYW1wbGVNb3Rpb25QYXRocyxcclxuICAgIEN1cnZlOiBDdXJ2ZSxcclxuICAgIEJlemllcjogQmV6aWVyXHJcbn07XHJcbiJdLCJzb3VyY2VSb290IjoiLyJ9