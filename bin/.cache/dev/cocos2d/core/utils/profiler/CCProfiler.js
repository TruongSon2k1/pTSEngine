
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'engine-dev/cocos2d/core/utils/profiler/CCProfiler.js';
                    var __require = nodeEnv ? function (request) {
                        return require(request);
                    } : function (request) {
                        return __quick_compile_engine__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_engine__.registerModule(__filename, module);}"use strict";

/****************************************************************************
 Copyright (c) 2013-2016 Chukong Technologies Inc.
 Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.

 https://www.cocos.com/

 Permission is hereby granted, free of charge, to any person obtaining a copy
 of this software and associated engine source code (the "Software"), a limited,
  worldwide, royalty-free, non-assignable, revocable and non-exclusive license
 to use Cocos Creator solely to develop games on your target platforms. You shall
  not use Cocos Creator software for developing other software or tools that's
  used for developing games. You are not granted to publish, distribute,
  sublicense, and/or sell copies of Cocos Creator.

 The software or tools in this License Agreement are licensed, not sold.
 Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.

 THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 THE SOFTWARE.
 ****************************************************************************/
var macro = require('../../platform/CCMacro');

var PerfCounter = require('./perf-counter');

var _showFPS = false;
var _fontSize = 15;
var _stats = null;
var _rootNode = null;
var _label = null;

function generateStats() {
  if (_stats) return;
  _stats = {
    fps: {
      desc: 'Framerate (FPS)',
      below: 30,
      average: 500
    },
    draws: {
      desc: 'Draw Call'
    },
    frame: {
      desc: 'Frame time (ms)',
      min: 0,
      max: 50,
      average: 500
    },
    logic: {
      desc: 'Game Logic (ms)',
      min: 0,
      max: 50,
      average: 500,
      color: '#080'
    },
    render: {
      desc: 'Renderer (ms)',
      min: 0,
      max: 50,
      average: 500,
      color: '#f90'
    },
    mode: {
      desc: cc.game.renderType === cc.game.RENDER_TYPE_WEBGL ? 'WebGL' : 'Canvas',
      min: 1
    }
  };
  var now = performance.now();

  for (var id in _stats) {
    _stats[id]._counter = new PerfCounter(id, _stats[id], now);
  }
}

function generateNode() {
  if (_rootNode && _rootNode.isValid) return;
  _rootNode = new cc.Node('PROFILER-NODE');
  _rootNode.x = _rootNode.y = 10;
  _rootNode.groupIndex = cc.Node.BuiltinGroupIndex.DEBUG;

  cc.Camera._setupDebugCamera();

  _rootNode.zIndex = macro.MAX_ZINDEX;
  cc.game.addPersistRootNode(_rootNode);
  var left = new cc.Node('LEFT-PANEL');
  left.anchorX = left.anchorY = 0;
  var leftLabel = left.addComponent(cc.Label);
  leftLabel.fontSize = _fontSize;
  leftLabel.lineHeight = _fontSize;
  left.parent = _rootNode;
  var right = new cc.Node('RIGHT-PANEL');
  right.anchorX = 1;
  right.anchorY = 0;
  right.x = 200;
  var rightLabel = right.addComponent(cc.Label);
  rightLabel.horizontalAlign = cc.Label.HorizontalAlign.RIGHT;
  rightLabel.fontSize = _fontSize;
  rightLabel.lineHeight = _fontSize;
  right.parent = _rootNode;

  if (cc.sys.platform !== cc.sys.BAIDU_GAME_SUB && cc.sys.platform !== cc.sys.WECHAT_GAME_SUB) {
    leftLabel.cacheMode = cc.Label.CacheMode.CHAR;
    rightLabel.cacheMode = cc.Label.CacheMode.CHAR;
  }

  _label = {
    left: leftLabel,
    right: rightLabel
  };
}

function beforeUpdate() {
  generateNode();
  var now = cc.director._lastUpdate;

  _stats['frame']._counter.start(now);

  _stats['logic']._counter.start(now);
}

function afterUpdate() {
  var now = performance.now();

  if (cc.director.isPaused()) {
    _stats['frame']._counter.start(now);
  } else {
    _stats['logic']._counter.end(now);
  }

  _stats['render']._counter.start(now);
}

function updateLabel(stat) {
  var length = 20;
  var desc = stat.desc;
  var value = stat._counter.human() + '';
  stat.label.string = stat.desc + '  ' + stat._counter.human();
}

function afterDraw() {
  var now = performance.now();

  _stats['render']._counter.end(now);

  _stats['draws']._counter.value = cc.renderer.drawCalls;

  _stats['frame']._counter.end(now);

  _stats['fps']._counter.frame(now);

  var left = '';
  var right = '';

  for (var id in _stats) {
    var stat = _stats[id];

    stat._counter.sample(now);

    left += stat.desc + '\n';
    right += stat._counter.human() + '\n';
  }

  if (_label) {
    _label.left.string = left;
    _label.right.string = right;
  }
}

cc.profiler = module.exports = {
  isShowingStats: function isShowingStats() {
    return _showFPS;
  },
  hideStats: function hideStats() {
    if (_showFPS) {
      if (_rootNode) {
        _rootNode.active = false;
      }

      cc.director.off(cc.Director.EVENT_BEFORE_UPDATE, beforeUpdate);
      cc.director.off(cc.Director.EVENT_AFTER_UPDATE, afterUpdate);
      cc.director.off(cc.Director.EVENT_AFTER_DRAW, afterDraw);
      _showFPS = false;
    }
  },
  showStats: function showStats() {
    if (!_showFPS) {
      generateStats();

      if (_rootNode) {
        _rootNode.active = true;
      }

      cc.director.on(cc.Director.EVENT_BEFORE_UPDATE, beforeUpdate);
      cc.director.on(cc.Director.EVENT_AFTER_UPDATE, afterUpdate);
      cc.director.on(cc.Director.EVENT_AFTER_DRAW, afterDraw);
      _showFPS = true;
    }
  }
};
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_engine__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImVuZ2luZS1kZXZcXGNvY29zMmRcXGNvcmVcXHV0aWxzXFxwcm9maWxlclxcQ0NQcm9maWxlci5qcyJdLCJuYW1lcyI6WyJtYWNybyIsInJlcXVpcmUiLCJQZXJmQ291bnRlciIsIl9zaG93RlBTIiwiX2ZvbnRTaXplIiwiX3N0YXRzIiwiX3Jvb3ROb2RlIiwiX2xhYmVsIiwiZ2VuZXJhdGVTdGF0cyIsImZwcyIsImRlc2MiLCJiZWxvdyIsImF2ZXJhZ2UiLCJkcmF3cyIsImZyYW1lIiwibWluIiwibWF4IiwibG9naWMiLCJjb2xvciIsInJlbmRlciIsIm1vZGUiLCJjYyIsImdhbWUiLCJyZW5kZXJUeXBlIiwiUkVOREVSX1RZUEVfV0VCR0wiLCJub3ciLCJwZXJmb3JtYW5jZSIsImlkIiwiX2NvdW50ZXIiLCJnZW5lcmF0ZU5vZGUiLCJpc1ZhbGlkIiwiTm9kZSIsIngiLCJ5IiwiZ3JvdXBJbmRleCIsIkJ1aWx0aW5Hcm91cEluZGV4IiwiREVCVUciLCJDYW1lcmEiLCJfc2V0dXBEZWJ1Z0NhbWVyYSIsInpJbmRleCIsIk1BWF9aSU5ERVgiLCJhZGRQZXJzaXN0Um9vdE5vZGUiLCJsZWZ0IiwiYW5jaG9yWCIsImFuY2hvclkiLCJsZWZ0TGFiZWwiLCJhZGRDb21wb25lbnQiLCJMYWJlbCIsImZvbnRTaXplIiwibGluZUhlaWdodCIsInBhcmVudCIsInJpZ2h0IiwicmlnaHRMYWJlbCIsImhvcml6b250YWxBbGlnbiIsIkhvcml6b250YWxBbGlnbiIsIlJJR0hUIiwic3lzIiwicGxhdGZvcm0iLCJCQUlEVV9HQU1FX1NVQiIsIldFQ0hBVF9HQU1FX1NVQiIsImNhY2hlTW9kZSIsIkNhY2hlTW9kZSIsIkNIQVIiLCJiZWZvcmVVcGRhdGUiLCJkaXJlY3RvciIsIl9sYXN0VXBkYXRlIiwic3RhcnQiLCJhZnRlclVwZGF0ZSIsImlzUGF1c2VkIiwiZW5kIiwidXBkYXRlTGFiZWwiLCJzdGF0IiwibGVuZ3RoIiwidmFsdWUiLCJodW1hbiIsImxhYmVsIiwic3RyaW5nIiwiYWZ0ZXJEcmF3IiwicmVuZGVyZXIiLCJkcmF3Q2FsbHMiLCJzYW1wbGUiLCJwcm9maWxlciIsIm1vZHVsZSIsImV4cG9ydHMiLCJpc1Nob3dpbmdTdGF0cyIsImhpZGVTdGF0cyIsImFjdGl2ZSIsIm9mZiIsIkRpcmVjdG9yIiwiRVZFTlRfQkVGT1JFX1VQREFURSIsIkVWRU5UX0FGVEVSX1VQREFURSIsIkVWRU5UX0FGVEVSX0RSQVciLCJzaG93U3RhdHMiLCJvbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7OztBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUEsSUFBSUEsS0FBSyxHQUFHQyxPQUFPLENBQUMsd0JBQUQsQ0FBbkI7O0FBRUEsSUFBTUMsV0FBVyxHQUFHRCxPQUFPLENBQUMsZ0JBQUQsQ0FBM0I7O0FBRUEsSUFBSUUsUUFBUSxHQUFHLEtBQWY7QUFDQSxJQUFJQyxTQUFTLEdBQUcsRUFBaEI7QUFFQSxJQUFJQyxNQUFNLEdBQUcsSUFBYjtBQUNBLElBQUlDLFNBQVMsR0FBRyxJQUFoQjtBQUNBLElBQUlDLE1BQU0sR0FBRyxJQUFiOztBQUVBLFNBQVNDLGFBQVQsR0FBMEI7QUFDdEIsTUFBSUgsTUFBSixFQUFZO0FBRVpBLEVBQUFBLE1BQU0sR0FBRztBQUNMSSxJQUFBQSxHQUFHLEVBQUU7QUFBRUMsTUFBQUEsSUFBSSxFQUFFLGlCQUFSO0FBQTJCQyxNQUFBQSxLQUFLLEVBQUUsRUFBbEM7QUFBc0NDLE1BQUFBLE9BQU8sRUFBRTtBQUEvQyxLQURBO0FBRUxDLElBQUFBLEtBQUssRUFBRTtBQUFFSCxNQUFBQSxJQUFJLEVBQUU7QUFBUixLQUZGO0FBR0xJLElBQUFBLEtBQUssRUFBRTtBQUFFSixNQUFBQSxJQUFJLEVBQUUsaUJBQVI7QUFBMkJLLE1BQUFBLEdBQUcsRUFBRSxDQUFoQztB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QUFBLEVBQUUsQ0FBQzJDLFFBQUgsQ0FBWXVCLEdBQVosQ0FBZ0JsRSxFQUFFLENBQUNtRSxRQUFILENBQVlFLGtCQUE1QixFQUFnRHZCLFdBQWhEO0FBQ0E5QyxNQUFBQSxFQUFFLENBQUMyQyxRQUFILENBQVl1QixHQUFaLENBQWdCbEUsRUFBRSxDQUFDbUUsUUFBSCxDQUFZRyxnQkFBNUIsRUFBOENkLFNBQTlDO0FBQ0ExRSxNQUFBQSxRQUFRLEdBQUcsS0FBWDtBQUNIO0FBQ0osR0FoQjBCO0FBa0IzQnlGLEVBQUFBLFNBbEIyQix1QkFrQmQ7QUFDVCxRQUFJLENBQUN6RixRQUFMLEVBQWU7QUFDWEssTUFBQUEsYUFBYTs7QUFFYixVQUFJRixTQUFKLEVBQWU7QUFDWEEsUUFBQUEsU0FBUyxDQUFDZ0YsTUFBVixHQUFtQixJQUFuQjtBQUNIOztBQUVEakUsTUFBQUEsRUFBRSxDQUFDMkMsUUFBSCxDQUFZNkIsRUFBWixDQUFleEUsRUFBRSxDQUFDbUUsUUFBSCxDQUFZQyxtQkFBM0IsRUFBZ0QxQixZQUFoRDtBQUNBMUMsTUFBQUEsRUFBRSxDQUFDMkMsUUFBSCxDQUFZNkIsRUFBWixDQUFleEUsRUFBRSxDQUFDbUUsUUFBSCxDQUFZRSxrQkFBM0IsRUFBK0N2QixXQUEvQztBQUNBOUMsTUFBQUEsRUFBRSxDQUFDMkMsUUFBSCxDQUFZNkIsRUFBWixDQUFleEUsRUFBRSxDQUFDbUUsUUFBSCxDQUFZRyxnQkFBM0IsRUFBNkNkLFNBQTdDO0FBQ0ExRSxNQUFBQSxRQUFRLEdBQUcsSUFBWDtBQUNIO0FBQ0o7QUEvQjBCLENBQS9CIiwic291cmNlc0NvbnRlbnQiOlsiLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKipcclxuIENvcHlyaWdodCAoYykgMjAxMy0yMDE2IENodWtvbmcgVGVjaG5vbG9naWVzIEluYy5cclxuIENvcHlyaWdodCAoYykgMjAxNy0yMDE4IFhpYW1lbiBZYWppIFNvZnR3YXJlIENvLiwgTHRkLlxyXG5cclxuIGh0dHBzOi8vd3d3LmNvY29zLmNvbS9cclxuXHJcbiBQZXJtaXNzaW9uIGlzIGhlcmVieSBncmFudGVkLCBmcmVlIG9mIGNoYXJnZSwgdG8gYW55IHBlcnNvbiBvYnRhaW5pbmcgYSBjb3B5XHJcbiBvZiB0aGlzIHNvZnR3YXJlIGFuZCBhc3NvY2lhdGVkIGVuZ2luZSBzb3VyY2UgY29kZSAodGhlIFwiU29mdHdhcmVcIiksIGEgbGltaXRlZCxcclxuICB3b3JsZHdpZGUsIHJveWFsdHktZnJlZSwgbm9uLWFzc2lnbmFibGUsIHJldm9jYWJsZSBhbmQgbm9uLWV4Y2x1c2l2ZSBsaWNlbnNlXHJcbiB0byB1c2UgQ29jb3MgQ3JlYXRvciBzb2xlbHkgdG8gZGV2ZWxvcCBnYW1lcyBvbiB5b3VyIHRhcmdldCBwbGF0Zm9ybXMuIFlvdSBzaGFsbFxyXG4gIG5vdCB1c2UgQ29jb3MgQ3JlYXRvciBzb2Z0d2FyZSBmb3IgZGV2ZWxvcGluZyBvdGhlciBzb2Z0d2FyZSBvciB0b29scyB0aGF0J3NcclxuICB1c2VkIGZvciBkZXZlbG9waW5nIGdhbWVzLiBZb3UgYXJlIG5vdCBncmFudGVkIHRvIHB1Ymxpc2gsIGRpc3RyaWJ1dGUsXHJcbiAgc3VibGljZW5zZSwgYW5kL29yIHNlbGwgY29waWVzIG9mIENvY29zIENyZWF0b3IuXHJcblxyXG4gVGhlIHNvZnR3YXJlIG9yIHRvb2xzIGluIHRoaXMgTGljZW5zZSBBZ3JlZW1lbnQgYXJlIGxpY2Vuc2VkLCBub3Qgc29sZC5cclxuIFhpYW1lbiBZYWppIFNvZnR3YXJlIENvLiwgTHRkLiByZXNlcnZlcyBhbGwgcmlnaHRzIG5vdCBleHByZXNzbHkgZ3JhbnRlZCB0byB5b3UuXHJcblxyXG4gVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEIFwiQVMgSVNcIiwgV0lUSE9VVCBXQVJSQU5UWSBPRiBBTlkgS0lORCwgRVhQUkVTUyBPUlxyXG4gSU1QTElFRCwgSU5DTFVESU5HIEJVVCBOT1QgTElNSVRFRCBUTyBUSEUgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFksXHJcbiBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBTkQgTk9OSU5GUklOR0VNRU5ULiBJTiBOTyBFVkVOVCBTSEFMTCBUSEVcclxuIEFVVEhPUlMgT1IgQ09QWVJJR0hUIEhPTERFUlMgQkUgTElBQkxFIEZPUiBBTlkgQ0xBSU0sIERBTUFHRVMgT1IgT1RIRVJcclxuIExJQUJJTElUWSwgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIFRPUlQgT1IgT1RIRVJXSVNFLCBBUklTSU5HIEZST00sXHJcbiBPVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRSBTT0ZUV0FSRSBPUiBUSEUgVVNFIE9SIE9USEVSIERFQUxJTkdTIElOXHJcbiBUSEUgU09GVFdBUkUuXHJcbiAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqL1xyXG5cclxudmFyIG1hY3JvID0gcmVxdWlyZSgnLi4vLi4vcGxhdGZvcm0vQ0NNYWNybycpO1xyXG5cclxuY29uc3QgUGVyZkNvdW50ZXIgPSByZXF1aXJlKCcuL3BlcmYtY291bnRlcicpO1xyXG5cclxubGV0IF9zaG93RlBTID0gZmFsc2U7XHJcbmxldCBfZm9udFNpemUgPSAxNTtcclxuXHJcbmxldCBfc3RhdHMgPSBudWxsO1xyXG5sZXQgX3Jvb3ROb2RlID0gbnVsbDtcclxubGV0IF9sYWJlbCA9IG51bGw7XHJcblxyXG5mdW5jdGlvbiBnZW5lcmF0ZVN0YXRzICgpIHtcclxuICAgIGlmIChfc3RhdHMpIHJldHVybjtcclxuICAgIFxyXG4gICAgX3N0YXRzID0ge1xyXG4gICAgICAgIGZwczogeyBkZXNjOiAnRnJhbWVyYXRlIChGUFMpJywgYmVsb3c6IDMwLCBhdmVyYWdlOiA1MDAgfSxcclxuICAgICAgICBkcmF3czogeyBkZXNjOiAnRHJhdyBDYWxsJyB9LFxyXG4gICAgICAgIGZyYW1lOiB7IGRlc2M6ICdGcmFtZSB0aW1lIChtcyknLCBtaW46IDAsIG1heDogNTAsIGF2ZXJhZ2U6IDUwMCB9LFxyXG4gICAgICAgIGxvZ2ljOiB7IGRlc2M6ICdHYW1lIExvZ2ljIChtcyknLCBtaW46IDAsIG1heDogNTAsIGF2ZXJhZ2U6IDUwMCwgY29sb3I6ICcjMDgwJyB9LFxyXG4gICAgICAgIHJlbmRlcjogeyBkZXNjOiAnUmVuZGVyZXIgKG1zKScsIG1pbjogMCwgbWF4OiA1MCwgYXZlcmFnZTogNTAwLCBjb2xvcjogJyNmOTAnIH0sXHJcbiAgICAgICAgbW9kZTogeyBkZXNjOiBjYy5nYW1lLnJlbmRlclR5cGUgPT09IGNjLmdhbWUuUkVOREVSX1RZUEVfV0VCR0wgPyAnV2ViR0wnIDogJ0NhbnZhcycsIG1pbjogMSB9XHJcbiAgICB9O1xyXG5cclxuICAgIGxldCBub3cgPSBwZXJmb3JtYW5jZS5ub3coKTtcclxuICAgIGZvciAobGV0IGlkIGluIF9zdGF0cykge1xyXG4gICAgICAgIF9zdGF0c1tpZF0uX2NvdW50ZXIgPSBuZXcgUGVyZkNvdW50ZXIoaWQsIF9zdGF0c1tpZF0sIG5vdyk7XHJcbiAgICB9XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGdlbmVyYXRlTm9kZSAoKSB7XHJcbiAgICBpZiAoX3Jvb3ROb2RlICYmIF9yb290Tm9kZS5pc1ZhbGlkKSByZXR1cm47XHJcblxyXG5cclxuICAgIF9yb290Tm9kZSA9IG5ldyBjYy5Ob2RlKCdQUk9GSUxFUi1OT0RFJyk7XHJcbiAgICBfcm9vdE5vZGUueCA9IF9yb290Tm9kZS55ID0gMTA7XHJcblxyXG4gICAgX3Jvb3ROb2RlLmdyb3VwSW5kZXggPSBjYy5Ob2RlLkJ1aWx0aW5Hcm91cEluZGV4LkRFQlVHO1xyXG4gICAgY2MuQ2FtZXJhLl9zZXR1cERlYnVnQ2FtZXJhKCk7XHJcblxyXG4gICAgX3Jvb3ROb2RlLnpJbmRleCA9IG1hY3JvLk1BWF9aSU5ERVg7XHJcbiAgICBjYy5nYW1lLmFkZFBlcnNpc3RSb290Tm9kZShfcm9vdE5vZGUpO1xyXG5cclxuICAgIGxldCBsZWZ0ID0gbmV3IGNjLk5vZGUoJ0xFRlQtUEFORUwnKTtcclxuICAgIGxlZnQuYW5jaG9yWCA9IGxlZnQuYW5jaG9yWSA9IDA7XHJcbiAgICBsZXQgbGVmdExhYmVsID0gbGVmdC5hZGRDb21wb25lbnQoY2MuTGFiZWwpO1xyXG4gICAgbGVmdExhYmVsLmZvbnRTaXplID0gX2ZvbnRTaXplO1xyXG4gICAgbGVmdExhYmVsLmxpbmVIZWlnaHQgPSBfZm9udFNpemU7XHJcbiAgICBsZWZ0LnBhcmVudCA9IF9yb290Tm9kZTtcclxuXHJcbiAgICBsZXQgcmlnaHQgPSBuZXcgY2MuTm9kZSgnUklHSFQtUEFORUwnKTtcclxuICAgIHJpZ2h0LmFuY2hvclggPSAxO1xyXG4gICAgcmlnaHQuYW5jaG9yWSA9IDA7XHJcbiAgICByaWdodC54ID0gMjAwO1xyXG4gICAgbGV0IHJpZ2h0TGFiZWwgPSByaWdodC5hZGRDb21wb25lbnQoY2MuTGFiZWwpO1xyXG4gICAgcmlnaHRMYWJlbC5ob3Jpem9udGFsQWxpZ24gPSBjYy5MYWJlbC5Ib3Jpem9udGFsQWxpZ24uUklHSFQ7XHJcbiAgICByaWdodExhYmVsLmZvbnRTaXplID0gX2ZvbnRTaXplO1xyXG4gICAgcmlnaHRMYWJlbC5saW5lSGVpZ2h0ID0gX2ZvbnRTaXplO1xyXG4gICAgcmlnaHQucGFyZW50ID0gX3Jvb3ROb2RlO1xyXG4gICAgaWYgKGNjLnN5cy5wbGF0Zm9ybSAhPT0gY2Muc3lzLkJBSURVX0dBTUVfU1VCICYmXHJcbiAgICAgICAgY2Muc3lzLnBsYXRmb3JtICE9PSBjYy5zeXMuV0VDSEFUX0dBTUVfU1VCKSB7XHJcbiAgICAgICAgbGVmdExhYmVsLmNhY2hlTW9kZSA9IGNjLkxhYmVsLkNhY2hlTW9kZS5DSEFSO1xyXG4gICAgICAgIHJpZ2h0TGFiZWwuY2FjaGVNb2RlID0gY2MuTGFiZWwuQ2FjaGVNb2RlLkNIQVI7XHJcbiAgICB9XHJcblxyXG4gICAgX2xhYmVsID0ge1xyXG4gICAgICAgIGxlZnQ6IGxlZnRMYWJlbCxcclxuICAgICAgICByaWdodDogcmlnaHRMYWJlbFxyXG4gICAgfTtcclxufVxyXG5cclxuZnVuY3Rpb24gYmVmb3JlVXBkYXRlICgpIHtcclxuICAgIGdlbmVyYXRlTm9kZSgpO1xyXG5cclxuICAgIGxldCBub3cgPSBjYy5kaXJlY3Rvci5fbGFzdFVwZGF0ZTtcclxuICAgIF9zdGF0c1snZnJhbWUnXS5fY291bnRlci5zdGFydChub3cpO1xyXG4gICAgX3N0YXRzWydsb2dpYyddLl9jb3VudGVyLnN0YXJ0KG5vdyk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGFmdGVyVXBkYXRlICgpIHtcclxuICAgIGxldCBub3cgPSBwZXJmb3JtYW5jZS5ub3coKTtcclxuICAgIGlmIChjYy5kaXJlY3Rvci5pc1BhdXNlZCgpKSB7XHJcbiAgICAgICAgX3N0YXRzWydmcmFtZSddLl9jb3VudGVyLnN0YXJ0KG5vdyk7XHJcbiAgICB9XHJcbiAgICBlbHNlIHtcclxuICAgICAgICBfc3RhdHNbJ2xvZ2ljJ10uX2NvdW50ZXIuZW5kKG5vdyk7XHJcbiAgICB9XHJcbiAgICBfc3RhdHNbJ3JlbmRlciddLl9jb3VudGVyLnN0YXJ0KG5vdyk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHVwZGF0ZUxhYmVsIChzdGF0KSB7XHJcbiAgICBsZXQgbGVuZ3RoID0gMjA7XHJcbiAgICBsZXQgZGVzYyA9IHN0YXQuZGVzYztcclxuICAgIGxldCB2YWx1ZSA9IHN0YXQuX2NvdW50ZXIuaHVtYW4oKSArICcnO1xyXG4gICAgc3RhdC5sYWJlbC5zdHJpbmcgPSBzdGF0LmRlc2MgKyAnICAnICsgc3RhdC5fY291bnRlci5odW1hbigpO1xyXG59XHJcblxyXG5mdW5jdGlvbiBhZnRlckRyYXcgKCkge1xyXG4gICAgbGV0IG5vdyA9IHBlcmZvcm1hbmNlLm5vdygpO1xyXG4gICAgX3N0YXRzWydyZW5kZXInXS5fY291bnRlci5lbmQobm93KTtcclxuICAgIF9zdGF0c1snZHJhd3MnXS5fY291bnRlci52YWx1ZSA9IGNjLnJlbmRlcmVyLmRyYXdDYWxscztcclxuICAgIF9zdGF0c1snZnJhbWUnXS5fY291bnRlci5lbmQobm93KTtcclxuICAgIF9zdGF0c1snZnBzJ10uX2NvdW50ZXIuZnJhbWUobm93KTtcclxuICAgIFxyXG4gICAgbGV0IGxlZnQgPSAnJztcclxuICAgIGxldCByaWdodCA9ICcnO1xyXG4gICAgZm9yIChsZXQgaWQgaW4gX3N0YXRzKSB7XHJcbiAgICAgICAgbGV0IHN0YXQgPSBfc3RhdHNbaWRdO1xyXG4gICAgICAgIHN0YXQuX2NvdW50ZXIuc2FtcGxlKG5vdyk7XHJcblxyXG4gICAgICAgIGxlZnQgKz0gc3RhdC5kZXNjICsgJ1xcbic7XHJcbiAgICAgICAgcmlnaHQgKz0gc3RhdC5fY291bnRlci5odW1hbigpICsgJ1xcbic7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKF9sYWJlbCkge1xyXG4gICAgICAgIF9sYWJlbC5sZWZ0LnN0cmluZyA9IGxlZnQ7XHJcbiAgICAgICAgX2xhYmVsLnJpZ2h0LnN0cmluZyA9IHJpZ2h0O1xyXG4gICAgfVxyXG59XHJcblxyXG5jYy5wcm9maWxlciA9IG1vZHVsZS5leHBvcnRzID0ge1xyXG4gICAgaXNTaG93aW5nU3RhdHMgKCkge1xyXG4gICAgICAgIHJldHVybiBfc2hvd0ZQUztcclxuICAgIH0sXHJcblxyXG4gICAgaGlkZVN0YXRzICgpIHtcclxuICAgICAgICBpZiAoX3Nob3dGUFMpIHtcclxuICAgICAgICAgICAgaWYgKF9yb290Tm9kZSkge1xyXG4gICAgICAgICAgICAgICAgX3Jvb3ROb2RlLmFjdGl2ZSA9IGZhbHNlO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBjYy5kaXJlY3Rvci5vZmYoY2MuRGlyZWN0b3IuRVZFTlRfQkVGT1JFX1VQREFURSwgYmVmb3JlVXBkYXRlKTtcclxuICAgICAgICAgICAgY2MuZGlyZWN0b3Iub2ZmKGNjLkRpcmVjdG9yLkVWRU5UX0FGVEVSX1VQREFURSwgYWZ0ZXJVcGRhdGUpO1xyXG4gICAgICAgICAgICBjYy5kaXJlY3Rvci5vZmYoY2MuRGlyZWN0b3IuRVZFTlRfQUZURVJfRFJBVywgYWZ0ZXJEcmF3KTtcclxuICAgICAgICAgICAgX3Nob3dGUFMgPSBmYWxzZTtcclxuICAgICAgICB9XHJcbiAgICB9LFxyXG5cclxuICAgIHNob3dTdGF0cyAoKSB7XHJcbiAgICAgICAgaWYgKCFfc2hvd0ZQUykge1xyXG4gICAgICAgICAgICBnZW5lcmF0ZVN0YXRzKCk7XHJcblxyXG4gICAgICAgICAgICBpZiAoX3Jvb3ROb2RlKSB7XHJcbiAgICAgICAgICAgICAgICBfcm9vdE5vZGUuYWN0aXZlID0gdHJ1ZTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgY2MuZGlyZWN0b3Iub24oY2MuRGlyZWN0b3IuRVZFTlRfQkVGT1JFX1VQREFURSwgYmVmb3JlVXBkYXRlKTtcclxuICAgICAgICAgICAgY2MuZGlyZWN0b3Iub24oY2MuRGlyZWN0b3IuRVZFTlRfQUZURVJfVVBEQVRFLCBhZnRlclVwZGF0ZSk7XHJcbiAgICAgICAgICAgIGNjLmRpcmVjdG9yLm9uKGNjLkRpcmVjdG9yLkVWRU5UX0FGVEVSX0RSQVcsIGFmdGVyRHJhdyk7XHJcbiAgICAgICAgICAgIF9zaG93RlBTID0gdHJ1ZTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuIl0sInNvdXJjZVJvb3QiOiIvIn0=