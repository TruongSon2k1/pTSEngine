
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'engine-dev/cocos2d/core/utils/text-utils.js';
                    var __require = nodeEnv ? function (request) {
                        return require(request);
                    } : function (request) {
                        return __quick_compile_engine__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_engine__.registerModule(__filename, module);}"use strict";

var _js = _interopRequireDefault(require("../platform/js"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { "default": obj }; }

/****************************************************************************
 Copyright (c) 2013-2016 Chukong Technologies Inc.
 Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.

 https://www.cocos.com/

 Permission is hereby granted, free of charge, to any person obtaining a copy
 of this software and associated engine source code (the "Software"), a limited,
 worldwide, royalty-free, non-assignable, revocable and non-exclusive license
 to use Cocos Creator solely to develop games on your target platforms. You shall
 not use Cocos Creator software for developing other software or tools that's
 used for developing games. You are not granted to publish, distribute,
 sublicense, and/or sell copies of Cocos Creator.

 The software or tools in this License Agreement are licensed, not sold.
 Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.

 THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 THE SOFTWARE.
 ****************************************************************************/
// Draw text the textBaseline ratio (Can adjust the appropriate baseline ratio based on the platform)
var _BASELINE_RATIO = 0.26;
var _BASELINE_OFFSET = 0;

if (CC_RUNTIME) {
  _BASELINE_OFFSET = _BASELINE_RATIO * 2 / 3;
}

var MAX_CACHE_SIZE = 100;
var pool = new _js["default"].Pool(2);

pool.get = function () {
  var node = this._get() || {
    key: null,
    value: null,
    prev: null,
    next: null
  };
  return node;
};

function LRUCache(size) {
  this.count = 0;
  this.limit = size;
  this.datas = {};
  this.head = null;
  this.tail = null;
}

LRUCache.prototype.moveToHead = function (node) {
  node.next = this.head;
  node.prev = null;
  if (this.head !== null) this.head.prev = node;
  this.head = node;
  if (this.tail === null) this.tail = node;
  this.count++;
  this.datas[node.key] = node;
};

LRUCache.prototype.put = function (key, value) {
  var node = pool.get();
  node.key = key;
  node.value = value;

  if (this.count >= this.limit) {
    var discard = this.tail;
    delete this.datas[discard.key];
    this.count--;
    this.tail = discard.prev;
    this.tail.next = null;
    discard.prev = null;
    discard.next = null;
    pool.put(discard);
  }

  this.moveToHead(node);
};

LRUCache.prototype.remove = function (node) {
  if (node.prev !== null) {
    node.prev.next = node.next;
  } else {
    this.head = node.next;
  }

  if (node.next !== null) {
    node.next.prev = node.prev;
  } else {
    this.tail = node.prev;
  }

  delete this.datas[node.key];
  this.count--;
};

LRUCache.prototype.get = function (key) {
  var node = this.datas[key];

  if (node) {
    this.remove(node);
    this.moveToHead(node);
    return node.value;
  }

  return null;
};

LRUCache.prototype.clear = function () {
  this.count = 0;
  this.datas = {};
  this.head = null;
  this.tail = null;
};

LRUCache.prototype.has = function (key) {
  return !!this.datas[key];
};

LRUCache.prototype["delete"] = function (key) {
  var node = this.datas[key];
  this.remove(node);
};

var measureCache = new LRUCache(MAX_CACHE_SIZE);
var textUtils = {
  BASELINE_RATIO: _BASELINE_RATIO,
  MIDDLE_RATIO: (_BASELINE_RATIO + 1) / 2 - _BASELINE_RATIO,
  BASELINE_OFFSET: _BASELINE_OFFSET,
  label_wordRex: /([a-zA-Z0-9Ã„Ã–ÃœÃ¤Ã¶Ã¼ÃŸÃ©Ã¨Ã§Ã Ã¹ÃªÃ¢Ã®Ã´Ã»Ð°-ÑÐ-Ð¯ÐÑ‘]+|\S)/,
  label_symbolRex: /^[!,.:;'}\]%\?>ã€â€˜â€œã€‹ï¼Ÿã€‚ï¼Œï¼]/,
  label_lastWordRex: /([a-zA-Z0-9Ã„Ã–ÃœÃ¤Ã¶Ã¼ÃŸÃ©Ã¨Ã§Ã Ã¹ÃªÃ¢Ã®Ã´Ã»Ð°Ã­Ã¬ÃÃŒÃ¯ÃÃ€Ã¡Ã Ã‰ÃˆÃ’Ã“Ã²Ã³ÅÅ‘Ã™ÃšÅ°ÃºÅ±Ã±Ã‘Ã¦Ã†Å“Å’ÃƒÃ‚Ã£Ã”ÃµÄ›Å¡ÄÅ™Å¾Ã½Ã¡Ã­Ã©Ã³ÃºÅ¯Å¥ÄÅˆÄšÅ ÄŒÅ˜Å½ÃÃÃ‰Ã“ÃšÅ¤Å¼ÅºÅ›Ã³Å„Å‚Ä™Ä‡Ä…Å»Å¹ÅšÃ“ÅƒÅÄ˜Ä†Ä„-ÑÐ-Ð¯ÐÑ‘]+|\S)$/,
  label_lastEnglish: /[a-zA-Z0-9Ã„Ã–ÃœÃ¤Ã¶Ã¼ÃŸÃ©Ã¨Ã§Ã Ã¹ÃªÃ¢Ã®Ã´Ã»Ð°Ã­Ã¬ÃÃŒÃ¯ÃÃ€Ã¡Ã Ã‰ÃˆÃ’Ã“Ã²Ã³ÅÅ‘Ã™ÃšÅ°ÃºÅ±Ã±Ã‘Ã¦Ã†Å“Å’ÃƒÃ‚Ã£Ã”ÃµÄ›Å¡ÄÅ™Å¾Ã½Ã¡Ã­Ã©Ã³ÃºÅ¯Å¥ÄÅˆÄšÅ ÄŒÅ˜Å½ÃÃÃ‰Ã“ÃšÅ¤Å¼ÅºÅ›Ã³Å„Å‚Ä™Ä‡Ä…Å»Å¹ÅšÃ“ÅƒÅÄ˜Ä†Ä„-ÑÐ-Ð¯ÐÑ‘]+$/,
  label_firstEnglish: /^[a-zA-Z0-9Ã„Ã–ÃœÃ¤Ã¶Ã¼ÃŸÃ©Ã¨Ã§Ã Ã¹ÃªÃ¢Ã®Ã´Ã»Ð°Ã­Ã¬ÃÃŒÃ¯ÃÃ€Ã¡Ã Ã‰ÃˆÃ’Ã“Ã²Ã³ÅÅ‘Ã™ÃšÅ°ÃºÅ±Ã±Ã‘Ã¦Ã†Å“Å’ÃƒÃ‚Ã£Ã”ÃµÄ›Å¡ÄÅ™Å¾Ã½Ã¡Ã­Ã©Ã³ÃºÅ¯Å¥ÄÅˆÄšÅ ÄŒÅ˜Å½ÃÃÃ‰Ã“ÃšÅ¤Å¼ÅºÅ›Ã³Å„Å‚Ä™Ä‡Ä…Å»Å¹ÅšÃ“ÅƒÅÄ˜Ä†Ä„-ÑÐ-Ð¯ÐÑ‘]/,
  // The unicode standard will never assign a character from code point 0xD800 to 0xDFFF
  // high surrogate (0xD800-0xDBFF) and low surrogate(0xDC00-0xDFFF) combines to a character on the Supplementary Multilingual Plane
  // reference: https://en.wikipedia.org/wiki/UTF-16
  highSurrogateRex: /[\uD800-\uDBFF]/,
  lowSurrogateRex: /[\uDC00-\uDFFF]/,
  label_wrapinspection: true,
  __CHINESE_REG: /^[\u4E00-\u9FFF\u3400-\u4DFF]+$/,
  __JAPANESE_REG: /[\u3000-\u303F]|[\u3040-\u309F]|[\u30A0-\u30FF]|[\uFF00-\uFFEF]|[\u4E00-\u9FAF]|[\u2605-\u2606]|[\u2190-\u2195]|\u203B/g,
  __KOREAN_REG: /^[\u1100-\u11FF]|[\u3130-\u318F]|[\uA960-\uA97F]|[\uAC00-\uD7AF]|[\uD7B0-\uD7FF]+$/,
  isUnicodeCJK: function isUnicodeCJK(ch) {
    return this.__CHINESE_REG.test(ch) || this.__JAPANESE_REG.test(ch) || this.__KOREAN_REG.test(ch);
  },
  //Checking whether the character is a whitespace
  isUnicodeSpace: function isUnicodeSpace(ch) {
    ch = ch.charCodeAt(0);
    return ch >= 9 && ch <= 13 || ch === 32 || ch === 133 || ch === 160 || ch === 5760 || ch >= 8192 && ch <= 8202 || ch === 8232 || ch === 8233 || ch === 8239 || ch === 8287 || ch === 12288;
  },
  safeMeasureText: function safeMeasureText(ctx, string, desc) {
    var font = desc || ctx.font;
    var key = font + "\uD83C\uDFAE" + string;
    var cache = measureCache.get(key);

    if (cache !== null) {
      return cache;
    }

    var metric = ctx.measureText(string);
    var width = metric && metric.width || 0;
    measureCache.put(key, width);
    return width;
  },
  // in case truncate a character on the Supplementary Multilingual Plane
  // test case: a = 'ðŸ˜‰ðŸš—'
  // _safeSubstring(a, 1) === 'ðŸ˜‰ðŸš—'
  // _safeSubstring(a, 0, 1) === 'ðŸ˜‰'
  // _safeSubstring(a, 0, 2) === 'ðŸ˜‰'
  // _safeSubstring(a, 0, 3) === 'ðŸ˜‰'
  // _safeSubstring(a, 0, 4) === 'ðŸ˜‰ðŸš—'
  // _safeSubstring(a, 1, 2) === _safeSubstring(a, 1, 3) === 'ðŸ˜‰'
  // _safeSubstring(a, 2, 3) === _safeSubstring(a, 2, 4) === 'ðŸš—'
  _safeSubstring: function _safeSubstring(targetString, startIndex, endIndex) {
    var newStartIndex = startIndex,
        newEndIndex = endIndex;
    var startChar = targetString[startIndex];

    if (this.lowSurrogateRex.test(startChar)) {
      newStartIndex--;
    }

    if (endIndex !== undefined) {
      if (endIndex - 1 !== startIndex) {
        var endChar = targetString[endIndex - 1];

        if (this.highSurrogateRex.test(endChar)) {
          newEndIndex--;
        }
      } else if (this.highSurrogateRex.test(startChar)) {
        newEndIndex++;
      }
    }

    return targetString.substring(newStartIndex, newEndIndex);
  },
  fragmentText: function fragmentText(stringToken, allWidth, maxWidth, measureText) {
    //check the first character
    var wrappedWords = []; //fast return if strArr is empty

    if (stringToken.length === 0 || maxWidth < 0) {
      wrappedWords.push('');
      return wrappedWords;
    }

    var text = stringToken;

    while (allWidth > maxWidth && text.length > 1) {
      var fuzzyLen = text.length * (maxWidth / allWidth) | 0;

      var tmpText = this._safeSubstring(text, fuzzyLen);

      var width = allWidth - measureText(tmpText);
      var sLine = tmpText;
      var pushNum = 0;
      var checkWhile = 0;
      var checkCount = 10; //Exceeded the size

      while (width > maxWidth && checkWhile++ < checkCount) {
        fuzzyLen *= maxWidth / width;
        fuzzyLen = fuzzyLen | 0;
        tmpText = this._safeSubstring(text, fuzzyLen);
        width = allWidth - measureText(tmpText);
      }

      checkWhile = 0; //Find the truncation point

      while (width <= maxWidth && checkWhile++ < checkCount) {
        if (tmpText) {
          var exec = this.label_wordRex.exec(tmpText);
          pushNum = exec ? exec[0].length : 1;
          sLine = tmpText;
        }

        fuzzyLen = fuzzyLen + pushNum;
        tmpText = this._safeSubstring(text, fuzzyLen);
        width = allWidth - measureText(tmpText);
      }

      fuzzyLen -= pushNum; // in case maxWidth cannot contain any characters, need at least one character per line

      if (fuzzyLen === 0) {
        fuzzyLen = 1;
        sLine = this._safeSubstring(text, 1);
      } else if (fuzzyLen === 1 && this.highSurrogateRex.test(text[0])) {
        fuzzyLen = 2;
        sLine = this._safeSubstring(text, 2);
      }

      var sText = this._safeSubstring(text, 0, fuzzyLen),
          result; //symbol in the first


      if (this.label_wrapinspection) {
        if (this.label_symbolRex.test(sLine || tmpText)) {
          result = this.label_lastWordRex.exec(sText);
          fuzzyLen -= result ? result[0].length : 0;
          if (fuzzyLen === 0) fuzzyLen = 1;
          sLine = this._safeSubstring(text, fuzzyLen);
          sText = this._safeSubstring(text, 0, fuzzyLen);
        }
      } //To judge whether a English words are truncated


      if (this.label_firstEnglish.test(sLine)) {
        result = this.label_lastEnglish.exec(sText);

        if (result && sText !== result[0]) {
          fuzzyLen -= result[0].length;
          sLine = this._safeSubstring(text, fuzzyLen);
          sText = this._safeSubstring(text, 0, fuzzyLen);
        }
      } // The first line And do not wrap should not remove the space


      if (wrappedWords.length === 0) {
        wrappedWords.push(sText);
      } else {
        sText = sText.trimLeft();

        if (sText.length > 0) {
          wrappedWords.push(sText);
        }
      }

      text = sLine || tmpText;
      allWidth = measureText(text);
    }

    if (wrappedWords.length === 0) {
      wrappedWords.push(text);
    } else {
      text = text.trimLeft();

      if (text.length > 0) {
        wrappedWords.push(text);
      }
    }

    return wrappedWords;
  }
};
cc.textUtils = module.exports = textUtils;
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_engine__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImVuZ2luZS1kZXZcXGNvY29zMmRcXGNvcmVcXHV0aWxzXFx0ZXh0LXV0aWxzLmpzIl0sIm5hbWVzIjpbIl9CQVNFTElORV9SQVRJTyIsIl9CQVNFTElORV9PRkZTRVQiLCJDQ19SVU5USU1FIiwiTUFYX0NBQ0hFX1NJWkUiLCJwb29sIiwianMiLCJQb29sIiwiZ2V0Iiwibm9kZSIsIl9nZXQiLCJrZXkiLCJ2YWx1ZSIsInByZXYiLCJuZXh0IiwiTFJVQ2FjaGUiLCJzaXplIiwiY291bnQiLCJsaW1pdCIsImRhdGFzIiwiaGVhZCIsInRhaWwiLCJwcm90b3R5cGUiLCJtb3ZlVG9IZWFkIiwicHV0IiwiZGlzY2FyZCIsInJlbW92ZSIsImNsZWFyIiwiaGFzIiwibWVhc3VyZUNhY2hlIiwidGV4dFV0aWxzIiwiQkFTRUxJTkVfUkFUSU8iLCJNSURETEVfUkFUSU8iLCJCQVNFTElORV9PRkZTRVQiLCJsYWJlbF93b3JkUmV4IiwibGFiZWxfc3ltYm9sUmV4IiwibGFiZWxfbGFzdFdvcmRSZXgiLCJsYWJlbF9sYXN0RW5nbGlzaCIsImxhYmVsX2ZpcnN0RW5nbGlzaCIsImhpZ2hTdXJyb2dhdGVSZXgiLCJsb3dTdXJyb2dhdGVSZXgiLCJsYWJlbF93cmFwaW5zcGVjdGlvbiIsIl9fQ0hJTkVTRV9SRUciLCJfX0pBUEFORVNFX1JFRyIsIl9fS09SRUFOX1JFRyIsImlzVW5pY29kZUNKSyIsImNoIiwidGVzdCIsImlzVW5pY29kZVNwYWNlIiwiY2hhckNvZGVBdCIsInNhZmVNZWFzdXJlVGV4dCIsImN0eCIsInN0cmluZyIsImRlc2MiLCJmb250IiwiY2FjaGUiLCJtZXRyaWMiLCJtZWFzdXJlVGV4dCIsIndpZHRoIiwiX3NhZmVTdWJzdHJpbmciLCJ0YXJnZXRTdHJpbmciLCJzdGFydEluZGV4IiwiZW5kSW5kZXgiLCJuZXdTdGFydEluZGV4IiwibmV3RW5kSW5kZXgiLCJzdGFydENoYXIiLCJ1bmRlZmluZWQiLCJlbmRDaGFyIiwic3Vic3RyaW5nIiwiZnJhZ21lbnRUZXh0Iiwic3RyaW5nVG9rZW4iLCJhbGxXaWR0aCIsIm1heFdpZHRoIiwid3JhcHBlZFdvcmRzIiwibGVuZ3RoIiwicHVzaCIsInRleHQiLCJmdXp6eUxlbiIsInRtcFRleHQiLCJzTGluZSIsInB1c2hOdW0iLCJjaGVja1doaWxlIiwiY2hlY2tDb3VudCIsImV4ZWMiLCJzVGV4dCIsInJlc3VsdCIsInRyaW1MZWZ0IiwiY2MiLCJtb2R1bGUiLCJleHBvcnRzIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7O0FBMEJBOzs7O0FBMUJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSUE7QUFDQSxJQUFJQSxlQUFlLEdBQUcsSUFBdEI7QUFDQSxJQUFJQyxnQkFBZ0IsR0FBRyxDQUF2Qjs7QUFDQSxJQUFJQyxVQUFKLEVBQWdCO0FBQ1pELEVBQUFBLGdCQUFnQixHQUFHRCxlQUFlLEdBQUcsQ0FBbEIsR0FBc0IsQ0FBekM7QUFDSDs7QUFFRCxJQUFNRyxjQUFjLEdBQUcsR0FBdkI7QUFFQSxJQUFJQyxJQUFJLEdBQUcsSUFBSUMsZUFBR0MsSUFBUCxDQUFZLENBQVosQ0FBWDs7QUFDQUYsSUFBSSxDQUFDRyxHQUFMLEdBQVcsWUFBWTtBQUNuQixNQUFJQyxJQUFJLEdBQUcsS0FBS0MsSUFBTCxNQUFlO0FBQ3RCQyxJQUFBQSxHQUFHLEVBQUUsSUFEaUI7QUFFdEJDLElBQUFBLEtBQUssRUFBRSxJQUZlO0FBR3RCQyxJQUFBQSxJQUFJLEVBQUUsSUFIZ0I7QUFJdEJDLElBQUFBLElBQUksRUFBRTtBQUpnQixHQUExQjtBQU9BLFNBQU9MLElBQVA7QUFDSCxDQVREOztBQVdBLFNBQVNNLFFBQVQsQ0FBa0JDLElBQWxCLEVBQXdCO0FBQ3BCLE9BQUtDLEtBQUwsR0FBYSxDQUFiO0FBQ0EsT0FBS0MsS0FBTCxHQUFhRixJQUFiO0FB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LENBQW9CaUIsSUFBcEIsRUFBMEIsQ0FBMUIsRUFBNkJDLFFBQTdCLENBQVI7QUFDSDtBQUNKLE9BbkUwQyxDQXFFM0M7OztBQUNBLFVBQUlKLFlBQVksQ0FBQ0MsTUFBYixLQUF3QixDQUE1QixFQUErQjtBQUMzQkQsUUFBQUEsWUFBWSxDQUFDRSxJQUFiLENBQWtCUyxLQUFsQjtBQUNILE9BRkQsTUFHSztBQUNEQSxRQUFBQSxLQUFLLEdBQUdBLEtBQUssQ0FBQ0UsUUFBTixFQUFSOztBQUNBLFlBQUlGLEtBQUssQ0FBQ1YsTUFBTixHQUFlLENBQW5CLEVBQXNCO0FBQ2xCRCxVQUFBQSxZQUFZLENBQUNFLElBQWIsQ0FBa0JTLEtBQWxCO0FBQ0g7QUFDSjs7QUFDRFIsTUFBQUEsSUFBSSxHQUFHRyxLQUFLLElBQUlELE9BQWhCO0FBQ0FQLE1BQUFBLFFBQVEsR0FBR2QsV0FBVyxDQUFDbUIsSUFBRCxDQUF0QjtBQUNIOztBQUVELFFBQUlILFlBQVksQ0FBQ0MsTUFBYixLQUF3QixDQUE1QixFQUErQjtBQUMzQkQsTUFBQUEsWUFBWSxDQUFDRSxJQUFiLENBQWtCQyxJQUFsQjtBQUNILEtBRkQsTUFHSztBQUNEQSxNQUFBQSxJQUFJLEdBQUdBLElBQUksQ0FBQ1UsUUFBTCxFQUFQOztBQUNBLFVBQUlWLElBQUksQ0FBQ0YsTUFBTCxHQUFjLENBQWxCLEVBQXFCO0FBQ2pCRCxRQUFBQSxZQUFZLENBQUNFLElBQWIsQ0FBa0JDLElBQWxCO0FBQ0g7QUFDSjs7QUFDRCxXQUFPSCxZQUFQO0FBQ0g7QUFuTFcsQ0FBaEI7QUFzTEFjLEVBQUUsQ0FBQ3pELFNBQUgsR0FBZTBELE1BQU0sQ0FBQ0MsT0FBUCxHQUFpQjNELFNBQWhDIiwic291cmNlc0NvbnRlbnQiOlsiLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKipcclxuIENvcHlyaWdodCAoYykgMjAxMy0yMDE2IENodWtvbmcgVGVjaG5vbG9naWVzIEluYy5cclxuIENvcHlyaWdodCAoYykgMjAxNy0yMDE4IFhpYW1lbiBZYWppIFNvZnR3YXJlIENvLiwgTHRkLlxyXG5cclxuIGh0dHBzOi8vd3d3LmNvY29zLmNvbS9cclxuXHJcbiBQZXJtaXNzaW9uIGlzIGhlcmVieSBncmFudGVkLCBmcmVlIG9mIGNoYXJnZSwgdG8gYW55IHBlcnNvbiBvYnRhaW5pbmcgYSBjb3B5XHJcbiBvZiB0aGlzIHNvZnR3YXJlIGFuZCBhc3NvY2lhdGVkIGVuZ2luZSBzb3VyY2UgY29kZSAodGhlIFwiU29mdHdhcmVcIiksIGEgbGltaXRlZCxcclxuIHdvcmxkd2lkZSwgcm95YWx0eS1mcmVlLCBub24tYXNzaWduYWJsZSwgcmV2b2NhYmxlIGFuZCBub24tZXhjbHVzaXZlIGxpY2Vuc2VcclxuIHRvIHVzZSBDb2NvcyBDcmVhdG9yIHNvbGVseSB0byBkZXZlbG9wIGdhbWVzIG9uIHlvdXIgdGFyZ2V0IHBsYXRmb3Jtcy4gWW91IHNoYWxsXHJcbiBub3QgdXNlIENvY29zIENyZWF0b3Igc29mdHdhcmUgZm9yIGRldmVsb3Bpbmcgb3RoZXIgc29mdHdhcmUgb3IgdG9vbHMgdGhhdCdzXHJcbiB1c2VkIGZvciBkZXZlbG9waW5nIGdhbWVzLiBZb3UgYXJlIG5vdCBncmFudGVkIHRvIHB1Ymxpc2gsIGRpc3RyaWJ1dGUsXHJcbiBzdWJsaWNlbnNlLCBhbmQvb3Igc2VsbCBjb3BpZXMgb2YgQ29jb3MgQ3JlYXRvci5cclxuXHJcbiBUaGUgc29mdHdhcmUgb3IgdG9vbHMgaW4gdGhpcyBMaWNlbnNlIEFncmVlbWVudCBhcmUgbGljZW5zZWQsIG5vdCBzb2xkLlxyXG4gWGlhbWVuIFlhamkgU29mdHdhcmUgQ28uLCBMdGQuIHJlc2VydmVzIGFsbCByaWdodHMgbm90IGV4cHJlc3NseSBncmFudGVkIHRvIHlvdS5cclxuXHJcbiBUSEUgU09GVFdBUkUgSVMgUFJPVklERUQgXCJBUyBJU1wiLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELCBFWFBSRVNTIE9SXHJcbiBJTVBMSUVELCBJTkNMVURJTkcgQlVUIE5PVCBMSU1JVEVEIFRPIFRIRSBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSxcclxuIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFORCBOT05JTkZSSU5HRU1FTlQuIElOIE5PIEVWRU5UIFNIQUxMIFRIRVxyXG4gQVVUSE9SUyBPUiBDT1BZUklHSFQgSE9MREVSUyBCRSBMSUFCTEUgRk9SIEFOWSBDTEFJTSwgREFNQUdFUyBPUiBPVEhFUlxyXG4gTElBQklMSVRZLCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwgVE9SVCBPUiBPVEhFUldJU0UsIEFSSVNJTkcgRlJPTSxcclxuIE9VVCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFIFNPRlRXQVJFIE9SIFRIRSBVU0UgT1IgT1RIRVIgREVBTElOR1MgSU5cclxuIFRIRSBTT0ZUV0FSRS5cclxuICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovXHJcblxyXG5pbXBvcnQganMgZnJvbSAnLi4vcGxhdGZvcm0vanMnXHJcblxyXG4vLyBEcmF3IHRleHQgdGhlIHRleHRCYXNlbGluZSByYXRpbyAoQ2FuIGFkanVzdCB0aGUgYXBwcm9wcmlhdGUgYmFzZWxpbmUgcmF0aW8gYmFzZWQgb24gdGhlIHBsYXRmb3JtKVxyXG5sZXQgX0JBU0VMSU5FX1JBVElPID0gMC4yNjtcclxubGV0IF9CQVNFTElORV9PRkZTRVQgPSAwO1xyXG5pZiAoQ0NfUlVOVElNRSkge1xyXG4gICAgX0JBU0VMSU5FX09GRlNFVCA9IF9CQVNFTElORV9SQVRJTyAqIDIgLyAzO1xyXG59XHJcblxyXG5jb25zdCBNQVhfQ0FDSEVfU0laRSA9IDEwMDtcclxuXHJcbmxldCBwb29sID0gbmV3IGpzLlBvb2woMik7XHJcbnBvb2wuZ2V0ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgdmFyIG5vZGUgPSB0aGlzLl9nZXQoKSB8fCB7XHJcbiAgICAgICAga2V5OiBudWxsLFxyXG4gICAgICAgIHZhbHVlOiBudWxsLFxyXG4gICAgICAgIHByZXY6IG51bGwsXHJcbiAgICAgICAgbmV4dDogbnVsbFxyXG4gICAgfTtcclxuXHJcbiAgICByZXR1cm4gbm9kZTtcclxufTtcclxuXHJcbmZ1bmN0aW9uIExSVUNhY2hlKHNpemUpIHtcclxuICAgIHRoaXMuY291bnQgPSAwO1xyXG4gICAgdGhpcy5saW1pdCA9IHNpemU7XHJcbiAgICB0aGlzLmRhdGFzID0ge307XHJcbiAgICB0aGlzLmhlYWQgPSBudWxsO1xyXG4gICAgdGhpcy50YWlsID0gbnVsbDtcclxufVxyXG5cclxuTFJVQ2FjaGUucHJvdG90eXBlLm1vdmVUb0hlYWQgPSBmdW5jdGlvbiAobm9kZSkge1xyXG4gICAgbm9kZS5uZXh0ID0gdGhpcy5oZWFkO1xyXG4gICAgbm9kZS5wcmV2ID0gbnVsbDtcclxuICAgIGlmICh0aGlzLmhlYWQgIT09IG51bGwpIFxyXG4gICAgICAgIHRoaXMuaGVhZC5wcmV2ID0gbm9kZTtcclxuICAgIHRoaXMuaGVhZCA9IG5vZGU7XHJcbiAgICBpZiAodGhpcy50YWlsID09PSBudWxsKSBcclxuICAgICAgICB0aGlzLnRhaWwgPSBub2RlO1xyXG4gICAgdGhpcy5jb3VudCsrO1xyXG4gICAgdGhpcy5kYXRhc1tub2RlLmtleV0gPSBub2RlO1xyXG59XHJcblxyXG5MUlVDYWNoZS5wcm90b3R5cGUucHV0ID0gZnVuY3Rpb24gKGtleSwgdmFsdWUpIHtcclxuICAgIGNvbnN0IG5vZGUgPSBwb29sLmdldCgpO1xyXG4gICAgbm9kZS5rZXkgPSBrZXk7XHJcbiAgICBub2RlLnZhbHVlID0gdmFsdWU7XHJcbiAgICBcclxuICAgIGlmICh0aGlzLmNvdW50ID49IHRoaXMubGltaXQpIHtcclxuICAgICAgICBsZXQgZGlzY2FyZCA9IHRoaXMudGFpbDtcclxuICAgICAgICBkZWxldGUgdGhpcy5kYXRhc1tkaXNjYXJkLmtleV07XHJcbiAgICAgICAgdGhpcy5jb3VudC0tO1xyXG4gICAgICAgIHRoaXMudGFpbCA9IGRpc2NhcmQucHJldjtcclxuICAgICAgICB0aGlzLnRhaWwubmV4dCA9IG51bGw7XHJcbiAgICAgICAgZGlzY2FyZC5wcmV2ID0gbnVsbDtcclxuICAgICAgICBkaXNjYXJkLm5leHQgPSBudWxsO1xyXG4gICAgICAgIHBvb2wucHV0KGRpc2NhcmQpO1xyXG4gICAgfVxyXG4gICAgdGhpcy5tb3ZlVG9IZWFkKG5vZGUpO1xyXG59XHJcblxyXG5MUlVDYWNoZS5wcm90b3R5cGUucmVtb3ZlID0gZnVuY3Rpb24gKG5vZGUpIHtcclxuICAgIGlmIChub2RlLnByZXYgIT09IG51bGwpIHtcclxuICAgICAgICBub2RlLnByZXYubmV4dCA9IG5vZGUubmV4dDtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgICAgdGhpcy5oZWFkID0gbm9kZS5uZXh0O1xyXG4gICAgfVxyXG4gICAgaWYgKG5vZGUubmV4dCAhPT0gbnVsbCkge1xyXG4gICAgICAgIG5vZGUubmV4dC5wcmV2ID0gbm9kZS5wcmV2O1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgICB0aGlzLnRhaWwgPSBub2RlLnByZXY7XHJcbiAgICB9XHJcbiAgICBkZWxldGUgdGhpcy5kYXRhc1tub2RlLmtleV07XHJcbiAgICB0aGlzLmNvdW50LS07XHJcbn1cclxuXHJcbkxSVUNhY2hlLnByb3RvdHlwZS5nZXQgPSBmdW5jdGlvbiAoa2V5KSB7XHJcbiAgICBjb25zdCBub2RlID0gdGhpcy5kYXRhc1trZXldO1xyXG4gICAgaWYgKG5vZGUpIHtcclxuICAgICAgICB0aGlzLnJlbW92ZShub2RlKTtcclxuICAgICAgICB0aGlzLm1vdmVUb0hlYWQobm9kZSk7XHJcbiAgICAgICAgcmV0dXJuIG5vZGUudmFsdWU7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gbnVsbDtcclxufVxyXG5cclxuTFJVQ2FjaGUucHJvdG90eXBlLmNsZWFyID0gZnVuY3Rpb24gKCkge1xyXG4gICAgdGhpcy5jb3VudCA9IDA7XHJcbiAgICB0aGlzLmRhdGFzID0ge307XHJcbiAgICB0aGlzLmhlYWQgPSBudWxsO1xyXG4gICAgdGhpcy50YWlsID0gbnVsbDtcclxufVxyXG5cclxuTFJVQ2FjaGUucHJvdG90eXBlLmhhcyA9IGZ1bmN0aW9uIChrZXkpIHtcclxuICAgIHJldHVybiAhIXRoaXMuZGF0YXNba2V5XTtcclxufVxyXG5cclxuTFJVQ2FjaGUucHJvdG90eXBlLmRlbGV0ZSA9IGZ1bmN0aW9uIChrZXkpIHtcclxuICAgIGNvbnN0IG5vZGUgPSB0aGlzLmRhdGFzW2tleV07XHJcbiAgICB0aGlzLnJlbW92ZShub2RlKTtcclxufVxyXG5cclxubGV0IG1lYXN1cmVDYWNoZSA9IG5ldyBMUlVDYWNoZShNQVhfQ0FDSEVfU0laRSk7XHJcblxyXG52YXIgdGV4dFV0aWxzID0ge1xyXG5cclxuICAgIEJBU0VMSU5FX1JBVElPOiBfQkFTRUxJTkVfUkFUSU8sXHJcbiAgICBNSURETEVfUkFUSU86IChfQkFTRUxJTkVfUkFUSU8gKyAxKSAvIDIgLSBfQkFTRUxJTkVfUkFUSU8sXHJcbiAgICBCQVNFTElORV9PRkZTRVQ6IF9CQVNFTElORV9PRkZTRVQsXHJcblxyXG4gICAgbGFiZWxfd29yZFJleCA6IC8oW2EtekEtWjAtOcOEw5bDnMOkw7bDvMOfw6nDqMOnw6DDucOqw6LDrsO0w7vQsC3Rj9CQLdCv0IHRkV0rfFxcUykvLFxyXG4gICAgbGFiZWxfc3ltYm9sUmV4IDogL15bISwuOjsnfVxcXSVcXD8+44CB4oCY4oCc44CL77yf44CC77yM77yBXS8sXHJcbiAgICBsYWJlbF9sYXN0V29yZFJleCA6IC8oW2EtekEtWjAtOcOEw5bDnMOkw7bDvMOfw6nDqMOnw6DDucOqw6LDrsO0w7vQsMOtw6zDjcOMw6/DgcOAw6HDoMOJw4jDksOTw7LDs8WQxZHDmcOaxbDDusWxw7HDkcOmw4bFk8WSw4PDgsOjw5TDtcSbxaHEjcWZxb7DvcOhw63DqcOzw7rFr8WlxI/FiMSaxaDEjMWYxb3DgcONw4nDk8OaxaTFvMW6xZvDs8WExYLEmcSHxIXFu8W5xZrDk8WDxYHEmMSGxIQt0Y/QkC3Qr9CB0ZFdK3xcXFMpJC8sXHJcbiAgICBsYWJlbF9sYXN0RW5nbGlzaCA6IC9bYS16QS1aMC05w4TDlsOcw6TDtsO8w5/DqcOow6fDoMO5w6rDosOuw7TDu9Cww63DrMONw4zDr8OBw4DDocOgw4nDiMOSw5PDssOzxZDFkcOZw5rFsMO6xbHDscORw6bDhsWTxZLDg8OCw6PDlMO1xJvFocSNxZnFvsO9w6HDrcOpw7PDusWvxaXEj8WIxJrFoMSMxZjFvcOBw43DicOTw5rFpMW8xbrFm8OzxYTFgsSZxIfEhcW7xbnFmsOTxYPFgcSYxIbEhC3Rj9CQLdCv0IHRkV0rJC8sXHJcbiAgICBsYWJlbF9maXJzdEVuZ2xpc2ggOiAvXlthLXpBLVowLTnDhMOWw5zDpMO2w7zDn8Opw6jDp8Ogw7nDqsOiw67DtMO70LDDrcOsw43DjMOvw4HDgMOhw6DDicOIw5LDk8Oyw7PFkMWRw5nDmsWww7rFscOxw5HDpsOGxZPFksODw4LDo8OUw7XEm8WhxI3FmcW+w73DocOtw6nDs8O6xa/FpcSPxYjEmsWgxIzFmMW9w4HDjcOJw5PDmsWkxbzFusWbw7PFhMWCxJnEh8SFxbvFucWaw5PFg8WBxJjEhsSELdGP0JAt0K/QgdGRXS8sXHJcbiAgICAvLyBUaGUgdW5pY29kZSBzdGFuZGFyZCB3aWxsIG5ldmVyIGFzc2lnbiBhIGNoYXJhY3RlciBmcm9tIGNvZGUgcG9pbnQgMHhEODAwIHRvIDB4REZGRlxyXG4gICAgLy8gaGlnaCBzdXJyb2dhdGUgKDB4RDgwMC0weERCRkYpIGFuZCBsb3cgc3Vycm9nYXRlKDB4REMwMC0weERGRkYpIGNvbWJpbmVzIHRvIGEgY2hhcmFjdGVyIG9uIHRoZSBTdXBwbGVtZW50YXJ5IE11bHRpbGluZ3VhbCBQbGFuZVxyXG4gICAgLy8gcmVmZXJlbmNlOiBodHRwczovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9VVEYtMTZcclxuICAgIGhpZ2hTdXJyb2dhdGVSZXg6IC9bXFx1RDgwMC1cXHVEQkZGXS8sXHJcbiAgICBsb3dTdXJyb2dhdGVSZXg6IC9bXFx1REMwMC1cXHVERkZGXS8sXHJcbiAgICBsYWJlbF93cmFwaW5zcGVjdGlvbiA6IHRydWUsXHJcblxyXG4gICAgX19DSElORVNFX1JFRzogL15bXFx1NEUwMC1cXHU5RkZGXFx1MzQwMC1cXHU0REZGXSskLyxcclxuICAgIF9fSkFQQU5FU0VfUkVHOiAvW1xcdTMwMDAtXFx1MzAzRl18W1xcdTMwNDAtXFx1MzA5Rl18W1xcdTMwQTAtXFx1MzBGRl18W1xcdUZGMDAtXFx1RkZFRl18W1xcdTRFMDAtXFx1OUZBRl18W1xcdTI2MDUtXFx1MjYwNl18W1xcdTIxOTAtXFx1MjE5NV18XFx1MjAzQi9nLFxyXG4gICAgX19LT1JFQU5fUkVHOiAvXltcXHUxMTAwLVxcdTExRkZdfFtcXHUzMTMwLVxcdTMxOEZdfFtcXHVBOTYwLVxcdUE5N0ZdfFtcXHVBQzAwLVxcdUQ3QUZdfFtcXHVEN0IwLVxcdUQ3RkZdKyQvLFxyXG5cclxuICAgIGlzVW5pY29kZUNKSzogZnVuY3Rpb24oY2gpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fX0NISU5FU0VfUkVHLnRlc3QoY2gpIHx8IHRoaXMuX19KQVBBTkVTRV9SRUcudGVzdChjaCkgfHwgdGhpcy5fX0tPUkVBTl9SRUcudGVzdChjaCk7XHJcbiAgICB9LFxyXG5cclxuICAgIC8vQ2hlY2tpbmcgd2hldGhlciB0aGUgY2hhcmFjdGVyIGlzIGEgd2hpdGVzcGFjZVxyXG4gICAgaXNVbmljb2RlU3BhY2U6IGZ1bmN0aW9uKGNoKSB7XHJcbiAgICAgICAgY2ggPSBjaC5jaGFyQ29kZUF0KDApO1xyXG4gICAgICAgIHJldHVybiAoKGNoID49IDkgJiYgY2ggPD0gMTMpIHx8IGNoID09PSAzMiB8fCBjaCA9PT0gMTMzIHx8IGNoID09PSAxNjAgfHwgY2ggPT09IDU3NjAgfHwgKGNoID49IDgxOTIgJiYgY2ggPD0gODIwMikgfHwgY2ggPT09IDgyMzIgfHwgY2ggPT09IDgyMzMgfHwgY2ggPT09IDgyMzkgfHwgY2ggPT09IDgyODcgfHwgY2ggPT09IDEyMjg4KTtcclxuICAgIH0sXHJcblxyXG4gICAgc2FmZU1lYXN1cmVUZXh0OiBmdW5jdGlvbiAoY3R4LCBzdHJpbmcsIGRlc2MpIHtcclxuICAgICAgICBsZXQgZm9udCA9IGRlc2MgfHwgY3R4LmZvbnQ7XHJcbiAgICAgICAgbGV0IGtleSA9IGZvbnQgKyBcIlxcdUQ4M0NcXHVERkFFXCIgKyBzdHJpbmc7XHJcbiAgICAgICAgbGV0IGNhY2hlID0gbWVhc3VyZUNhY2hlLmdldChrZXkpO1xyXG4gICAgICAgIGlmIChjYWNoZSAhPT0gbnVsbCkge1xyXG4gICAgICAgICAgICByZXR1cm4gY2FjaGU7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBsZXQgbWV0cmljID0gY3R4Lm1lYXN1cmVUZXh0KHN0cmluZyk7XHJcbiAgICAgICAgbGV0IHdpZHRoID0gbWV0cmljICYmIG1ldHJpYy53aWR0aCB8fCAwO1xyXG4gICAgICAgIG1lYXN1cmVDYWNoZS5wdXQoa2V5LCB3aWR0aCk7XHJcblxyXG4gICAgICAgIHJldHVybiB3aWR0aDtcclxuICAgIH0sXHJcblxyXG4gICAgLy8gaW4gY2FzZSB0cnVuY2F0ZSBhIGNoYXJhY3RlciBvbiB0aGUgU3VwcGxlbWVudGFyeSBNdWx0aWxpbmd1YWwgUGxhbmVcclxuICAgIC8vIHRlc3QgY2FzZTogYSA9ICfwn5iJ8J+alydcclxuICAgIC8vIF9zYWZlU3Vic3RyaW5nKGEsIDEpID09PSAn8J+YifCfmpcnXHJcbiAgICAvLyBfc2FmZVN1YnN0cmluZyhhLCAwLCAxKSA9PT0gJ/CfmIknXHJcbiAgICAvLyBfc2FmZVN1YnN0cmluZyhhLCAwLCAyKSA9PT0gJ/CfmIknXHJcbiAgICAvLyBfc2FmZVN1YnN0cmluZyhhLCAwLCAzKSA9PT0gJ/CfmIknXHJcbiAgICAvLyBfc2FmZVN1YnN0cmluZyhhLCAwLCA0KSA9PT0gJ/CfmInwn5qXJ1xyXG4gICAgLy8gX3NhZmVTdWJzdHJpbmcoYSwgMSwgMikgPT09IF9zYWZlU3Vic3RyaW5nKGEsIDEsIDMpID09PSAn8J+YiSdcclxuICAgIC8vIF9zYWZlU3Vic3RyaW5nKGEsIDIsIDMpID09PSBfc2FmZVN1YnN0cmluZyhhLCAyLCA0KSA9PT0gJ/CfmpcnXHJcbiAgICBfc2FmZVN1YnN0cmluZyAodGFyZ2V0U3RyaW5nLCBzdGFydEluZGV4LCBlbmRJbmRleCkge1xyXG4gICAgICAgIGxldCBuZXdTdGFydEluZGV4ID0gc3RhcnRJbmRleCwgbmV3RW5kSW5kZXggPSBlbmRJbmRleDtcclxuICAgICAgICBsZXQgc3RhcnRDaGFyID0gdGFyZ2V0U3RyaW5nW3N0YXJ0SW5kZXhdO1xyXG4gICAgICAgIGlmICh0aGlzLmxvd1N1cnJvZ2F0ZVJleC50ZXN0KHN0YXJ0Q2hhcikpIHtcclxuICAgICAgICAgICAgbmV3U3RhcnRJbmRleC0tO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoZW5kSW5kZXggIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICBpZiAoZW5kSW5kZXggLSAxICE9PSBzdGFydEluZGV4KSB7XHJcbiAgICAgICAgICAgICAgICBsZXQgZW5kQ2hhciA9IHRhcmdldFN0cmluZ1tlbmRJbmRleCAtIDFdO1xyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuaGlnaFN1cnJvZ2F0ZVJleC50ZXN0KGVuZENoYXIpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbmV3RW5kSW5kZXgtLTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIGlmICh0aGlzLmhpZ2hTdXJyb2dhdGVSZXgudGVzdChzdGFydENoYXIpKSB7XHJcbiAgICAgICAgICAgICAgICBuZXdFbmRJbmRleCsrO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB0YXJnZXRTdHJpbmcuc3Vic3RyaW5nKG5ld1N0YXJ0SW5kZXgsIG5ld0VuZEluZGV4KTtcclxuICAgIH0sXHJcblxyXG4gICAgZnJhZ21lbnRUZXh0OiBmdW5jdGlvbiAoc3RyaW5nVG9rZW4sIGFsbFdpZHRoLCBtYXhXaWR0aCwgbWVhc3VyZVRleHQpIHtcclxuICAgICAgICAvL2NoZWNrIHRoZSBmaXJzdCBjaGFyYWN0ZXJcclxuICAgICAgICB2YXIgd3JhcHBlZFdvcmRzID0gW107XHJcbiAgICAgICAgLy9mYXN0IHJldHVybiBpZiBzdHJBcnIgaXMgZW1wdHlcclxuICAgICAgICBpZihzdHJpbmdUb2tlbi5sZW5ndGggPT09IDAgfHwgbWF4V2lkdGggPCAwKSB7XHJcbiAgICAgICAgICAgIHdyYXBwZWRXb3Jkcy5wdXNoKCcnKTtcclxuICAgICAgICAgICAgcmV0dXJuIHdyYXBwZWRXb3JkcztcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHZhciB0ZXh0ID0gc3RyaW5nVG9rZW47XHJcbiAgICAgICAgd2hpbGUgKGFsbFdpZHRoID4gbWF4V2lkdGggJiYgdGV4dC5sZW5ndGggPiAxKSB7XHJcblxyXG4gICAgICAgICAgICB2YXIgZnV6enlMZW4gPSB0ZXh0Lmxlbmd0aCAqICggbWF4V2lkdGggLyBhbGxXaWR0aCApIHwgMDtcclxuICAgICAgICAgICAgdmFyIHRtcFRleHQgPSB0aGlzLl9zYWZlU3Vic3RyaW5nKHRleHQsIGZ1enp5TGVuKTtcclxuICAgICAgICAgICAgdmFyIHdpZHRoID0gYWxsV2lkdGggLSBtZWFzdXJlVGV4dCh0bXBUZXh0KTtcclxuICAgICAgICAgICAgdmFyIHNMaW5lID0gdG1wVGV4dDtcclxuICAgICAgICAgICAgdmFyIHB1c2hOdW0gPSAwO1xyXG5cclxuICAgICAgICAgICAgdmFyIGNoZWNrV2hpbGUgPSAwO1xyXG4gICAgICAgICAgICB2YXIgY2hlY2tDb3VudCA9IDEwO1xyXG5cclxuICAgICAgICAgICAgLy9FeGNlZWRlZCB0aGUgc2l6ZVxyXG4gICAgICAgICAgICB3aGlsZSAod2lkdGggPiBtYXhXaWR0aCAmJiBjaGVja1doaWxlKysgPCBjaGVja0NvdW50KSB7XHJcbiAgICAgICAgICAgICAgICBmdXp6eUxlbiAqPSBtYXhXaWR0aCAvIHdpZHRoO1xyXG4gICAgICAgICAgICAgICAgZnV6enlMZW4gPSBmdXp6eUxlbiB8IDA7XHJcbiAgICAgICAgICAgICAgICB0bXBUZXh0ID0gdGhpcy5fc2FmZVN1YnN0cmluZyh0ZXh0LCBmdXp6eUxlbik7XHJcbiAgICAgICAgICAgICAgICB3aWR0aCA9IGFsbFdpZHRoIC0gbWVhc3VyZVRleHQodG1wVGV4dCk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGNoZWNrV2hpbGUgPSAwO1xyXG5cclxuICAgICAgICAgICAgLy9GaW5kIHRoZSB0cnVuY2F0aW9uIHBvaW50XHJcbiAgICAgICAgICAgIHdoaWxlICh3aWR0aCA8PSBtYXhXaWR0aCAmJiBjaGVja1doaWxlKysgPCBjaGVja0NvdW50KSB7XHJcbiAgICAgICAgICAgICAgICBpZiAodG1wVGV4dCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBleGVjID0gdGhpcy5sYWJlbF93b3JkUmV4LmV4ZWModG1wVGV4dCk7XHJcbiAgICAgICAgICAgICAgICAgICAgcHVzaE51bSA9IGV4ZWMgPyBleGVjWzBdLmxlbmd0aCA6IDE7XHJcbiAgICAgICAgICAgICAgICAgICAgc0xpbmUgPSB0bXBUZXh0O1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGZ1enp5TGVuID0gZnV6enlMZW4gKyBwdXNoTnVtO1xyXG4gICAgICAgICAgICAgICAgdG1wVGV4dCA9IHRoaXMuX3NhZmVTdWJzdHJpbmcodGV4dCwgZnV6enlMZW4pO1xyXG4gICAgICAgICAgICAgICAgd2lkdGggPSBhbGxXaWR0aCAtIG1lYXN1cmVUZXh0KHRtcFRleHQpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBmdXp6eUxlbiAtPSBwdXNoTnVtO1xyXG4gICAgICAgICAgICAvLyBpbiBjYXNlIG1heFdpZHRoIGNhbm5vdCBjb250YWluIGFueSBjaGFyYWN0ZXJzLCBuZWVkIGF0IGxlYXN0IG9uZSBjaGFyYWN0ZXIgcGVyIGxpbmVcclxuICAgICAgICAgICAgaWYgKGZ1enp5TGVuID09PSAwKSB7XHJcbiAgICAgICAgICAgICAgICBmdXp6eUxlbiA9IDE7XHJcbiAgICAgICAgICAgICAgICBzTGluZSA9IHRoaXMuX3NhZmVTdWJzdHJpbmcodGV4dCwgMSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSBpZiAoZnV6enlMZW4gPT09IDEgJiYgdGhpcy5oaWdoU3Vycm9nYXRlUmV4LnRlc3QodGV4dFswXSkpIHtcclxuICAgICAgICAgICAgICAgIGZ1enp5TGVuID0gMjtcclxuICAgICAgICAgICAgICAgIHNMaW5lID0gdGhpcy5fc2FmZVN1YnN0cmluZyh0ZXh0LCAyKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgdmFyIHNUZXh0ID0gdGhpcy5fc2FmZVN1YnN0cmluZyh0ZXh0LCAwLCBmdXp6eUxlbiksIHJlc3VsdDtcclxuXHJcbiAgICAgICAgICAgIC8vc3ltYm9sIGluIHRoZSBmaXJzdFxyXG4gICAgICAgICAgICBpZiAodGhpcy5sYWJlbF93cmFwaW5zcGVjdGlvbikge1xyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMubGFiZWxfc3ltYm9sUmV4LnRlc3Qoc0xpbmUgfHwgdG1wVGV4dCkpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXN1bHQgPSB0aGlzLmxhYmVsX2xhc3RXb3JkUmV4LmV4ZWMoc1RleHQpO1xyXG4gICAgICAgICAgICAgICAgICAgIGZ1enp5TGVuIC09IHJlc3VsdCA/IHJlc3VsdFswXS5sZW5ndGggOiAwO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChmdXp6eUxlbiA9PT0gMCkgZnV6enlMZW4gPSAxO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBzTGluZSA9IHRoaXMuX3NhZmVTdWJzdHJpbmcodGV4dCwgZnV6enlMZW4pO1xyXG4gICAgICAgICAgICAgICAgICAgIHNUZXh0ID0gdGhpcy5fc2FmZVN1YnN0cmluZyh0ZXh0LCAwLCBmdXp6eUxlbik7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vVG8ganVkZ2Ugd2hldGhlciBhIEVuZ2xpc2ggd29yZHMgYXJlIHRydW5jYXRlZFxyXG4gICAgICAgICAgICBpZiAodGhpcy5sYWJlbF9maXJzdEVuZ2xpc2gudGVzdChzTGluZSkpIHtcclxuICAgICAgICAgICAgICAgIHJlc3VsdCA9IHRoaXMubGFiZWxfbGFzdEVuZ2xpc2guZXhlYyhzVGV4dCk7XHJcbiAgICAgICAgICAgICAgICBpZiAocmVzdWx0ICYmIHNUZXh0ICE9PSByZXN1bHRbMF0pIHtcclxuICAgICAgICAgICAgICAgICAgICBmdXp6eUxlbiAtPSByZXN1bHRbMF0ubGVuZ3RoO1xyXG4gICAgICAgICAgICAgICAgICAgIHNMaW5lID0gdGhpcy5fc2FmZVN1YnN0cmluZyh0ZXh0LCBmdXp6eUxlbik7XHJcbiAgICAgICAgICAgICAgICAgICAgc1RleHQgPSB0aGlzLl9zYWZlU3Vic3RyaW5nKHRleHQsIDAsIGZ1enp5TGVuKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gVGhlIGZpcnN0IGxpbmUgQW5kIGRvIG5vdCB3cmFwIHNob3VsZCBub3QgcmVtb3ZlIHRoZSBzcGFjZVxyXG4gICAgICAgICAgICBpZiAod3JhcHBlZFdvcmRzLmxlbmd0aCA9PT0gMCkge1xyXG4gICAgICAgICAgICAgICAgd3JhcHBlZFdvcmRzLnB1c2goc1RleHQpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgc1RleHQgPSBzVGV4dC50cmltTGVmdCgpO1xyXG4gICAgICAgICAgICAgICAgaWYgKHNUZXh0Lmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgICAgICAgICB3cmFwcGVkV29yZHMucHVzaChzVGV4dCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdGV4dCA9IHNMaW5lIHx8IHRtcFRleHQ7XHJcbiAgICAgICAgICAgIGFsbFdpZHRoID0gbWVhc3VyZVRleHQodGV4dCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAod3JhcHBlZFdvcmRzLmxlbmd0aCA9PT0gMCkge1xyXG4gICAgICAgICAgICB3cmFwcGVkV29yZHMucHVzaCh0ZXh0KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHRleHQgPSB0ZXh0LnRyaW1MZWZ0KCk7XHJcbiAgICAgICAgICAgIGlmICh0ZXh0Lmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgICAgIHdyYXBwZWRXb3Jkcy5wdXNoKHRleHQpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB3cmFwcGVkV29yZHM7XHJcbiAgICB9LFxyXG59O1xyXG5cclxuY2MudGV4dFV0aWxzID0gbW9kdWxlLmV4cG9ydHMgPSB0ZXh0VXRpbHM7XHJcbiJdLCJzb3VyY2VSb290IjoiLyJ9