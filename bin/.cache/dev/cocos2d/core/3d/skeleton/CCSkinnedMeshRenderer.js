
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'engine-dev/cocos2d/core/3d/skeleton/CCSkinnedMeshRenderer.js';
                    var __require = nodeEnv ? function (request) {
                        return require(request);
                    } : function (request) {
                        return __quick_compile_engine__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_engine__.registerModule(__filename, module);}"use strict";

var _mat = _interopRequireDefault(require("../../value-types/mat4"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { "default": obj }; }

/****************************************************************************
 Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.

 http://www.cocos.com

 Permission is hereby granted, free of charge, to any person obtaining a copy
 of this software and associated engine source code (the "Software"), a limited,
  worldwide, royalty-free, non-assignable, revocable and non-exclusive license
 to use Cocos Creator solely to develop games on your target platforms. You shall
  not use Cocos Creator software for developing other software or tools that's
  used for developing games. You are not granted to publish, distribute,
  sublicense, and/or sell copies of Cocos Creator.

 The software or tools in this License Agreement are licensed, not sold.
 Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.

 THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 THE SOFTWARE.
 ****************************************************************************/
var Skeleton = require('./CCSkeleton');

var MeshRenderer = require('../../mesh/CCMeshRenderer');

var RenderFlow = require('../../renderer/render-flow');

var enums = require('../../../renderer/enums');

var _m4_tmp = cc.mat4();

var _m4_tmp2 = cc.mat4();
/**
 * !#en
 * Skinned Mesh Renderer
 * !#zh
 * 蒙皮渲染组件
 * @class SkinnedMeshRenderer
 * @extends MeshRenderer
 */


var SkinnedMeshRenderer = cc.Class({
  name: 'cc.SkinnedMeshRenderer',
  "extends": MeshRenderer,
  editor: CC_EDITOR && {
    menu: 'i18n:MAIN_MENU.component.mesh/Skinned Mesh Renderer'
  },
  ctor: function ctor() {
    this._jointsData = this._jointsFloat32Data = null;
    this._jointsTexture = null;
    this._joints = [];
    this._dummyNode = new cc.Node();
    this._jointsTextureOptions = null;
    this._usingRGBA8Texture = false;
  },
  properties: {
    _skeleton: Skeleton,
    _rootBone: cc.Node,

    /**
     * !#en
     * Skeleton Asset
     * !#zh
     * 骨骼资源
     * @property {Skeleton} skeleton
     */
    skeleton: {
      get: function get() {
        return this._skeleton;
      },
      set: function set(val) {
        this._skeleton = val;

        this._init();
      },
      type: Skeleton
    },

    /**
     * !#en
     * Root Bone
     * !#zh
     * 骨骼根节点
     * @property {Node} rootBone
     */
    rootBone: {
      get: function get() {
        return this._rootBone;
      },
      set: function set(val) {
        this._rootBone = val;

        this._init();
      },
      type: cc.Node
    },
    // SkinnedMeshRenderer cannot batch
    enableAutoBatch: {
      get: function get() {
        return false;
      },
      visible: false,
      override: true
    }
  },
  __preload: function __preload() {
    this._super();

    this._init();
  },
  _init: function _init() {
    this._model = this._skeleton && this._skeleton.model;
    this._calFunc = null;

    this._initJoints();

    this._initJointsTexture();

    this._initCalcFunc();

    this._updateRenderNode();
  },
  _calcWorldMatrixToRoot: function _calcWorldMatrixToRoot(joint) {
    var worldMatrixToRoot = joint._worldMatrixToRoot;

    if (!worldMatrixToRoot) {
      joint._worldMatrixToRoot = worldMatrixToRoot = cc.mat4();
      joint.getLocalMatrix(worldMatrixToRoot);
    } else {
      return;
    }

    var parent = joint.parent;

    if (parent !== this.rootBone) {
      if (!parent._worldMatrixToRoot) {
        this._calcWorldMatrixToRoot(parent);
      }

      _mat["default"].mul(worldMatrixToRoot, parent._worldMatrixToRoot, worldMatrixToRoot);
    }
  },
  _validateRender: function _validateRender() {
    if (!this._jointsData) {
      this.disableRender();
      return;
    }

    this._super();
  },
  _initJoints: function _initJoints() {
    var joints = this._joints;
    joints.length = 0;
    if (!this.skeleton || !this.rootBone) return;

    var useJointMatrix = this._useJointMatrix();

    var jointPaths = this.skeleton.jointPaths;
    var rootBone = this.rootBone;

    for (var i = 0; i < jointPaths.length; i++) {
      var joint = cc.find(jointPaths[i], rootBone);

      if (!joint) {
        cc.warn('Can not find joint in root bone [%s] with path [%s]', rootBone.name, jointPaths[i]);
      }

      if (useJointMatrix) {
        joint._renderFlag &= ~RenderFlow.FLAG_CHILDREN;

        this._calcWorldMatrixToRoot(joint);
      }

      joints.push(joint);
    }

    if (useJointMatrix) {
      var uniqueBindPoses = this.skeleton.uniqueBindPoses;

      for (var _i = 0; _i < jointPaths.length; _i++) {
        var _joint = joints[_i];

        if (uniqueBindPoses[_i]) {
          _mat["default"].mul(_m4_tmp, _joint._worldMatrixToRoot, uniqueBindPoses[_i]);

          _joint._jointMatrix = _mat["default"].toArray([], _m4_tmp);
        } else {
          _joint._jointMatrix = _joint._worldMatrixToRoot;
        }
      }
    }
  },
  _initJointsTexture: function _initJointsTexture() {
    if (!this._skeleton) return;
    var jointCount = this._joints.length;
    var inited = false;

    if (jointCount <= cc.sys.getMaxJointMatrixSize()) {
      inited = true;
      this._jointsData = this._jointsFloat32Data = new Float32Array(jointCount * 16);
    }

    if (!inited) {
      var SUPPORT_FLOAT_TEXTURE = !!cc.sys.glExtension('OES_texture_float');
      var size;

      if (jointCount > 256) {
        size = 64;
      } else if (jointCount > 64) {
        size = 32;
      } else if (jointCount > 16) {
        size = 16;
      } else {
        size = 8;
      }

      this._jointsData = this._jointsFloat32Data = new Float32Array(size * size * 4);
      var pixelFormat = cc.Texture2D.PixelFormat.RGBA32F,
          width = size,
          height = size;

      if (!SUPPORT_FLOAT_TEXTURE) {
        this._jointsData = new Uint8Array(this._jointsFloat32Data.buffer);
        pixelFormat = cc.Texture2D.PixelFormat.RGBA8888;
        width *= 4;
        this._usingRGBA8Texture = true;
        cc.warn("SkinnedMeshRenderer [" + this.node.name + "] has too many joints [" + jointCount + "] and device do not support float32 texture, fallback to use RGBA8888 texture, which is much slower.");
      }

      var texture = this._jointsTexture || new cc.Texture2D();
      var NEAREST = cc.Texture2D.Filter.NEAREST;
      texture.setFilters(NEAREST, NEAREST);
      texture.initWithData(this._jointsData, pixelFormat, width, height);
      this._jointsTexture = texture;
      this._jointsTextureOptions = {
        format: pixelFormat,
        width: texture.width,
        height: texture.height,
        images: []
      };
    }

    this._updateMaterial();
  },
  _updateMaterial: function _updateMaterial() {
    MeshRenderer.prototype._updateMaterial.call(this);

    var materials = this.getMaterials();

    for (var i = 0; i < materials.length; i++) {
      var material = materials[i];

      if (this._jointsTexture) {
        material.setProperty('jointsTexture', this._jointsTexture);
        material.setProperty('jointsTextureSize', new Float32Array([this._jointsTexture.width, this._jointsTexture.height]));
        material.define('CC_JOINTS_TEXTURE_FLOAT32', !!cc.sys.glExtension('OES_texture_float'));
        material.define('CC_USE_JOINTS_TEXTRUE', true);
      } else {
        if (this._jointsFloat32Data) {
          material.setProperty('jointMatrices', this._jointsFloat32Data, undefined, true);
        }

        material.define('CC_USE_JOINTS_TEXTRUE', false);
      }

      material.define('CC_USE_SKINNING', true);
    }
  },
  _setJointsDataWithArray: function _setJointsDataWithArray(iMatrix, matrixArray) {
    var data = this._jointsFloat32Data;
    data.set(matrixArray, iMatrix * 16);
  },
  _setJointsDataWithMatrix: function _setJointsDataWithMatrix(iMatrix, matrix) {
    this._jointsFloat32Data.set(matrix.m, 16 * iMatrix);
  },
  _commitJointsData: function _commitJointsData() {
    if (this._jointsTexture) {
      this._jointsTextureOptions.images[0] = this._jointsData;

      this._jointsTexture.update(this._jointsTextureOptions);
    }
  },
  _useJointMatrix: function _useJointMatrix() {
    return this._model && this._model.precomputeJointMatrix;
  },
  _updateRenderNode: function _updateRenderNode() {
    if (this._useJointMatrix() || this._usingRGBA8Texture) {
      this._assembler.setRenderNode(this.rootBone);
    } else {
      this._assembler.setRenderNode(this._dummyNode);
    }
  },
  _initCalcFunc: function _initCalcFunc() {
    if (this._useJointMatrix()) {
      this._calFunc = this._calJointMatrix;
    } else if (this._usingRGBA8Texture) {
      this._calFunc = this._calRGBA8WorldMatrix;
    } else {
      this._calFunc = this._calWorldMatrix;
    }
  },
  _calJointMatrix: function _calJointMatrix() {
    var joints = this._joints;
    var bindposes = this.skeleton.bindposes;
    var uniqueBindPoses = this.skeleton.uniqueBindPoses;

    for (var i = 0; i < joints.length; ++i) {
      var joint = joints[i];
      var jointMatrix = joint._jointMatrix;

      if (uniqueBindPoses[i]) {
        this._setJointsDataWithArray(i, jointMatrix);
      } else {
        _mat["default"].multiply(_m4_tmp, jointMatrix, bindposes[i]);

        this._setJointsDataWithMatrix(i, _m4_tmp);
      }
    }
  },
  // Some device rgba8 texture precision is low, when encode a big number it may loss precision.
  // Invert root bone matrix can effectively avoid big position encode into rgba8 texture.
  _calRGBA8WorldMatrix: function _calRGBA8WorldMatrix() {
    var joints = this._joints;
    var bindposes = this.skeleton.bindposes;

    this.rootBone._updateWorldMatrix();

    var rootMatrix = this.rootBone._worldMatrix;

    var invRootMat = _mat["default"].invert(_m4_tmp2, rootMatrix);

    for (var i = 0; i < joints.length; ++i) {
      var joint = joints[i];

      joint._updateWorldMatrix();

      _mat["default"].multiply(_m4_tmp, invRootMat, joint._worldMatrix);

      _mat["default"].multiply(_m4_tmp, _m4_tmp, bindposes[i]);

      this._setJointsDataWithMatrix(i, _m4_tmp);
    }
  },
  _calWorldMatrix: function _calWorldMatrix() {
    var joints = this._joints;
    var bindposes = this.skeleton.bindposes;

    for (var i = 0; i < joints.length; ++i) {
      var joint = joints[i];

      joint._updateWorldMatrix();

      _mat["default"].multiply(_m4_tmp, joint._worldMatrix, bindposes[i]);

      this._setJointsDataWithMatrix(i, _m4_tmp);
    }
  },
  calcJointMatrix: function calcJointMatrix() {
    if (!this.skeleton || !this.rootBone) return;

    this._calFunc.call(this);

    this._commitJointsData();
  }
});
cc.SkinnedMeshRenderer = module.exports = SkinnedMeshRenderer;
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_engine__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImVuZ2luZS1kZXZcXGNvY29zMmRcXGNvcmVcXDNkXFxza2VsZXRvblxcQ0NTa2lubmVkTWVzaFJlbmRlcmVyLmpzIl0sIm5hbWVzIjpbIlNrZWxldG9uIiwicmVxdWlyZSIsIk1lc2hSZW5kZXJlciIsIlJlbmRlckZsb3ciLCJlbnVtcyIsIl9tNF90bXAiLCJjYyIsIm1hdDQiLCJfbTRfdG1wMiIsIlNraW5uZWRNZXNoUmVuZGVyZXIiLCJDbGFzcyIsIm5hbWUiLCJlZGl0b3IiLCJDQ19FRElUT1IiLCJtZW51IiwiY3RvciIsIl9qb2ludHNEYXRhIiwiX2pvaW50c0Zsb2F0MzJEYXRhIiwiX2pvaW50c1RleHR1cmUiLCJfam9pbnRzIiwiX2R1bW15Tm9kZSIsIk5vZGUiLCJfam9pbnRzVGV4dHVyZU9wdGlvbnMiLCJfdXNpbmdSR0JBOFRleHR1cmUiLCJwcm9wZXJ0aWVzIiwiX3NrZWxldG9uIiwiX3Jvb3RCb25lIiwic2tlbGV0b24iLCJnZXQiLCJzZXQiLCJ2YWwiLCJfaW5pdCIsInR5cGUiLCJyb290Qm9uZSIsImVuYWJsZUF1dG9CYXRjaCIsInZpc2libGUiLCJvdmVycmlkZSIsIl9fcHJlbG9hZCIsIl9zdXBlciIsIl9tb2RlbCIsIm1vZGVsIiwiX2NhbEZ1bmMiLCJfaW5pdEpvaW50cyIsIl9pbml0Sm9pbnRzVGV4dHVyZSIsIl9pbml0Q2FsY0Z1bmMiLCJfdXBkYXRlUmVuZGVyTm9kZSIsIl9jYWxjV29ybGRNYXRyaXhUb1Jvb3QiLCJqb2ludCIsIndvcmxkTWF0cml4VG9Sb290IiwiX3dvcmxkTWF0cml4VG9Sb290IiwiZ2V0TG9jYWxNYXRyaXgiLCJwYXJlbnQiLCJNYXQ0IiwibXVsIiwiX3ZhbGlkYXRlUmVuZGVyIiwiZGlzYWJsZVJlbmRlciIsImpvaW50cyIsImxlbmd0aCIsInVzZUpvaW50TWF0cml4IiwiX3VzZUpvaW50TWF0cml4Iiwiam9pbnRQYXRocyIsImkiLCJmaW5kIiwid2FybiIsIl9yZW5kZXJGbGFnIiwiRkxBR19DSElMRFJFTiIsInB1c2giLCJ1bmlxdWVCaW5kUG9zZXMiLCJfam9pbnRNYXRyaXgiLCJ0b0FycmF5Iiwiam9pbnRDb3VudCIsImluaXRlZCIsInN5cyIsImdldE1heEpvaW50TWF0cml4U2l6ZSIsIkZsb2F0MzJBcnJheSIsIlNVUFBPUlRfRkxPQVRfVEVYVFVSRSIsImdsRXh0ZW5zaW9uIiwic2l6ZSIsInBpeGVsRm9ybWF0IiwiVGV4dHVyZTJEIiwiUGl4ZWxGb3JtYXQiLCJSR0JBMzJGIiwid2lkdGgiLCJoZWlnaHQiLCJVaW50OEFycmF5IiwiYnVmZmVyIiwiUkdCQTg4ODgiLCJub2RlIiwidGV4dHVyZSIsIk5FQVJFU1QiLCJGaWx0ZXIiLCJzZXRGaWx0ZXJzIiwiaW5pdFdpdGhEYXRhIiwiZm9ybWF0IiwiaW1hZ2VzIiwiX3VwZGF0ZU1hdGVyaWFsIiwicHJvdG90eXBlIiwiY2FsbCIsIm1hdGVyaWFscyIsImdldE1hdGVyaWFscyIsIm1hdGVyaWFsIiwic2V0UHJvcGVydHkiLCJkZWZpbmUiLCJ1bmRlZmluZWQiLCJfc2V0Sm9pbnRzRGF0YVdpdGhBcnJheSIsImlNYXRyaXgiLCJtYXRyaXhBcnJheSIsImRhdGEiLCJfc2V0Sm9pbnRzRGF0YVdpdGhNYXRyaXgiLCJtYXRyaXgiLCJtIiwiX2NvbW1pdEpvaW50c0RhdGEiLCJ1cGRhdGUiLCJwcmVjb21wdXRlSm9pbnRNYXRyaXgiLCJfYXNzZW1ibGVyIiwic2V0UmVuZGVyTm9kZSIsIl9jYWxKb2ludE1hdHJpeCIsIl9jYWxSR0JBOFdvcmxkTWF0cml4IiwiX2NhbFdvcmxkTWF0cml4IiwiYmluZHBvc2VzIiwiam9pbnRNYXRyaXgiLCJtdWx0aXBseSIsIl91cGRhdGVXb3JsZE1hdHJpeCIsInJvb3RNYXRyaXgiLCJfd29ybGRNYXRyaXgiLCJpbnZSb290TWF0IiwiaW52ZXJ0IiwiY2FsY0pvaW50TWF0cml4IiwibW9kdWxlIiwiZXhwb3J0cyJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7OztBQXlCQTs7OztBQXpCQTtBQUNBO0FBQ0E7QUFDQTtBQUNB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Q0EsV0FBSytDLHdCQUFMLENBQThCL0MsQ0FBOUIsRUFBaUN4RCxPQUFqQztBQUNIO0FBQ0osR0E3VDhCO0FBK1QvQjBILEVBQUFBLGVBL1QrQiw2QkErVFo7QUFDZixRQUFJLENBQUMsS0FBS3BHLFFBQU4sSUFBa0IsQ0FBQyxLQUFLTSxRQUE1QixFQUFzQzs7QUFFdEMsU0FBS1EsUUFBTCxDQUFjd0QsSUFBZCxDQUFtQixJQUFuQjs7QUFDQSxTQUFLYyxpQkFBTDtBQUNIO0FBcFU4QixDQUFULENBQTFCO0FBdVVBekcsRUFBRSxDQUFDRyxtQkFBSCxHQUF5QnVILE1BQU0sQ0FBQ0MsT0FBUCxHQUFpQnhILG1CQUExQyIsInNvdXJjZXNDb250ZW50IjpbIi8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqXHJcbiBDb3B5cmlnaHQgKGMpIDIwMTctMjAxOCBYaWFtZW4gWWFqaSBTb2Z0d2FyZSBDby4sIEx0ZC5cclxuXHJcbiBodHRwOi8vd3d3LmNvY29zLmNvbVxyXG5cclxuIFBlcm1pc3Npb24gaXMgaGVyZWJ5IGdyYW50ZWQsIGZyZWUgb2YgY2hhcmdlLCB0byBhbnkgcGVyc29uIG9idGFpbmluZyBhIGNvcHlcclxuIG9mIHRoaXMgc29mdHdhcmUgYW5kIGFzc29jaWF0ZWQgZW5naW5lIHNvdXJjZSBjb2RlICh0aGUgXCJTb2Z0d2FyZVwiKSwgYSBsaW1pdGVkLFxyXG4gIHdvcmxkd2lkZSwgcm95YWx0eS1mcmVlLCBub24tYXNzaWduYWJsZSwgcmV2b2NhYmxlIGFuZCBub24tZXhjbHVzaXZlIGxpY2Vuc2VcclxuIHRvIHVzZSBDb2NvcyBDcmVhdG9yIHNvbGVseSB0byBkZXZlbG9wIGdhbWVzIG9uIHlvdXIgdGFyZ2V0IHBsYXRmb3Jtcy4gWW91IHNoYWxsXHJcbiAgbm90IHVzZSBDb2NvcyBDcmVhdG9yIHNvZnR3YXJlIGZvciBkZXZlbG9waW5nIG90aGVyIHNvZnR3YXJlIG9yIHRvb2xzIHRoYXQnc1xyXG4gIHVzZWQgZm9yIGRldmVsb3BpbmcgZ2FtZXMuIFlvdSBhcmUgbm90IGdyYW50ZWQgdG8gcHVibGlzaCwgZGlzdHJpYnV0ZSxcclxuICBzdWJsaWNlbnNlLCBhbmQvb3Igc2VsbCBjb3BpZXMgb2YgQ29jb3MgQ3JlYXRvci5cclxuXHJcbiBUaGUgc29mdHdhcmUgb3IgdG9vbHMgaW4gdGhpcyBMaWNlbnNlIEFncmVlbWVudCBhcmUgbGljZW5zZWQsIG5vdCBzb2xkLlxyXG4gWGlhbWVuIFlhamkgU29mdHdhcmUgQ28uLCBMdGQuIHJlc2VydmVzIGFsbCByaWdodHMgbm90IGV4cHJlc3NseSBncmFudGVkIHRvIHlvdS5cclxuXHJcbiBUSEUgU09GVFdBUkUgSVMgUFJPVklERUQgXCJBUyBJU1wiLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELCBFWFBSRVNTIE9SXHJcbiBJTVBMSUVELCBJTkNMVURJTkcgQlVUIE5PVCBMSU1JVEVEIFRPIFRIRSBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSxcclxuIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFORCBOT05JTkZSSU5HRU1FTlQuIElOIE5PIEVWRU5UIFNIQUxMIFRIRVxyXG4gQVVUSE9SUyBPUiBDT1BZUklHSFQgSE9MREVSUyBCRSBMSUFCTEUgRk9SIEFOWSBDTEFJTSwgREFNQUdFUyBPUiBPVEhFUlxyXG4gTElBQklMSVRZLCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwgVE9SVCBPUiBPVEhFUldJU0UsIEFSSVNJTkcgRlJPTSxcclxuIE9VVCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFIFNPRlRXQVJFIE9SIFRIRSBVU0UgT1IgT1RIRVIgREVBTElOR1MgSU5cclxuIFRIRSBTT0ZUV0FSRS5cclxuICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovXHJcblxyXG5pbXBvcnQgTWF0NCBmcm9tICcuLi8uLi92YWx1ZS10eXBlcy9tYXQ0JztcclxuY29uc3QgU2tlbGV0b24gPSByZXF1aXJlKCcuL0NDU2tlbGV0b24nKTtcclxuY29uc3QgTWVzaFJlbmRlcmVyID0gcmVxdWlyZSgnLi4vLi4vbWVzaC9DQ01lc2hSZW5kZXJlcicpO1xyXG5jb25zdCBSZW5kZXJGbG93ID0gcmVxdWlyZSgnLi4vLi4vcmVuZGVyZXIvcmVuZGVyLWZsb3cnKTtcclxuY29uc3QgZW51bXMgPSByZXF1aXJlKCcuLi8uLi8uLi9yZW5kZXJlci9lbnVtcycpO1xyXG5cclxubGV0IF9tNF90bXAgPSBjYy5tYXQ0KCk7XHJcbmxldCBfbTRfdG1wMiA9IGNjLm1hdDQoKTtcclxuXHJcbi8qKlxyXG4gKiAhI2VuXHJcbiAqIFNraW5uZWQgTWVzaCBSZW5kZXJlclxyXG4gKiAhI3poXHJcbiAqIOiSmeearua4suafk+e7hOS7tlxyXG4gKiBAY2xhc3MgU2tpbm5lZE1lc2hSZW5kZXJlclxyXG4gKiBAZXh0ZW5kcyBNZXNoUmVuZGVyZXJcclxuICovXHJcbmxldCBTa2lubmVkTWVzaFJlbmRlcmVyID0gY2MuQ2xhc3Moe1xyXG4gICAgbmFtZTogJ2NjLlNraW5uZWRNZXNoUmVuZGVyZXInLFxyXG4gICAgZXh0ZW5kczogTWVzaFJlbmRlcmVyLFxyXG5cclxuICAgIGVkaXRvcjogQ0NfRURJVE9SICYmIHtcclxuICAgICAgICBtZW51OiAnaTE4bjpNQUlOX01FTlUuY29tcG9uZW50Lm1lc2gvU2tpbm5lZCBNZXNoIFJlbmRlcmVyJyxcclxuICAgIH0sXHJcblxyXG4gICAgY3RvciAoKSB7XHJcbiAgICAgICAgdGhpcy5fam9pbnRzRGF0YSA9IHRoaXMuX2pvaW50c0Zsb2F0MzJEYXRhID0gbnVsbDtcclxuICAgICAgICB0aGlzLl9qb2ludHNUZXh0dXJlID0gbnVsbDtcclxuICAgICAgICB0aGlzLl9qb2ludHMgPSBbXTtcclxuICAgICAgICB0aGlzLl9kdW1teU5vZGUgPSBuZXcgY2MuTm9kZSgpO1xyXG4gICAgICAgIHRoaXMuX2pvaW50c1RleHR1cmVPcHRpb25zID0gbnVsbDtcclxuICAgICAgICB0aGlzLl91c2luZ1JHQkE4VGV4dHVyZSA9IGZhbHNlO1xyXG4gICAgfSxcclxuXHJcbiAgICBwcm9wZXJ0aWVzOiB7XHJcbiAgICAgICAgX3NrZWxldG9uOiBTa2VsZXRvbixcclxuICAgICAgICBfcm9vdEJvbmU6IGNjLk5vZGUsXHJcblxyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqICEjZW5cclxuICAgICAgICAgKiBTa2VsZXRvbiBBc3NldFxyXG4gICAgICAgICAqICEjemhcclxuICAgICAgICAgKiDpqqjpqrzotYTmupBcclxuICAgICAgICAgKiBAcHJvcGVydHkge1NrZWxldG9ufSBza2VsZXRvblxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIHNrZWxldG9uOiB7XHJcbiAgICAgICAgICAgIGdldCAoKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fc2tlbGV0b247XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIHNldCAodmFsKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9za2VsZXRvbiA9IHZhbDtcclxuICAgICAgICAgICAgICAgIHRoaXMuX2luaXQoKTtcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgdHlwZTogU2tlbGV0b25cclxuICAgICAgICB9LFxyXG5cclxuICAgICAgICAvKipcclxuICAgICAgICAgKiAhI2VuXHJcbiAgICAgICAgICogUm9vdCBCb25lXHJcbiAgICAgICAgICogISN6aFxyXG4gICAgICAgICAqIOmqqOmqvOagueiKgueCuVxyXG4gICAgICAgICAqIEBwcm9wZXJ0eSB7Tm9kZX0gcm9vdEJvbmVcclxuICAgICAgICAgKi9cclxuICAgICAgICByb290Qm9uZToge1xyXG4gICAgICAgICAgICBnZXQgKCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3Jvb3RCb25lO1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBzZXQgKHZhbCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fcm9vdEJvbmUgPSB2YWw7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9pbml0KCk7XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIHR5cGU6IGNjLk5vZGVcclxuICAgICAgICB9LFxyXG5cclxuICAgICAgICAvLyBTa2lubmVkTWVzaFJlbmRlcmVyIGNhbm5vdCBiYXRjaFxyXG4gICAgICAgIGVuYWJsZUF1dG9CYXRjaDoge1xyXG4gICAgICAgICAgICBnZXQgKCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICB2aXNpYmxlOiBmYWxzZSxcclxuICAgICAgICAgICAgb3ZlcnJpZGU6IHRydWVcclxuICAgICAgICB9XHJcbiAgICB9LFxyXG5cclxuICAgIF9fcHJlbG9hZCAoKSB7XHJcbiAgICAgICAgdGhpcy5fc3VwZXIoKTtcclxuICAgICAgICB0aGlzLl9pbml0KCk7XHJcbiAgICB9LFxyXG5cclxuICAgIF9pbml0ICgpIHtcclxuICAgICAgICB0aGlzLl9tb2RlbCA9IHRoaXMuX3NrZWxldG9uICYmIHRoaXMuX3NrZWxldG9uLm1vZGVsO1xyXG4gICAgICAgIHRoaXMuX2NhbEZ1bmMgPSBudWxsO1xyXG4gICAgICAgIFxyXG4gICAgICAgIHRoaXMuX2luaXRKb2ludHMoKTtcclxuICAgICAgICB0aGlzLl9pbml0Sm9pbnRzVGV4dHVyZSgpO1xyXG4gICAgICAgIHRoaXMuX2luaXRDYWxjRnVuYygpO1xyXG4gICAgICAgIHRoaXMuX3VwZGF0ZVJlbmRlck5vZGUoKTtcclxuICAgIH0sXHJcblxyXG4gICAgX2NhbGNXb3JsZE1hdHJpeFRvUm9vdCAoam9pbnQpIHtcclxuICAgICAgICBsZXQgd29ybGRNYXRyaXhUb1Jvb3QgPSBqb2ludC5fd29ybGRNYXRyaXhUb1Jvb3Q7XHJcbiAgICAgICAgaWYgKCF3b3JsZE1hdHJpeFRvUm9vdCkge1xyXG4gICAgICAgICAgICBqb2ludC5fd29ybGRNYXRyaXhUb1Jvb3QgPSB3b3JsZE1hdHJpeFRvUm9vdCA9IGNjLm1hdDQoKTtcclxuICAgICAgICAgICAgam9pbnQuZ2V0TG9jYWxNYXRyaXgod29ybGRNYXRyaXhUb1Jvb3QpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgbGV0IHBhcmVudCA9IGpvaW50LnBhcmVudDtcclxuICAgICAgICBpZiAocGFyZW50ICE9PSB0aGlzLnJvb3RCb25lKSB7XHJcbiAgICAgICAgICAgIGlmICghcGFyZW50Ll93b3JsZE1hdHJpeFRvUm9vdCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fY2FsY1dvcmxkTWF0cml4VG9Sb290KHBhcmVudCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgTWF0NC5tdWwod29ybGRNYXRyaXhUb1Jvb3QsIHBhcmVudC5fd29ybGRNYXRyaXhUb1Jvb3QsIHdvcmxkTWF0cml4VG9Sb290KTtcclxuICAgICAgICB9XHJcbiAgICB9LFxyXG5cclxuICAgIF92YWxpZGF0ZVJlbmRlciAoKSB7XHJcbiAgICAgICAgaWYgKCF0aGlzLl9qb2ludHNEYXRhKSB7XHJcbiAgICAgICAgICAgIHRoaXMuZGlzYWJsZVJlbmRlcigpO1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuX3N1cGVyKCk7XHJcbiAgICB9LFxyXG5cclxuICAgIF9pbml0Sm9pbnRzICgpIHtcclxuICAgICAgICBsZXQgam9pbnRzID0gdGhpcy5fam9pbnRzO1xyXG4gICAgICAgIGpvaW50cy5sZW5ndGggPSAwO1xyXG5cclxuICAgICAgICBpZiAoIXRoaXMuc2tlbGV0b24gfHwgIXRoaXMucm9vdEJvbmUpIHJldHVybjtcclxuXHJcbiAgICAgICAgbGV0IHVzZUpvaW50TWF0cml4ID0gdGhpcy5fdXNlSm9pbnRNYXRyaXgoKTtcclxuXHJcbiAgICAgICAgbGV0IGpvaW50UGF0aHMgPSB0aGlzLnNrZWxldG9uLmpvaW50UGF0aHM7XHJcbiAgICAgICAgbGV0IHJvb3RCb25lID0gdGhpcy5yb290Qm9uZTtcclxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGpvaW50UGF0aHMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgbGV0IGpvaW50ID0gY2MuZmluZChqb2ludFBhdGhzW2ldLCByb290Qm9uZSk7XHJcbiAgICAgICAgICAgIGlmICgham9pbnQpIHtcclxuICAgICAgICAgICAgICAgIGNjLndhcm4oJ0NhbiBub3QgZmluZCBqb2ludCBpbiByb290IGJvbmUgWyVzXSB3aXRoIHBhdGggWyVzXScsIHJvb3RCb25lLm5hbWUsIGpvaW50UGF0aHNbaV0pO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAodXNlSm9pbnRNYXRyaXgpIHtcclxuICAgICAgICAgICAgICAgIGpvaW50Ll9yZW5kZXJGbGFnICY9IH5SZW5kZXJGbG93LkZMQUdfQ0hJTERSRU47XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9jYWxjV29ybGRNYXRyaXhUb1Jvb3Qoam9pbnQpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBqb2ludHMucHVzaChqb2ludCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAodXNlSm9pbnRNYXRyaXgpIHtcclxuICAgICAgICAgICAgY29uc3QgdW5pcXVlQmluZFBvc2VzID0gdGhpcy5za2VsZXRvbi51bmlxdWVCaW5kUG9zZXM7XHJcbiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgam9pbnRQYXRocy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgbGV0IGpvaW50ID0gam9pbnRzW2ldO1xyXG4gICAgICAgICAgICAgICAgaWYgKHVuaXF1ZUJpbmRQb3Nlc1tpXSkge1xyXG4gICAgICAgICAgICAgICAgICAgIE1hdDQubXVsKF9tNF90bXAsIGpvaW50Ll93b3JsZE1hdHJpeFRvUm9vdCwgdW5pcXVlQmluZFBvc2VzW2ldKTtcclxuICAgICAgICAgICAgICAgICAgICBqb2ludC5fam9pbnRNYXRyaXggPSBNYXQ0LnRvQXJyYXkoW10sIF9tNF90bXApO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgam9pbnQuX2pvaW50TWF0cml4ID0gam9pbnQuX3dvcmxkTWF0cml4VG9Sb290O1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9LFxyXG5cclxuICAgIF9pbml0Sm9pbnRzVGV4dHVyZSAoKSB7XHJcbiAgICAgICAgaWYgKCF0aGlzLl9za2VsZXRvbikgcmV0dXJuO1xyXG5cclxuICAgICAgICBsZXQgam9pbnRDb3VudCA9IHRoaXMuX2pvaW50cy5sZW5ndGg7XHJcblxyXG4gICAgICAgIGxldCBpbml0ZWQgPSBmYWxzZTtcclxuICAgICAgICBpZiAoam9pbnRDb3VudCA8PSBjYy5zeXMuZ2V0TWF4Sm9pbnRNYXRyaXhTaXplKCkpIHtcclxuICAgICAgICAgICAgaW5pdGVkID0gdHJ1ZTtcclxuXHJcbiAgICAgICAgICAgIHRoaXMuX2pvaW50c0RhdGEgPSB0aGlzLl9qb2ludHNGbG9hdDMyRGF0YSA9IG5ldyBGbG9hdDMyQXJyYXkoam9pbnRDb3VudCAqIDE2KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICghaW5pdGVkKSB7XHJcbiAgICAgICAgICAgIGxldCBTVVBQT1JUX0ZMT0FUX1RFWFRVUkUgPSAhIWNjLnN5cy5nbEV4dGVuc2lvbignT0VTX3RleHR1cmVfZmxvYXQnKTtcclxuICAgICAgICAgICAgbGV0IHNpemU7XHJcbiAgICAgICAgICAgIGlmIChqb2ludENvdW50ID4gMjU2KSB7XHJcbiAgICAgICAgICAgICAgICBzaXplID0gNjQ7XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoam9pbnRDb3VudCA+IDY0KSB7XHJcbiAgICAgICAgICAgICAgICBzaXplID0gMzI7XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoam9pbnRDb3VudCA+IDE2KSB7XHJcbiAgICAgICAgICAgICAgICBzaXplID0gMTY7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBzaXplID0gODtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgdGhpcy5fam9pbnRzRGF0YSA9IHRoaXMuX2pvaW50c0Zsb2F0MzJEYXRhID0gbmV3IEZsb2F0MzJBcnJheShzaXplICogc2l6ZSAqIDQpO1xyXG5cclxuICAgICAgICAgICAgbGV0IHBpeGVsRm9ybWF0ID0gY2MuVGV4dHVyZTJELlBpeGVsRm9ybWF0LlJHQkEzMkYsIFxyXG4gICAgICAgICAgICAgICAgd2lkdGggPSBzaXplLCBcclxuICAgICAgICAgICAgICAgIGhlaWdodCA9IHNpemU7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBpZiAoIVNVUFBPUlRfRkxPQVRfVEVYVFVSRSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fam9pbnRzRGF0YSA9IG5ldyBVaW50OEFycmF5KHRoaXMuX2pvaW50c0Zsb2F0MzJEYXRhLmJ1ZmZlcik7XHJcbiAgICAgICAgICAgICAgICBwaXhlbEZvcm1hdCA9IGNjLlRleHR1cmUyRC5QaXhlbEZvcm1hdC5SR0JBODg4ODtcclxuICAgICAgICAgICAgICAgIHdpZHRoICo9IDQ7XHJcblxyXG4gICAgICAgICAgICAgICAgdGhpcy5fdXNpbmdSR0JBOFRleHR1cmUgPSB0cnVlO1xyXG5cclxuICAgICAgICAgICAgICAgIGNjLndhcm4oYFNraW5uZWRNZXNoUmVuZGVyZXIgWyR7dGhpcy5ub2RlLm5hbWV9XSBoYXMgdG9vIG1hbnkgam9pbnRzIFske2pvaW50Q291bnR9XSBhbmQgZGV2aWNlIGRvIG5vdCBzdXBwb3J0IGZsb2F0MzIgdGV4dHVyZSwgZmFsbGJhY2sgdG8gdXNlIFJHQkE4ODg4IHRleHR1cmUsIHdoaWNoIGlzIG11Y2ggc2xvd2VyLmApO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBsZXQgdGV4dHVyZSA9IHRoaXMuX2pvaW50c1RleHR1cmUgfHwgbmV3IGNjLlRleHR1cmUyRCgpO1xyXG4gICAgICAgICAgICBsZXQgTkVBUkVTVCA9IGNjLlRleHR1cmUyRC5GaWx0ZXIuTkVBUkVTVDtcclxuICAgICAgICAgICAgdGV4dHVyZS5zZXRGaWx0ZXJzKE5FQVJFU1QsIE5FQVJFU1QpO1xyXG4gICAgICAgICAgICB0ZXh0dXJlLmluaXRXaXRoRGF0YSh0aGlzLl9qb2ludHNEYXRhLCBwaXhlbEZvcm1hdCwgd2lkdGgsIGhlaWdodCk7XHJcbiAgICAgICAgICAgIHRoaXMuX2pvaW50c1RleHR1cmUgPSB0ZXh0dXJlO1xyXG4gICAgICAgICAgICB0aGlzLl9qb2ludHNUZXh0dXJlT3B0aW9ucyA9IHtcclxuICAgICAgICAgICAgICAgIGZvcm1hdDogcGl4ZWxGb3JtYXQsIFxyXG4gICAgICAgICAgICAgICAgd2lkdGg6IHRleHR1cmUud2lkdGgsIFxyXG4gICAgICAgICAgICAgICAgaGVpZ2h0OiB0ZXh0dXJlLmhlaWdodCwgXHJcbiAgICAgICAgICAgICAgICBpbWFnZXM6W11cclxuICAgICAgICAgICAgfTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMuX3VwZGF0ZU1hdGVyaWFsKCk7XHJcbiAgICB9LFxyXG5cclxuICAgIF91cGRhdGVNYXRlcmlhbCAoKSB7XHJcbiAgICAgICAgTWVzaFJlbmRlcmVyLnByb3RvdHlwZS5fdXBkYXRlTWF0ZXJpYWwuY2FsbCh0aGlzKTtcclxuXHJcbiAgICAgICAgbGV0IG1hdGVyaWFscyA9IHRoaXMuZ2V0TWF0ZXJpYWxzKCk7XHJcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBtYXRlcmlhbHMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgbGV0IG1hdGVyaWFsID0gbWF0ZXJpYWxzW2ldO1xyXG4gICAgICAgICAgICBpZiAodGhpcy5fam9pbnRzVGV4dHVyZSkge1xyXG4gICAgICAgICAgICAgICAgbWF0ZXJpYWwuc2V0UHJvcGVydHkoJ2pvaW50c1RleHR1cmUnLCB0aGlzLl9qb2ludHNUZXh0dXJlKTtcclxuICAgICAgICAgICAgICAgIG1hdGVyaWFsLnNldFByb3BlcnR5KCdqb2ludHNUZXh0dXJlU2l6ZScsIG5ldyBGbG9hdDMyQXJyYXkoW3RoaXMuX2pvaW50c1RleHR1cmUud2lkdGgsIHRoaXMuX2pvaW50c1RleHR1cmUuaGVpZ2h0XSkpO1xyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICBtYXRlcmlhbC5kZWZpbmUoJ0NDX0pPSU5UU19URVhUVVJFX0ZMT0FUMzInLCAhIWNjLnN5cy5nbEV4dGVuc2lvbignT0VTX3RleHR1cmVfZmxvYXQnKSk7XHJcbiAgICAgICAgICAgICAgICBtYXRlcmlhbC5kZWZpbmUoJ0NDX1VTRV9KT0lOVFNfVEVYVFJVRScsIHRydWUpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuX2pvaW50c0Zsb2F0MzJEYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbWF0ZXJpYWwuc2V0UHJvcGVydHkoJ2pvaW50TWF0cmljZXMnLCB0aGlzLl9qb2ludHNGbG9hdDMyRGF0YSwgdW5kZWZpbmVkLCB0cnVlKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIG1hdGVyaWFsLmRlZmluZSgnQ0NfVVNFX0pPSU5UU19URVhUUlVFJywgZmFsc2UpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIG1hdGVyaWFsLmRlZmluZSgnQ0NfVVNFX1NLSU5OSU5HJywgdHJ1ZSk7XHJcbiAgICAgICAgfVxyXG4gICAgfSxcclxuXHJcbiAgICBfc2V0Sm9pbnRzRGF0YVdpdGhBcnJheSAoaU1hdHJpeCwgbWF0cml4QXJyYXkpIHtcclxuICAgICAgICBsZXQgZGF0YSA9IHRoaXMuX2pvaW50c0Zsb2F0MzJEYXRhO1xyXG4gICAgICAgIGRhdGEuc2V0KG1hdHJpeEFycmF5LCBpTWF0cml4ICogMTYpO1xyXG4gICAgfSxcclxuXHJcbiAgICBfc2V0Sm9pbnRzRGF0YVdpdGhNYXRyaXggKGlNYXRyaXgsIG1hdHJpeCkge1xyXG4gICAgICAgIHRoaXMuX2pvaW50c0Zsb2F0MzJEYXRhLnNldChtYXRyaXgubSwgMTYgKiBpTWF0cml4KTtcclxuICAgIH0sXHJcblxyXG4gICAgX2NvbW1pdEpvaW50c0RhdGEgKCkge1xyXG4gICAgICAgIGlmICh0aGlzLl9qb2ludHNUZXh0dXJlKSB7XHJcbiAgICAgICAgICAgIHRoaXMuX2pvaW50c1RleHR1cmVPcHRpb25zLmltYWdlc1swXSA9IHRoaXMuX2pvaW50c0RhdGE7XHJcbiAgICAgICAgICAgIHRoaXMuX2pvaW50c1RleHR1cmUudXBkYXRlKHRoaXMuX2pvaW50c1RleHR1cmVPcHRpb25zKTtcclxuICAgICAgICB9XHJcbiAgICB9LFxyXG5cclxuICAgIF91c2VKb2ludE1hdHJpeCAoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX21vZGVsICYmIHRoaXMuX21vZGVsLnByZWNvbXB1dGVKb2ludE1hdHJpeDtcclxuICAgIH0sXHJcblxyXG4gICAgX3VwZGF0ZVJlbmRlck5vZGUgKCkge1xyXG4gICAgICAgIGlmICh0aGlzLl91c2VKb2ludE1hdHJpeCgpIHx8IHRoaXMuX3VzaW5nUkdCQThUZXh0dXJlKSB7XHJcbiAgICAgICAgICAgIHRoaXMuX2Fzc2VtYmxlci5zZXRSZW5kZXJOb2RlKHRoaXMucm9vdEJvbmUpXHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5fYXNzZW1ibGVyLnNldFJlbmRlck5vZGUodGhpcy5fZHVtbXlOb2RlKTtcclxuICAgICAgICB9XHJcbiAgICB9LFxyXG5cclxuICAgIF9pbml0Q2FsY0Z1bmMgKCkge1xyXG4gICAgICAgIGlmICh0aGlzLl91c2VKb2ludE1hdHJpeCgpKSB7XHJcbiAgICAgICAgICAgIHRoaXMuX2NhbEZ1bmMgPSB0aGlzLl9jYWxKb2ludE1hdHJpeDtcclxuICAgICAgICB9IFxyXG4gICAgICAgIGVsc2UgaWYgKHRoaXMuX3VzaW5nUkdCQThUZXh0dXJlKSB7XHJcbiAgICAgICAgICAgIHRoaXMuX2NhbEZ1bmMgPSB0aGlzLl9jYWxSR0JBOFdvcmxkTWF0cml4O1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5fY2FsRnVuYyA9IHRoaXMuX2NhbFdvcmxkTWF0cml4O1xyXG4gICAgICAgIH1cclxuICAgIH0sXHJcblxyXG4gICAgX2NhbEpvaW50TWF0cml4ICgpIHtcclxuICAgICAgICBjb25zdCBqb2ludHMgPSB0aGlzLl9qb2ludHM7XHJcbiAgICAgICAgY29uc3QgYmluZHBvc2VzID0gdGhpcy5za2VsZXRvbi5iaW5kcG9zZXM7XHJcbiAgICAgICAgY29uc3QgdW5pcXVlQmluZFBvc2VzID0gdGhpcy5za2VsZXRvbi51bmlxdWVCaW5kUG9zZXM7XHJcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBqb2ludHMubGVuZ3RoOyArK2kpIHtcclxuICAgICAgICAgICAgbGV0IGpvaW50ID0gam9pbnRzW2ldO1xyXG4gICAgICAgICAgICBsZXQgam9pbnRNYXRyaXggPSBqb2ludC5fam9pbnRNYXRyaXg7XHJcblxyXG4gICAgICAgICAgICBpZiAodW5pcXVlQmluZFBvc2VzW2ldKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9zZXRKb2ludHNEYXRhV2l0aEFycmF5KGksIGpvaW50TWF0cml4KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIE1hdDQubXVsdGlwbHkoX200X3RtcCwgam9pbnRNYXRyaXgsIGJpbmRwb3Nlc1tpXSk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9zZXRKb2ludHNEYXRhV2l0aE1hdHJpeChpLCBfbTRfdG1wKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH0sXHJcblxyXG4gICAgLy8gU29tZSBkZXZpY2UgcmdiYTggdGV4dHVyZSBwcmVjaXNpb24gaXMgbG93LCB3aGVuIGVuY29kZSBhIGJpZyBudW1iZXIgaXQgbWF5IGxvc3MgcHJlY2lzaW9uLlxyXG4gICAgLy8gSW52ZXJ0IHJvb3QgYm9uZSBtYXRyaXggY2FuIGVmZmVjdGl2ZWx5IGF2b2lkIGJpZyBwb3NpdGlvbiBlbmNvZGUgaW50byByZ2JhOCB0ZXh0dXJlLlxyXG4gICAgX2NhbFJHQkE4V29ybGRNYXRyaXggKCkge1xyXG4gICAgICAgIGNvbnN0IGpvaW50cyA9IHRoaXMuX2pvaW50cztcclxuICAgICAgICBjb25zdCBiaW5kcG9zZXMgPSB0aGlzLnNrZWxldG9uLmJpbmRwb3NlcztcclxuXHJcbiAgICAgICAgdGhpcy5yb290Qm9uZS5fdXBkYXRlV29ybGRNYXRyaXgoKTtcclxuICAgICAgICBsZXQgcm9vdE1hdHJpeCA9IHRoaXMucm9vdEJvbmUuX3dvcmxkTWF0cml4O1xyXG4gICAgICAgIGxldCBpbnZSb290TWF0ID0gTWF0NC5pbnZlcnQoX200X3RtcDIsIHJvb3RNYXRyaXgpO1xyXG5cclxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGpvaW50cy5sZW5ndGg7ICsraSkge1xyXG4gICAgICAgICAgICBsZXQgam9pbnQgPSBqb2ludHNbaV07XHJcbiAgICAgICAgICAgIGpvaW50Ll91cGRhdGVXb3JsZE1hdHJpeCgpO1xyXG5cclxuICAgICAgICAgICAgTWF0NC5tdWx0aXBseShfbTRfdG1wLCBpbnZSb290TWF0LCBqb2ludC5fd29ybGRNYXRyaXgpO1xyXG4gICAgICAgICAgICBNYXQ0Lm11bHRpcGx5KF9tNF90bXAsIF9tNF90bXAsIGJpbmRwb3Nlc1tpXSk7XHJcbiAgICAgICAgICAgIHRoaXMuX3NldEpvaW50c0RhdGFXaXRoTWF0cml4KGksIF9tNF90bXApO1xyXG4gICAgICAgIH1cclxuICAgIH0sXHJcblxyXG4gICAgX2NhbFdvcmxkTWF0cml4ICgpIHtcclxuICAgICAgICBjb25zdCBqb2ludHMgPSB0aGlzLl9qb2ludHM7XHJcbiAgICAgICAgY29uc3QgYmluZHBvc2VzID0gdGhpcy5za2VsZXRvbi5iaW5kcG9zZXM7XHJcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBqb2ludHMubGVuZ3RoOyArK2kpIHtcclxuICAgICAgICAgICAgbGV0IGpvaW50ID0gam9pbnRzW2ldO1xyXG5cclxuICAgICAgICAgICAgam9pbnQuX3VwZGF0ZVdvcmxkTWF0cml4KCk7XHJcbiAgICAgICAgICAgIE1hdDQubXVsdGlwbHkoX200X3RtcCwgam9pbnQuX3dvcmxkTWF0cml4LCBiaW5kcG9zZXNbaV0pO1xyXG4gICAgICAgICAgICB0aGlzLl9zZXRKb2ludHNEYXRhV2l0aE1hdHJpeChpLCBfbTRfdG1wKTtcclxuICAgICAgICB9XHJcbiAgICB9LFxyXG5cclxuICAgIGNhbGNKb2ludE1hdHJpeCAoKSB7XHJcbiAgICAgICAgaWYgKCF0aGlzLnNrZWxldG9uIHx8ICF0aGlzLnJvb3RCb25lKSByZXR1cm47XHJcblxyXG4gICAgICAgIHRoaXMuX2NhbEZ1bmMuY2FsbCh0aGlzKTtcclxuICAgICAgICB0aGlzLl9jb21taXRKb2ludHNEYXRhKCk7XHJcbiAgICB9XHJcbn0pO1xyXG5cclxuY2MuU2tpbm5lZE1lc2hSZW5kZXJlciA9IG1vZHVsZS5leHBvcnRzID0gU2tpbm5lZE1lc2hSZW5kZXJlcjtcclxuIl0sInNvdXJjZVJvb3QiOiIvIn0=