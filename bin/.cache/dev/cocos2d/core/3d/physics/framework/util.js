
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'engine-dev/cocos2d/core/3d/physics/framework/util.js';
                    var __require = nodeEnv ? function (request) {
                        return require(request);
                    } : function (request) {
                        return __quick_compile_engine__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_engine__.registerModule(__filename, module);}"use strict";

exports.__esModule = true;
exports.stringfyVec3 = stringfyVec3;
exports.stringfyQuat = stringfyQuat;
exports.setWrap = setWrap;
exports.getWrap = getWrap;
exports.clearNodeTransformDirtyFlag = clearNodeTransformDirtyFlag;
exports.clearNodeTransformRecord = clearNodeTransformRecord;
exports.updateWorldTransform = updateWorldTransform;
exports.updateWorldRT = updateWorldRT;
exports.worldDirty = worldDirty;

/****************************************************************************
 Copyright (c) 2019 Xiamen Yaji Software Co., Ltd.

 https://www.cocos.com/

 Permission is hereby granted, free of charge, to any person obtaining a copy
 of this software and associated engine source code (the "Software"), a limited,
 worldwide, royalty-free, non-assignable, revocable and non-exclusive license
 to use Cocos Creator solely to develop games on your target platforms. You shall
 not use Cocos Creator software for developing other software or tools that's
 used for developing games. You are not granted to publish, distribute,
 sublicense, and/or sell copies of Cocos Creator.

 The software or tools in this License Agreement are licensed, not sold.
 Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.

 THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 THE SOFTWARE.
 ****************************************************************************/
function stringfyVec3(value) {
  return "(x: " + value.x + ", y: " + value.y + ", z: " + value.z + ")";
}

function stringfyQuat(value) {
  return "(x: " + value.x + ", y: " + value.y + ", z: " + value.z + ", w: " + value.w + ")";
}

function setWrap(object, wrapper) {
  object.__cc_wrapper__ = wrapper;
}

function getWrap(object) {
  return object.__cc_wrapper__;
}

var LocalDirtyFlag = cc.Node._LocalDirtyFlag;
var PHYSICS_TRS = LocalDirtyFlag.PHYSICS_TRS;
var ALL_TRS = LocalDirtyFlag.ALL_TRS;
var SKEW = LocalDirtyFlag.SKEW;
var FLAG_TRANSFORM = cc.RenderFlow.FLAG_TRANSFORM;
var Mat3 = cc.Mat3;
var Mat4 = cc.Mat4;
var Vec3 = cc.Vec3;
var Quat = cc.Quat;
var Trs = cc.Trs;
var _nodeArray = [];

var _lpos = cc.v3();

var _lrot = cc.quat();

var _mat3 = new Mat3();

var _mat3m = _mat3.m;

var _quat = cc.quat();

var _mat4 = cc.mat4();

var _nodeTransformRecord = {};

function clearNodeTransformDirtyFlag() {
  for (var key in _nodeTransformRecord) {
    var physicsNode = _nodeTransformRecord[key];
    physicsNode._localMatDirty &= ~ALL_TRS;

    if (!(physicsNode._localMatDirty & SKEW)) {
      physicsNode._worldMatDirty = false;
      !CC_NATIVERENDERER && (physicsNode._renderFlag &= ~FLAG_TRANSFORM);
    }
  }

  _nodeTransformRecord = {};
  _nodeArray.length = 0;
}

function clearNodeTransformRecord() {
  _nodeTransformRecord = {};
  _nodeArray.length = 0;
}
/*
 * The method of node backtrace is used to optimize the calculation of global transformation. 
 * Node backtrace is continuous until the parent node is empty or the parent node has performed the calculation of global transformation.
 * The result of backtrace will store the node relational chain in the array. 
 * The process of traversing array is equivalent to the process of global transformation from the parent node to the physical node.
 * The calculated results are saved in the node, and the physical global transformation flag will be erased finally.
 */


function updateWorldTransform(node, traverseAllNode) {
  if (traverseAllNode === void 0) {
    traverseAllNode = false;
  }

  var cur = node;
  var i = 0;
  var needUpdateTransform = false;
  var physicsDirtyFlag = 0;

  while (cur) {
    // If current node transform has been calculated
    if (traverseAllNode || !_nodeTransformRecord[cur._id]) {
      _nodeArray[i++] = cur;
    } else {
      // Current node's transform has beed calculated
      physicsDirtyFlag |= cur._localMatDirty & PHYSICS_TRS;
      needUpdateTransform = needUpdateTransform || !!physicsDirtyFlag;
      break;
    }

    if (cur._localMatDirty & PHYSICS_TRS) {
      needUpdateTransform = true;
    }

    cur = cur._parent;
  }

  if (!needUpdateTransform) {
    return false;
  }

  var child;
  var childWorldMat, curWorldMat, childTrs, childLocalMat;
  var wpos, wrot, wscale;
  _nodeArray.length = i;

  while (i) {
    child = _nodeArray[--i];
    !traverseAllNode && (_nodeTransformRecord[child._id] = child);
    childWorldMat = child._worldMatrix;
    childLocalMat = child._matrix;
    childTrs = child._trs;
    wpos = child.__wpos = child.__wpos || cc.v3();
    wrot = child.__wrot = child.__wrot || cc.quat();
    wscale = child.__wscale = child.__wscale || cc.v3();

    if (child._localMatDirty & PHYSICS_TRS) {
      Trs.toMat4(childLocalMat, childTrs);
    }

    child._localMatDirty |= physicsDirtyFlag;
    physicsDirtyFlag |= child._localMatDirty & PHYSICS_TRS;

    if (!(physicsDirtyFlag & PHYSICS_TRS)) {
      cur = child;
      continue;
    }

    if (cur) {
      curWorldMat = cur._worldMatrix;
      Trs.toPosition(_lpos, childTrs);
      Vec3.transformMat4(wpos, _lpos, curWorldMat);
      Mat4.multiply(childWorldMat, curWorldMat, childLocalMat);
      Trs.toRotation(_lrot, childTrs);
      Quat.multiply(wrot, cur.__wrot, _lrot);
      Mat3.fromQuat(_mat3, Quat.conjugate(_quat, wrot));
      Mat3.multiplyMat4(_mat3, _mat3, childWorldMat);
      wscale.x = _mat3m[0];
      wscale.y = _mat3m[4];
      wscale.z = _mat3m[8];
    } else {
      Trs.toPosition(wpos, childTrs);
      Trs.toRotation(wrot, childTrs);
      Trs.toScale(wscale, childTrs);
      Mat4.copy(childWorldMat, childLocalMat);
    }

    cur = child;
  }

  return true;
}

function updateWorldRT(node, position, rotation) {
  var parent = node.parent;

  if (parent) {
    updateWorldTransform(parent, true);
    Vec3.transformMat4(_lpos, position, Mat4.invert(_mat4, parent._worldMatrix));
    Quat.multiply(_quat, Quat.conjugate(_quat, parent.__wrot), rotation);
    node.setPosition(_lpos);
    node.setRotation(_quat);
  } else {
    node.setPosition(position);
    node.setRotation(rotation);
  }
}

function worldDirty(node) {
  var cur = node;

  while (cur) {
    if (cur._worldMatDirty) return true;
    cur = cur._parent;
  }

  return false;
}
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_engine__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImVuZ2luZS1kZXZcXGNvY29zMmRcXGNvcmVcXDNkXFxwaHlzaWNzXFxmcmFtZXdvcmtcXHV0aWwudHMiXSwibmFtZXMiOlsic3RyaW5nZnlWZWMzIiwidmFsdWUiLCJ4IiwieSIsInoiLCJzdHJpbmdmeVF1YXQiLCJ3Iiwic2V0V3JhcCIsIm9iamVjdCIsIndyYXBwZXIiLCJfX2NjX3dyYXBwZXJfXyIsImdldFdyYXAiLCJMb2NhbERpcnR5RmxhZyIsImNjIiwiTm9kZSIsIl9Mb2NhbERpcnR5RmxhZyIsIlBIWVNJQ1NfVFJTIiwiQUxMX1RSUyIsIlNLRVciLCJGTEFHX1RSQU5TRk9STSIsIlJlbmRlckZsb3ciLCJNYXQzIiwiTWF0NCIsIlZlYzMiLCJRdWF0IiwiVHJzIiwiX25vZGVBcnJheSIsIl9scG9zIiwidjMiLCJfbHJvdCIsInF1YXQiLCJfbWF0MyIsIl9tYXQzbSIsIm0iLCJfcXVhdCIsIl9tYXQ0IiwibWF0NCIsIl9ub2RlVHJhbnNmb3JtUmVjb3JkIiwiY2xlYXJOb2RlVHJhbnNmb3JtRGlydHlGbGFnIiwia2V5IiwicGh5c2ljc05vZGUiLCJfbG9jYWxNYXREaXJ0eSIsIl93b3JsZE1hdERpcnR5IiwiQ0NfTkFUSVZFUkVOREVSRVIiLCJfcmVuZGVyRmxhZyIsImxlbmd0aCIsImNsZWFyTm9kZVRyYW5zZm9ybVJlY29yZCIsInVwZGF0ZVdvcmxkVHJhbnNmb3JtIiwibm9kZSIsInRyYXZlcnNlQWxsTm9kZSIsImN1ciIsImkiLCJuZWVkVXBkYXRlVHJhbnNmb3JtIiwicGh5c2ljc0RpcnR5RmxhZyIsIl9pZCIsIl9wYXJlbnQiLCJjaGlsZCIsImNoaWxkV29ybGRNYXQiLCJjdXJXb3JsZE1hdCIsImNoaWxkVHJzIiwiY2hpbGRMb2NhbE1hdCIsIndwb3MiLCJ3cm90Iiwid3NjYWxlIiwiX3dvcmxkTWF0cml4IiwiX21hdHJpeCIsIl90cnMiLCJfX3dwb3MiLCJfX3dyb3QiLCJfX3dzY2FsZSIsInRvTWF0NCIsInRvUG9zaXRpb24iLCJ0cmFuc2Zvcm1NYXQ0IiwibXVsdGlwbHkiLCJ0b1JvdGF0aW9uIiwiZnJvbVF1YXQiLCJjb25qdWdhdGUiLCJtdWx0aXBseU1hdDQiLCJ0b1NjYWxlIiwiY29weSIsInVwZGF0ZVdvcmxkUlQiLCJwb3NpdGlvbiIsInJvdGF0aW9uIiwicGFyZW50IiwiaW52ZXJ0Iiwic2V0UG9zaXRpb24iLCJzZXRSb3RhdGlvbiIsIndvcmxkRGlydHkiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUlPLFNBQVNBLFlBQVQsQ0FBdUJDLEtBQXZCLEVBQWlEO0FBQ3BELGtCQUFjQSxLQUFLLENBQUNDLENBQXBCLGFBQTZCRCxLQUFLLENBQUNFLENBQW5DLGFBQTRDRixLQUFLLENBQUNHLENBQWxEO0FBQ0g7O0FBRU0sU0FBU0MsWUFBVCxDQUF1QkosS0FBdkIsRUFBaUQ7QUFDcEQsa0JBQWNBLEtBQUssQ0FBQ0MsQ0FBcEIsYUFBNkJELEtBQUssQ0FBQ0UsQ0FBbkMsYUFBNENGLEtBQUssQ0FBQ0csQ0FBbEQsYUFBMkRILEtBQUssQ0FBQ0ssQ0FBakU7QUFDSDs7QUFNTSxTQUFTQyxPQUFULENBQTJCQyxNQUEzQixFQUF3Q0MsT0FBeEMsRUFBMEQ7QUFDNURELEVBQUFBLE1BQUQsQ0FBOEJFLGNBQTlCLEdBQStDRCxPQUEvQztBQUNIOztBQUVNLFNBQVNFLE9BQVQsQ0FBMkJILE1BQTNCLEVBQXdDO0FBQzNDLFNBQVFBLE1BQUQsQ0FBOEJFLGNBQXJDO0FBQ0g7O0FBRUQsSUFBTUUsY0FBYyxHQUFHQyxFQUFFLENBQUNDLElBQUgsQ0FBUUMsZUFBL0I7QUFDQSxJQUFNQyxXQUFXLEdBQUdKLGNBQWMsQ0FBQ0ksV0FBbkM7QUFDQSxJQUFNQyxPQUFPLEdBQUdMLGNBQWMsQ0FBQ0ssT0FB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LElBQXJCLEVBQW9DO0FBQ3ZDLE1BQUlFLEdBQUcsR0FBR0YsSUFBVjs7QUFDQSxTQUFPRSxHQUFQLEVBQVk7QUFDUixRQUFJQSxHQUFHLENBQUNSLGNBQVIsRUFBd0IsT0FBTyxJQUFQO0FBQ3hCUSxJQUFBQSxHQUFHLEdBQUdBLEdBQUcsQ0FBQ0ssT0FBVjtBQUNIOztBQUNELFNBQU8sS0FBUDtBQUNIIiwic291cmNlc0NvbnRlbnQiOlsiLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKipcclxuIENvcHlyaWdodCAoYykgMjAxOSBYaWFtZW4gWWFqaSBTb2Z0d2FyZSBDby4sIEx0ZC5cclxuXHJcbiBodHRwczovL3d3dy5jb2Nvcy5jb20vXHJcblxyXG4gUGVybWlzc2lvbiBpcyBoZXJlYnkgZ3JhbnRlZCwgZnJlZSBvZiBjaGFyZ2UsIHRvIGFueSBwZXJzb24gb2J0YWluaW5nIGEgY29weVxyXG4gb2YgdGhpcyBzb2Z0d2FyZSBhbmQgYXNzb2NpYXRlZCBlbmdpbmUgc291cmNlIGNvZGUgKHRoZSBcIlNvZnR3YXJlXCIpLCBhIGxpbWl0ZWQsXHJcbiB3b3JsZHdpZGUsIHJveWFsdHktZnJlZSwgbm9uLWFzc2lnbmFibGUsIHJldm9jYWJsZSBhbmQgbm9uLWV4Y2x1c2l2ZSBsaWNlbnNlXHJcbiB0byB1c2UgQ29jb3MgQ3JlYXRvciBzb2xlbHkgdG8gZGV2ZWxvcCBnYW1lcyBvbiB5b3VyIHRhcmdldCBwbGF0Zm9ybXMuIFlvdSBzaGFsbFxyXG4gbm90IHVzZSBDb2NvcyBDcmVhdG9yIHNvZnR3YXJlIGZvciBkZXZlbG9waW5nIG90aGVyIHNvZnR3YXJlIG9yIHRvb2xzIHRoYXQnc1xyXG4gdXNlZCBmb3IgZGV2ZWxvcGluZyBnYW1lcy4gWW91IGFyZSBub3QgZ3JhbnRlZCB0byBwdWJsaXNoLCBkaXN0cmlidXRlLFxyXG4gc3VibGljZW5zZSwgYW5kL29yIHNlbGwgY29waWVzIG9mIENvY29zIENyZWF0b3IuXHJcblxyXG4gVGhlIHNvZnR3YXJlIG9yIHRvb2xzIGluIHRoaXMgTGljZW5zZSBBZ3JlZW1lbnQgYXJlIGxpY2Vuc2VkLCBub3Qgc29sZC5cclxuIFhpYW1lbiBZYWppIFNvZnR3YXJlIENvLiwgTHRkLiByZXNlcnZlcyBhbGwgcmlnaHRzIG5vdCBleHByZXNzbHkgZ3JhbnRlZCB0byB5b3UuXHJcblxyXG4gVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEIFwiQVMgSVNcIiwgV0lUSE9VVCBXQVJSQU5UWSBPRiBBTlkgS0lORCwgRVhQUkVTUyBPUlxyXG4gSU1QTElFRCwgSU5DTFVESU5HIEJVVCBOT1QgTElNSVRFRCBUTyBUSEUgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFksXHJcbiBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBTkQgTk9OSU5GUklOR0VNRU5ULiBJTiBOTyBFVkVOVCBTSEFMTCBUSEVcclxuIEFVVEhPUlMgT1IgQ09QWVJJR0hUIEhPTERFUlMgQkUgTElBQkxFIEZPUiBBTlkgQ0xBSU0sIERBTUFHRVMgT1IgT1RIRVJcclxuIExJQUJJTElUWSwgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIFRPUlQgT1IgT1RIRVJXSVNFLCBBUklTSU5HIEZST00sXHJcbiBPVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRSBTT0ZUV0FSRSBPUiBUSEUgVVNFIE9SIE9USEVSIERFQUxJTkdTIElOXHJcbiBUSEUgU09GVFdBUkUuXHJcbiAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqL1xyXG5cclxuaW1wb3J0IHsgSVZlYzNMaWtlLCBJUXVhdExpa2UgfSBmcm9tICcuLi9zcGVjL2ktY29tbW9uJztcclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBzdHJpbmdmeVZlYzMgKHZhbHVlOiBJVmVjM0xpa2UpOiBzdHJpbmcge1xyXG4gICAgcmV0dXJuIGAoeDogJHt2YWx1ZS54fSwgeTogJHt2YWx1ZS55fSwgejogJHt2YWx1ZS56fSlgO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gc3RyaW5nZnlRdWF0ICh2YWx1ZTogSVF1YXRMaWtlKTogc3RyaW5nIHtcclxuICAgIHJldHVybiBgKHg6ICR7dmFsdWUueH0sIHk6ICR7dmFsdWUueX0sIHo6ICR7dmFsdWUuen0sIHc6ICR7dmFsdWUud30pYDtcclxufVxyXG5cclxuaW50ZXJmYWNlIElXcmFwcGVkPFQ+IHtcclxuICAgIF9fY2Nfd3JhcHBlcl9fOiBUO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gc2V0V3JhcDxXcmFwcGVyPiAob2JqZWN0OiBhbnksIHdyYXBwZXI6IFdyYXBwZXIpIHtcclxuICAgIChvYmplY3QgYXMgSVdyYXBwZWQ8V3JhcHBlcj4pLl9fY2Nfd3JhcHBlcl9fID0gd3JhcHBlcjtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGdldFdyYXA8V3JhcHBlcj4gKG9iamVjdDogYW55KSB7XHJcbiAgICByZXR1cm4gKG9iamVjdCBhcyBJV3JhcHBlZDxXcmFwcGVyPikuX19jY193cmFwcGVyX187XHJcbn1cclxuXHJcbmNvbnN0IExvY2FsRGlydHlGbGFnID0gY2MuTm9kZS5fTG9jYWxEaXJ0eUZsYWc7XHJcbmNvbnN0IFBIWVNJQ1NfVFJTID0gTG9jYWxEaXJ0eUZsYWcuUEhZU0lDU19UUlM7XHJcbmNvbnN0IEFMTF9UUlMgPSBMb2NhbERpcnR5RmxhZy5BTExfVFJTO1xyXG5jb25zdCBTS0VXID0gTG9jYWxEaXJ0eUZsYWcuU0tFVztcclxuY29uc3QgRkxBR19UUkFOU0ZPUk0gPSBjYy5SZW5kZXJGbG93LkZMQUdfVFJBTlNGT1JNO1xyXG5cclxuY29uc3QgTWF0MyA9IGNjLk1hdDM7XHJcbmNvbnN0IE1hdDQgPSBjYy5NYXQ0O1xyXG5jb25zdCBWZWMzID0gY2MuVmVjMztcclxuY29uc3QgUXVhdCA9IGNjLlF1YXQ7XHJcbmNvbnN0IFRycyA9IGNjLlRycztcclxuXHJcbmNvbnN0IF9ub2RlQXJyYXk6IEFycmF5PGNjLk5vZGU+ID0gW107XHJcbmNvbnN0IF9scG9zID0gY2MudjMoKTtcclxuY29uc3QgX2xyb3QgPSBjYy5xdWF0KCk7XHJcbmNvbnN0IF9tYXQzID0gbmV3IE1hdDMoKTtcclxuY29uc3QgX21hdDNtID0gX21hdDMubTtcclxuY29uc3QgX3F1YXQgPSBjYy5xdWF0KCk7XHJcbmNvbnN0IF9tYXQ0ID0gY2MubWF0NCgpO1xyXG5cclxubGV0IF9ub2RlVHJhbnNmb3JtUmVjb3JkID0ge307XHJcbmV4cG9ydCBmdW5jdGlvbiBjbGVhck5vZGVUcmFuc2Zvcm1EaXJ0eUZsYWcgKCkge1xyXG4gICAgZm9yIChsZXQga2V5IGluIF9ub2RlVHJhbnNmb3JtUmVjb3JkKSB7XHJcbiAgICAgICAgbGV0IHBoeXNpY3NOb2RlID0gX25vZGVUcmFuc2Zvcm1SZWNvcmRba2V5XTtcclxuICAgICAgICBwaHlzaWNzTm9kZS5fbG9jYWxNYXREaXJ0eSAmPSB+QUxMX1RSUztcclxuICAgICAgICBpZiAoIShwaHlzaWNzTm9kZS5fbG9jYWxNYXREaXJ0eSAmIFNLRVcpKSB7XHJcbiAgICAgICAgICAgIHBoeXNpY3NOb2RlLl93b3JsZE1hdERpcnR5ID0gZmFsc2U7XHJcbiAgICAgICAgICAgICFDQ19OQVRJVkVSRU5ERVJFUiAmJiAocGh5c2ljc05vZGUuX3JlbmRlckZsYWcgJj0gfkZMQUdfVFJBTlNGT1JNKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBfbm9kZVRyYW5zZm9ybVJlY29yZCA9IHt9O1xyXG4gICAgX25vZGVBcnJheS5sZW5ndGggPSAwO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gY2xlYXJOb2RlVHJhbnNmb3JtUmVjb3JkICgpIHtcclxuICAgIF9ub2RlVHJhbnNmb3JtUmVjb3JkID0ge307XHJcbiAgICBfbm9kZUFycmF5Lmxlbmd0aCA9IDA7XHJcbn1cclxuXHJcbi8qXHJcbiAqIFRoZSBtZXRob2Qgb2Ygbm9kZSBiYWNrdHJhY2UgaXMgdXNlZCB0byBvcHRpbWl6ZSB0aGUgY2FsY3VsYXRpb24gb2YgZ2xvYmFsIHRyYW5zZm9ybWF0aW9uLiBcclxuICogTm9kZSBiYWNrdHJhY2UgaXMgY29udGludW91cyB1bnRpbCB0aGUgcGFyZW50IG5vZGUgaXMgZW1wdHkgb3IgdGhlIHBhcmVudCBub2RlIGhhcyBwZXJmb3JtZWQgdGhlIGNhbGN1bGF0aW9uIG9mIGdsb2JhbCB0cmFuc2Zvcm1hdGlvbi5cclxuICogVGhlIHJlc3VsdCBvZiBiYWNrdHJhY2Ugd2lsbCBzdG9yZSB0aGUgbm9kZSByZWxhdGlvbmFsIGNoYWluIGluIHRoZSBhcnJheS4gXHJcbiAqIFRoZSBwcm9jZXNzIG9mIHRyYXZlcnNpbmcgYXJyYXkgaXMgZXF1aXZhbGVudCB0byB0aGUgcHJvY2VzcyBvZiBnbG9iYWwgdHJhbnNmb3JtYXRpb24gZnJvbSB0aGUgcGFyZW50IG5vZGUgdG8gdGhlIHBoeXNpY2FsIG5vZGUuXHJcbiAqIFRoZSBjYWxjdWxhdGVkIHJlc3VsdHMgYXJlIHNhdmVkIGluIHRoZSBub2RlLCBhbmQgdGhlIHBoeXNpY2FsIGdsb2JhbCB0cmFuc2Zvcm1hdGlvbiBmbGFnIHdpbGwgYmUgZXJhc2VkIGZpbmFsbHkuXHJcbiAqL1xyXG5leHBvcnQgZnVuY3Rpb24gdXBkYXRlV29ybGRUcmFuc2Zvcm0gKG5vZGU6IGNjLk5vZGUsIHRyYXZlcnNlQWxsTm9kZTogYm9vbGVhbiA9IGZhbHNlKSB7XHJcbiAgICBsZXQgY3VyID0gbm9kZTtcclxuICAgIGxldCBpID0gMDtcclxuICAgIGxldCBuZWVkVXBkYXRlVHJhbnNmb3JtID0gZmFsc2U7XHJcbiAgICBsZXQgcGh5c2ljc0RpcnR5RmxhZyA9IDA7XHJcbiAgICB3aGlsZSAoY3VyKSB7XHJcbiAgICAgICAgLy8gSWYgY3VycmVudCBub2RlIHRyYW5zZm9ybSBoYXMgYmVlbiBjYWxjdWxhdGVkXHJcbiAgICAgICAgaWYgKHRyYXZlcnNlQWxsTm9kZSB8fCAhX25vZGVUcmFuc2Zvcm1SZWNvcmRbY3VyLl9pZF0pIHtcclxuICAgICAgICAgICAgX25vZGVBcnJheVtpKytdID0gY3VyO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIC8vIEN1cnJlbnQgbm9kZSdzIHRyYW5zZm9ybSBoYXMgYmVlZCBjYWxjdWxhdGVkXHJcbiAgICAgICAgICAgIHBoeXNpY3NEaXJ0eUZsYWcgfD0gKGN1ci5fbG9jYWxNYXREaXJ0eSAmIFBIWVNJQ1NfVFJTKTtcclxuICAgICAgICAgICAgbmVlZFVwZGF0ZVRyYW5zZm9ybSA9IG5lZWRVcGRhdGVUcmFuc2Zvcm0gfHwgISFwaHlzaWNzRGlydHlGbGFnO1xyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKGN1ci5fbG9jYWxNYXREaXJ0eSAmIFBIWVNJQ1NfVFJTKSB7XHJcbiAgICAgICAgICAgIG5lZWRVcGRhdGVUcmFuc2Zvcm0gPSB0cnVlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjdXIgPSBjdXIuX3BhcmVudDtcclxuICAgIH1cclxuICAgIGlmICghbmVlZFVwZGF0ZVRyYW5zZm9ybSkge1xyXG4gICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH1cclxuXHJcbiAgICBsZXQgY2hpbGQ7XHJcbiAgICBsZXQgY2hpbGRXb3JsZE1hdCwgY3VyV29ybGRNYXQsIGNoaWxkVHJzLCBjaGlsZExvY2FsTWF0O1xyXG4gICAgbGV0IHdwb3MsIHdyb3QsIHdzY2FsZTtcclxuXHJcbiAgICBfbm9kZUFycmF5Lmxlbmd0aCA9IGk7XHJcbiAgICB3aGlsZSAoaSkge1xyXG4gICAgICAgIGNoaWxkID0gX25vZGVBcnJheVstLWldO1xyXG4gICAgICAgICF0cmF2ZXJzZUFsbE5vZGUgJiYgKF9ub2RlVHJhbnNmb3JtUmVjb3JkW2NoaWxkLl9pZF0gPSBjaGlsZCk7XHJcblxyXG4gICAgICAgIGNoaWxkV29ybGRNYXQgPSBjaGlsZC5fd29ybGRNYXRyaXg7XHJcbiAgICAgICAgY2hpbGRMb2NhbE1hdCA9IGNoaWxkLl9tYXRyaXg7XHJcbiAgICAgICAgY2hpbGRUcnMgPSBjaGlsZC5fdHJzO1xyXG5cclxuICAgICAgICB3cG9zID0gY2hpbGQuX193cG9zID0gY2hpbGQuX193cG9zIHx8IGNjLnYzKCk7XHJcbiAgICAgICAgd3JvdCA9IGNoaWxkLl9fd3JvdCA9IGNoaWxkLl9fd3JvdCB8fCBjYy5xdWF0KCk7XHJcbiAgICAgICAgd3NjYWxlID0gY2hpbGQuX193c2NhbGUgPSBjaGlsZC5fX3dzY2FsZSB8fCBjYy52MygpO1xyXG5cclxuICAgICAgICBpZiAoY2hpbGQuX2xvY2FsTWF0RGlydHkgJiBQSFlTSUNTX1RSUykge1xyXG4gICAgICAgICAgICBUcnMudG9NYXQ0KGNoaWxkTG9jYWxNYXQsIGNoaWxkVHJzKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgY2hpbGQuX2xvY2FsTWF0RGlydHkgfD0gcGh5c2ljc0RpcnR5RmxhZztcclxuICAgICAgICBwaHlzaWNzRGlydHlGbGFnIHw9IChjaGlsZC5fbG9jYWxNYXREaXJ0eSAmIFBIWVNJQ1NfVFJTKTtcclxuXHJcbiAgICAgICAgaWYgKCEocGh5c2ljc0RpcnR5RmxhZyAmIFBIWVNJQ1NfVFJTKSkge1xyXG4gICAgICAgICAgICBjdXIgPSBjaGlsZDtcclxuICAgICAgICAgICAgY29udGludWU7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAoY3VyKSB7XHJcbiAgICAgICAgICAgIGN1cldvcmxkTWF0ID0gY3VyLl93b3JsZE1hdHJpeDtcclxuICAgICAgICAgICAgVHJzLnRvUG9zaXRpb24oX2xwb3MsIGNoaWxkVHJzKTtcclxuICAgICAgICAgICAgVmVjMy50cmFuc2Zvcm1NYXQ0KHdwb3MsIF9scG9zLCBjdXJXb3JsZE1hdCk7XHJcblxyXG4gICAgICAgICAgICBNYXQ0Lm11bHRpcGx5KGNoaWxkV29ybGRNYXQsIGN1cldvcmxkTWF0LCBjaGlsZExvY2FsTWF0KTtcclxuICAgICAgICAgICAgVHJzLnRvUm90YXRpb24oX2xyb3QsIGNoaWxkVHJzKTtcclxuICAgICAgICAgICAgUXVhdC5tdWx0aXBseSh3cm90LCBjdXIuX193cm90LCBfbHJvdCk7XHJcblxyXG4gICAgICAgICAgICBNYXQzLmZyb21RdWF0KF9tYXQzLCBRdWF0LmNvbmp1Z2F0ZShfcXVhdCwgd3JvdCkpO1xyXG4gICAgICAgICAgICBNYXQzLm11bHRpcGx5TWF0NChfbWF0MywgX21hdDMsIGNoaWxkV29ybGRNYXQpO1xyXG4gICAgICAgICAgICB3c2NhbGUueCA9IF9tYXQzbVswXTtcclxuICAgICAgICAgICAgd3NjYWxlLnkgPSBfbWF0M21bNF07XHJcbiAgICAgICAgICAgIHdzY2FsZS56ID0gX21hdDNtWzhdO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIFRycy50b1Bvc2l0aW9uKHdwb3MsIGNoaWxkVHJzKTtcclxuICAgICAgICAgICAgVHJzLnRvUm90YXRpb24od3JvdCwgY2hpbGRUcnMpO1xyXG4gICAgICAgICAgICBUcnMudG9TY2FsZSh3c2NhbGUsIGNoaWxkVHJzKTtcclxuICAgICAgICAgICAgTWF0NC5jb3B5KGNoaWxkV29ybGRNYXQsIGNoaWxkTG9jYWxNYXQpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjdXIgPSBjaGlsZDtcclxuICAgIH1cclxuICAgIHJldHVybiB0cnVlO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gdXBkYXRlV29ybGRSVCAobm9kZTogY2MuTm9kZSwgcG9zaXRpb246IGNjLlZlYzMsIHJvdGF0aW9uOiBjYy5RdWF0KSB7XHJcbiAgICBsZXQgcGFyZW50ID0gbm9kZS5wYXJlbnQ7XHJcbiAgICBpZiAocGFyZW50KSB7XHJcbiAgICAgICAgdXBkYXRlV29ybGRUcmFuc2Zvcm0ocGFyZW50LCB0cnVlKTtcclxuICAgICAgICBWZWMzLnRyYW5zZm9ybU1hdDQoX2xwb3MsIHBvc2l0aW9uLCBNYXQ0LmludmVydChfbWF0NCwgcGFyZW50Ll93b3JsZE1hdHJpeCkpO1xyXG4gICAgICAgIFF1YXQubXVsdGlwbHkoX3F1YXQsIFF1YXQuY29uanVnYXRlKF9xdWF0LCBwYXJlbnQuX193cm90KSwgcm90YXRpb24pO1xyXG4gICAgICAgIG5vZGUuc2V0UG9zaXRpb24oX2xwb3MpO1xyXG4gICAgICAgIG5vZGUuc2V0Um90YXRpb24oX3F1YXQpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgICBub2RlLnNldFBvc2l0aW9uKHBvc2l0aW9uKTtcclxuICAgICAgICBub2RlLnNldFJvdGF0aW9uKHJvdGF0aW9uKTtcclxuICAgIH1cclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIHdvcmxkRGlydHkgKG5vZGU6IGNjLk5vZGUpIHtcclxuICAgIGxldCBjdXIgPSBub2RlO1xyXG4gICAgd2hpbGUgKGN1cikge1xyXG4gICAgICAgIGlmIChjdXIuX3dvcmxkTWF0RGlydHkpIHJldHVybiB0cnVlO1xyXG4gICAgICAgIGN1ciA9IGN1ci5fcGFyZW50O1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIGZhbHNlO1xyXG59XHJcbiJdLCJzb3VyY2VSb290IjoiLyJ9