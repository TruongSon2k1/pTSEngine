
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'engine-dev/cocos2d/core/renderer/webgl/mesh-buffer.js';
                    var __require = nodeEnv ? function (request) {
                        return require(request);
                    } : function (request) {
                        return __quick_compile_engine__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_engine__.registerModule(__filename, module);}"use strict";

var _gfx = _interopRequireDefault(require("../../../renderer/gfx"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { "default": obj }; }

/****************************************************************************
 Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.

 https://www.cocos.com/

 Permission is hereby granted, free of charge, to any person obtaining a copy
 of this software and associated engine source code (the "Software"), a limited,
 worldwide, royalty-free, non-assignable, revocable and non-exclusive license
 to use Cocos Creator solely to develop games on your target platforms. You shall
 not use Cocos Creator software for developing other software or tools that's
 used for developing games. You are not granted to publish, distribute,
 sublicense, and/or sell copies of Cocos Creator.

 The software or tools in this License Agreement are licensed, not sold.
 Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.

 THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 THE SOFTWARE.
 ****************************************************************************/
var FIX_IOS14_BUFFER = (cc.sys.os === cc.sys.OS_IOS || cc.sys.os === cc.sys.OS_OSX) && cc.sys.isBrowser && /(OS 1[4-9])|(Version\/1[4-9])/.test(window.navigator.userAgent);
var MeshBuffer = cc.Class({
  name: 'cc.MeshBuffer',
  ctor: function ctor(batcher, vertexFormat) {
    this.init(batcher, vertexFormat);
  },
  init: function init(batcher, vertexFormat) {
    this.byteOffset = 0;
    this.indiceOffset = 0;
    this.vertexOffset = 0;
    this.indiceStart = 0;
    this._dirty = false;
    this._vertexFormat = vertexFormat;
    this._vertexBytes = this._vertexFormat._bytes;
    this._arrOffset = 0;
    this._vbArr = [];
    this._vb = new _gfx["default"].VertexBuffer(batcher._device, vertexFormat, _gfx["default"].USAGE_DYNAMIC, new ArrayBuffer(), 0);
    this._vbArr[0] = this._vb;
    this._ibArr = [];
    this._ib = new _gfx["default"].IndexBuffer(batcher._device, _gfx["default"].INDEX_FMT_UINT16, _gfx["default"].USAGE_STATIC, new ArrayBuffer(), 0);
    this._ibArr[0] = this._ib;
    this._vData = null;
    this._uintVData = null;
    this._iData = null;
    this._batcher = batcher;
    this._initVDataCount = 256 * vertexFormat._bytes; // actually 256 * 4 * (vertexFormat._bytes / 4)

    this._initIDataCount = 256 * 6;
    this._offsetInfo = {
      byteOffset: 0,
      vertexOffset: 0,
      indiceOffset: 0
    };

    this._reallocBuffer();
  },
  uploadData: function uploadData() {
    if (this.byteOffset === 0 || !this._dirty) {
      return;
    } // update vertext data


    var vertexsData = new Float32Array(this._vData.buffer, 0, this.byteOffset >> 2);
    var indicesData = new Uint16Array(this._iData.buffer, 0, this.indiceOffset);
    var vb = this._vb;
    vb.update(0, vertexsData);
    var ib = this._ib;
    ib.update(0, indicesData);
    this._dirty = false;
  },
  switchBuffer: function switchBuffer() {
    var offset = ++this._arrOffset;
    this.byteOffset = 0;
    this.vertexOffset = 0;
    this.indiceOffset = 0;
    this.indiceStart = 0;

    if (offset < this._vbArr.length) {
      this._vb = this._vbArr[offset];
      this._ib = this._ibArr[offset];
    } else {
      this._vb = new _gfx["default"].VertexBuffer(this._batcher._device, this._vertexFormat, _gfx["default"].USAGE_DYNAMIC, new ArrayBuffer(), 0);
      this._vbArr[offset] = this._vb;
      this._ib = new _gfx["default"].IndexBuffer(this._batcher._device, _gfx["default"].INDEX_FMT_UINT16, _gfx["default"].USAGE_STATIC, new ArrayBuffer(), 0);
      this._ibArr[offset] = this._ib;
    }
  },
  checkAndSwitchBuffer: function checkAndSwitchBuffer(vertexCount) {
    if (this.vertexOffset + vertexCount > 65535) {
      this.uploadData();

      this._batcher._flush();

      this.switchBuffer();
    }
  },
  requestStatic: function requestStatic(vertexCount, indiceCount) {
    this.checkAndSwitchBuffer(vertexCount);
    var byteOffset = this.byteOffset + vertexCount * this._vertexBytes;
    var indiceOffset = this.indiceOffset + indiceCount;
    var byteLength = this._vData.byteLength;
    var indiceLength = this._iData.length;

    if (byteOffset > byteLength || indiceOffset > indiceLength) {
      while (byteLength < byteOffset || indiceLength < indiceOffset) {
        this._initVDataCount *= 2;
        this._initIDataCount *= 2;
        byteLength = this._initVDataCount * 4;
        indiceLength = this._initIDataCount;
      }

      this._reallocBuffer();
    }

    this._updateOffset(vertexCount, indiceCount, byteOffset);
  },
  _updateOffset: function _updateOffset(vertexCount, indiceCount, byteOffset) {
    var offsetInfo = this._offsetInfo;
    offsetInfo.vertexOffset = this.vertexOffset;
    this.vertexOffset += vertexCount;
    offsetInfo.indiceOffset = this.indiceOffset;
    this.indiceOffset += indiceCount;
    offsetInfo.byteOffset = this.byteOffset;
    this.byteOffset = byteOffset;
    this._dirty = true;
  },
  request: function request(vertexCount, indiceCount) {
    if (this._batcher._buffer !== this) {
      this._batcher._flush();

      this._batcher._buffer = this;
    }

    this.requestStatic(vertexCount, indiceCount);
    return this._offsetInfo;
  },
  _reallocBuffer: function _reallocBuffer() {
    this._reallocVData(true);

    this._reallocIData(true);
  },
  _reallocVData: function _reallocVData(copyOldData) {
    var oldVData;

    if (this._vData) {
      oldVData = new Uint8Array(this._vData.buffer);
    }

    this._vData = new Float32Array(this._initVDataCount);
    this._uintVData = new Uint32Array(this._vData.buffer);
    var newData = new Uint8Array(this._uintVData.buffer);

    if (oldVData && copyOldData) {
      for (var i = 0, l = oldVData.length; i < l; i++) {
        newData[i] = oldVData[i];
      }
    }
  },
  _reallocIData: function _reallocIData(copyOldData) {
    var oldIData = this._iData;
    this._iData = new Uint16Array(this._initIDataCount);

    if (oldIData && copyOldData) {
      var iData = this._iData;

      for (var i = 0, l = oldIData.length; i < l; i++) {
        iData[i] = oldIData[i];
      }
    }
  },
  reset: function reset() {
    this._arrOffset = 0;
    this._vb = this._vbArr[0];
    this._ib = this._ibArr[0];
    this.byteOffset = 0;
    this.indiceOffset = 0;
    this.vertexOffset = 0;
    this.indiceStart = 0;
    this._dirty = false;
  },
  destroy: function destroy() {
    this.reset();

    for (var i = 0; i < this._vbArr.length; i++) {
      var vb = this._vbArr[i];
      vb.destroy();
    }

    this._vbArr = null;

    for (var _i = 0; _i < this._ibArr.length; _i++) {
      var ib = this._ibArr[_i];
      ib.destroy();
    }

    this._ibArr = null;
    this._ib = null;
    this._vb = null;
  },
  forwardIndiceStartToOffset: function forwardIndiceStartToOffset() {
    this.indiceStart = this.indiceOffset;
  }
}); // Should not share vb and id between multiple drawcalls on iOS14, it will cost a lot of time.
// TODO: maybe remove it after iOS14 fix it?

if (FIX_IOS14_BUFFER) {
  MeshBuffer.prototype.checkAndSwitchBuffer = function (vertexCount) {
    if (this.vertexOffset + vertexCount > 65535) {
      this.uploadData();

      this._batcher._flush();
    }
  };

  MeshBuffer.prototype.forwardIndiceStartToOffset = function () {
    this.uploadData();
    this.switchBuffer();
  };
}

cc.MeshBuffer = module.exports = MeshBuffer;
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_engine__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImVuZ2luZS1kZXZcXGNvY29zMmRcXGNvcmVcXHJlbmRlcmVyXFx3ZWJnbFxcbWVzaC1idWZmZXIuanMiXSwibmFtZXMiOlsiRklYX0lPUzE0X0JVRkZFUiIsImNjIiwic3lzIiwib3MiLCJPU19JT1MiLCJPU19PU1giLCJpc0Jyb3dzZXIiLCJ0ZXN0Iiwid2luZG93IiwibmF2aWdhdG9yIiwidXNlckFnZW50IiwiTWVzaEJ1ZmZlciIsIkNsYXNzIiwibmFtZSIsImN0b3IiLCJiYXRjaGVyIiwidmVydGV4Rm9ybWF0IiwiaW5pdCIsImJ5dGVPZmZzZXQiLCJpbmRpY2VPZmZzZXQiLCJ2ZXJ0ZXhPZmZzZXQiLCJpbmRpY2VTdGFydCIsIl9kaXJ0eSIsIl92ZXJ0ZXhGb3JtYXQiLCJfdmVydGV4Qnl0ZXMiLCJfYnl0ZXMiLCJfYXJyT2Zmc2V0IiwiX3ZiQXJyIiwiX3ZiIiwiZ2Z4IiwiVmVydGV4QnVmZmVyIiwiX2RldmljZSIsIlVTQUdFX0RZTkFNSUMiLCJBcnJheUJ1ZmZlciIsIl9pYkFyciIsIl9pYiIsIkluZGV4QnVmZmVyIiwiSU5ERVhfRk1UX1VJTlQxNiIsIlVTQUdFX1NUQVRJQyIsIl92RGF0YSIsIl91aW50VkRhdGEiLCJfaURhdGEiLCJfYmF0Y2hlciIsIl9pbml0VkRhdGFDb3VudCIsIl9pbml0SURhdGFDb3VudCIsIl9vZmZzZXRJbmZvIiwiX3JlYWxsb2NCdWZmZXIiLCJ1cGxvYWREYXRhIiwidmVydGV4c0RhdGEiLCJGbG9hdDMyQXJyYXkiLCJidWZmZXIiLCJpbmRpY2VzRGF0YSIsIlVpbnQxNkFycmF5IiwidmIiLCJ1cGRhdGUiLCJpYiIsInN3aXRjaEJ1ZmZlciIsIm9mZnNldCIsImxlbmd0aCIsImNoZWNrQW5kU3dpdGNoQnVmZmVyIiwidmVydGV4Q291bnQiLCJfZmx1c2giLCJyZXF1ZXN0U3RhdGljIiwiaW5kaWNlQ291bnQiLCJieXRlTGVuZ3RoIiwiaW5kaWNlTGVuZ3RoIiwiX3VwZGF0ZU9mZnNldCIsIm9mZnNldEluZm8iLCJyZXF1ZXN0IiwiX2J1ZmZlciIsIl9yZWFsbG9jVkRhdGEiLCJfcmVhbGxvY0lEYXRhIiwiY29weU9sZERhdGEiLCJvbGRWRGF0YSIsIlVpbnQ4QXJyYXkiLCJVaW50MzJBcnJheSIsIm5ld0RhdGEiLCJpIiwibCIsIm9sZElEYXRhIiwiaURhdGEiLCJyZXNldCIsImRlc3Ryb3kiLCJmb3J3YXJkSW5kaWNlU3RhcnRUb09mZnNldCIsInByb3RvdHlwZSIsIm1vZHVsZSIsImV4cG9ydHMiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7QUF5QkE7Ozs7QUF6QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSUEsSUFBTUEsZ0JBQWdCLEdBQUcsQ0FBQ0MsRUFBRSxDQUFDQyxHQUFILENBQU9DLEVBQVAsS0FBY0YsRUFBRSxDQUFDQyxHQUFILENBQU9FLE1BQXJCLElBQStCSCxFQUFFLENBQUNDLEdBQUgsQ0FBT0MsRUFBUCxLQUFjRixFQUFFLENBQUNDLEdBQUgsQ0FBT0csTUFBckQsS0FBZ0VKLEVBQUUsQ0FBQ0MsR0FBSCxDQUFPSSxTQUF2RSxJQUFvRixnQ0FBZ0NDLElBQWhDLENBQXFDQyxNQUFNLENBQUNDLFNBQVAsQ0FBaUJDLFNBQXRELENBQTdHO0FBRUEsSUFBSUMsVUFBVSxHQUFHVixFQUFFLENBQUNXLEtBQUgsQ0FBUztBQUN0QkMsRUFBQUEsSUFBSSxFQUFFLGVBRGdCO0FBRXRCQyxFQUFBQSxJQUZzQixnQkFFaEJDLE9BRmdCLEVBRVBDLFlBRk8sRUFFTztBQUN6QixTQUFLQyxJQUFMLENBQVdGLE9BQVgsRUFBb0JDLFlBQXBCO0FBQ0gsR0FKcUI7QUFNdEJDLEVBQUFBLElBTnNCLGdCQU1oQkYsT0FOZ0IsRUFNUEMsWUFOTyxFQU1PO0FBQ3pCLFNBQUtFLFVBQUwsR0FBa0IsQ0FBbEI7QUFDQSxTQUFLQyxZQUFMLEdBQW9C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RUFBd0NtQixFQUFDLEVBQXpDLEVBQTZDO0FBQ3pDLFVBQUl0QixFQUFFLEdBQUcsS0FBS3JCLE1BQUwsQ0FBWTJDLEVBQVosQ0FBVDtBQUNBdEIsTUFBQUEsRUFBRSxDQUFDMkIsT0FBSDtBQUNIOztBQUNELFNBQUtoRCxNQUFMLEdBQWMsSUFBZDtBQUVBLFNBQUtDLEdBQUwsR0FBVyxJQUFYO0FBQ0EsU0FBS1AsR0FBTCxHQUFXLElBQVg7QUFDSCxHQWxPcUI7QUFvT3RCdUQsRUFBQUEsMEJBcE9zQix3Q0FvT1E7QUFDMUIsU0FBSzlELFdBQUwsR0FBbUIsS0FBS0YsWUFBeEI7QUFDSDtBQXRPcUIsQ0FBVCxDQUFqQixFQXlPQTtBQUNBOztBQUNBLElBQUluQixnQkFBSixFQUFzQjtBQUNsQlcsRUFBQUEsVUFBVSxDQUFDeUUsU0FBWCxDQUFxQnpCLG9CQUFyQixHQUE0QyxVQUFVQyxXQUFWLEVBQXVCO0FBQy9ELFFBQUksS0FBS3hDLFlBQUwsR0FBb0J3QyxXQUFwQixHQUFrQyxLQUF0QyxFQUE2QztBQUN6QyxXQUFLYixVQUFMOztBQUNBLFdBQUtMLFFBQUwsQ0FBY21CLE1BQWQ7QUFDSDtBQUNKLEdBTEQ7O0FBTUFsRCxFQUFBQSxVQUFVLENBQUN5RSxTQUFYLENBQXFCRCwwQkFBckIsR0FBa0QsWUFBWTtBQUMxRCxTQUFLcEMsVUFBTDtBQUNBLFNBQUtTLFlBQUw7QUFDSCxHQUhEO0FBSUg7O0FBRUR2RCxFQUFFLENBQUNVLFVBQUgsR0FBZ0IwRSxNQUFNLENBQUNDLE9BQVAsR0FBaUIzRSxVQUFqQyIsInNvdXJjZXNDb250ZW50IjpbIi8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqXHJcbiBDb3B5cmlnaHQgKGMpIDIwMTctMjAxOCBYaWFtZW4gWWFqaSBTb2Z0d2FyZSBDby4sIEx0ZC5cclxuXHJcbiBodHRwczovL3d3dy5jb2Nvcy5jb20vXHJcblxyXG4gUGVybWlzc2lvbiBpcyBoZXJlYnkgZ3JhbnRlZCwgZnJlZSBvZiBjaGFyZ2UsIHRvIGFueSBwZXJzb24gb2J0YWluaW5nIGEgY29weVxyXG4gb2YgdGhpcyBzb2Z0d2FyZSBhbmQgYXNzb2NpYXRlZCBlbmdpbmUgc291cmNlIGNvZGUgKHRoZSBcIlNvZnR3YXJlXCIpLCBhIGxpbWl0ZWQsXHJcbiB3b3JsZHdpZGUsIHJveWFsdHktZnJlZSwgbm9uLWFzc2lnbmFibGUsIHJldm9jYWJsZSBhbmQgbm9uLWV4Y2x1c2l2ZSBsaWNlbnNlXHJcbiB0byB1c2UgQ29jb3MgQ3JlYXRvciBzb2xlbHkgdG8gZGV2ZWxvcCBnYW1lcyBvbiB5b3VyIHRhcmdldCBwbGF0Zm9ybXMuIFlvdSBzaGFsbFxyXG4gbm90IHVzZSBDb2NvcyBDcmVhdG9yIHNvZnR3YXJlIGZvciBkZXZlbG9waW5nIG90aGVyIHNvZnR3YXJlIG9yIHRvb2xzIHRoYXQnc1xyXG4gdXNlZCBmb3IgZGV2ZWxvcGluZyBnYW1lcy4gWW91IGFyZSBub3QgZ3JhbnRlZCB0byBwdWJsaXNoLCBkaXN0cmlidXRlLFxyXG4gc3VibGljZW5zZSwgYW5kL29yIHNlbGwgY29waWVzIG9mIENvY29zIENyZWF0b3IuXHJcblxyXG4gVGhlIHNvZnR3YXJlIG9yIHRvb2xzIGluIHRoaXMgTGljZW5zZSBBZ3JlZW1lbnQgYXJlIGxpY2Vuc2VkLCBub3Qgc29sZC5cclxuIFhpYW1lbiBZYWppIFNvZnR3YXJlIENvLiwgTHRkLiByZXNlcnZlcyBhbGwgcmlnaHRzIG5vdCBleHByZXNzbHkgZ3JhbnRlZCB0byB5b3UuXHJcblxyXG4gVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEIFwiQVMgSVNcIiwgV0lUSE9VVCBXQVJSQU5UWSBPRiBBTlkgS0lORCwgRVhQUkVTUyBPUlxyXG4gSU1QTElFRCwgSU5DTFVESU5HIEJVVCBOT1QgTElNSVRFRCBUTyBUSEUgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFksXHJcbiBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBTkQgTk9OSU5GUklOR0VNRU5ULiBJTiBOTyBFVkVOVCBTSEFMTCBUSEVcclxuIEFVVEhPUlMgT1IgQ09QWVJJR0hUIEhPTERFUlMgQkUgTElBQkxFIEZPUiBBTlkgQ0xBSU0sIERBTUFHRVMgT1IgT1RIRVJcclxuIExJQUJJTElUWSwgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIFRPUlQgT1IgT1RIRVJXSVNFLCBBUklTSU5HIEZST00sXHJcbiBPVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRSBTT0ZUV0FSRSBPUiBUSEUgVVNFIE9SIE9USEVSIERFQUxJTkdTIElOXHJcbiBUSEUgU09GVFdBUkUuXHJcbiAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqL1xyXG5cclxuaW1wb3J0IGdmeCBmcm9tICcuLi8uLi8uLi9yZW5kZXJlci9nZngnO1xyXG5cclxuY29uc3QgRklYX0lPUzE0X0JVRkZFUiA9IChjYy5zeXMub3MgPT09IGNjLnN5cy5PU19JT1MgfHwgY2Muc3lzLm9zID09PSBjYy5zeXMuT1NfT1NYKSAmJiBjYy5zeXMuaXNCcm93c2VyICYmIC8oT1MgMVs0LTldKXwoVmVyc2lvblxcLzFbNC05XSkvLnRlc3Qod2luZG93Lm5hdmlnYXRvci51c2VyQWdlbnQpO1xyXG5cclxubGV0IE1lc2hCdWZmZXIgPSBjYy5DbGFzcyh7XHJcbiAgICBuYW1lOiAnY2MuTWVzaEJ1ZmZlcicsXHJcbiAgICBjdG9yIChiYXRjaGVyLCB2ZXJ0ZXhGb3JtYXQpIHtcclxuICAgICAgICB0aGlzLmluaXQgKGJhdGNoZXIsIHZlcnRleEZvcm1hdCk7XHJcbiAgICB9LFxyXG5cclxuICAgIGluaXQgKGJhdGNoZXIsIHZlcnRleEZvcm1hdCkge1xyXG4gICAgICAgIHRoaXMuYnl0ZU9mZnNldCA9IDA7XHJcbiAgICAgICAgdGhpcy5pbmRpY2VPZmZzZXQgPSAwO1xyXG4gICAgICAgIHRoaXMudmVydGV4T2Zmc2V0ID0gMDtcclxuICAgICAgICB0aGlzLmluZGljZVN0YXJ0ID0gMDtcclxuXHJcbiAgICAgICAgdGhpcy5fZGlydHkgPSBmYWxzZTtcclxuXHJcbiAgICAgICAgdGhpcy5fdmVydGV4Rm9ybWF0ID0gdmVydGV4Rm9ybWF0O1xyXG4gICAgICAgIHRoaXMuX3ZlcnRleEJ5dGVzID0gdGhpcy5fdmVydGV4Rm9ybWF0Ll9ieXRlcztcclxuXHJcbiAgICAgICAgdGhpcy5fYXJyT2Zmc2V0ID0gMDtcclxuICAgICAgICB0aGlzLl92YkFyciA9IFtdO1xyXG4gICAgICAgIHRoaXMuX3ZiID0gbmV3IGdmeC5WZXJ0ZXhCdWZmZXIoXHJcbiAgICAgICAgICAgIGJhdGNoZXIuX2RldmljZSxcclxuICAgICAgICAgICAgdmVydGV4Rm9ybWF0LFxyXG4gICAgICAgICAgICBnZnguVVNBR0VfRFlOQU1JQyxcclxuICAgICAgICAgICAgbmV3IEFycmF5QnVmZmVyKCksXHJcbiAgICAgICAgICAgIDBcclxuICAgICAgICApO1xyXG4gICAgICAgIHRoaXMuX3ZiQXJyWzBdID0gdGhpcy5fdmI7XHJcblxyXG4gICAgICAgIHRoaXMuX2liQXJyID0gW107XHJcbiAgICAgICAgdGhpcy5faWIgPSBuZXcgZ2Z4LkluZGV4QnVmZmVyKFxyXG4gICAgICAgICAgICBiYXRjaGVyLl9kZXZpY2UsXHJcbiAgICAgICAgICAgIGdmeC5JTkRFWF9GTVRfVUlOVDE2LFxyXG4gICAgICAgICAgICBnZnguVVNBR0VfU1RBVElDLFxyXG4gICAgICAgICAgICBuZXcgQXJyYXlCdWZmZXIoKSxcclxuICAgICAgICAgICAgMFxyXG4gICAgICAgICk7XHJcbiAgICAgICAgdGhpcy5faWJBcnJbMF0gPSB0aGlzLl9pYjtcclxuXHJcbiAgICAgICAgdGhpcy5fdkRhdGEgPSBudWxsO1xyXG4gICAgICAgIHRoaXMuX3VpbnRWRGF0YSA9IG51bGw7XHJcbiAgICAgICAgdGhpcy5faURhdGEgPSBudWxsO1xyXG5cclxuICAgICAgICB0aGlzLl9iYXRjaGVyID0gYmF0Y2hlcjtcclxuXHJcbiAgICAgICAgdGhpcy5faW5pdFZEYXRhQ291bnQgPSAyNTYgKiB2ZXJ0ZXhGb3JtYXQuX2J5dGVzOy8vIGFjdHVhbGx5IDI1NiAqIDQgKiAodmVydGV4Rm9ybWF0Ll9ieXRlcyAvIDQpXHJcbiAgICAgICAgdGhpcy5faW5pdElEYXRhQ291bnQgPSAyNTYgKiA2O1xyXG4gICAgICAgIFxyXG4gICAgICAgIHRoaXMuX29mZnNldEluZm8gPSB7XHJcbiAgICAgICAgICAgIGJ5dGVPZmZzZXQgOiAwLFxyXG4gICAgICAgICAgICB2ZXJ0ZXhPZmZzZXQgOiAwLFxyXG4gICAgICAgICAgICBpbmRpY2VPZmZzZXQgOiAwXHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuX3JlYWxsb2NCdWZmZXIoKTtcclxuICAgIH0sXHJcblxyXG4gICAgdXBsb2FkRGF0YSAoKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuYnl0ZU9mZnNldCA9PT0gMCB8fCAhdGhpcy5fZGlydHkpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gdXBkYXRlIHZlcnRleHQgZGF0YVxyXG4gICAgICAgIGxldCB2ZXJ0ZXhzRGF0YSA9IG5ldyBGbG9hdDMyQXJyYXkodGhpcy5fdkRhdGEuYnVmZmVyLCAwLCB0aGlzLmJ5dGVPZmZzZXQgPj4gMik7XHJcbiAgICAgICAgbGV0IGluZGljZXNEYXRhID0gbmV3IFVpbnQxNkFycmF5KHRoaXMuX2lEYXRhLmJ1ZmZlciwgMCwgdGhpcy5pbmRpY2VPZmZzZXQpO1xyXG5cclxuICAgICAgICBsZXQgdmIgPSB0aGlzLl92YjtcclxuICAgICAgICB2Yi51cGRhdGUoMCwgdmVydGV4c0RhdGEpO1xyXG5cclxuICAgICAgICBsZXQgaWIgPSB0aGlzLl9pYjtcclxuICAgICAgICBpYi51cGRhdGUoMCwgaW5kaWNlc0RhdGEpO1xyXG5cclxuICAgICAgICB0aGlzLl9kaXJ0eSA9IGZhbHNlO1xyXG4gICAgfSxcclxuXHJcbiAgICBzd2l0Y2hCdWZmZXIgKCkge1xyXG4gICAgICAgIGxldCBvZmZzZXQgPSArK3RoaXMuX2Fyck9mZnNldDtcclxuXHJcbiAgICAgICAgdGhpcy5ieXRlT2Zmc2V0ID0gMDtcclxuICAgICAgICB0aGlzLnZlcnRleE9mZnNldCA9IDA7XHJcbiAgICAgICAgdGhpcy5pbmRpY2VPZmZzZXQgPSAwO1xyXG4gICAgICAgIHRoaXMuaW5kaWNlU3RhcnQgPSAwO1xyXG5cclxuICAgICAgICBpZiAob2Zmc2V0IDwgdGhpcy5fdmJBcnIubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIHRoaXMuX3ZiID0gdGhpcy5fdmJBcnJbb2Zmc2V0XTtcclxuICAgICAgICAgICAgdGhpcy5faWIgPSB0aGlzLl9pYkFycltvZmZzZXRdO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcblxyXG4gICAgICAgICAgICB0aGlzLl92YiA9IG5ldyBnZnguVmVydGV4QnVmZmVyKFxyXG4gICAgICAgICAgICAgICAgdGhpcy5fYmF0Y2hlci5fZGV2aWNlLFxyXG4gICAgICAgICAgICAgICAgdGhpcy5fdmVydGV4Rm9ybWF0LFxyXG4gICAgICAgICAgICAgICAgZ2Z4LlVTQUdFX0RZTkFNSUMsXHJcbiAgICAgICAgICAgICAgICBuZXcgQXJyYXlCdWZmZXIoKSxcclxuICAgICAgICAgICAgICAgIDBcclxuICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgdGhpcy5fdmJBcnJbb2Zmc2V0XSA9IHRoaXMuX3ZiO1xyXG5cclxuICAgICAgICAgICAgdGhpcy5faWIgPSBuZXcgZ2Z4LkluZGV4QnVmZmVyKFxyXG4gICAgICAgICAgICAgICAgdGhpcy5fYmF0Y2hlci5fZGV2aWNlLFxyXG4gICAgICAgICAgICAgICAgZ2Z4LklOREVYX0ZNVF9VSU5UMTYsXHJcbiAgICAgICAgICAgICAgICBnZnguVVNBR0VfU1RBVElDLFxyXG4gICAgICAgICAgICAgICAgbmV3IEFycmF5QnVmZmVyKCksXHJcbiAgICAgICAgICAgICAgICAwXHJcbiAgICAgICAgICAgICk7XHJcbiAgICAgICAgICAgIHRoaXMuX2liQXJyW29mZnNldF0gPSB0aGlzLl9pYjtcclxuICAgICAgICB9XHJcbiAgICB9LFxyXG5cclxuICAgIGNoZWNrQW5kU3dpdGNoQnVmZmVyICh2ZXJ0ZXhDb3VudCkge1xyXG4gICAgICAgIGlmICh0aGlzLnZlcnRleE9mZnNldCArIHZlcnRleENvdW50ID4gNjU1MzUpIHtcclxuICAgICAgICAgICAgdGhpcy51cGxvYWREYXRhKCk7XHJcbiAgICAgICAgICAgIHRoaXMuX2JhdGNoZXIuX2ZsdXNoKCk7XHJcbiAgICAgICAgICAgIHRoaXMuc3dpdGNoQnVmZmVyKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfSxcclxuXHJcbiAgICByZXF1ZXN0U3RhdGljICh2ZXJ0ZXhDb3VudCwgaW5kaWNlQ291bnQpIHtcclxuXHJcbiAgICAgICAgdGhpcy5jaGVja0FuZFN3aXRjaEJ1ZmZlcih2ZXJ0ZXhDb3VudCk7XHJcblxyXG4gICAgICAgIGxldCBieXRlT2Zmc2V0ID0gdGhpcy5ieXRlT2Zmc2V0ICsgdmVydGV4Q291bnQgKiB0aGlzLl92ZXJ0ZXhCeXRlcztcclxuICAgICAgICBsZXQgaW5kaWNlT2Zmc2V0ID0gdGhpcy5pbmRpY2VPZmZzZXQgKyBpbmRpY2VDb3VudDtcclxuXHJcbiAgICAgICAgbGV0IGJ5dGVMZW5ndGggPSB0aGlzLl92RGF0YS5ieXRlTGVuZ3RoO1xyXG4gICAgICAgIGxldCBpbmRpY2VMZW5ndGggPSB0aGlzLl9pRGF0YS5sZW5ndGg7XHJcbiAgICAgICAgaWYgKGJ5dGVPZmZzZXQgPiBieXRlTGVuZ3RoIHx8IGluZGljZU9mZnNldCA+IGluZGljZUxlbmd0aCkge1xyXG4gICAgICAgICAgICB3aGlsZSAoYnl0ZUxlbmd0aCA8IGJ5dGVPZmZzZXQgfHwgaW5kaWNlTGVuZ3RoIDwgaW5kaWNlT2Zmc2V0KSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9pbml0VkRhdGFDb3VudCAqPSAyO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5faW5pdElEYXRhQ291bnQgKj0gMjtcclxuXHJcbiAgICAgICAgICAgICAgICBieXRlTGVuZ3RoID0gdGhpcy5faW5pdFZEYXRhQ291bnQgKiA0O1xyXG4gICAgICAgICAgICAgICAgaW5kaWNlTGVuZ3RoID0gdGhpcy5faW5pdElEYXRhQ291bnQ7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHRoaXMuX3JlYWxsb2NCdWZmZXIoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5fdXBkYXRlT2Zmc2V0KHZlcnRleENvdW50LCBpbmRpY2VDb3VudCwgYnl0ZU9mZnNldCk7XHJcbiAgICB9LFxyXG5cclxuICAgIF91cGRhdGVPZmZzZXQgKHZlcnRleENvdW50LCBpbmRpY2VDb3VudCwgYnl0ZU9mZnNldCkge1xyXG4gICAgICAgIGxldCBvZmZzZXRJbmZvID0gdGhpcy5fb2Zmc2V0SW5mbztcclxuICAgICAgICBvZmZzZXRJbmZvLnZlcnRleE9mZnNldCA9IHRoaXMudmVydGV4T2Zmc2V0O1xyXG4gICAgICAgIHRoaXMudmVydGV4T2Zmc2V0ICs9IHZlcnRleENvdW50O1xyXG5cclxuICAgICAgICBvZmZzZXRJbmZvLmluZGljZU9mZnNldCA9IHRoaXMuaW5kaWNlT2Zmc2V0O1xyXG4gICAgICAgIHRoaXMuaW5kaWNlT2Zmc2V0ICs9IGluZGljZUNvdW50O1xyXG5cclxuICAgICAgICBvZmZzZXRJbmZvLmJ5dGVPZmZzZXQgPSB0aGlzLmJ5dGVPZmZzZXQ7XHJcbiAgICAgICAgdGhpcy5ieXRlT2Zmc2V0ID0gYnl0ZU9mZnNldDtcclxuXHJcbiAgICAgICAgdGhpcy5fZGlydHkgPSB0cnVlO1xyXG4gICAgfSxcclxuXHJcbiAgICByZXF1ZXN0ICh2ZXJ0ZXhDb3VudCwgaW5kaWNlQ291bnQpIHtcclxuICAgICAgICBpZiAodGhpcy5fYmF0Y2hlci5fYnVmZmVyICE9PSB0aGlzKSB7XHJcbiAgICAgICAgICAgIHRoaXMuX2JhdGNoZXIuX2ZsdXNoKCk7XHJcbiAgICAgICAgICAgIHRoaXMuX2JhdGNoZXIuX2J1ZmZlciA9IHRoaXM7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLnJlcXVlc3RTdGF0aWModmVydGV4Q291bnQsIGluZGljZUNvdW50KTtcclxuICAgICAgICByZXR1cm4gdGhpcy5fb2Zmc2V0SW5mbztcclxuICAgIH0sXHJcbiAgICBcclxuICAgIF9yZWFsbG9jQnVmZmVyICgpIHtcclxuICAgICAgICB0aGlzLl9yZWFsbG9jVkRhdGEodHJ1ZSk7XHJcbiAgICAgICAgdGhpcy5fcmVhbGxvY0lEYXRhKHRydWUpO1xyXG4gICAgfSxcclxuXHJcbiAgICBfcmVhbGxvY1ZEYXRhIChjb3B5T2xkRGF0YSkge1xyXG4gICAgICAgIGxldCBvbGRWRGF0YTtcclxuICAgICAgICBpZiAodGhpcy5fdkRhdGEpIHtcclxuICAgICAgICAgICAgb2xkVkRhdGEgPSBuZXcgVWludDhBcnJheSh0aGlzLl92RGF0YS5idWZmZXIpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy5fdkRhdGEgPSBuZXcgRmxvYXQzMkFycmF5KHRoaXMuX2luaXRWRGF0YUNvdW50KTtcclxuICAgICAgICB0aGlzLl91aW50VkRhdGEgPSBuZXcgVWludDMyQXJyYXkodGhpcy5fdkRhdGEuYnVmZmVyKTtcclxuXHJcbiAgICAgICAgbGV0IG5ld0RhdGEgPSBuZXcgVWludDhBcnJheSh0aGlzLl91aW50VkRhdGEuYnVmZmVyKTtcclxuXHJcbiAgICAgICAgaWYgKG9sZFZEYXRhICYmIGNvcHlPbGREYXRhKSB7XHJcbiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwLCBsID0gb2xkVkRhdGEubGVuZ3RoOyBpIDwgbDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICBuZXdEYXRhW2ldID0gb2xkVkRhdGFbaV07XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9LFxyXG5cclxuICAgIF9yZWFsbG9jSURhdGEgKGNvcHlPbGREYXRhKSB7XHJcbiAgICAgICAgbGV0IG9sZElEYXRhID0gdGhpcy5faURhdGE7XHJcblxyXG4gICAgICAgIHRoaXMuX2lEYXRhID0gbmV3IFVpbnQxNkFycmF5KHRoaXMuX2luaXRJRGF0YUNvdW50KTtcclxuXHJcbiAgICAgICAgaWYgKG9sZElEYXRhICYmIGNvcHlPbGREYXRhKSB7XHJcbiAgICAgICAgICAgIGxldCBpRGF0YSA9IHRoaXMuX2lEYXRhO1xyXG4gICAgICAgICAgICBmb3IgKGxldCBpID0gMCwgbCA9IG9sZElEYXRhLmxlbmd0aDsgaSA8IGw7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgaURhdGFbaV0gPSBvbGRJRGF0YVtpXTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH0sXHJcblxyXG4gICAgcmVzZXQgKCkge1xyXG4gICAgICAgIHRoaXMuX2Fyck9mZnNldCA9IDA7XHJcbiAgICAgICAgdGhpcy5fdmIgPSB0aGlzLl92YkFyclswXTtcclxuICAgICAgICB0aGlzLl9pYiA9IHRoaXMuX2liQXJyWzBdO1xyXG5cclxuICAgICAgICB0aGlzLmJ5dGVPZmZzZXQgPSAwO1xyXG4gICAgICAgIHRoaXMuaW5kaWNlT2Zmc2V0ID0gMDtcclxuICAgICAgICB0aGlzLnZlcnRleE9mZnNldCA9IDA7XHJcbiAgICAgICAgdGhpcy5pbmRpY2VTdGFydCA9IDA7XHJcblxyXG4gICAgICAgIHRoaXMuX2RpcnR5ID0gZmFsc2U7XHJcbiAgICB9LFxyXG5cclxuICAgIGRlc3Ryb3kgKCkge1xyXG4gICAgICAgIHRoaXMucmVzZXQoKTtcclxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8ICB0aGlzLl92YkFyci5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICBsZXQgdmIgPSB0aGlzLl92YkFycltpXTtcclxuICAgICAgICAgICAgdmIuZGVzdHJveSgpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLl92YkFyciA9IG51bGw7XHJcblxyXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5faWJBcnIubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgbGV0IGliID0gdGhpcy5faWJBcnJbaV07XHJcbiAgICAgICAgICAgIGliLmRlc3Ryb3koKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5faWJBcnIgPSBudWxsO1xyXG5cclxuICAgICAgICB0aGlzLl9pYiA9IG51bGw7XHJcbiAgICAgICAgdGhpcy5fdmIgPSBudWxsO1xyXG4gICAgfSxcclxuXHJcbiAgICBmb3J3YXJkSW5kaWNlU3RhcnRUb09mZnNldCAoKSB7XHJcbiAgICAgICAgdGhpcy5pbmRpY2VTdGFydCA9IHRoaXMuaW5kaWNlT2Zmc2V0O1xyXG4gICAgfVxyXG59KTtcclxuXHJcbi8vIFNob3VsZCBub3Qgc2hhcmUgdmIgYW5kIGlkIGJldHdlZW4gbXVsdGlwbGUgZHJhd2NhbGxzIG9uIGlPUzE0LCBpdCB3aWxsIGNvc3QgYSBsb3Qgb2YgdGltZS5cclxuLy8gVE9ETzogbWF5YmUgcmVtb3ZlIGl0IGFmdGVyIGlPUzE0IGZpeCBpdD9cclxuaWYgKEZJWF9JT1MxNF9CVUZGRVIpIHtcclxuICAgIE1lc2hCdWZmZXIucHJvdG90eXBlLmNoZWNrQW5kU3dpdGNoQnVmZmVyID0gZnVuY3Rpb24gKHZlcnRleENvdW50KSB7XHJcbiAgICAgICAgaWYgKHRoaXMudmVydGV4T2Zmc2V0ICsgdmVydGV4Q291bnQgPiA2NTUzNSkge1xyXG4gICAgICAgICAgICB0aGlzLnVwbG9hZERhdGEoKTtcclxuICAgICAgICAgICAgdGhpcy5fYmF0Y2hlci5fZmx1c2goKTtcclxuICAgICAgICB9XHJcbiAgICB9OyAgICAgXHJcbiAgICBNZXNoQnVmZmVyLnByb3RvdHlwZS5mb3J3YXJkSW5kaWNlU3RhcnRUb09mZnNldCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB0aGlzLnVwbG9hZERhdGEoKTtcclxuICAgICAgICB0aGlzLnN3aXRjaEJ1ZmZlcigpO1xyXG4gICAgfSAgXHJcbn1cclxuXHJcbmNjLk1lc2hCdWZmZXIgPSBtb2R1bGUuZXhwb3J0cyA9IE1lc2hCdWZmZXI7XHJcbiJdLCJzb3VyY2VSb290IjoiLyJ9