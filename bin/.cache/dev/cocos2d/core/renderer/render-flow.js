
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'engine-dev/cocos2d/core/renderer/render-flow.js';
                    var __require = nodeEnv ? function (request) {
                        return require(request);
                    } : function (request) {
                        return __quick_compile_engine__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_engine__.registerModule(__filename, module);}"use strict";

var FlagOfset = 0;
var DONOTHING = 1 << FlagOfset++;
var BREAK_FLOW = 1 << FlagOfset++;
var LOCAL_TRANSFORM = 1 << FlagOfset++;
var WORLD_TRANSFORM = 1 << FlagOfset++;
var TRANSFORM = LOCAL_TRANSFORM | WORLD_TRANSFORM;
var UPDATE_RENDER_DATA = 1 << FlagOfset++;
var OPACITY = 1 << FlagOfset++;
var COLOR = 1 << FlagOfset++;
var OPACITY_COLOR = OPACITY | COLOR;
var RENDER = 1 << FlagOfset++;
var CHILDREN = 1 << FlagOfset++;
var POST_RENDER = 1 << FlagOfset++;
var FINAL = 1 << FlagOfset++;

var _batcher, _forward;

var _cullingMask = 0;

function RenderFlow() {
  this._func = init;
  this._next = null;
}

var _proto = RenderFlow.prototype;

_proto._doNothing = function () {};

_proto._localTransform = function (node) {
  node._updateLocalMatrix();

  node._renderFlag &= ~LOCAL_TRANSFORM;

  this._next._func(node);
};

_proto._worldTransform = function (node) {
  _batcher.worldMatDirty++;
  var t = node._matrix;
  var trs = node._trs;
  var tm = t.m;
  tm[12] = trs[0];
  tm[13] = trs[1];
  tm[14] = trs[2];

  node._mulMat(node._worldMatrix, node._parent._worldMatrix, t);

  node._renderFlag &= ~WORLD_TRANSFORM;

  this._next._func(node);

  _batcher.worldMatDirty--;
};

_proto._opacity = function (node) {
  _batcher.parentOpacityDirty++;

  this._next._func(node);

  node._renderFlag &= ~OPACITY;
  _batcher.parentOpacityDirty--;
};

_proto._color = function (node) {
  var comp = node._renderComponent;

  if (comp) {
    comp._updateColor();
  }

  node._renderFlag &= ~COLOR;

  this._next._func(node);
};

_proto._updateRenderData = function (node) {
  var comp = node._renderComponent;

  comp._assembler.updateRenderData(comp);

  node._renderFlag &= ~UPDATE_RENDER_DATA;

  this._next._func(node);
};

_proto._render = function (node) {
  var comp = node._renderComponent;

  comp._checkBacth(_batcher, node._cullingMask);

  comp._assembler.fillBuffers(comp, _batcher);

  this._next._func(node);
};

_proto._children = function (node) {
  var cullingMask = _cullingMask;
  var batcher = _batcher;
  var parentOpacity = batcher.parentOpacity;
  var opacity = batcher.parentOpacity *= node._opacity / 255;
  var worldTransformFlag = batcher.worldMatDirty ? WORLD_TRANSFORM : 0;
  var worldOpacityFlag = batcher.parentOpacityDirty ? OPACITY_COLOR : 0;
  var worldDirtyFlag = worldTransformFlag | worldOpacityFlag;
  var children = node._children;

  for (var i = 0, l = children.length; i < l; i++) {
    var c = children[i]; // Advance the modification of the flag to avoid node attribute modification is invalid when opacity === 0.

    c._renderFlag |= worldDirtyFlag;
    if (!c._activeInHierarchy || c._opacity === 0) continue;
    _cullingMask = c._cullingMask = c.groupIndex === 0 ? cullingMask : 1 << c.groupIndex; // TODO: Maybe has better way to implement cascade opacity

    var colorVal = c._color._val;

    c._color._fastSetA(c._opacity * opacity);

    flows[c._renderFlag]._func(c);

    c._color._val = colorVal;
  }

  batcher.parentOpacity = parentOpacity;

  this._next._func(node);
};

_proto._postRender = function (node) {
  var comp = node._renderComponent;

  comp._checkBacth(_batcher, node._cullingMask);

  comp._assembler.postFillBuffers(comp, _batcher);

  this._next._func(node);
};

var EMPTY_FLOW = new RenderFlow();
EMPTY_FLOW._func = EMPTY_FLOW._doNothing;
EMPTY_FLOW._next = EMPTY_FLOW;
var flows = {};

function createFlow(flag, next) {
  var flow = new RenderFlow();
  flow._next = next || EMPTY_FLOW;

  switch (flag) {
    case DONOTHING:
      flow._func = flow._doNothing;
      break;

    case BREAK_FLOW:
      flow._func = flow._doNothing;
      break;

    case LOCAL_TRANSFORM:
      flow._func = flow._localTransform;
      break;

    case WORLD_TRANSFORM:
      flow._func = flow._worldTransform;
      break;

    case OPACITY:
      flow._func = flow._opacity;
      break;

    case COLOR:
      flow._func = flow._color;
      break;

    case UPDATE_RENDER_DATA:
      flow._func = flow._updateRenderData;
      break;

    case RENDER:
      flow._func = flow._render;
      break;

    case CHILDREN:
      flow._func = flow._children;
      break;

    case POST_RENDER:
      flow._func = flow._postRender;
      break;
  }

  return flow;
}

function getFlow(flag) {
  var flow = null;
  var tFlag = FINAL;

  while (tFlag > 0) {
    if (tFlag & flag) flow = createFlow(tFlag, flow);
    tFlag = tFlag >> 1;
  }

  return flow;
} // 


function init(node) {
  var flag = node._renderFlag;
  var r = flows[flag] = getFlow(flag);

  r._func(node);
}

RenderFlow.flows = flows;
RenderFlow.createFlow = createFlow; // validate whether render component is ready to be rendered.

var _validateList = [];

RenderFlow.registerValidate = function (renderComp) {
  if (renderComp._inValidateList) return;

  _validateList.push(renderComp);

  renderComp._inValidateList = true;
};

RenderFlow.validateRenderers = function () {
  for (var i = 0, l = _validateList.length; i < l; i++) {
    var renderComp = _validateList[i];
    if (!renderComp.isValid) continue;

    if (!renderComp.enabledInHierarchy) {
      renderComp.disableRender();
    } else {
      renderComp._validateRender();
    }

    renderComp._inValidateList = false;
  }

  _validateList.length = 0;
};

RenderFlow.visitRootNode = function (rootNode) {
  RenderFlow.validateRenderers();
  var preCullingMask = _cullingMask;
  _cullingMask = rootNode._cullingMask;

  if (rootNode._renderFlag & WORLD_TRANSFORM) {
    _batcher.worldMatDirty++;

    rootNode._calculWorldMatrix();

    rootNode._renderFlag &= ~WORLD_TRANSFORM;

    flows[rootNode._renderFlag]._func(rootNode);

    _batcher.worldMatDirty--;
  } else {
    flows[rootNode._renderFlag]._func(rootNode);
  }

  _cullingMask = preCullingMask;
};

RenderFlow.render = function (rootNode, dt) {
  _batcher.reset();

  _batcher.walking = true;
  RenderFlow.visitRootNode(rootNode);

  _batcher.terminate();

  _batcher.walking = false;

  _forward.render(_batcher._renderScene, dt);
};

RenderFlow.renderCamera = function (camera, rootNode) {
  _batcher.reset();

  _batcher.walking = true;
  RenderFlow.visitRootNode(rootNode);

  _batcher.terminate();

  _batcher.walking = false;

  _forward.renderCamera(camera, _batcher._renderScene);
};

RenderFlow.init = function (batcher, forwardRenderer) {
  _batcher = batcher;
  _forward = forwardRenderer;
  flows[0] = EMPTY_FLOW;

  for (var i = 1; i < FINAL; i++) {
    flows[i] = new RenderFlow();
  }
};

RenderFlow.getBachther = function () {
  return _batcher;
};

RenderFlow.FLAG_DONOTHING = DONOTHING;
RenderFlow.FLAG_BREAK_FLOW = BREAK_FLOW;
RenderFlow.FLAG_LOCAL_TRANSFORM = LOCAL_TRANSFORM;
RenderFlow.FLAG_WORLD_TRANSFORM = WORLD_TRANSFORM;
RenderFlow.FLAG_TRANSFORM = TRANSFORM;
RenderFlow.FLAG_OPACITY = OPACITY;
RenderFlow.FLAG_COLOR = COLOR;
RenderFlow.FLAG_OPACITY_COLOR = OPACITY_COLOR;
RenderFlow.FLAG_UPDATE_RENDER_DATA = UPDATE_RENDER_DATA;
RenderFlow.FLAG_RENDER = RENDER;
RenderFlow.FLAG_CHILDREN = CHILDREN;
RenderFlow.FLAG_POST_RENDER = POST_RENDER;
RenderFlow.FLAG_FINAL = FINAL;
module.exports = cc.RenderFlow = RenderFlow;
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_engine__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImVuZ2luZS1kZXZcXGNvY29zMmRcXGNvcmVcXHJlbmRlcmVyXFxyZW5kZXItZmxvdy5qcyJdLCJuYW1lcyI6WyJGbGFnT2ZzZXQiLCJET05PVEhJTkciLCJCUkVBS19GTE9XIiwiTE9DQUxfVFJBTlNGT1JNIiwiV09STERfVFJBTlNGT1JNIiwiVFJBTlNGT1JNIiwiVVBEQVRFX1JFTkRFUl9EQVRBIiwiT1BBQ0lUWSIsIkNPTE9SIiwiT1BBQ0lUWV9DT0xPUiIsIlJFTkRFUiIsIkNISUxEUkVOIiwiUE9TVF9SRU5ERVIiLCJGSU5BTCIsIl9iYXRjaGVyIiwiX2ZvcndhcmQiLCJfY3VsbGluZ01hc2siLCJSZW5kZXJGbG93IiwiX2Z1bmMiLCJpbml0IiwiX25leHQiLCJfcHJvdG8iLCJwcm90b3R5cGUiLCJfZG9Ob3RoaW5nIiwiX2xvY2FsVHJhbnNmb3JtIiwibm9kZSIsIl91cGRhdGVMb2NhbE1hdHJpeCIsIl9yZW5kZXJGbGFnIiwiX3dvcmxkVHJhbnNmb3JtIiwid29ybGRNYXREaXJ0eSIsInQiLCJfbWF0cml4IiwidHJzIiwiX3RycyIsInRtIiwibSIsIl9tdWxNYXQiLCJfd29ybGRNYXRyaXgiLCJfcGFyZW50IiwiX29wYWNpdHkiLCJwYXJlbnRPcGFjaXR5RGlydHkiLCJfY29sb3IiLCJjb21wIiwiX3JlbmRlckNvbXBvbmVudCIsIl91cGRhdGVDb2xvciIsIl91cGRhdGVSZW5kZXJEYXRhIiwiX2Fzc2VtYmxlciIsInVwZGF0ZVJlbmRlckRhdGEiLCJfcmVuZGVyIiwiX2NoZWNrQmFjdGgiLCJmaWxsQnVmZmVycyIsIl9jaGlsZHJlbiIsImN1bGxpbmdNYXNrIiwiYmF0Y2hlciIsInBhcmVudE9wYWNpdHkiLCJvcGFjaXR5Iiwid29ybGRUcmFuc2Zvcm1GbGFnIiwid29ybGRPcGFjaXR5RmxhZyIsIndvcmxkRGlydHlGbGFnIiwiY2hpbGRyZW4iLCJpIiwibCIsImxlbmd0aCIsImMiLCJfYWN0aXZlSW5IaWVyYXJjaHkiLCJncm91cEluZGV4IiwiY29sb3JWYWwiLCJfdmFsIiwiX2Zhc3RTZXRBIiwiZmxvd3MiLCJfcG9zdFJlbmRlciIsInBvc3RGaWxsQnVmZmVycyIsIkVNUFRZX0ZMT1ciLCJjcmVhdGVGbG93IiwiZmxhZyIsIm5leHQiLCJmbG93IiwiZ2V0RmxvdyIsInRGbGFnIiwiciIsIl92YWxpZGF0ZUxpc3QiLCJyZWdpc3RlclZhbGlkYXRlIiwicmVuZGVyQ29tcCIsIl9pblZhbGlkYXRlTGlzdCIsInB1c2giLCJ2YWxpZGF0ZVJlbmRlcmVycyIsImlzVmFsaWQiLCJlbmFibGVkSW5IaWVyYXJjaHkiLCJkaXNhYmxlUmVuZGVyIiwiX3ZhbGlkYXRlUmVuZGVyIiwidmlzaXRSb290Tm9kZSIsInJvb3ROb2RlIiwicHJlQ3VsbGluZ01hc2siLCJfY2FsY3VsV29ybGRNYXRyaXgiLCJyZW5kZXIiLCJkdCIsInJlc2V0Iiwid2Fsa2luZyIsInRlcm1pbmF0ZSIsIl9yZW5kZXJTY2VuZSIsInJlbmRlckNhbWVyYSIsImNhbWVyYSIsImZvcndhcmRSZW5kZXJlciIsImdldEJhY2h0aGVyIiwiRkxBR19ET05PVEhJTkciLCJGTEFHX0JSRUFLX0ZMT1ciLCJGTEFHX0xPQ0FMX1RSQU5TRk9STSIsIkZMQUdfV09STERfVFJBTlNGT1JNIiwiRkxBR19UUkFOU0ZPUk0iLCJGTEFHX09QQUNJVFkiLCJGTEFHX0NPTE9SIiwiRkxBR19PUEFDSVRZX0NPTE9SIiwiRkxBR19VUERBVEVfUkVOREVSX0RBVEEiLCJGTEFHX1JFTkRFUiIsIkZMQUdfQ0hJTERSRU4iLCJGTEFHX1BPU1RfUkVOREVSIiwiRkxBR19GSU5BTCIsIm1vZHVsZSIsImV4cG9ydHMiLCJjYyJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7OztBQUFBLElBQUlBLFNBQVMsR0FBRyxDQUFoQjtBQUVBLElBQU1DLFNBQVMsR0FBRyxLQUFLRCxTQUFTLEVBQWhDO0FBQ0EsSUFBTUUsVUFBVSxHQUFHLEtBQUtGLFNBQVMsRUFBakM7QUFDQSxJQUFNRyxlQUFlLEdBQUcsS0FBS0gsU0FBUyxFQUF0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YUFBaEM7QUFDQVEsVUFBVSxDQUFDK0YsdUJBQVgsR0FBcUMxRyxrQkFBckM7QUFDQVcsVUFBVSxDQUFDZ0csV0FBWCxHQUF5QnZHLE1BQXpCO0FBQ0FPLFVBQVUsQ0FBQ2lHLGFBQVgsR0FBMkJ2RyxRQUEzQjtBQUNBTSxVQUFVLENBQUNrRyxnQkFBWCxHQUE4QnZHLFdBQTlCO0FBQ0FLLFVBQVUsQ0FBQ21HLFVBQVgsR0FBd0J2RyxLQUF4QjtBQUVBd0csTUFBTSxDQUFDQyxPQUFQLEdBQWlCQyxFQUFFLENBQUN0RyxVQUFILEdBQWdCQSxVQUFqQyIsInNvdXJjZXNDb250ZW50IjpbImxldCBGbGFnT2ZzZXQgPSAwO1xyXG5cclxuY29uc3QgRE9OT1RISU5HID0gMSA8PCBGbGFnT2ZzZXQrKztcclxuY29uc3QgQlJFQUtfRkxPVyA9IDEgPDwgRmxhZ09mc2V0Kys7XHJcbmNvbnN0IExPQ0FMX1RSQU5TRk9STSA9IDEgPDwgRmxhZ09mc2V0Kys7XHJcbmNvbnN0IFdPUkxEX1RSQU5TRk9STSA9IDEgPDwgRmxhZ09mc2V0Kys7XHJcbmNvbnN0IFRSQU5TRk9STSA9IExPQ0FMX1RSQU5TRk9STSB8IFdPUkxEX1RSQU5TRk9STTtcclxuY29uc3QgVVBEQVRFX1JFTkRFUl9EQVRBID0gMSA8PCBGbGFnT2ZzZXQrKztcclxuY29uc3QgT1BBQ0lUWSA9IDEgPDwgRmxhZ09mc2V0Kys7XHJcbmNvbnN0IENPTE9SID0gMSA8PCBGbGFnT2ZzZXQrKztcclxuY29uc3QgT1BBQ0lUWV9DT0xPUiA9IE9QQUNJVFkgfCBDT0xPUjtcclxuY29uc3QgUkVOREVSID0gMSA8PCBGbGFnT2ZzZXQrKztcclxuY29uc3QgQ0hJTERSRU4gPSAxIDw8IEZsYWdPZnNldCsrO1xyXG5jb25zdCBQT1NUX1JFTkRFUiA9IDEgPDwgRmxhZ09mc2V0Kys7XHJcbmNvbnN0IEZJTkFMID0gMSA8PCBGbGFnT2ZzZXQrKztcclxuXHJcbmxldCBfYmF0Y2hlciwgX2ZvcndhcmQ7XHJcbmxldCBfY3VsbGluZ01hc2sgPSAwO1xyXG5cclxuZnVuY3Rpb24gUmVuZGVyRmxvdyAoKSB7XHJcbiAgICB0aGlzLl9mdW5jID0gaW5pdDtcclxuICAgIHRoaXMuX25leHQgPSBudWxsO1xyXG59XHJcblxyXG5sZXQgX3Byb3RvID0gUmVuZGVyRmxvdy5wcm90b3R5cGU7XHJcbl9wcm90by5fZG9Ob3RoaW5nID0gZnVuY3Rpb24gKCkge1xyXG59O1xyXG5cclxuX3Byb3RvLl9sb2NhbFRyYW5zZm9ybSA9IGZ1bmN0aW9uIChub2RlKSB7XHJcbiAgICBub2RlLl91cGRhdGVMb2NhbE1hdHJpeCgpO1xyXG4gICAgbm9kZS5fcmVuZGVyRmxhZyAmPSB+TE9DQUxfVFJBTlNGT1JNO1xyXG4gICAgdGhpcy5fbmV4dC5fZnVuYyhub2RlKTtcclxufTtcclxuXHJcbl9wcm90by5fd29ybGRUcmFuc2Zvcm0gPSBmdW5jdGlvbiAobm9kZSkge1xyXG4gICAgX2JhdGNoZXIud29ybGRNYXREaXJ0eSArKztcclxuXHJcbiAgICBsZXQgdCA9IG5vZGUuX21hdHJpeDtcclxuICAgIGxldCB0cnMgPSBub2RlLl90cnM7XHJcbiAgICBsZXQgdG0gPSB0Lm07XHJcbiAgICB0bVsxMl0gPSB0cnNbMF07XHJcbiAgICB0bVsxM10gPSB0cnNbMV07XHJcbiAgICB0bVsxNF0gPSB0cnNbMl07XHJcblxyXG4gICAgbm9kZS5fbXVsTWF0KG5vZGUuX3dvcmxkTWF0cml4LCBub2RlLl9wYXJlbnQuX3dvcmxkTWF0cml4LCB0KTtcclxuICAgIG5vZGUuX3JlbmRlckZsYWcgJj0gfldPUkxEX1RSQU5TRk9STTtcclxuICAgIHRoaXMuX25leHQuX2Z1bmMobm9kZSk7XHJcblxyXG4gICAgX2JhdGNoZXIud29ybGRNYXREaXJ0eSAtLTtcclxufTtcclxuXHJcbl9wcm90by5fb3BhY2l0eSA9IGZ1bmN0aW9uIChub2RlKSB7XHJcbiAgICBfYmF0Y2hlci5wYXJlbnRPcGFjaXR5RGlydHkrKztcclxuXHJcbiAgICB0aGlzLl9uZXh0Ll9mdW5jKG5vZGUpO1xyXG5cclxuICAgIG5vZGUuX3JlbmRlckZsYWcgJj0gfk9QQUNJVFk7XHJcbiAgICBfYmF0Y2hlci5wYXJlbnRPcGFjaXR5RGlydHktLTtcclxufTtcclxuXHJcbl9wcm90by5fY29sb3IgPSBmdW5jdGlvbiAobm9kZSkge1xyXG4gICAgbGV0IGNvbXAgPSBub2RlLl9yZW5kZXJDb21wb25lbnQ7XHJcbiAgICBpZiAoY29tcCkge1xyXG4gICAgICAgIGNvbXAuX3VwZGF0ZUNvbG9yKCk7XHJcbiAgICB9XHJcblxyXG4gICAgbm9kZS5fcmVuZGVyRmxhZyAmPSB+Q09MT1I7XHJcbiAgICB0aGlzLl9uZXh0Ll9mdW5jKG5vZGUpO1xyXG59O1xyXG5cclxuX3Byb3RvLl91cGRhdGVSZW5kZXJEYXRhID0gZnVuY3Rpb24gKG5vZGUpIHtcclxuICAgIGxldCBjb21wID0gbm9kZS5fcmVuZGVyQ29tcG9uZW50O1xyXG4gICAgY29tcC5fYXNzZW1ibGVyLnVwZGF0ZVJlbmRlckRhdGEoY29tcCk7XHJcbiAgICBub2RlLl9yZW5kZXJGbGFnICY9IH5VUERBVEVfUkVOREVSX0RBVEE7XHJcbiAgICB0aGlzLl9uZXh0Ll9mdW5jKG5vZGUpO1xyXG59O1xyXG5cclxuX3Byb3RvLl9yZW5kZXIgPSBmdW5jdGlvbiAobm9kZSkge1xyXG4gICAgbGV0IGNvbXAgPSBub2RlLl9yZW5kZXJDb21wb25lbnQ7XHJcbiAgICBjb21wLl9jaGVja0JhY3RoKF9iYXRjaGVyLCBub2RlLl9jdWxsaW5nTWFzayk7XHJcbiAgICBjb21wLl9hc3NlbWJsZXIuZmlsbEJ1ZmZlcnMoY29tcCwgX2JhdGNoZXIpO1xyXG4gICAgdGhpcy5fbmV4dC5fZnVuYyhub2RlKTtcclxufTtcclxuXHJcblxyXG5fcHJvdG8uX2NoaWxkcmVuID0gZnVuY3Rpb24gKG5vZGUpIHtcclxuICAgIGxldCBjdWxsaW5nTWFzayA9IF9jdWxsaW5nTWFzaztcclxuICAgIGxldCBiYXRjaGVyID0gX2JhdGNoZXI7XHJcblxyXG4gICAgbGV0IHBhcmVudE9wYWNpdHkgPSBiYXRjaGVyLnBhcmVudE9wYWNpdHk7XHJcbiAgICBsZXQgb3BhY2l0eSA9IChiYXRjaGVyLnBhcmVudE9wYWNpdHkgKj0gKG5vZGUuX29wYWNpdHkgLyAyNTUpKTtcclxuXHJcbiAgICBsZXQgd29ybGRUcmFuc2Zvcm1GbGFnID0gYmF0Y2hlci53b3JsZE1hdERpcnR5ID8gV09STERfVFJBTlNGT1JNIDogMDtcclxuICAgIGxldCB3b3JsZE9wYWNpdHlGbGFnID0gYmF0Y2hlci5wYXJlbnRPcGFjaXR5RGlydHkgPyBPUEFDSVRZX0NPTE9SIDogMDtcclxuICAgIGxldCB3b3JsZERpcnR5RmxhZyA9IHdvcmxkVHJhbnNmb3JtRmxhZyB8IHdvcmxkT3BhY2l0eUZsYWc7XHJcblxyXG4gICAgbGV0IGNoaWxkcmVuID0gbm9kZS5fY2hpbGRyZW47XHJcbiAgICBmb3IgKGxldCBpID0gMCwgbCA9IGNoaWxkcmVuLmxlbmd0aDsgaSA8IGw7IGkrKykge1xyXG4gICAgICAgIGxldCBjID0gY2hpbGRyZW5baV07XHJcblxyXG4gICAgICAgIC8vIEFkdmFuY2UgdGhlIG1vZGlmaWNhdGlvbiBvZiB0aGUgZmxhZyB0byBhdm9pZCBub2RlIGF0dHJpYnV0ZSBtb2RpZmljYXRpb24gaXMgaW52YWxpZCB3aGVuIG9wYWNpdHkgPT09IDAuXHJcbiAgICAgICAgYy5fcmVuZGVyRmxhZyB8PSB3b3JsZERpcnR5RmxhZztcclxuICAgICAgICBpZiAoIWMuX2FjdGl2ZUluSGllcmFyY2h5IHx8IGMuX29wYWNpdHkgPT09IDApIGNvbnRpbnVlO1xyXG5cclxuICAgICAgICBfY3VsbGluZ01hc2sgPSBjLl9jdWxsaW5nTWFzayA9IGMuZ3JvdXBJbmRleCA9PT0gMCA/IGN1bGxpbmdNYXNrIDogMSA8PCBjLmdyb3VwSW5kZXg7XHJcblxyXG4gICAgICAgIC8vIFRPRE86IE1heWJlIGhhcyBiZXR0ZXIgd2F5IHRvIGltcGxlbWVudCBjYXNjYWRlIG9wYWNpdHlcclxuICAgICAgICBsZXQgY29sb3JWYWwgPSBjLl9jb2xvci5fdmFsO1xyXG4gICAgICAgIGMuX2NvbG9yLl9mYXN0U2V0QShjLl9vcGFjaXR5ICogb3BhY2l0eSk7XHJcbiAgICAgICAgZmxvd3NbYy5fcmVuZGVyRmxhZ10uX2Z1bmMoYyk7XHJcbiAgICAgICAgYy5fY29sb3IuX3ZhbCA9IGNvbG9yVmFsO1xyXG4gICAgfVxyXG5cclxuICAgIGJhdGNoZXIucGFyZW50T3BhY2l0eSA9IHBhcmVudE9wYWNpdHk7XHJcblxyXG4gICAgdGhpcy5fbmV4dC5fZnVuYyhub2RlKTtcclxufTtcclxuXHJcbl9wcm90by5fcG9zdFJlbmRlciA9IGZ1bmN0aW9uIChub2RlKSB7XHJcbiAgICBsZXQgY29tcCA9IG5vZGUuX3JlbmRlckNvbXBvbmVudDtcclxuICAgIGNvbXAuX2NoZWNrQmFjdGgoX2JhdGNoZXIsIG5vZGUuX2N1bGxpbmdNYXNrKTtcclxuICAgIGNvbXAuX2Fzc2VtYmxlci5wb3N0RmlsbEJ1ZmZlcnMoY29tcCwgX2JhdGNoZXIpO1xyXG4gICAgdGhpcy5fbmV4dC5fZnVuYyhub2RlKTtcclxufTtcclxuXHJcbmNvbnN0IEVNUFRZX0ZMT1cgPSBuZXcgUmVuZGVyRmxvdygpO1xyXG5FTVBUWV9GTE9XLl9mdW5jID0gRU1QVFlfRkxPVy5fZG9Ob3RoaW5nO1xyXG5FTVBUWV9GTE9XLl9uZXh0ID0gRU1QVFlfRkxPVztcclxuXHJcbmxldCBmbG93cyA9IHt9O1xyXG5cclxuZnVuY3Rpb24gY3JlYXRlRmxvdyAoZmxhZywgbmV4dCkge1xyXG4gICAgbGV0IGZsb3cgPSBuZXcgUmVuZGVyRmxvdygpO1xyXG4gICAgZmxvdy5fbmV4dCA9IG5leHQgfHwgRU1QVFlfRkxPVztcclxuXHJcbiAgICBzd2l0Y2ggKGZsYWcpIHtcclxuICAgICAgICBjYXNlIERPTk9USElORzogXHJcbiAgICAgICAgICAgIGZsb3cuX2Z1bmMgPSBmbG93Ll9kb05vdGhpbmc7XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGNhc2UgQlJFQUtfRkxPVzpcclxuICAgICAgICAgICAgZmxvdy5fZnVuYyA9IGZsb3cuX2RvTm90aGluZztcclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgY2FzZSBMT0NBTF9UUkFOU0ZPUk06IFxyXG4gICAgICAgICAgICBmbG93Ll9mdW5jID0gZmxvdy5fbG9jYWxUcmFuc2Zvcm07XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGNhc2UgV09STERfVFJBTlNGT1JNOiBcclxuICAgICAgICAgICAgZmxvdy5fZnVuYyA9IGZsb3cuX3dvcmxkVHJhbnNmb3JtO1xyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICBjYXNlIE9QQUNJVFk6XHJcbiAgICAgICAgICAgIGZsb3cuX2Z1bmMgPSBmbG93Ll9vcGFjaXR5O1xyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICBjYXNlIENPTE9SOlxyXG4gICAgICAgICAgICBmbG93Ll9mdW5jID0gZmxvdy5fY29sb3I7XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGNhc2UgVVBEQVRFX1JFTkRFUl9EQVRBOlxyXG4gICAgICAgICAgICBmbG93Ll9mdW5jID0gZmxvdy5fdXBkYXRlUmVuZGVyRGF0YTtcclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgY2FzZSBSRU5ERVI6IFxyXG4gICAgICAgICAgICBmbG93Ll9mdW5jID0gZmxvdy5fcmVuZGVyO1xyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICBjYXNlIENISUxEUkVOOiBcclxuICAgICAgICAgICAgZmxvdy5fZnVuYyA9IGZsb3cuX2NoaWxkcmVuO1xyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICBjYXNlIFBPU1RfUkVOREVSOiBcclxuICAgICAgICAgICAgZmxvdy5fZnVuYyA9IGZsb3cuX3Bvc3RSZW5kZXI7XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBmbG93O1xyXG59XHJcblxyXG5mdW5jdGlvbiBnZXRGbG93IChmbGFnKSB7XHJcbiAgICBsZXQgZmxvdyA9IG51bGw7XHJcbiAgICBsZXQgdEZsYWcgPSBGSU5BTDtcclxuICAgIHdoaWxlICh0RmxhZyA+IDApIHtcclxuICAgICAgICBpZiAodEZsYWcgJiBmbGFnKVxyXG4gICAgICAgICAgICBmbG93ID0gY3JlYXRlRmxvdyh0RmxhZywgZmxvdyk7XHJcbiAgICAgICAgdEZsYWcgPSB0RmxhZyA+PiAxO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIGZsb3c7XHJcbn1cclxuXHJcbi8vIFxyXG5mdW5jdGlvbiBpbml0IChub2RlKSB7XHJcbiAgICBsZXQgZmxhZyA9IG5vZGUuX3JlbmRlckZsYWc7XHJcbiAgICBsZXQgciA9IGZsb3dzW2ZsYWddID0gZ2V0RmxvdyhmbGFnKTtcclxuICAgIHIuX2Z1bmMobm9kZSk7XHJcbn1cclxuXHJcblJlbmRlckZsb3cuZmxvd3MgPSBmbG93cztcclxuUmVuZGVyRmxvdy5jcmVhdGVGbG93ID0gY3JlYXRlRmxvdztcclxuXHJcbi8vIHZhbGlkYXRlIHdoZXRoZXIgcmVuZGVyIGNvbXBvbmVudCBpcyByZWFkeSB0byBiZSByZW5kZXJlZC5cclxubGV0IF92YWxpZGF0ZUxpc3QgPSBbXTtcclxuUmVuZGVyRmxvdy5yZWdpc3RlclZhbGlkYXRlID0gZnVuY3Rpb24gKHJlbmRlckNvbXApIHtcclxuICAgIGlmIChyZW5kZXJDb21wLl9pblZhbGlkYXRlTGlzdCkgcmV0dXJuO1xyXG4gICAgX3ZhbGlkYXRlTGlzdC5wdXNoKHJlbmRlckNvbXApO1xyXG4gICAgcmVuZGVyQ29tcC5faW5WYWxpZGF0ZUxpc3QgPSAgdHJ1ZTtcclxufTtcclxuUmVuZGVyRmxvdy52YWxpZGF0ZVJlbmRlcmVycyA9IGZ1bmN0aW9uICgpIHtcclxuICAgIGZvciAobGV0IGkgPSAwLCBsID0gX3ZhbGlkYXRlTGlzdC5sZW5ndGg7IGkgPCBsOyBpKyspIHtcclxuICAgICAgICBsZXQgcmVuZGVyQ29tcCA9IF92YWxpZGF0ZUxpc3RbaV07XHJcbiAgICAgICAgaWYgKCFyZW5kZXJDb21wLmlzVmFsaWQpIGNvbnRpbnVlO1xyXG4gICAgICAgIGlmICghcmVuZGVyQ29tcC5lbmFibGVkSW5IaWVyYXJjaHkpIHtcclxuICAgICAgICAgICAgcmVuZGVyQ29tcC5kaXNhYmxlUmVuZGVyKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICByZW5kZXJDb21wLl92YWxpZGF0ZVJlbmRlcigpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZW5kZXJDb21wLl9pblZhbGlkYXRlTGlzdCA9IGZhbHNlO1xyXG4gICAgfVxyXG4gICAgX3ZhbGlkYXRlTGlzdC5sZW5ndGggPSAwO1xyXG59O1xyXG5cclxuXHJcblJlbmRlckZsb3cudmlzaXRSb290Tm9kZSA9IGZ1bmN0aW9uIChyb290Tm9kZSkge1xyXG4gICAgUmVuZGVyRmxvdy52YWxpZGF0ZVJlbmRlcmVycygpOyAgICBcclxuXHJcbiAgICBsZXQgcHJlQ3VsbGluZ01hc2sgPSBfY3VsbGluZ01hc2s7XHJcbiAgICBfY3VsbGluZ01hc2sgPSByb290Tm9kZS5fY3VsbGluZ01hc2s7XHJcblxyXG4gICAgaWYgKHJvb3ROb2RlLl9yZW5kZXJGbGFnICYgV09STERfVFJBTlNGT1JNKSB7XHJcbiAgICAgICAgX2JhdGNoZXIud29ybGRNYXREaXJ0eSArKztcclxuICAgICAgICByb290Tm9kZS5fY2FsY3VsV29ybGRNYXRyaXgoKTtcclxuICAgICAgICByb290Tm9kZS5fcmVuZGVyRmxhZyAmPSB+V09STERfVFJBTlNGT1JNO1xyXG5cclxuICAgICAgICBmbG93c1tyb290Tm9kZS5fcmVuZGVyRmxhZ10uX2Z1bmMocm9vdE5vZGUpO1xyXG5cclxuICAgICAgICBfYmF0Y2hlci53b3JsZE1hdERpcnR5IC0tO1xyXG4gICAgfVxyXG4gICAgZWxzZSB7XHJcbiAgICAgICAgZmxvd3Nbcm9vdE5vZGUuX3JlbmRlckZsYWddLl9mdW5jKHJvb3ROb2RlKTtcclxuICAgIH1cclxuXHJcbiAgICBfY3VsbGluZ01hc2sgPSBwcmVDdWxsaW5nTWFzaztcclxufTtcclxuXHJcblJlbmRlckZsb3cucmVuZGVyID0gZnVuY3Rpb24gKHJvb3ROb2RlLCBkdCkge1xyXG4gICAgX2JhdGNoZXIucmVzZXQoKTtcclxuICAgIF9iYXRjaGVyLndhbGtpbmcgPSB0cnVlO1xyXG5cclxuICAgIFJlbmRlckZsb3cudmlzaXRSb290Tm9kZShyb290Tm9kZSk7XHJcblxyXG4gICAgX2JhdGNoZXIudGVybWluYXRlKCk7XHJcbiAgICBfYmF0Y2hlci53YWxraW5nID0gZmFsc2U7XHJcblxyXG4gICAgX2ZvcndhcmQucmVuZGVyKF9iYXRjaGVyLl9yZW5kZXJTY2VuZSwgZHQpO1xyXG59O1xyXG5cclxuUmVuZGVyRmxvdy5yZW5kZXJDYW1lcmEgPSBmdW5jdGlvbiAoY2FtZXJhLCByb290Tm9kZSkge1xyXG4gICAgX2JhdGNoZXIucmVzZXQoKTtcclxuICAgIF9iYXRjaGVyLndhbGtpbmcgPSB0cnVlO1xyXG5cclxuICAgIFJlbmRlckZsb3cudmlzaXRSb290Tm9kZShyb290Tm9kZSk7XHJcblxyXG4gICAgX2JhdGNoZXIudGVybWluYXRlKCk7XHJcbiAgICBfYmF0Y2hlci53YWxraW5nID0gZmFsc2U7XHJcblxyXG4gICAgX2ZvcndhcmQucmVuZGVyQ2FtZXJhKGNhbWVyYSwgX2JhdGNoZXIuX3JlbmRlclNjZW5lKTtcclxufTtcclxuXHJcblJlbmRlckZsb3cuaW5pdCA9IGZ1bmN0aW9uIChiYXRjaGVyLCBmb3J3YXJkUmVuZGVyZXIpIHtcclxuICAgIF9iYXRjaGVyID0gYmF0Y2hlcjtcclxuICAgIF9mb3J3YXJkID0gZm9yd2FyZFJlbmRlcmVyO1xyXG5cclxuICAgIGZsb3dzWzBdID0gRU1QVFlfRkxPVztcclxuICAgIGZvciAobGV0IGkgPSAxOyBpIDwgRklOQUw7IGkrKykge1xyXG4gICAgICAgIGZsb3dzW2ldID0gbmV3IFJlbmRlckZsb3coKTtcclxuICAgIH1cclxufTtcclxuXHJcblJlbmRlckZsb3cuZ2V0QmFjaHRoZXIgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICByZXR1cm4gX2JhdGNoZXI7XHJcbn07XHJcblxyXG5SZW5kZXJGbG93LkZMQUdfRE9OT1RISU5HID0gRE9OT1RISU5HO1xyXG5SZW5kZXJGbG93LkZMQUdfQlJFQUtfRkxPVyA9IEJSRUFLX0ZMT1c7XHJcblJlbmRlckZsb3cuRkxBR19MT0NBTF9UUkFOU0ZPUk0gPSBMT0NBTF9UUkFOU0ZPUk07XHJcblJlbmRlckZsb3cuRkxBR19XT1JMRF9UUkFOU0ZPUk0gPSBXT1JMRF9UUkFOU0ZPUk07XHJcblJlbmRlckZsb3cuRkxBR19UUkFOU0ZPUk0gPSBUUkFOU0ZPUk07XHJcblJlbmRlckZsb3cuRkxBR19PUEFDSVRZID0gT1BBQ0lUWTtcclxuUmVuZGVyRmxvdy5GTEFHX0NPTE9SID0gQ09MT1I7XHJcblJlbmRlckZsb3cuRkxBR19PUEFDSVRZX0NPTE9SID0gT1BBQ0lUWV9DT0xPUjtcclxuUmVuZGVyRmxvdy5GTEFHX1VQREFURV9SRU5ERVJfREFUQSA9IFVQREFURV9SRU5ERVJfREFUQTtcclxuUmVuZGVyRmxvdy5GTEFHX1JFTkRFUiA9IFJFTkRFUjtcclxuUmVuZGVyRmxvdy5GTEFHX0NISUxEUkVOID0gQ0hJTERSRU47XHJcblJlbmRlckZsb3cuRkxBR19QT1NUX1JFTkRFUiA9IFBPU1RfUkVOREVSO1xyXG5SZW5kZXJGbG93LkZMQUdfRklOQUwgPSBGSU5BTDtcclxuXHJcbm1vZHVsZS5leHBvcnRzID0gY2MuUmVuZGVyRmxvdyA9IFJlbmRlckZsb3c7XHJcbiJdLCJzb3VyY2VSb290IjoiLyJ9