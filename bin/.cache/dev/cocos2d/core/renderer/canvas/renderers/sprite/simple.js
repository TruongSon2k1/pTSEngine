
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'engine-dev/cocos2d/core/renderer/canvas/renderers/sprite/simple.js';
                    var __require = nodeEnv ? function (request) {
                        return require(request);
                    } : function (request) {
                        return __quick_compile_engine__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_engine__.registerModule(__filename, module);}"use strict";

exports.__esModule = true;
exports["default"] = void 0;

var _assembler = _interopRequireDefault(require("../../../assembler"));

var _renderData = _interopRequireDefault(require("../render-data"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { "default": obj }; }

function _inheritsLoose(subClass, superClass) { subClass.prototype = Object.create(superClass.prototype); subClass.prototype.constructor = subClass; _setPrototypeOf(subClass, superClass); }

function _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }

var utils = require('../utils');

var CanvasSimpleSprite = /*#__PURE__*/function (_Assembler) {
  _inheritsLoose(CanvasSimpleSprite, _Assembler);

  function CanvasSimpleSprite() {
    return _Assembler.apply(this, arguments) || this;
  }

  var _proto = CanvasSimpleSprite.prototype;

  _proto.init = function init() {
    this._renderData = new _renderData["default"]();
    this._renderData.dataLength = 2;
  };

  _proto.updateRenderData = function updateRenderData(sprite) {
    if (sprite._vertsDirty) {
      this.updateUVs(sprite);
      this.updateVerts(sprite);
      sprite._vertsDirty = false;
    }
  };

  _proto.updateUVs = function updateUVs(sprite) {
    var frame = sprite.spriteFrame;
    var renderData = this._renderData;
    var verts = renderData.vertices;
    var rect = frame._rect;

    if (frame._rotated) {
      var l = rect.x;
      var r = rect.width;
      var b = rect.y;
      var t = rect.height;
      verts[0].u = l;
      verts[0].v = b;
      verts[1].u = t;
      verts[1].v = r;
    } else {
      var _l = rect.x;
      var _r = rect.width;
      var _b = rect.y;
      var _t = rect.height;
      verts[0].u = _l;
      verts[0].v = _b;
      verts[1].u = _r;
      verts[1].v = _t;
    }
  };

  _proto.updateVerts = function updateVerts(sprite) {
    var renderData = this._renderData,
        node = sprite.node,
        verts = renderData.vertices,
        frame = sprite.spriteFrame,
        cw = node.width,
        ch = node.height,
        appx = node.anchorX * cw,
        appy = node.anchorY * ch,
        l,
        b,
        r,
        t;

    if (sprite.trim) {
      l = -appx;
      b = -appy;
      r = cw;
      t = ch;
    } else {
      var ow = frame._originalSize.width,
          oh = frame._originalSize.height,
          rw = frame._rect.width,
          rh = frame._rect.height,
          offset = frame._offset,
          scaleX = cw / ow,
          scaleY = ch / oh;
      var trimLeft = offset.x + (ow - rw) / 2;
      var trimBottom = offset.y + (oh - rh) / 2;
      l = trimLeft * scaleX - appx;
      b = trimBottom * scaleY - appy;
      r = cw;
      t = ch;
    }

    if (frame._rotated) {
      verts[0].y = l;
      verts[0].x = b;
      verts[1].y = r;
      verts[1].x = t;
    } else {
      verts[0].x = l;
      verts[0].y = b;
      verts[1].x = r;
      verts[1].y = t;
    }

    renderData.vertDirty = false;
  };

  _proto.draw = function draw(ctx, comp) {
    var node = comp.node;
    var frame = comp._spriteFrame; // Transform

    var matrix = node._worldMatrix;
    var matrixm = matrix.m;
    var a = matrixm[0],
        b = matrixm[1],
        c = matrixm[4],
        d = matrixm[5],
        tx = matrixm[12],
        ty = matrixm[13];
    ctx.transform(a, b, c, d, tx, ty);
    ctx.scale(1, -1);

    if (frame._rotated) {
      ctx.rotate(-Math.PI / 2);
    } // TODO: handle blend function
    // opacity


    utils.context.setGlobalAlpha(ctx, node.opacity / 255);
    var tex = frame._texture,
        verts = this._renderData.vertices;
    var image = utils.getColorizedImage(tex, node._color);
    var x = verts[0].x;
    var y = verts[0].y;
    var w = verts[1].x;
    var h = verts[1].y;
    y = -y - h;
    var sx = verts[0].u;
    var sy = verts[0].v;
    var sw = verts[1].u;
    var sh = verts[1].v;
    ctx.drawImage(image, sx, sy, sw, sh, x, y, w, h);
    return 1;
  };

  return CanvasSimpleSprite;
}(_assembler["default"]);

exports["default"] = CanvasSimpleSprite;
module.exports = exports["default"];
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_engine__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImVuZ2luZS1kZXZcXGNvY29zMmRcXGNvcmVcXHJlbmRlcmVyXFxjYW52YXNcXHJlbmRlcmVyc1xcc3ByaXRlXFxzaW1wbGUuanMiXSwibmFtZXMiOlsidXRpbHMiLCJyZXF1aXJlIiwiQ2FudmFzU2ltcGxlU3ByaXRlIiwiaW5pdCIsIl9yZW5kZXJEYXRhIiwiUmVuZGVyRGF0YSIsImRhdGFMZW5ndGgiLCJ1cGRhdGVSZW5kZXJEYXRhIiwic3ByaXRlIiwiX3ZlcnRzRGlydHkiLCJ1cGRhdGVVVnMiLCJ1cGRhdGVWZXJ0cyIsImZyYW1lIiwic3ByaXRlRnJhbWUiLCJyZW5kZXJEYXRhIiwidmVydHMiLCJ2ZXJ0aWNlcyIsInJlY3QiLCJfcmVjdCIsIl9yb3RhdGVkIiwibCIsIngiLCJyIiwid2lkdGgiLCJiIiwieSIsInQiLCJoZWlnaHQiLCJ1IiwidiIsIm5vZGUiLCJjdyIsImNoIiwiYXBweCIsImFuY2hvclgiLCJhcHB5IiwiYW5jaG9yWSIsInRyaW0iLCJvdyIsIl9vcmlnaW5hbFNpemUiLCJvaCIsInJ3IiwicmgiLCJvZmZzZXQiLCJfb2Zmc2V0Iiwic2NhbGVYIiwic2NhbGVZIiwidHJpbUxlZnQiLCJ0cmltQm90dG9tIiwidmVydERpcnR5IiwiZHJhdyIsImN0eCIsImNvbXAiLCJfc3ByaXRlRnJhbWUiLCJtYXRyaXgiLCJfd29ybGRNYXRyaXgiLCJtYXRyaXhtIiwibSIsImEiLCJjIiwiZCIsInR4IiwidHkiLCJ0cmFuc2Zvcm0iLCJzY2FsZSIsInJvdGF0ZSIsIk1hdGgiLCJQSSIsImNvbnRleHQiLCJzZXRHbG9iYWxBbHBoYSIsIm9wYWNpdHkiLCJ0ZXgiLCJfdGV4dHVyZSIsImltYWdlIiwiZ2V0Q29sb3JpemVkSW1hZ2UiLCJfY29sb3IiLCJ3IiwiaCIsInN4Iiwic3kiLCJzdyIsInNoIiwiZHJhd0ltYWdlIiwiQXNzZW1ibGVyIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7O0FBeUJBOztBQUNBOzs7Ozs7OztBQUNBLElBQU1BLEtBQUssR0FBR0MsT0FBTyxDQUFDLFVBQUQsQ0FBckI7O0lBRXFCQzs7Ozs7Ozs7O1NBQ2pCQyxPQUFBLGdCQUFRO0FBQ0osU0FBS0MsV0FBTCxHQUFtQixJQUFJQyxzQkFBSixFQUFuQjtBQUNBLFNBQUtELFdBQUwsQ0FBaUJFLFVBQWpCLEdBQThCLENBQTlCO0FBQ0g7O1NBRURDLG1CQUFBLDBCQUFrQkMsTUFBbEIsRUFBMEI7QUFDdEIsUUFBSUEsTUFBTSxDQUFDQyxXQUFYLEVBQXdCO0FBQ3BCLFdBQUtDLFNBQUwsQ0FBZUYsTUFBZjtBQUNBLFdBQUtHLFdBQUwsQ0FBaUJILE1BQWpCO0FBQ0FBLE1BQUFBLE1BQU0sQ0FBQ0MsV0FBUCxHQUFxQixLQUFyQjtBQUNIO0FBQ0o7O1NBRURDLFlBQUEsbUJBQVdGLE1BQVgsRUFBbUI7QUFDZixRQUFJSSxLQUFLLEdBQUdKLE1BQU0sQ0FBQ0ssV0FBbkI7QUFDQSxRQUFJQyxVQUFVLEdBQUcsS0FBS1YsV0FBdEI7QUFDQSxRQUFJVyxLQUFLLEdBQUdELFVBQVUsQ0FBQ0UsUUFBdkI7QUFDQSxRQUFJQyxJQUFJLEdBQUdMLEtBQUssQ0FBQ00sS0FBakI7O0FBRUEsUUFBSU4sS0FBSyxDQUFDTyxRQUFWLEVBQW9CO0FBQ2hCLFVBQUlDLENBQUMsR0FBR0gsSUFBSSxDQUFDSSxDQUFiO0FBQ0EsVUFBSUMsQ0FBQyxHQUFHTCxJQUFJLENBQUNNLEtBQWI7QUFDQSxVQUFJQyxDQUFDLEdBQUdQLElBQUksQ0FBQ1EsQ0FBYjtBQUNBLFVBQUlDLENBQUMsR0FBR1QsSUFBSSxDQUFDVSxNQUFiO0FBQ0FaLE1BQUFBLEtBQUssQ0FBQyxDQUFELENBQUwsQ0FBU2EsQ0FBVCxHQUFhUixDQUFiO0FBQ0FMLE1BQUFBLEtBQUssQ0FBQyxDQUFELENBQUwsQ0FBU2MsQ0FBVCxHQUFhTCxDQUFiO0FBQ0FULE1BQUFBLEtBQUssQ0FBQyxDQUFELENBQUwsQ0FBU2EsQ0FBVCxHQUFhRixDQUFiO0FBQ0FYLE1BQUFBLEtBQUssQ0FBQyxDQUFELENBQUwsQ0FBU2MsQ0FBVCxHQUFhUCxDQUFiO0FBQ0gsS0FURCxNQVVLO0FBQ0QsVUFBSUYsRUFBQyxHQUFHSCxJQUFJLENBQUNJLENBQWI7QUFDQSxVQUFJQyxFQUFDLEdBQUdMLElBQUksQ0FBQ00sS0FBYjtBQUNBLFVBQUlDLEVBQUMsR0FBR1AsSUFBSSxDQUFDUSxDQUFiO0FBQ0EsVUFBSUMsRUFBQyxHQUFHVCxJQUFJLENBQUNVLE1BQWI7QUFDQVosTUFBQUEsS0FBSyxDQUFDLENBQUQsQ0FBTCxDQUFTYSxDQUFULEdBQWFSLEVBQWI7QUFDQUwsTUFBQUEsS0FBSyxDQUFDLENBQUQsQ0FBTCxDQUFTYyxDQUFULEdBQWFMLEVBQWI7QUFDQVQsTUFBQUEsS0FBSyxDQUFDLENBQUQsQ0FBTCxDQUFTYSxDQUFULEdBQWFOLEVBQWI7QUFDQVAsTUFBQUEsS0FBSyxDQUFDLENBQUQsQ0FBTCxDQUFTYyxDQUFULEdBQWFILEVBQWI7QUFDSDtBQUNKOztTQUVEZixjQUFBLHFCQUFhSCxNQUFiLEVBQXFCO0FBQ2pCLFFBQUlNLFVBQVUsR0FBRyxLQUFLVixXQUF0QjtBQUFBLFFBQ0kwQixJQUFJLEdBQUd0QixNQUFNLENBQUNzQixJQURsQjtBQUFBLFFBRUlmLEtBQUssR0FBR0QsVUFBVSxDQUFDRSxRQUZ2QjtBQUFBLFFBR0lKLEtBQUssR0FBR0osTUFBTSxDQUFDSyxXQUhuQjtBQUFBLFFBSUlrQixFQUFFLEdBQUdELElBQUksQ0FBQ1AsS0FKZDtBQUFBLFFBSXFCUyxFQUFFLEdBQUdGLElBQUksQ0FBQ0gsTUFKL0I7QUFBQSxRQUtJTSxJQUFJLEdBQUdILElBQUksQ0FBQ0ksT0FBTCxHQUFlSCxFQUwxQjtBQUFBLFFBSzhCSSxJQUFJLEdBQUdMLElBQUksQ0FBQ00sT0FBTCxHQUFlSixFQUxwRDtBQUFBLFFBTUlaLENBTko7QUFBQSxRQU1PSSxDQU5QO0FBQUEsUUFNVUYsQ0FOVjtBQUFBLFFBTWFJLENBTmI7O0FBT0EsUUFBSWxCLE1BQU0sQ0FBQzZCLElBQVgsRUFBaUI7QUFDYmpCLE1BQUFBLENBQUMsR0FBRyxDQUFDYSxJQUFMO0FBQ0FULE1BQUFBLENBQUMsR0FBRyxDQUFDVyxJQUFMO0FBQ0FiLE1BQUFBLENBQUMsR0FBR1MsRUFBSjtBQUNBTCxNQUFBQSxDQUFDLEdBQUdNLEVBQUo7QUFDSCxLQUxELE1BTUs7QUFDRCxVQUFJTSxFQUFFLEdBQUcxQixLQUFLLENBQUMyQixhQUFOLENBQW9CaEIsS0FBN0I7QUFBQSxVQUFvQ2lCLEVBQUUsR0FBRzVCLEtBQUssQ0FBQzJCLGFBQU4sQ0FBb0JaLE1BQTdEO0FBQUEsVUFDSWMsRUFBRSxHQUFHN0IsS0FBSyxDQUFDTSxLQUFOLENBQVlLLEtBRHJCO0FBQUEsVUFDNEJtQixFQUFFLEdBQUc5QixLQUFLLENBQUNNLEtBQU4sQ0FBWVMsTUFEN0M7QUFBQSxVQUVJZ0IsTUFBTSxHQUFHL0IsS0FBSyxDQUFDZ0MsT0FGbkI7QUFBQSxVQUdJQyxNQUFNLEdBQUdkLEVBQUUsR0FBR08sRUFIbEI7QUFBQSxVQUdzQlEsTUFBTSxHQUFHZCxFQUFFLEdBQUdRLEVBSHBDO0FBSUEsVUFBSU8sUUFBUSxHQUFHSixNQUFNLENBQUN0QixDQUFQLEdBQVcsQ0FBQ2lCLEVBQUUsR0FBR0csRUFBTixJQUFZLENBQXRDO0FBQ0EsVUFBSU8sVUFBVSxHQUFHTCxNQUFNLENBQUNsQixDQUFQLEdBQVcsQ0FBQ2UsRUFBRSxHQUFHRSxFQUFOLElBQVksQ0FBeEM7QUFDQXRCLE1BQUFBLENBQUMsR0FBRzJCLFFBQVEsR0FBR0YsTUFBWCxHQUFvQlosSUFBeEI7QUFDQVQsTUFBQUEsQ0FBQyxHQUFHd0IsVUFBVSxHQUFHRixNQUFiLEdBQXNCWCxJQUExQjtBQUNBYixNQUFBQSxDQUFDLEdBQUdTLEVBQUo7QUFDQUwsTUFBQUEsQ0FBQyxHQUFHTSxFQUFKO0FBQ0g7O0FBRUQsUUFBSXBCLEtBQUssQ0FBQ08sUUFBVixFQUFvQjtBQUNoQkosTUFBQUEsS0FBSyxDQUFDLENBQUQsQ0FBTCxDQUFTVSxDQUFULEdBQWFMLENBQWI7QUFDQUwsTUFBQUEsS0FBSyxDQUFDLENBQUQsQ0FBTCxDQUFTTSxDQUFULEdBQWFHLENBQWI7QUFDQVQsTUFBQUEsS0FBSyxDQUFDLENBQUQsQ0FBTCxDQUFTVSxDQUFULEdBQWFILENBQWI7QUFDQVAsTUFBQUEsS0FBSyxDQUFDLENBQUQsQ0FBTCxDQUFTTSxDQUFULEdBQWFLLENBQWI7QUFDSCxLQUxELE1BS087QUFDSFgsTUFBQUEsS0FBSyxDQUFDLENBQUQsQ0FBTCxDQUFTTSxDQUFULEdBQWFELENBQWI7QUFDQUwsTUFBQUEsS0FBSyxDQUFDLENBQUQsQ0FBTCxDQUFTVSxDQUFULEdBQWFELENBQWI7QUFDQVQsTUFBQUEsS0FBSyxDQUFDLENBQUQsQ0FBTCxDQUFTTSxDQUFULEdBQWFDLENBQWI7QUFDQVAsTUFBQUEsS0FBSyxDQUFDLENBQUQsQ0FBTCxDQUFTVSxDQUFULEdBQWFDLENBQWI7QUFDSDs7QUFFRFosSUFBQUEsVUFBVSxDQUFDbUMsU0FBWCxHQUF1QixLQUF2QjtBQUNIOztTQUVEQyxPQUFBLGNBQU1DLEdBQU4sRUFBV0MsSUFBWCxFQUFpQjtBQUNiLFFBQUl0QixJQUFJLEdBQUdzQixJQUFJLENBQUN0QixJQUFoQjtBQUNBLFFBQUlsQixLQUFLLEdBQUd3QyxJQUFJLENBQUNDLFlBQWpCLENBRmEsQ0FHYjs7QUFDQSxRQUFJQyxNQUFNLEdBQUd4QixJQUFJLENBQUN5QixZQUFsQjtBQUNBLFFBQUlDLE9BQU8sR0FBR0YsTUFBTSxDQUFDRyxDQUFyQjtBQUNBLFFBQUlDLENBQUMsR0FBR0YsT0FBTyxDQUFDLENBQUQsQ0FBZjtBQUFBLFFBQW9CaEMsQ0FBQyxHQUFHZ0MsT0FBTyxDQUFDLENBQUQsQ0FBL0I7QUFBQSxRQUFvQ0csQ0FBQyxHQUFHSCxPQUFPLENBQUMsQ0FBRCxDQUEvQztBQUFBLFFBQW9ESSxDQUFDLEdBQUdKLE9BQU8sQ0FBQyxDQUFELENBQS9EO0FBQUEsUUFDSUssRUFBRSxHQUFHTCxPQUFPLENBQUMsRUFBRCxDQURoQjtBQUFBLFFBQ3NCTSxFQUFFLEdBQUdOLE9BQU8sQ0FBQyxFQUFELENBRGxDO0FBRUFMLElBQUFBLEdBQUcsQ0FBQ1ksU0FBSixDQUFjTCxDQUFkLEVBQWlCbEMsQ0FBakIsRUFBb0JtQyxDQUFwQixFQUF1QkMsQ0FBdkIsRUFBMEJDLEVBQTFCLEVBQThCQyxFQUE5QjtBQUNBWCxJQUFBQSxHQUFHLENBQUNhLEtBQUosQ0FBVSxDQUFWLEVBQWEsQ0FBQyxDQUFkOztBQUNBLFFBQUlwRCxLQUFLLENBQUNPLFFBQVYsRUFBb0I7QUFDaEJnQyxNQUFBQSxHQUFHLENBQUNjLE1BQUosQ0FBVyxDQUFFQyxJQUFJLENBQUNDLEVBQVAsR0FBWSxDQUF2QjtBQUNILEtBWlksQ0FjYjtBQUVBOzs7QUFDQW5FLElBQUFBLEtBQUssQ0FBQ29FLE9BQU4sQ0FBY0MsY0FBZCxDQUE2QmxCLEdBQTdCLEVBQWtDckIsSUFBSSxDQUFDd0MsT0FBTCxHQUFlLEdBQWpEO0FBRUEsUUFBSUMsR0FBRyxHQUFHM0QsS0FBSyxDQUFDNEQsUUFBaEI7QUFBQSxRQUNJekQsS0FBSyxHQUFHLEtBQUtYLFdBQUwsQ0FBaUJZLFFBRDdCO0FBR0EsUUFBSXlELEtBQUssR0FBR3pFLEtBQUssQ0FBQzBFLGlCQUFOLENBQXdCSCxHQUF4QixFQUE2QnpDLElBQUksQ0FBQzZDLE1BQWxDLENBQVo7QUFFQSxRQUFJdEQsQ0FBQyxHQUFHTixLQUFLLENBQUMsQ0FBRCxDQUFMLENBQVNNLENBQWpCO0FBQ0EsUUFBSUksQ0FBQyxHQUFHVixLQUFLLENBQUMsQ0FBRCxDQUFMLENBQVNVLENBQWpCO0FBQ0EsUUFBSW1ELENBQUMsR0FBRzdELEtBQUssQ0FBQyxDQUFELENBQUwsQ0FBU00sQ0FBakI7QUFDQSxRQUFJd0QsQ0FBQyxHQUFHOUQsS0FBSyxDQUFDLENBQUQsQ0FBTCxDQUFTVSxDQUFqQjtBQUNBQSxJQUFBQSxDQUFDLEdBQUcsQ0FBRUEsQ0FBRixHQUFNb0QsQ0FBVjtBQUVBLFFBQUlDLEVBQUUsR0FBRy9ELEtBQUssQ0FBQyxDQUFELENBQUwsQ0FBU2EsQ0FBbEI7QUFDQSxRQUFJbUQsRUFBRSxHQUFHaEUsS0FBSyxDQUFDLENBQUQsQ0FBTCxDQUFTYyxDQUFsQjtBQUNBLFFBQUltRCxFQUFFLEdBQUdqRSxLQUFLLENBQUMsQ0FBRCxDQUFMLENBQVNhLENBQWxCO0FBQ0EsUUFBSXFELEVBQUUsR0FBR2xFLEtBQUssQ0FBQyxDQUFELENBQUwsQ0FBU2MsQ0FBbEI7QUFFQXNCLElBQUFBLEdBQUcsQ0FBQytCLFNBQUosQ0FBY1QsS0FBZCxFQUNJSyxFQURKLEVBQ1FDLEVBRFIsRUFDWUMsRUFEWixFQUNnQkMsRUFEaEIsRUFFSTVELENBRkosRUFFT0ksQ0FGUCxFQUVVbUQsQ0FGVixFQUVhQyxDQUZiO0FBR0EsV0FBTyxDQUFQO0FBQ0g7OztFQTNIMkNNIiwic291cmNlc0NvbnRlbnQiOlsiLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKipcclxuIENvcHlyaWdodCAoYykgMjAxOCBYaWFtZW4gWWFqaSBTb2Z0d2FyZSBDby4sIEx0ZC5cclxuXHJcbiBodHRwczovL3d3dy5jb2Nvcy5jb20vXHJcblxyXG4gUGVybWlzc2lvbiBpcyBoZXJlYnkgZ3JhbnRlZCwgZnJlZSBvZiBjaGFyZ2UsIHRvIGFueSBwZXJzb24gb2J0YWluaW5nIGEgY29weVxyXG4gb2YgdGhpcyBzb2Z0d2FyZSBhbmQgYXNzb2NpYXRlZCBlbmdpbmUgc291cmNlIGNvZGUgKHRoZSBcIlNvZnR3YXJlXCIpLCBhIGxpbWl0ZWQsXHJcbiB3b3JsZHdpZGUsIHJveWFsdHktZnJlZSwgbm9uLWFzc2lnbmFibGUsIHJldm9jYWJsZSBhbmQgbm9uLWV4Y2x1c2l2ZSBsaWNlbnNlXHJcbiB0byB1c2UgQ29jb3MgQ3JlYXRvciBzb2xlbHkgdG8gZGV2ZWxvcCBnYW1lcyBvbiB5b3VyIHRhcmdldCBwbGF0Zm9ybXMuIFlvdSBzaGFsbFxyXG4gbm90IHVzZSBDb2NvcyBDcmVhdG9yIHNvZnR3YXJlIGZvciBkZXZlbG9waW5nIG90aGVyIHNvZnR3YXJlIG9yIHRvb2xzIHRoYXQnc1xyXG4gdXNlZCBmb3IgZGV2ZWxvcGluZyBnYW1lcy4gWW91IGFyZSBub3QgZ3JhbnRlZCB0byBwdWJsaXNoLCBkaXN0cmlidXRlLFxyXG4gc3VibGljZW5zZSwgYW5kL29yIHNlbGwgY29waWVzIG9mIENvY29zIENyZWF0b3IuXHJcblxyXG4gVGhlIHNvZnR3YXJlIG9yIHRvb2xzIGluIHRoaXMgTGljZW5zZSBBZ3JlZW1lbnQgYXJlIGxpY2Vuc2VkLCBub3Qgc29sZC5cclxuIFhpYW1lbiBZYWppIFNvZnR3YXJlIENvLiwgTHRkLiByZXNlcnZlcyBhbGwgcmlnaHRzIG5vdCBleHByZXNzbHkgZ3JhbnRlZCB0byB5b3UuXHJcblxyXG4gVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEIFwiQVMgSVNcIiwgV0lUSE9VVCBXQVJSQU5UWSBPRiBBTlkgS0lORCwgRVhQUkVTUyBPUlxyXG4gSU1QTElFRCwgSU5DTFVESU5HIEJVVCBOT1QgTElNSVRFRCBUTyBUSEUgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFksXHJcbiBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBTkQgTk9OSU5GUklOR0VNRU5ULiBJTiBOTyBFVkVOVCBTSEFMTCBUSEVcclxuIEFVVEhPUlMgT1IgQ09QWVJJR0hUIEhPTERFUlMgQkUgTElBQkxFIEZPUiBBTlkgQ0xBSU0sIERBTUFHRVMgT1IgT1RIRVJcclxuIExJQUJJTElUWSwgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIFRPUlQgT1IgT1RIRVJXSVNFLCBBUklTSU5HIEZST00sXHJcbiBPVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRSBTT0ZUV0FSRSBPUiBUSEUgVVNFIE9SIE9USEVSIERFQUxJTkdTIElOXHJcbiBUSEUgU09GVFdBUkUuXHJcbiAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqL1xyXG5cclxuaW1wb3J0IEFzc2VtYmxlciBmcm9tICcuLi8uLi8uLi9hc3NlbWJsZXInO1xyXG5pbXBvcnQgUmVuZGVyRGF0YSBmcm9tICcuLi9yZW5kZXItZGF0YSc7XHJcbmNvbnN0IHV0aWxzID0gcmVxdWlyZSgnLi4vdXRpbHMnKTtcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIENhbnZhc1NpbXBsZVNwcml0ZSBleHRlbmRzIEFzc2VtYmxlciB7XHJcbiAgICBpbml0ICgpIHtcclxuICAgICAgICB0aGlzLl9yZW5kZXJEYXRhID0gbmV3IFJlbmRlckRhdGEoKTtcclxuICAgICAgICB0aGlzLl9yZW5kZXJEYXRhLmRhdGFMZW5ndGggPSAyO1xyXG4gICAgfVxyXG5cclxuICAgIHVwZGF0ZVJlbmRlckRhdGEgKHNwcml0ZSkge1xyXG4gICAgICAgIGlmIChzcHJpdGUuX3ZlcnRzRGlydHkpIHtcclxuICAgICAgICAgICAgdGhpcy51cGRhdGVVVnMoc3ByaXRlKTtcclxuICAgICAgICAgICAgdGhpcy51cGRhdGVWZXJ0cyhzcHJpdGUpO1xyXG4gICAgICAgICAgICBzcHJpdGUuX3ZlcnRzRGlydHkgPSBmYWxzZTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgdXBkYXRlVVZzIChzcHJpdGUpIHtcclxuICAgICAgICBsZXQgZnJhbWUgPSBzcHJpdGUuc3ByaXRlRnJhbWU7XHJcbiAgICAgICAgbGV0IHJlbmRlckRhdGEgPSB0aGlzLl9yZW5kZXJEYXRhO1xyXG4gICAgICAgIGxldCB2ZXJ0cyA9IHJlbmRlckRhdGEudmVydGljZXM7XHJcbiAgICAgICAgbGV0IHJlY3QgPSBmcmFtZS5fcmVjdDtcclxuICAgICAgICBcclxuICAgICAgICBpZiAoZnJhbWUuX3JvdGF0ZWQpIHtcclxuICAgICAgICAgICAgbGV0IGwgPSByZWN0Lng7XHJcbiAgICAgICAgICAgIGxldCByID0gcmVjdC53aWR0aDtcclxuICAgICAgICAgICAgbGV0IGIgPSByZWN0Lnk7XHJcbiAgICAgICAgICAgIGxldCB0ID0gcmVjdC5oZWlnaHQ7XHJcbiAgICAgICAgICAgIHZlcnRzWzBdLnUgPSBsO1xyXG4gICAgICAgICAgICB2ZXJ0c1swXS52ID0gYjtcclxuICAgICAgICAgICAgdmVydHNbMV0udSA9IHQ7XHJcbiAgICAgICAgICAgIHZlcnRzWzFdLnYgPSByO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgbGV0IGwgPSByZWN0Lng7XHJcbiAgICAgICAgICAgIGxldCByID0gcmVjdC53aWR0aDtcclxuICAgICAgICAgICAgbGV0IGIgPSByZWN0Lnk7XHJcbiAgICAgICAgICAgIGxldCB0ID0gcmVjdC5oZWlnaHQ7XHJcbiAgICAgICAgICAgIHZlcnRzWzBdLnUgPSBsO1xyXG4gICAgICAgICAgICB2ZXJ0c1swXS52ID0gYjtcclxuICAgICAgICAgICAgdmVydHNbMV0udSA9IHI7XHJcbiAgICAgICAgICAgIHZlcnRzWzFdLnYgPSB0O1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICB1cGRhdGVWZXJ0cyAoc3ByaXRlKSB7XHJcbiAgICAgICAgbGV0IHJlbmRlckRhdGEgPSB0aGlzLl9yZW5kZXJEYXRhLFxyXG4gICAgICAgICAgICBub2RlID0gc3ByaXRlLm5vZGUsXHJcbiAgICAgICAgICAgIHZlcnRzID0gcmVuZGVyRGF0YS52ZXJ0aWNlcyxcclxuICAgICAgICAgICAgZnJhbWUgPSBzcHJpdGUuc3ByaXRlRnJhbWUsXHJcbiAgICAgICAgICAgIGN3ID0gbm9kZS53aWR0aCwgY2ggPSBub2RlLmhlaWdodCxcclxuICAgICAgICAgICAgYXBweCA9IG5vZGUuYW5jaG9yWCAqIGN3LCBhcHB5ID0gbm9kZS5hbmNob3JZICogY2gsXHJcbiAgICAgICAgICAgIGwsIGIsIHIsIHQ7XHJcbiAgICAgICAgaWYgKHNwcml0ZS50cmltKSB7XHJcbiAgICAgICAgICAgIGwgPSAtYXBweDtcclxuICAgICAgICAgICAgYiA9IC1hcHB5O1xyXG4gICAgICAgICAgICByID0gY3c7XHJcbiAgICAgICAgICAgIHQgPSBjaDtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIGxldCBvdyA9IGZyYW1lLl9vcmlnaW5hbFNpemUud2lkdGgsIG9oID0gZnJhbWUuX29yaWdpbmFsU2l6ZS5oZWlnaHQsXHJcbiAgICAgICAgICAgICAgICBydyA9IGZyYW1lLl9yZWN0LndpZHRoLCByaCA9IGZyYW1lLl9yZWN0LmhlaWdodCxcclxuICAgICAgICAgICAgICAgIG9mZnNldCA9IGZyYW1lLl9vZmZzZXQsXHJcbiAgICAgICAgICAgICAgICBzY2FsZVggPSBjdyAvIG93LCBzY2FsZVkgPSBjaCAvIG9oO1xyXG4gICAgICAgICAgICBsZXQgdHJpbUxlZnQgPSBvZmZzZXQueCArIChvdyAtIHJ3KSAvIDI7XHJcbiAgICAgICAgICAgIGxldCB0cmltQm90dG9tID0gb2Zmc2V0LnkgKyAob2ggLSByaCkgLyAyO1xyXG4gICAgICAgICAgICBsID0gdHJpbUxlZnQgKiBzY2FsZVggLSBhcHB4O1xyXG4gICAgICAgICAgICBiID0gdHJpbUJvdHRvbSAqIHNjYWxlWSAtIGFwcHk7XHJcbiAgICAgICAgICAgIHIgPSBjdztcclxuICAgICAgICAgICAgdCA9IGNoO1xyXG4gICAgICAgIH1cclxuICAgICAgICBcclxuICAgICAgICBpZiAoZnJhbWUuX3JvdGF0ZWQpIHtcclxuICAgICAgICAgICAgdmVydHNbMF0ueSA9IGw7XHJcbiAgICAgICAgICAgIHZlcnRzWzBdLnggPSBiO1xyXG4gICAgICAgICAgICB2ZXJ0c1sxXS55ID0gcjtcclxuICAgICAgICAgICAgdmVydHNbMV0ueCA9IHQ7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdmVydHNbMF0ueCA9IGw7XHJcbiAgICAgICAgICAgIHZlcnRzWzBdLnkgPSBiO1xyXG4gICAgICAgICAgICB2ZXJ0c1sxXS54ID0gcjtcclxuICAgICAgICAgICAgdmVydHNbMV0ueSA9IHQ7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIFxyXG4gICAgICAgIHJlbmRlckRhdGEudmVydERpcnR5ID0gZmFsc2U7XHJcbiAgICB9XHJcblxyXG4gICAgZHJhdyAoY3R4LCBjb21wKSB7XHJcbiAgICAgICAgbGV0IG5vZGUgPSBjb21wLm5vZGU7XHJcbiAgICAgICAgbGV0IGZyYW1lID0gY29tcC5fc3ByaXRlRnJhbWU7XHJcbiAgICAgICAgLy8gVHJhbnNmb3JtXHJcbiAgICAgICAgbGV0IG1hdHJpeCA9IG5vZGUuX3dvcmxkTWF0cml4O1xyXG4gICAgICAgIGxldCBtYXRyaXhtID0gbWF0cml4Lm07XHJcbiAgICAgICAgbGV0IGEgPSBtYXRyaXhtWzBdLCBiID0gbWF0cml4bVsxXSwgYyA9IG1hdHJpeG1bNF0sIGQgPSBtYXRyaXhtWzVdLFxyXG4gICAgICAgICAgICB0eCA9IG1hdHJpeG1bMTJdLCB0eSA9IG1hdHJpeG1bMTNdO1xyXG4gICAgICAgIGN0eC50cmFuc2Zvcm0oYSwgYiwgYywgZCwgdHgsIHR5KTtcclxuICAgICAgICBjdHguc2NhbGUoMSwgLTEpO1xyXG4gICAgICAgIGlmIChmcmFtZS5fcm90YXRlZCkge1xyXG4gICAgICAgICAgICBjdHgucm90YXRlKC0gTWF0aC5QSSAvIDIpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gVE9ETzogaGFuZGxlIGJsZW5kIGZ1bmN0aW9uXHJcblxyXG4gICAgICAgIC8vIG9wYWNpdHlcclxuICAgICAgICB1dGlscy5jb250ZXh0LnNldEdsb2JhbEFscGhhKGN0eCwgbm9kZS5vcGFjaXR5IC8gMjU1KTtcclxuXHJcbiAgICAgICAgbGV0IHRleCA9IGZyYW1lLl90ZXh0dXJlLFxyXG4gICAgICAgICAgICB2ZXJ0cyA9IHRoaXMuX3JlbmRlckRhdGEudmVydGljZXM7XHJcblxyXG4gICAgICAgIGxldCBpbWFnZSA9IHV0aWxzLmdldENvbG9yaXplZEltYWdlKHRleCwgbm9kZS5fY29sb3IpO1xyXG5cclxuICAgICAgICBsZXQgeCA9IHZlcnRzWzBdLng7XHJcbiAgICAgICAgbGV0IHkgPSB2ZXJ0c1swXS55O1xyXG4gICAgICAgIGxldCB3ID0gdmVydHNbMV0ueDtcclxuICAgICAgICBsZXQgaCA9IHZlcnRzWzFdLnk7XHJcbiAgICAgICAgeSA9IC0geSAtIGg7XHJcblxyXG4gICAgICAgIGxldCBzeCA9IHZlcnRzWzBdLnU7XHJcbiAgICAgICAgbGV0IHN5ID0gdmVydHNbMF0udjtcclxuICAgICAgICBsZXQgc3cgPSB2ZXJ0c1sxXS51O1xyXG4gICAgICAgIGxldCBzaCA9IHZlcnRzWzFdLnY7XHJcblxyXG4gICAgICAgIGN0eC5kcmF3SW1hZ2UoaW1hZ2UsXHJcbiAgICAgICAgICAgIHN4LCBzeSwgc3csIHNoLFxyXG4gICAgICAgICAgICB4LCB5LCB3LCBoKTtcclxuICAgICAgICByZXR1cm4gMTtcclxuICAgIH1cclxufVxyXG5cclxuIl0sInNvdXJjZVJvb3QiOiIvIn0=