
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'engine-dev/cocos2d/core/asset-manager/urlTransformer.js';
                    var __require = nodeEnv ? function (request) {
                        return require(request);
                    } : function (request) {
                        return __quick_compile_engine__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_engine__.registerModule(__filename, module);}"use strict";

/****************************************************************************
 Copyright (c) 2019 Xiamen Yaji Software Co., Ltd.

 https://www.cocos.com/

 Permission is hereby granted, free of charge, to any person obtaining a copy
 of this software and associated engine source code (the "Software"), a limited,
  worldwide, royalty-free, non-assignable, revocable and non-exclusive license
 to use Cocos Creator solely to develop games on your target platforms. You shall
  not use Cocos Creator software for developing other software or tools that's
  used for developing games. You are not granted to publish, distribute,
  sublicense, and/or sell copies of Cocos Creator.

 The software or tools in this License Agreement are licensed, not sold.
 Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.

 THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 THE SOFTWARE.
 ****************************************************************************/
var _require = require('./helper'),
    decodeUuid = _require.decodeUuid;

var RequestItem = require('./request-item');

var _require2 = require('./shared'),
    RequestType = _require2.RequestType,
    bundles = _require2.bundles;

function parse(task) {
  var input = task.input,
      options = task.options;
  input = Array.isArray(input) ? input : [input];
  task.output = [];

  for (var i = 0; i < input.length; i++) {
    var item = input[i];
    var out = RequestItem.create();

    if (typeof item === 'string') {
      item = Object.create(null);
      item[options.__requestType__ || RequestType.UUID] = input[i];
    }

    if (typeof item === 'object') {
      // local options will overlap glabal options
      cc.js.addon(item, options);

      if (item.preset) {
        cc.js.addon(item, cc.assetManager.presets[item.preset]);
      }

      for (var key in item) {
        switch (key) {
          case RequestType.UUID:
            var uuid = out.uuid = decodeUuid(item.uuid);

            if (bundles.has(item.bundle)) {
              var config = bundles.get(item.bundle)._config;

              var info = config.getAssetInfo(uuid);

              if (info && info.redirect) {
                if (!bundles.has(info.redirect)) throw new Error("Please load bundle " + info.redirect + " first");
                config = bundles.get(info.redirect)._config;
                info = config.getAssetInfo(uuid);
              }

              out.config = config;
              out.info = info;
            }

            out.ext = item.ext || '.json';
            break;

          case '__requestType__':
          case 'ext':
          case 'bundle':
          case 'preset':
          case 'type':
            break;

          case RequestType.DIR:
            if (bundles.has(item.bundle)) {
              var infos = [];

              bundles.get(item.bundle)._config.getDirWithPath(item.dir, item.type, infos);

              for (var _i = 0, l = infos.length; _i < l; _i++) {
                var info = infos[_i];
                input.push({
                  uuid: info.uuid,
                  __isNative__: false,
                  ext: '.json',
                  bundle: item.bundle
                });
              }
            }

            out.recycle();
            out = null;
            break;

          case RequestType.PATH:
            if (bundles.has(item.bundle)) {
              var config = bundles.get(item.bundle)._config;

              var info = config.getInfoWithPath(item.path, item.type);

              if (info && info.redirect) {
                if (!bundles.has(info.redirect)) throw new Error("you need to load bundle " + info.redirect + " first");
                config = bundles.get(info.redirect)._config;
                info = config.getAssetInfo(info.uuid);
              }

              if (!info) {
                out.recycle();
                throw new Error("Bundle " + item.bundle + " doesn't contain " + item.path);
              }

              out.config = config;
              out.uuid = info.uuid;
              out.info = info;
            }

            out.ext = item.ext || '.json';
            break;

          case RequestType.SCENE:
            if (bundles.has(item.bundle)) {
              var config = bundles.get(item.bundle)._config;

              var info = config.getSceneInfo(item.scene);

              if (info && info.redirect) {
                if (!bundles.has(info.redirect)) throw new Error("you need to load bundle " + info.redirect + " first");
                config = bundles.get(info.redirect)._config;
                info = config.getAssetInfo(info.uuid);
              }

              if (!info) {
                out.recycle();
                throw new Error("Bundle " + config.name + " doesn't contain scene " + item.scene);
              }

              out.config = config;
              out.uuid = info.uuid;
              out.info = info;
            }

            break;

          case '__isNative__':
            out.isNative = item.__isNative__;
            break;

          case RequestType.URL:
            out.url = item.url;
            out.uuid = item.uuid || item.url;
            out.ext = item.ext || cc.path.extname(item.url);
            out.isNative = item.__isNative__ !== undefined ? item.__isNative__ : true;
            break;

          default:
            out.options[key] = item[key];
        }

        if (!out) break;
      }
    }

    if (!out) continue;
    task.output.push(out);
    if (!out.uuid && !out.url) throw new Error('Can not parse this input:' + JSON.stringify(item));
  }

  return null;
}

function combine(task) {
  var input = task.output = task.input;

  for (var i = 0; i < input.length; i++) {
    var item = input[i];
    if (item.url) continue;
    var url = '',
        base = '';
    var config = item.config;

    if (item.isNative) {
      base = config && config.nativeBase ? config.base + config.nativeBase : cc.assetManager.generalNativeBase;
    } else {
      base = config && config.importBase ? config.base + config.importBase : cc.assetManager.generalImportBase;
    }

    var uuid = item.uuid;
    var ver = '';

    if (item.info) {
      if (item.isNative) {
        ver = item.info.nativeVer ? '.' + item.info.nativeVer : '';
      } else {
        ver = item.info.ver ? '.' + item.info.ver : '';
      }
    } // ugly hack, WeChat does not support loading font likes 'myfont.dw213.ttf'. So append hash to directory


    if (item.ext === '.ttf') {
      url = base + "/" + uuid.slice(0, 2) + "/" + uuid + ver + "/" + item.options.__nativeName__;
    } else {
      url = base + "/" + uuid.slice(0, 2) + "/" + uuid + ver + item.ext;
    }

    item.url = url;
  }

  return null;
}

module.exports = {
  parse: parse,
  combine: combine
};
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_engine__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImVuZ2luZS1kZXZcXGNvY29zMmRcXGNvcmVcXGFzc2V0LW1hbmFnZXJcXHVybFRyYW5zZm9ybWVyLmpzIl0sIm5hbWVzIjpbInJlcXVpcmUiLCJkZWNvZGVVdWlkIiwiUmVxdWVzdEl0ZW0iLCJSZXF1ZXN0VHlwZSIsImJ1bmRsZXMiLCJwYXJzZSIsInRhc2siLCJpbnB1dCIsIm9wdGlvbnMiLCJBcnJheSIsImlzQXJyYXkiLCJvdXRwdXQiLCJpIiwibGVuZ3RoIiwiaXRlbSIsIm91dCIsImNyZWF0ZSIsIk9iamVjdCIsIl9fcmVxdWVzdFR5cGVfXyIsIlVVSUQiLCJjYyIsImpzIiwiYWRkb24iLCJwcmVzZXQiLCJhc3NldE1hbmFnZXIiLCJwcmVzZXRzIiwia2V5IiwidXVpZCIsImhhcyIsImJ1bmRsZSIsImNvbmZpZyIsImdldCIsIl9jb25maWciLCJpbmZvIiwiZ2V0QXNzZXRJbmZvIiwicmVkaXJlY3QiLCJFcnJvciIsImV4dCIsIkRJUiIsImluZm9zIiwiZ2V0RGlyV2l0aFBhdGgiLCJkaXIiLCJ0eXBlIiwibCIsInB1c2giLCJfX2lzTmF0aXZlX18iLCJyZWN5Y2xlIiwiUEFUSCIsImdldEluZm9XaXRoUGF0aCIsInBhdGgiLCJTQ0VORSIsImdldFNjZW5lSW5mbyIsInNjZW5lIiwibmFtZSIsImlzTmF0aXZlIiwiVVJMIiwidXJsIiwiZXh0bmFtZSIsInVuZGVmaW5lZCIsIkpTT04iLCJzdHJpbmdpZnkiLCJjb21iaW5lIiwiYmFzZSIsIm5hdGl2ZUJhc2UiLCJnZW5lcmFsTmF0aXZlQmFzZSIsImltcG9ydEJhc2UiLCJnZW5lcmFsSW1wb3J0QmFzZSIsInZlciIsIm5hdGl2ZVZlciIsInNsaWNlIiwiX19uYXRpdmVOYW1lX18iLCJtb2R1bGUiLCJleHBvcnRzIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7O0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FB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LEdBQWlCLE1BQU1yRCxJQUFJLENBQUNtQixJQUFMLENBQVVrQyxHQUFqQyxHQUF3QyxFQUE5QztBQUNIO0FBQ0osS0F2QmtDLENBeUJuQzs7O0FBQ0EsUUFBSXJELElBQUksQ0FBQ3VCLEdBQUwsS0FBYSxNQUFqQixFQUF5QjtBQUNyQm1CLE1BQUFBLEdBQUcsR0FBTU0sSUFBTixTQUFjbkMsSUFBSSxDQUFDMEMsS0FBTCxDQUFXLENBQVgsRUFBYyxDQUFkLENBQWQsU0FBa0MxQyxJQUFsQyxHQUF5Q3dDLEdBQXpDLFNBQWdEckQsSUFBSSxDQUFDTixPQUFMLENBQWE4RCxjQUFoRTtBQUNILEtBRkQsTUFHSztBQUNEZCxNQUFBQSxHQUFHLEdBQU1NLElBQU4sU0FBY25DLElBQUksQ0FBQzBDLEtBQUwsQ0FBVyxDQUFYLEVBQWMsQ0FBZCxDQUFkLFNBQWtDMUMsSUFBbEMsR0FBeUN3QyxHQUF6QyxHQUErQ3JELElBQUksQ0FBQ3VCLEdBQXZEO0FBQ0g7O0FBRUR2QixJQUFBQSxJQUFJLENBQUMwQyxHQUFMLEdBQVdBLEdBQVg7QUFDSDs7QUFDRCxTQUFPLElBQVA7QUFDSDs7QUFFRGUsTUFBTSxDQUFDQyxPQUFQLEdBQWlCO0FBQUVuRSxFQUFBQSxLQUFLLEVBQUxBLEtBQUY7QUFBU3dELEVBQUFBLE9BQU8sRUFBUEE7QUFBVCxDQUFqQiIsInNvdXJjZXNDb250ZW50IjpbIi8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqXHJcbiBDb3B5cmlnaHQgKGMpIDIwMTkgWGlhbWVuIFlhamkgU29mdHdhcmUgQ28uLCBMdGQuXHJcblxyXG4gaHR0cHM6Ly93d3cuY29jb3MuY29tL1xyXG5cclxuIFBlcm1pc3Npb24gaXMgaGVyZWJ5IGdyYW50ZWQsIGZyZWUgb2YgY2hhcmdlLCB0byBhbnkgcGVyc29uIG9idGFpbmluZyBhIGNvcHlcclxuIG9mIHRoaXMgc29mdHdhcmUgYW5kIGFzc29jaWF0ZWQgZW5naW5lIHNvdXJjZSBjb2RlICh0aGUgXCJTb2Z0d2FyZVwiKSwgYSBsaW1pdGVkLFxyXG4gIHdvcmxkd2lkZSwgcm95YWx0eS1mcmVlLCBub24tYXNzaWduYWJsZSwgcmV2b2NhYmxlIGFuZCBub24tZXhjbHVzaXZlIGxpY2Vuc2VcclxuIHRvIHVzZSBDb2NvcyBDcmVhdG9yIHNvbGVseSB0byBkZXZlbG9wIGdhbWVzIG9uIHlvdXIgdGFyZ2V0IHBsYXRmb3Jtcy4gWW91IHNoYWxsXHJcbiAgbm90IHVzZSBDb2NvcyBDcmVhdG9yIHNvZnR3YXJlIGZvciBkZXZlbG9waW5nIG90aGVyIHNvZnR3YXJlIG9yIHRvb2xzIHRoYXQnc1xyXG4gIHVzZWQgZm9yIGRldmVsb3BpbmcgZ2FtZXMuIFlvdSBhcmUgbm90IGdyYW50ZWQgdG8gcHVibGlzaCwgZGlzdHJpYnV0ZSxcclxuICBzdWJsaWNlbnNlLCBhbmQvb3Igc2VsbCBjb3BpZXMgb2YgQ29jb3MgQ3JlYXRvci5cclxuXHJcbiBUaGUgc29mdHdhcmUgb3IgdG9vbHMgaW4gdGhpcyBMaWNlbnNlIEFncmVlbWVudCBhcmUgbGljZW5zZWQsIG5vdCBzb2xkLlxyXG4gWGlhbWVuIFlhamkgU29mdHdhcmUgQ28uLCBMdGQuIHJlc2VydmVzIGFsbCByaWdodHMgbm90IGV4cHJlc3NseSBncmFudGVkIHRvIHlvdS5cclxuXHJcbiBUSEUgU09GVFdBUkUgSVMgUFJPVklERUQgXCJBUyBJU1wiLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELCBFWFBSRVNTIE9SXHJcbiBJTVBMSUVELCBJTkNMVURJTkcgQlVUIE5PVCBMSU1JVEVEIFRPIFRIRSBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSxcclxuIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFORCBOT05JTkZSSU5HRU1FTlQuIElOIE5PIEVWRU5UIFNIQUxMIFRIRVxyXG4gQVVUSE9SUyBPUiBDT1BZUklHSFQgSE9MREVSUyBCRSBMSUFCTEUgRk9SIEFOWSBDTEFJTSwgREFNQUdFUyBPUiBPVEhFUlxyXG4gTElBQklMSVRZLCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwgVE9SVCBPUiBPVEhFUldJU0UsIEFSSVNJTkcgRlJPTSxcclxuIE9VVCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFIFNPRlRXQVJFIE9SIFRIRSBVU0UgT1IgT1RIRVIgREVBTElOR1MgSU5cclxuIFRIRSBTT0ZUV0FSRS5cclxuICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovXHJcbmNvbnN0IHsgZGVjb2RlVXVpZCB9ID0gcmVxdWlyZSgnLi9oZWxwZXInKTtcclxuY29uc3QgUmVxdWVzdEl0ZW0gPSByZXF1aXJlKCcuL3JlcXVlc3QtaXRlbScpO1xyXG5jb25zdCB7IFJlcXVlc3RUeXBlLCBidW5kbGVzIH0gPSByZXF1aXJlKCcuL3NoYXJlZCcpO1xyXG5cclxuZnVuY3Rpb24gcGFyc2UgKHRhc2spIHtcclxuXHJcbiAgICB2YXIgaW5wdXQgPSB0YXNrLmlucHV0LCBvcHRpb25zID0gdGFzay5vcHRpb25zO1xyXG4gICAgaW5wdXQgPSBBcnJheS5pc0FycmF5KGlucHV0KSA/IGlucHV0IDogWyBpbnB1dCBdO1xyXG5cclxuICAgIHRhc2sub3V0cHV0ID0gW107XHJcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGlucHV0Lmxlbmd0aDsgaSArKyApIHtcclxuICAgICAgICB2YXIgaXRlbSA9IGlucHV0W2ldO1xyXG4gICAgICAgIHZhciBvdXQgPSBSZXF1ZXN0SXRlbS5jcmVhdGUoKTtcclxuICAgICAgICBpZiAodHlwZW9mIGl0ZW0gPT09ICdzdHJpbmcnKSB7XHJcbiAgICAgICAgICAgIGl0ZW0gPSBPYmplY3QuY3JlYXRlKG51bGwpO1xyXG4gICAgICAgICAgICBpdGVtW29wdGlvbnMuX19yZXF1ZXN0VHlwZV9fIHx8IFJlcXVlc3RUeXBlLlVVSURdID0gaW5wdXRbaV07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh0eXBlb2YgaXRlbSA9PT0gJ29iamVjdCcpIHtcclxuICAgICAgICAgICAgLy8gbG9jYWwgb3B0aW9ucyB3aWxsIG92ZXJsYXAgZ2xhYmFsIG9wdGlvbnNcclxuICAgICAgICAgICAgY2MuanMuYWRkb24oaXRlbSwgb3B0aW9ucyk7XHJcbiAgICAgICAgICAgIGlmIChpdGVtLnByZXNldCkge1xyXG4gICAgICAgICAgICAgICAgY2MuanMuYWRkb24oaXRlbSwgY2MuYXNzZXRNYW5hZ2VyLnByZXNldHNbaXRlbS5wcmVzZXRdKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBmb3IgKHZhciBrZXkgaW4gaXRlbSkge1xyXG4gICAgICAgICAgICAgICAgc3dpdGNoIChrZXkpIHtcclxuICAgICAgICAgICAgICAgICAgICBjYXNlIFJlcXVlc3RUeXBlLlVVSUQ6IFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgdXVpZCA9IG91dC51dWlkID0gZGVjb2RlVXVpZChpdGVtLnV1aWQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoYnVuZGxlcy5oYXMoaXRlbS5idW5kbGUpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgY29uZmlnID0gYnVuZGxlcy5nZXQoaXRlbS5idW5kbGUpLl9jb25maWc7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgaW5mbyA9IGNvbmZpZy5nZXRBc3NldEluZm8odXVpZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaW5mbyAmJiBpbmZvLnJlZGlyZWN0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFidW5kbGVzLmhhcyhpbmZvLnJlZGlyZWN0KSkgdGhyb3cgbmV3IEVycm9yKGBQbGVhc2UgbG9hZCBidW5kbGUgJHtpbmZvLnJlZGlyZWN0fSBmaXJzdGApO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbmZpZyA9IGJ1bmRsZXMuZ2V0KGluZm8ucmVkaXJlY3QpLl9jb25maWc7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5mbyA9IGNvbmZpZy5nZXRBc3NldEluZm8odXVpZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvdXQuY29uZmlnID0gY29uZmlnO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb3V0LmluZm8gPSBpbmZvO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG91dC5leHQgPSBpdGVtLmV4dCB8fCAnLmpzb24nO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICBjYXNlICdfX3JlcXVlc3RUeXBlX18nOlxyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ2V4dCc6IFxyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ2J1bmRsZSc6XHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAncHJlc2V0JzpcclxuICAgICAgICAgICAgICAgICAgICBjYXNlICd0eXBlJzogYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBSZXF1ZXN0VHlwZS5ESVI6IFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoYnVuZGxlcy5oYXMoaXRlbS5idW5kbGUpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgaW5mb3MgPSBbXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJ1bmRsZXMuZ2V0KGl0ZW0uYnVuZGxlKS5fY29uZmlnLmdldERpcldpdGhQYXRoKGl0ZW0uZGlyLCBpdGVtLnR5cGUsIGluZm9zKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwLCBsID0gaW5mb3MubGVuZ3RoOyBpIDwgbDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGluZm8gPSBpbmZvc1tpXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnB1dC5wdXNoKHt1dWlkOiBpbmZvLnV1aWQsIF9faXNOYXRpdmVfXzogZmFsc2UsIGV4dDogJy5qc29uJywgYnVuZGxlOiBpdGVtLmJ1bmRsZX0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG91dC5yZWN5Y2xlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG91dCA9IG51bGw7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgUmVxdWVzdFR5cGUuUEFUSDogXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChidW5kbGVzLmhhcyhpdGVtLmJ1bmRsZSkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjb25maWcgPSBidW5kbGVzLmdldChpdGVtLmJ1bmRsZSkuX2NvbmZpZztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBpbmZvID0gY29uZmlnLmdldEluZm9XaXRoUGF0aChpdGVtLnBhdGgsIGl0ZW0udHlwZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpbmZvICYmIGluZm8ucmVkaXJlY3QpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWJ1bmRsZXMuaGFzKGluZm8ucmVkaXJlY3QpKSB0aHJvdyBuZXcgRXJyb3IoYHlvdSBuZWVkIHRvIGxvYWQgYnVuZGxlICR7aW5mby5yZWRpcmVjdH0gZmlyc3RgKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25maWcgPSBidW5kbGVzLmdldChpbmZvLnJlZGlyZWN0KS5fY29uZmlnO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluZm8gPSBjb25maWcuZ2V0QXNzZXRJbmZvKGluZm8udXVpZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFpbmZvKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3V0LnJlY3ljbGUoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYEJ1bmRsZSAke2l0ZW0uYnVuZGxlfSBkb2Vzbid0IGNvbnRhaW4gJHtpdGVtLnBhdGh9YCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvdXQuY29uZmlnID0gY29uZmlnOyBcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG91dC51dWlkID0gaW5mby51dWlkO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb3V0LmluZm8gPSBpbmZvO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG91dC5leHQgPSBpdGVtLmV4dCB8fCAnLmpzb24nO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICBjYXNlIFJlcXVlc3RUeXBlLlNDRU5FOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoYnVuZGxlcy5oYXMoaXRlbS5idW5kbGUpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgY29uZmlnID0gYnVuZGxlcy5nZXQoaXRlbS5idW5kbGUpLl9jb25maWc7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgaW5mbyA9IGNvbmZpZy5nZXRTY2VuZUluZm8oaXRlbS5zY2VuZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpbmZvICYmIGluZm8ucmVkaXJlY3QpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWJ1bmRsZXMuaGFzKGluZm8ucmVkaXJlY3QpKSB0aHJvdyBuZXcgRXJyb3IoYHlvdSBuZWVkIHRvIGxvYWQgYnVuZGxlICR7aW5mby5yZWRpcmVjdH0gZmlyc3RgKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25maWcgPSBidW5kbGVzLmdldChpbmZvLnJlZGlyZWN0KS5fY29uZmlnO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluZm8gPSBjb25maWcuZ2V0QXNzZXRJbmZvKGluZm8udXVpZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWluZm8pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvdXQucmVjeWNsZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgQnVuZGxlICR7Y29uZmlnLm5hbWV9IGRvZXNuJ3QgY29udGFpbiBzY2VuZSAke2l0ZW0uc2NlbmV9YCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvdXQuY29uZmlnID0gY29uZmlnOyBcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG91dC51dWlkID0gaW5mby51dWlkO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb3V0LmluZm8gPSBpbmZvO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ19faXNOYXRpdmVfXyc6IFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBvdXQuaXNOYXRpdmUgPSBpdGVtLl9faXNOYXRpdmVfXztcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBSZXF1ZXN0VHlwZS5VUkw6IFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBvdXQudXJsID0gaXRlbS51cmw7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG91dC51dWlkID0gaXRlbS51dWlkIHx8IGl0ZW0udXJsO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBvdXQuZXh0ID0gaXRlbS5leHQgfHwgY2MucGF0aC5leHRuYW1lKGl0ZW0udXJsKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgb3V0LmlzTmF0aXZlID0gaXRlbS5fX2lzTmF0aXZlX18gIT09IHVuZGVmaW5lZCA/IGl0ZW0uX19pc05hdGl2ZV9fIDogdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDogb3V0Lm9wdGlvbnNba2V5XSA9IGl0ZW1ba2V5XTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmICghb3V0KSBicmVhaztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoIW91dCkgY29udGludWU7XHJcbiAgICAgICAgdGFzay5vdXRwdXQucHVzaChvdXQpO1xyXG4gICAgICAgIGlmICghb3V0LnV1aWQgJiYgIW91dC51cmwpIHRocm93IG5ldyBFcnJvcignQ2FuIG5vdCBwYXJzZSB0aGlzIGlucHV0OicgKyBKU09OLnN0cmluZ2lmeShpdGVtKSk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gbnVsbDtcclxufVxyXG5cclxuZnVuY3Rpb24gY29tYmluZSAodGFzaykge1xyXG4gICAgdmFyIGlucHV0ID0gdGFzay5vdXRwdXQgPSB0YXNrLmlucHV0O1xyXG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBpbnB1dC5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgIHZhciBpdGVtID0gaW5wdXRbaV07XHJcbiAgICAgICAgaWYgKGl0ZW0udXJsKSBjb250aW51ZTtcclxuXHJcbiAgICAgICAgdmFyIHVybCA9ICcnLCBiYXNlID0gJyc7XHJcbiAgICAgICAgdmFyIGNvbmZpZyA9IGl0ZW0uY29uZmlnO1xyXG4gICAgICAgIGlmIChpdGVtLmlzTmF0aXZlKSB7XHJcbiAgICAgICAgICAgIGJhc2UgPSAoY29uZmlnICYmIGNvbmZpZy5uYXRpdmVCYXNlKSA/IChjb25maWcuYmFzZSArIGNvbmZpZy5uYXRpdmVCYXNlKSA6IGNjLmFzc2V0TWFuYWdlci5nZW5lcmFsTmF0aXZlQmFzZTtcclxuICAgICAgICB9IFxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICBiYXNlID0gKGNvbmZpZyAmJiBjb25maWcuaW1wb3J0QmFzZSkgPyAoY29uZmlnLmJhc2UgKyBjb25maWcuaW1wb3J0QmFzZSkgOiBjYy5hc3NldE1hbmFnZXIuZ2VuZXJhbEltcG9ydEJhc2U7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBsZXQgdXVpZCA9IGl0ZW0udXVpZDtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgdmFyIHZlciA9ICcnO1xyXG4gICAgICAgIGlmIChpdGVtLmluZm8pIHtcclxuICAgICAgICAgICAgaWYgKGl0ZW0uaXNOYXRpdmUpIHtcclxuICAgICAgICAgICAgICAgIHZlciA9IGl0ZW0uaW5mby5uYXRpdmVWZXIgPyAoJy4nICsgaXRlbS5pbmZvLm5hdGl2ZVZlcikgOiAnJztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHZlciA9IGl0ZW0uaW5mby52ZXIgPyAoJy4nICsgaXRlbS5pbmZvLnZlcikgOiAnJztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gdWdseSBoYWNrLCBXZUNoYXQgZG9lcyBub3Qgc3VwcG9ydCBsb2FkaW5nIGZvbnQgbGlrZXMgJ215Zm9udC5kdzIxMy50dGYnLiBTbyBhcHBlbmQgaGFzaCB0byBkaXJlY3RvcnlcclxuICAgICAgICBpZiAoaXRlbS5leHQgPT09ICcudHRmJykge1xyXG4gICAgICAgICAgICB1cmwgPSBgJHtiYXNlfS8ke3V1aWQuc2xpY2UoMCwgMil9LyR7dXVpZH0ke3Zlcn0vJHtpdGVtLm9wdGlvbnMuX19uYXRpdmVOYW1lX199YDtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHVybCA9IGAke2Jhc2V9LyR7dXVpZC5zbGljZSgwLCAyKX0vJHt1dWlkfSR7dmVyfSR7aXRlbS5leHR9YDtcclxuICAgICAgICB9XHJcbiAgICAgICAgXHJcbiAgICAgICAgaXRlbS51cmwgPSB1cmw7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gbnVsbDtcclxufVxyXG5cclxubW9kdWxlLmV4cG9ydHMgPSB7IHBhcnNlLCBjb21iaW5lIH07Il0sInNvdXJjZVJvb3QiOiIvIn0=