
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'engine-dev/cocos2d/core/asset-manager/factory.js';
                    var __require = nodeEnv ? function (request) {
                        return require(request);
                    } : function (request) {
                        return __quick_compile_engine__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_engine__.registerModule(__filename, module);}"use strict";

/****************************************************************************
 Copyright (c) 2020 Xiamen Yaji Software Co., Ltd.

 https://www.cocos.com/

 Permission is hereby granted, free of charge, to any person obtaining a copy
 of this software and associated engine source code (the "Software"), a limited,
  worldwide, royalty-free, non-assignable, revocable and non-exclusive license
 to use Cocos Creator solely to develop games on your target platforms. You shall
  not use Cocos Creator software for developing other software or tools that's
  used for developing games. You are not granted to publish, distribute,
  sublicense, and/or sell copies of Cocos Creator.

 The software or tools in this License Agreement are licensed, not sold.
 Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.

 THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 THE SOFTWARE.
 ****************************************************************************/
var Bundle = require('./bundle');

var Cache = require('./cache');

var _require = require('./shared'),
    assets = _require.assets,
    bundles = _require.bundles;

var _creating = new Cache();

function createTexture(id, data, options, onComplete) {
  var out = null,
      err = null;

  try {
    out = new cc.Texture2D();
    out._nativeUrl = id;
    out._nativeAsset = data;
  } catch (e) {
    err = e;
  }

  onComplete && onComplete(err, out);
}

function createAudioClip(id, data, options, onComplete) {
  var out = new cc.AudioClip();
  out._nativeUrl = id;
  out._nativeAsset = data;
  out.duration = data.duration;
  onComplete && onComplete(null, out);
}

function createJsonAsset(id, data, options, onComplete) {
  var out = new cc.JsonAsset();
  out.json = data;
  onComplete && onComplete(null, out);
}

function createTextAsset(id, data, options, onComplete) {
  var out = new cc.TextAsset();
  out.text = data;
  onComplete && onComplete(null, out);
}

function createFont(id, data, options, onComplete) {
  var out = new cc.TTFFont();
  out._nativeUrl = id;
  out._nativeAsset = data;
  onComplete && onComplete(null, out);
}

function createBufferAsset(id, data, options, onComplete) {
  var out = new cc.BufferAsset();
  out._nativeUrl = id;
  out._nativeAsset = data;
  onComplete && onComplete(null, out);
}

function createAsset(id, data, options, onComplete) {
  var out = new cc.Asset();
  out._nativeUrl = id;
  out._nativeAsset = data;
  onComplete && onComplete(null, out);
}

function createBundle(id, data, options, onComplete) {
  var bundle = bundles.get(data.name);

  if (!bundle) {
    bundle = new Bundle();
    data.base = data.base || id + '/';
    bundle.init(data);
  }

  onComplete && onComplete(null, bundle);
}

var factory = {
  register: function register(type, handler) {
    if (typeof type === 'object') {
      cc.js.mixin(producers, type);
    } else {
      producers[type] = handler;
    }
  },
  create: function create(id, data, type, options, onComplete) {
    var func = producers[type] || producers['default'];
    var asset, creating;

    if (asset = assets.get(id)) {
      onComplete(null, asset);
    } else if (creating = _creating.get(id)) {
      creating.push(onComplete);
    } else {
      _creating.add(id, [onComplete]);

      func(id, data, options, function (err, data) {
        if (!err && data instanceof cc.Asset) {
          data._uuid = id;
          assets.add(id, data);
        }

        var callbacks = _creating.remove(id);

        for (var i = 0, l = callbacks.length; i < l; i++) {
          callbacks[i](err, data);
        }
      });
    }
  }
};
var producers = {
  // Images
  '.png': createTexture,
  '.jpg': createTexture,
  '.bmp': createTexture,
  '.jpeg': createTexture,
  '.gif': createTexture,
  '.ico': createTexture,
  '.tiff': createTexture,
  '.webp': createTexture,
  '.image': createTexture,
  '.pvr': createTexture,
  '.pkm': createTexture,
  // Audio
  '.mp3': createAudioClip,
  '.ogg': createAudioClip,
  '.wav': createAudioClip,
  '.m4a': createAudioClip,
  // Txt
  '.txt': createTextAsset,
  '.xml': createTextAsset,
  '.vsh': createTextAsset,
  '.fsh': createTextAsset,
  '.atlas': createTextAsset,
  '.tmx': createTextAsset,
  '.tsx': createTextAsset,
  '.fnt': createTextAsset,
  '.json': createJsonAsset,
  '.ExportJson': createJsonAsset,
  // font
  '.font': createFont,
  '.eot': createFont,
  '.ttf': createFont,
  '.woff': createFont,
  '.svg': createFont,
  '.ttc': createFont,
  // Binary
  '.binary': createBufferAsset,
  '.bin': createBufferAsset,
  '.dbbin': createBufferAsset,
  '.skel': createBufferAsset,
  'bundle': createBundle,
  'default': createAsset
};
module.exports = factory;
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_engine__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImVuZ2luZS1kZXZcXGNvY29zMmRcXGNvcmVcXGFzc2V0LW1hbmFnZXJcXGZhY3RvcnkuanMiXSwibmFtZXMiOlsiQnVuZGxlIiwicmVxdWlyZSIsIkNhY2hlIiwiYXNzZXRzIiwiYnVuZGxlcyIsIl9jcmVhdGluZyIsImNyZWF0ZVRleHR1cmUiLCJpZCIsImRhdGEiLCJvcHRpb25zIiwib25Db21wbGV0ZSIsIm91dCIsImVyciIsImNjIiwiVGV4dHVyZTJEIiwiX25hdGl2ZVVybCIsIl9uYXRpdmVBc3NldCIsImUiLCJjcmVhdGVBdWRpb0NsaXAiLCJBdWRpb0NsaXAiLCJkdXJhdGlvbiIsImNyZWF0ZUpzb25Bc3NldCIsIkpzb25Bc3NldCIsImpzb24iLCJjcmVhdGVUZXh0QXNzZXQiLCJUZXh0QXNzZXQiLCJ0ZXh0IiwiY3JlYXRlRm9udCIsIlRURkZvbnQiLCJjcmVhdGVCdWZmZXJBc3NldCIsIkJ1ZmZlckFzc2V0IiwiY3JlYXRlQXNzZXQiLCJBc3NldCIsImNyZWF0ZUJ1bmRsZSIsImJ1bmRsZSIsImdldCIsIm5hbWUiLCJiYXNlIiwiaW5pdCIsImZhY3RvcnkiLCJyZWdpc3RlciIsInR5cGUiLCJoYW5kbGVyIiwianMiLCJtaXhpbiIsInByb2R1Y2VycyIsImNyZWF0ZSIsImZ1bmMiLCJhc3NldCIsImNyZWF0aW5nIiwicHVzaCIsImFkZCIsIl91dWlkIiwiY2FsbGJhY2tzIiwicmVtb3ZlIiwiaSIsImwiLCJsZW5ndGgiLCJtb2R1bGUiLCJleHBvcnRzIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7O0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBTUEsTUFBTSxHQUFHQyxPQUFPLENBQUMsVUFBRCxDQUF0Qjs7QUFDQSxJQUFNQyxLQUFLLEdBQUdELE9BQU8sQ0FB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LyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKipcclxuIENvcHlyaWdodCAoYykgMjAyMCBYaWFtZW4gWWFqaSBTb2Z0d2FyZSBDby4sIEx0ZC5cclxuXHJcbiBodHRwczovL3d3dy5jb2Nvcy5jb20vXHJcblxyXG4gUGVybWlzc2lvbiBpcyBoZXJlYnkgZ3JhbnRlZCwgZnJlZSBvZiBjaGFyZ2UsIHRvIGFueSBwZXJzb24gb2J0YWluaW5nIGEgY29weVxyXG4gb2YgdGhpcyBzb2Z0d2FyZSBhbmQgYXNzb2NpYXRlZCBlbmdpbmUgc291cmNlIGNvZGUgKHRoZSBcIlNvZnR3YXJlXCIpLCBhIGxpbWl0ZWQsXHJcbiAgd29ybGR3aWRlLCByb3lhbHR5LWZyZWUsIG5vbi1hc3NpZ25hYmxlLCByZXZvY2FibGUgYW5kIG5vbi1leGNsdXNpdmUgbGljZW5zZVxyXG4gdG8gdXNlIENvY29zIENyZWF0b3Igc29sZWx5IHRvIGRldmVsb3AgZ2FtZXMgb24geW91ciB0YXJnZXQgcGxhdGZvcm1zLiBZb3Ugc2hhbGxcclxuICBub3QgdXNlIENvY29zIENyZWF0b3Igc29mdHdhcmUgZm9yIGRldmVsb3Bpbmcgb3RoZXIgc29mdHdhcmUgb3IgdG9vbHMgdGhhdCdzXHJcbiAgdXNlZCBmb3IgZGV2ZWxvcGluZyBnYW1lcy4gWW91IGFyZSBub3QgZ3JhbnRlZCB0byBwdWJsaXNoLCBkaXN0cmlidXRlLFxyXG4gIHN1YmxpY2Vuc2UsIGFuZC9vciBzZWxsIGNvcGllcyBvZiBDb2NvcyBDcmVhdG9yLlxyXG5cclxuIFRoZSBzb2Z0d2FyZSBvciB0b29scyBpbiB0aGlzIExpY2Vuc2UgQWdyZWVtZW50IGFyZSBsaWNlbnNlZCwgbm90IHNvbGQuXHJcbiBYaWFtZW4gWWFqaSBTb2Z0d2FyZSBDby4sIEx0ZC4gcmVzZXJ2ZXMgYWxsIHJpZ2h0cyBub3QgZXhwcmVzc2x5IGdyYW50ZWQgdG8geW91LlxyXG5cclxuIFRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCBcIkFTIElTXCIsIFdJVEhPVVQgV0FSUkFOVFkgT0YgQU5ZIEtJTkQsIEVYUFJFU1MgT1JcclxuIElNUExJRUQsIElOQ0xVRElORyBCVVQgTk9UIExJTUlURUQgVE8gVEhFIFdBUlJBTlRJRVMgT0YgTUVSQ0hBTlRBQklMSVRZLFxyXG4gRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UgQU5EIE5PTklORlJJTkdFTUVOVC4gSU4gTk8gRVZFTlQgU0hBTEwgVEhFXHJcbiBBVVRIT1JTIE9SIENPUFlSSUdIVCBIT0xERVJTIEJFIExJQUJMRSBGT1IgQU5ZIENMQUlNLCBEQU1BR0VTIE9SIE9USEVSXHJcbiBMSUFCSUxJVFksIFdIRVRIRVIgSU4gQU4gQUNUSU9OIE9GIENPTlRSQUNULCBUT1JUIE9SIE9USEVSV0lTRSwgQVJJU0lORyBGUk9NLFxyXG4gT1VUIE9GIE9SIElOIENPTk5FQ1RJT04gV0lUSCBUSEUgU09GVFdBUkUgT1IgVEhFIFVTRSBPUiBPVEhFUiBERUFMSU5HUyBJTlxyXG4gVEhFIFNPRlRXQVJFLlxyXG4gKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi9cclxuY29uc3QgQnVuZGxlID0gcmVxdWlyZSgnLi9idW5kbGUnKTtcclxuY29uc3QgQ2FjaGUgPSByZXF1aXJlKCcuL2NhY2hlJyk7XHJcbmNvbnN0IHsgYXNzZXRzLCBidW5kbGVzIH0gPSByZXF1aXJlKCcuL3NoYXJlZCcpO1xyXG5cclxuY29uc3QgX2NyZWF0aW5nID0gbmV3IENhY2hlKCk7XHJcblxyXG5mdW5jdGlvbiBjcmVhdGVUZXh0dXJlIChpZCwgZGF0YSwgb3B0aW9ucywgb25Db21wbGV0ZSkge1xyXG4gICAgbGV0IG91dCA9IG51bGwsIGVyciA9IG51bGw7XHJcbiAgICB0cnkge1xyXG4gICAgICAgIG91dCA9IG5ldyBjYy5UZXh0dXJlMkQoKTtcclxuICAgICAgICBvdXQuX25hdGl2ZVVybCA9IGlkO1xyXG4gICAgICAgIG91dC5fbmF0aXZlQXNzZXQgPSBkYXRhO1xyXG4gICAgfVxyXG4gICAgY2F0Y2ggKGUpIHtcclxuICAgICAgICBlcnIgPSBlO1xyXG4gICAgfVxyXG4gICAgb25Db21wbGV0ZSAmJiBvbkNvbXBsZXRlKGVyciwgb3V0KTtcclxufVxyXG5cclxuZnVuY3Rpb24gY3JlYXRlQXVkaW9DbGlwIChpZCwgZGF0YSwgb3B0aW9ucywgb25Db21wbGV0ZSkge1xyXG4gICAgbGV0IG91dCA9IG5ldyBjYy5BdWRpb0NsaXAoKTtcclxuICAgIG91dC5fbmF0aXZlVXJsID0gaWQ7XHJcbiAgICBvdXQuX25hdGl2ZUFzc2V0ID0gZGF0YTtcclxuICAgIG91dC5kdXJhdGlvbiA9IGRhdGEuZHVyYXRpb247XHJcbiAgICBvbkNvbXBsZXRlICYmIG9uQ29tcGxldGUobnVsbCwgb3V0KTtcclxufVxyXG5cclxuZnVuY3Rpb24gY3JlYXRlSnNvbkFzc2V0IChpZCwgZGF0YSwgb3B0aW9ucywgb25Db21wbGV0ZSkge1xyXG4gICAgbGV0IG91dCA9IG5ldyBjYy5Kc29uQXNzZXQoKTtcclxuICAgIG91dC5qc29uID0gZGF0YTtcclxuICAgIG9uQ29tcGxldGUgJiYgb25Db21wbGV0ZShudWxsLCBvdXQpO1xyXG59XHJcblxyXG5mdW5jdGlvbiBjcmVhdGVUZXh0QXNzZXQgKGlkLCBkYXRhLCBvcHRpb25zLCBvbkNvbXBsZXRlKSB7XHJcbiAgICBsZXQgb3V0ID0gbmV3IGNjLlRleHRBc3NldCgpO1xyXG4gICAgb3V0LnRleHQgPSBkYXRhO1xyXG4gICAgb25Db21wbGV0ZSAmJiBvbkNvbXBsZXRlKG51bGwsIG91dCk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGNyZWF0ZUZvbnQgKGlkLCBkYXRhLCBvcHRpb25zLCBvbkNvbXBsZXRlKSB7XHJcbiAgICBsZXQgb3V0ID0gbmV3IGNjLlRURkZvbnQoKTtcclxuICAgIG91dC5fbmF0aXZlVXJsID0gaWQ7XHJcbiAgICBvdXQuX25hdGl2ZUFzc2V0ID0gZGF0YTtcclxuICAgIG9uQ29tcGxldGUgJiYgb25Db21wbGV0ZShudWxsLCBvdXQpO1xyXG59XHJcblxyXG5mdW5jdGlvbiBjcmVhdGVCdWZmZXJBc3NldCAoaWQsIGRhdGEsIG9wdGlvbnMsIG9uQ29tcGxldGUpIHtcclxuICAgIGxldCBvdXQgPSBuZXcgY2MuQnVmZmVyQXNzZXQoKTtcclxuICAgIG91dC5fbmF0aXZlVXJsID0gaWQ7XHJcbiAgICBvdXQuX25hdGl2ZUFzc2V0ID0gZGF0YTtcclxuICAgIG9uQ29tcGxldGUgJiYgb25Db21wbGV0ZShudWxsLCBvdXQpO1xyXG59XHJcblxyXG5mdW5jdGlvbiBjcmVhdGVBc3NldCAoaWQsIGRhdGEsIG9wdGlvbnMsIG9uQ29tcGxldGUpIHtcclxuICAgIGxldCBvdXQgPSBuZXcgY2MuQXNzZXQoKTtcclxuICAgIG91dC5fbmF0aXZlVXJsID0gaWQ7XHJcbiAgICBvdXQuX25hdGl2ZUFzc2V0ID0gZGF0YTtcclxuICAgIG9uQ29tcGxldGUgJiYgb25Db21wbGV0ZShudWxsLCBvdXQpO1xyXG59XHJcblxyXG5mdW5jdGlvbiBjcmVhdGVCdW5kbGUgKGlkLCBkYXRhLCBvcHRpb25zLCBvbkNvbXBsZXRlKSB7XHJcbiAgICBsZXQgYnVuZGxlID0gYnVuZGxlcy5nZXQoZGF0YS5uYW1lKTtcclxuICAgIGlmICghYnVuZGxlKSB7XHJcbiAgICAgICAgYnVuZGxlID0gbmV3IEJ1bmRsZSgpO1xyXG4gICAgICAgIGRhdGEuYmFzZSA9IGRhdGEuYmFzZSB8fCBpZCArICcvJztcclxuICAgICAgICBidW5kbGUuaW5pdChkYXRhKTtcclxuICAgIH1cclxuICAgIG9uQ29tcGxldGUgJiYgb25Db21wbGV0ZShudWxsLCBidW5kbGUpO1xyXG59XHJcblxyXG5jb25zdCBmYWN0b3J5ID0ge1xyXG5cclxuICAgIHJlZ2lzdGVyICh0eXBlLCBoYW5kbGVyKSB7XHJcbiAgICAgICAgaWYgKHR5cGVvZiB0eXBlID09PSAnb2JqZWN0Jykge1xyXG4gICAgICAgICAgICBjYy5qcy5taXhpbihwcm9kdWNlcnMsIHR5cGUpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgcHJvZHVjZXJzW3R5cGVdID0gaGFuZGxlcjtcclxuICAgICAgICB9XHJcbiAgICB9LFxyXG5cclxuICAgIGNyZWF0ZSAoaWQsIGRhdGEsIHR5cGUsIG9wdGlvbnMsIG9uQ29tcGxldGUpIHtcclxuICAgICAgICB2YXIgZnVuYyA9IHByb2R1Y2Vyc1t0eXBlXSB8fCBwcm9kdWNlcnNbJ2RlZmF1bHQnXTtcclxuICAgICAgICBsZXQgYXNzZXQsIGNyZWF0aW5nO1xyXG4gICAgICAgIGlmIChhc3NldCA9IGFzc2V0cy5nZXQoaWQpKSB7XHJcbiAgICAgICAgICAgIG9uQ29tcGxldGUobnVsbCwgYXNzZXQpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIGlmIChjcmVhdGluZyA9IF9jcmVhdGluZy5nZXQoaWQpKSB7XHJcbiAgICAgICAgICAgIGNyZWF0aW5nLnB1c2gob25Db21wbGV0ZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICBfY3JlYXRpbmcuYWRkKGlkLCBbb25Db21wbGV0ZV0pO1xyXG4gICAgICAgICAgICBmdW5jKGlkLCBkYXRhLCBvcHRpb25zLCBmdW5jdGlvbiAoZXJyLCBkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoIWVyciAmJiBkYXRhIGluc3RhbmNlb2YgY2MuQXNzZXQpIHtcclxuICAgICAgICAgICAgICAgICAgICBkYXRhLl91dWlkID0gaWQ7XHJcbiAgICAgICAgICAgICAgICAgICAgYXNzZXRzLmFkZChpZCwgZGF0YSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBsZXQgY2FsbGJhY2tzID0gX2NyZWF0aW5nLnJlbW92ZShpZCk7XHJcbiAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMCwgbCA9IGNhbGxiYWNrcy5sZW5ndGg7IGkgPCBsOyBpKyspIHtcclxuICAgICAgICAgICAgICAgICAgICBjYWxsYmFja3NbaV0oZXJyLCBkYXRhKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59O1xyXG5cclxuY29uc3QgcHJvZHVjZXJzID0ge1xyXG4gICAgLy8gSW1hZ2VzXHJcbiAgICAnLnBuZycgOiBjcmVhdGVUZXh0dXJlLFxyXG4gICAgJy5qcGcnIDogY3JlYXRlVGV4dHVyZSxcclxuICAgICcuYm1wJyA6IGNyZWF0ZVRleHR1cmUsXHJcbiAgICAnLmpwZWcnIDogY3JlYXRlVGV4dHVyZSxcclxuICAgICcuZ2lmJyA6IGNyZWF0ZVRleHR1cmUsXHJcbiAgICAnLmljbycgOiBjcmVhdGVUZXh0dXJlLFxyXG4gICAgJy50aWZmJyA6IGNyZWF0ZVRleHR1cmUsXHJcbiAgICAnLndlYnAnIDogY3JlYXRlVGV4dHVyZSxcclxuICAgICcuaW1hZ2UnIDogY3JlYXRlVGV4dHVyZSxcclxuICAgICcucHZyJzogY3JlYXRlVGV4dHVyZSxcclxuICAgICcucGttJzogY3JlYXRlVGV4dHVyZSxcclxuXHJcbiAgICAvLyBBdWRpb1xyXG4gICAgJy5tcDMnIDogY3JlYXRlQXVkaW9DbGlwLFxyXG4gICAgJy5vZ2cnIDogY3JlYXRlQXVkaW9DbGlwLFxyXG4gICAgJy53YXYnIDogY3JlYXRlQXVkaW9DbGlwLFxyXG4gICAgJy5tNGEnIDogY3JlYXRlQXVkaW9DbGlwLFxyXG5cclxuICAgIC8vIFR4dFxyXG4gICAgJy50eHQnIDogY3JlYXRlVGV4dEFzc2V0LFxyXG4gICAgJy54bWwnIDogY3JlYXRlVGV4dEFzc2V0LFxyXG4gICAgJy52c2gnIDogY3JlYXRlVGV4dEFzc2V0LFxyXG4gICAgJy5mc2gnIDogY3JlYXRlVGV4dEFzc2V0LFxyXG4gICAgJy5hdGxhcycgOiBjcmVhdGVUZXh0QXNzZXQsXHJcblxyXG4gICAgJy50bXgnIDogY3JlYXRlVGV4dEFzc2V0LFxyXG4gICAgJy50c3gnIDogY3JlYXRlVGV4dEFzc2V0LFxyXG4gICAgJy5mbnQnIDogY3JlYXRlVGV4dEFzc2V0LFxyXG5cclxuICAgICcuanNvbicgOiBjcmVhdGVKc29uQXNzZXQsXHJcbiAgICAnLkV4cG9ydEpzb24nIDogY3JlYXRlSnNvbkFzc2V0LFxyXG5cclxuICAgIC8vIGZvbnRcclxuICAgICcuZm9udCcgOiBjcmVhdGVGb250LFxyXG4gICAgJy5lb3QnIDogY3JlYXRlRm9udCxcclxuICAgICcudHRmJyA6IGNyZWF0ZUZvbnQsXHJcbiAgICAnLndvZmYnIDogY3JlYXRlRm9udCxcclxuICAgICcuc3ZnJyA6IGNyZWF0ZUZvbnQsXHJcbiAgICAnLnR0YycgOiBjcmVhdGVGb250LFxyXG5cclxuICAgIC8vIEJpbmFyeVxyXG4gICAgJy5iaW5hcnknOiBjcmVhdGVCdWZmZXJBc3NldCxcclxuICAgICcuYmluJzogY3JlYXRlQnVmZmVyQXNzZXQsXHJcbiAgICAnLmRiYmluJzogY3JlYXRlQnVmZmVyQXNzZXQsXHJcbiAgICAnLnNrZWwnOiBjcmVhdGVCdWZmZXJBc3NldCxcclxuXHJcbiAgICAnYnVuZGxlJzogY3JlYXRlQnVuZGxlLFxyXG5cclxuICAgICdkZWZhdWx0JzogY3JlYXRlQXNzZXRcclxuXHJcbn07XHJcblxyXG5tb2R1bGUuZXhwb3J0cyA9IGZhY3Rvcnk7XHJcbiJdLCJzb3VyY2VSb290IjoiLyJ9