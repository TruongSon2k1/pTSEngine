
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'engine-dev/cocos2d/core/components/CCCanvas.js';
                    var __require = nodeEnv ? function (request) {
                        return require(request);
                    } : function (request) {
                        return __quick_compile_engine__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_engine__.registerModule(__filename, module);}"use strict";

/****************************************************************************
 Copyright (c) 2013-2016 Chukong Technologies Inc.
 Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.

 https://www.cocos.com/

 Permission is hereby granted, free of charge, to any person obtaining a copy
 of this software and associated engine source code (the "Software"), a limited,
  worldwide, royalty-free, non-assignable, revocable and non-exclusive license
 to use Cocos Creator solely to develop games on your target platforms. You shall
  not use Cocos Creator software for developing other software or tools that's
  used for developing games. You are not granted to publish, distribute,
  sublicense, and/or sell copies of Cocos Creator.

 The software or tools in this License Agreement are licensed, not sold.
 Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.

 THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 THE SOFTWARE.
 ****************************************************************************/
var Camera = require('../camera/CCCamera');

var Component = require('./CCComponent'); // Screen adaptation strategy for Canvas + Widget


function resetWidgetComponent(canvas) {
  var widget = canvas.node.getComponent(cc.Widget);

  if (!widget) {
    widget = canvas.node.addComponent(cc.Widget);
  }

  widget.isAlignTop = true;
  widget.isAlignBottom = true;
  widget.isAlignLeft = true;
  widget.isAlignRight = true;
  widget.top = 0;
  widget.bottom = 0;
  widget.left = 0;
  widget.right = 0;
}
/**
 * !#zh 作为 UI 根节点，为所有子节点提供视窗四边的位置信息以供对齐，另外提供屏幕适配策略接口，方便从编辑器设置。<br>
 * 注：由于本节点的尺寸会跟随屏幕拉伸，所以 anchorPoint 只支持 (0.5, 0.5)，否则适配不同屏幕时坐标会有偏差。
 *
 * @class Canvas
 * @extends Component
 */


var Canvas = cc.Class({
  name: 'cc.Canvas',
  "extends": Component,
  editor: CC_EDITOR && {
    menu: 'i18n:MAIN_MENU.component.ui/Canvas',
    help: 'i18n:COMPONENT.help_url.canvas',
    executeInEditMode: true,
    disallowMultiple: true
  },
  resetInEditor: CC_EDITOR && function () {
    _Scene._applyCanvasPreferences(this);

    resetWidgetComponent(this);
  },
  statics: {
    /**
     * !#en Current active canvas, the scene should only have one active canvas at the same time.
     * !#zh 当前激活的画布组件，场景同一时间只能有一个激活的画布。
     * @property {Canvas} instance
     * @static
     */
    instance: null
  },
  properties: {
    /**
     * !#en The desigin resolution for current scene.
     * !#zh 当前场景设计分辨率。
     * @property {Size} designResolution
     * @default new cc.Size(960, 640)
     */
    _designResolution: cc.size(960, 640),
    designResolution: {
      get: function get() {
        return cc.size(this._designResolution);
      },
      set: function set(value) {
        this._designResolution.width = value.width;
        this._designResolution.height = value.height;
        this.applySettings();
      },
      tooltip: CC_DEV && 'i18n:COMPONENT.canvas.design_resolution'
    },
    _fitWidth: false,
    _fitHeight: true,

    /**
     * !#en TODO
     * !#zh: 是否优先将设计分辨率高度撑满视图高度。
     * @property {Boolean} fitHeight
     * @default false
     */
    fitHeight: {
      get: function get() {
        return this._fitHeight;
      },
      set: function set(value) {
        if (this._fitHeight !== value) {
          this._fitHeight = value;
          this.applySettings();
        }
      },
      tooltip: CC_DEV && 'i18n:COMPONENT.canvas.fit_height'
    },

    /**
     * !#en TODO
     * !#zh: 是否优先将设计分辨率宽度撑满视图宽度。
     * @property {Boolean} fitWidth
     * @default false
     */
    fitWidth: {
      get: function get() {
        return this._fitWidth;
      },
      set: function set(value) {
        if (this._fitWidth !== value) {
          this._fitWidth = value;
          this.applySettings();
        }
      },
      tooltip: CC_DEV && 'i18n:COMPONENT.canvas.fit_width'
    }
  },
  // fit canvas node to design resolution
  _fitDesignResolution: CC_EDITOR && function () {
    // TODO: support paddings of locked widget
    var designSize = cc.engine.getDesignResolutionSize();
    this.node.setPosition(designSize.width * 0.5, designSize.height * 0.5);
    this.node.setContentSize(designSize);
  },
  __preload: function __preload() {
    if (CC_DEV) {
      var Flags = cc.Object.Flags;
      this._objFlags |= Flags.IsPositionLocked | Flags.IsAnchorLocked | Flags.IsSizeLocked;
    }

    if (Canvas.instance) {
      return cc.warnID(6700, this.node.name, Canvas.instance.node.name);
    }

    Canvas.instance = this; // Align node to fit the screen

    this.applySettings(); // Stretch to matched size during the scene initialization

    var widget = this.getComponent(cc.Widget);

    if (widget) {
      widget.updateAlignment();
    } else if (CC_EDITOR) {
      this._fitDesignResolution();
    } // Constantly align canvas node in edit mode


    if (CC_EDITOR) {
      cc.director.on(cc.Director.EVENT_AFTER_UPDATE, this._fitDesignResolution, this);
      cc.engine.on('design-resolution-changed', this._fitDesignResolution, this);
    }
  },
  start: function start() {
    if (!Camera.main && cc.game.renderType !== cc.game.RENDER_TYPE_CANVAS) {
      // Create default Main Camera
      var cameraNode = new cc.Node('Main Camera');
      cameraNode.parent = this.node;
      cameraNode.setSiblingIndex(0);
      var camera = cameraNode.addComponent(Camera);
      var ClearFlags = Camera.ClearFlags;
      camera.clearFlags = ClearFlags.COLOR | ClearFlags.DEPTH | ClearFlags.STENCIL;
      camera.depth = -1;
    }
  },
  onDestroy: function onDestroy() {
    if (CC_EDITOR) {
      cc.director.off(cc.Director.EVENT_AFTER_UPDATE, this._fitDesignResolution, this);
      cc.engine.off('design-resolution-changed', this._fitDesignResolution, this);
    }

    if (Canvas.instance === this) {
      Canvas.instance = null;
    }
  },
  applySettings: function applySettings() {
    var ResolutionPolicy = cc.ResolutionPolicy;
    var policy;

    if (this.fitHeight && this.fitWidth) {
      policy = ResolutionPolicy.SHOW_ALL;
    } else if (!this.fitHeight && !this.fitWidth) {
      policy = ResolutionPolicy.NO_BORDER;
    } else if (this.fitWidth) {
      policy = ResolutionPolicy.FIXED_WIDTH;
    } else {
      // fitHeight
      policy = ResolutionPolicy.FIXED_HEIGHT;
    }

    var designRes = this._designResolution;

    if (CC_EDITOR) {
      cc.engine.setDesignResolutionSize(designRes.width, designRes.height);
    } else {
      cc.view.setDesignResolutionSize(designRes.width, designRes.height, policy);
    }
  }
});
cc.Canvas = module.exports = Canvas;
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_engine__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImVuZ2luZS1kZXZcXGNvY29zMmRcXGNvcmVcXGNvbXBvbmVudHNcXENDQ2FudmFzLmpzIl0sIm5hbWVzIjpbIkNhbWVyYSIsInJlcXVpcmUiLCJDb21wb25lbnQiLCJyZXNldFdpZGdldENvbXBvbmVudCIsImNhbnZhcyIsIndpZGdldCIsIm5vZGUiLCJnZXRDb21wb25lbnQiLCJjYyIsIldpZGdldCIsImFkZENvbXBvbmVudCIsImlzQWxpZ25Ub3AiLCJpc0FsaWduQm90dG9tIiwiaXNBbGlnbkxlZnQiLCJpc0FsaWduUmlnaHQiLCJ0b3AiLCJib3R0b20iLCJsZWZ0IiwicmlnaHQiLCJDYW52YXMiLCJDbGFzcyIsIm5hbWUiLCJlZGl0b3IiLCJDQ19FRElUT1IiLCJtZW51IiwiaGVscCIsImV4ZWN1dGVJbkVkaXRNb2RlIiwiZGlzYWxsb3dNdWx0aXBsZSIsInJlc2V0SW5FZGl0b3IiLCJfU2NlbmUiLCJfYXBwbHlDYW52YXNQcmVmZXJlbmNlcyIsInN0YXRpY3MiLCJpbnN0YW5jZSIsInByb3BlcnRpZXMiLCJfZGVzaWduUmVzb2x1dGlvbiIsInNpemUiLCJkZXNpZ25SZXNvbHV0aW9uIiwiZ2V0Iiwic2V0IiwidmFsdWUiLCJ3aWR0aCIsImhlaWdodCIsImFwcGx5U2V0dGluZ3MiLCJ0b29sdGlwIiwiQ0NfREVWIiwiX2ZpdFdpZHRoIiwiX2ZpdEhlaWdodCIsImZpdEhlaWdodCIsImZpdFdpZHRoIiwiX2ZpdERlc2lnblJlc29sdXRpb24iLCJkZXNpZ25TaXplIiwiZW5naW5lIiwiZ2V0RGVzaWduUmVzb2x1dGlvblNpemUiLCJzZXRQb3NpdGlvbiIsInNldENvbnRlbnRTaXplIiwiX19wcmVsb2FkIiwiRmxhZ3MiLCJPYmplY3QiLCJfb2JqRmxhZ3MiLCJJc1Bvc2l0aW9uTG9ja2VkIiwiSXNBbmNob3JMb2NrZWQiLCJJc1NpemVMb2NrZWQiLCJ3YXJuSUQiLCJ1cGRhdGVBbGlnbm1lbnQiLCJkaXJlY3RvciIsIm9uIiwiRGlyZWN0b3IiLCJFVkVOVF9BRlRFUl9VUERBVEUiLCJzdGFydCIsIm1haW4iLCJnYW1lIiwicmVuZGVyVHlwZSIsIlJFTkRFUl9UWVBFX0NBTlZBUyIsImNhbWVyYU5vZGUiLCJOb2RlIiwicGFyZW50Iiwic2V0U2libGluZ0luZGV4IiwiY2FtZXJhIiwiQ2xlYXJGbGFncyIsImNsZWFyRmxhZ3MiLCJDT0xPUiIsIkRFUFRIIiwiU1RFTkNJTCIsImRlcHRoIiwib25EZXN0cm95Iiwib2ZmIiwiUmVzb2x1dGlvblBvbGljeSIsInBvbGljeSIsIlNIT1dfQUxMIiwiTk9fQk9SREVSIiwiRklYRURfV0lEVEgiLCJGSVhFRF9IRUlHSFQiLCJkZXNpZ25SZXMiLCJzZXREZXNpZ25SZXNvbHV0aW9uU2l6ZSIsInZpZXciLCJtb2R1bGUiLCJleHBvcnRzIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7O0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQSxJQUFJQSxNQUFNLEdBQUdDLE9BQU8sQ0FBQyxvQkFBRCxDQUFwQjs7QUFDQSxJQUFJQyxTQUFTLEdBQUdELE9BQU8sQ0FBQyxlQUFELENBQXZCLEVBRUE7OztBQUNBLFNBQVNFLG9CQUFULENBQStCQyxNQUEvQixFQUF1QztBQUNuQyxNQUFJQyxNQUFNLEdBQUdELE1BQU0sQ0FBQ0UsSUFBUCxDQUFZQyxZQUFaLENBQXlCQyxFQUFFLENBQUNDLE1BQTVCLENBQWI7O0FBQ0EsTUFBSSxDQUFDSixNQUFMLEVBQWE7QUFDVEEsSUFBQUEsTUFBTSxHQUFHRCxNQUFNLENBQUNFLElBQVAsQ0FBWUksWUFBWixDQUF5QkYsRUFBRSxDQUFDQyxNQUE1QixDQUFUO0FBQ0g7O0FBQ0RKLEVBQUFBLE1BQU0sQ0FBQ00sVUFBUCxHQUFvQixJQUFwQjtBQUNBTixFQUFBQSxNQUFNLENBQUNPLGFBQVAsR0FBdUIsSUFB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O0FBQ0RqQyxNQUFBQSxFQUFFLENBQUNzRixJQUFILENBQVFELHVCQUFSLENBQWdDRCxTQUFTLENBQUNwRCxLQUExQyxFQUFpRG9ELFNBQVMsQ0FBQ25ELE1BQTNELEVBQW1FOEMsTUFBbkU7QUFDSDtBQUNKO0FBakxpQixDQUFULENBQWI7QUFxTEEvRSxFQUFFLENBQUNXLE1BQUgsR0FBWTRFLE1BQU0sQ0FBQ0MsT0FBUCxHQUFpQjdFLE1BQTdCIiwic291cmNlc0NvbnRlbnQiOlsiLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKipcclxuIENvcHlyaWdodCAoYykgMjAxMy0yMDE2IENodWtvbmcgVGVjaG5vbG9naWVzIEluYy5cclxuIENvcHlyaWdodCAoYykgMjAxNy0yMDE4IFhpYW1lbiBZYWppIFNvZnR3YXJlIENvLiwgTHRkLlxyXG5cclxuIGh0dHBzOi8vd3d3LmNvY29zLmNvbS9cclxuXHJcbiBQZXJtaXNzaW9uIGlzIGhlcmVieSBncmFudGVkLCBmcmVlIG9mIGNoYXJnZSwgdG8gYW55IHBlcnNvbiBvYnRhaW5pbmcgYSBjb3B5XHJcbiBvZiB0aGlzIHNvZnR3YXJlIGFuZCBhc3NvY2lhdGVkIGVuZ2luZSBzb3VyY2UgY29kZSAodGhlIFwiU29mdHdhcmVcIiksIGEgbGltaXRlZCxcclxuICB3b3JsZHdpZGUsIHJveWFsdHktZnJlZSwgbm9uLWFzc2lnbmFibGUsIHJldm9jYWJsZSBhbmQgbm9uLWV4Y2x1c2l2ZSBsaWNlbnNlXHJcbiB0byB1c2UgQ29jb3MgQ3JlYXRvciBzb2xlbHkgdG8gZGV2ZWxvcCBnYW1lcyBvbiB5b3VyIHRhcmdldCBwbGF0Zm9ybXMuIFlvdSBzaGFsbFxyXG4gIG5vdCB1c2UgQ29jb3MgQ3JlYXRvciBzb2Z0d2FyZSBmb3IgZGV2ZWxvcGluZyBvdGhlciBzb2Z0d2FyZSBvciB0b29scyB0aGF0J3NcclxuICB1c2VkIGZvciBkZXZlbG9waW5nIGdhbWVzLiBZb3UgYXJlIG5vdCBncmFudGVkIHRvIHB1Ymxpc2gsIGRpc3RyaWJ1dGUsXHJcbiAgc3VibGljZW5zZSwgYW5kL29yIHNlbGwgY29waWVzIG9mIENvY29zIENyZWF0b3IuXHJcblxyXG4gVGhlIHNvZnR3YXJlIG9yIHRvb2xzIGluIHRoaXMgTGljZW5zZSBBZ3JlZW1lbnQgYXJlIGxpY2Vuc2VkLCBub3Qgc29sZC5cclxuIFhpYW1lbiBZYWppIFNvZnR3YXJlIENvLiwgTHRkLiByZXNlcnZlcyBhbGwgcmlnaHRzIG5vdCBleHByZXNzbHkgZ3JhbnRlZCB0byB5b3UuXHJcblxyXG4gVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEIFwiQVMgSVNcIiwgV0lUSE9VVCBXQVJSQU5UWSBPRiBBTlkgS0lORCwgRVhQUkVTUyBPUlxyXG4gSU1QTElFRCwgSU5DTFVESU5HIEJVVCBOT1QgTElNSVRFRCBUTyBUSEUgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFksXHJcbiBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBTkQgTk9OSU5GUklOR0VNRU5ULiBJTiBOTyBFVkVOVCBTSEFMTCBUSEVcclxuIEFVVEhPUlMgT1IgQ09QWVJJR0hUIEhPTERFUlMgQkUgTElBQkxFIEZPUiBBTlkgQ0xBSU0sIERBTUFHRVMgT1IgT1RIRVJcclxuIExJQUJJTElUWSwgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIFRPUlQgT1IgT1RIRVJXSVNFLCBBUklTSU5HIEZST00sXHJcbiBPVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRSBTT0ZUV0FSRSBPUiBUSEUgVVNFIE9SIE9USEVSIERFQUxJTkdTIElOXHJcbiBUSEUgU09GVFdBUkUuXHJcbiAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqL1xyXG5cclxudmFyIENhbWVyYSA9IHJlcXVpcmUoJy4uL2NhbWVyYS9DQ0NhbWVyYScpO1xyXG52YXIgQ29tcG9uZW50ID0gcmVxdWlyZSgnLi9DQ0NvbXBvbmVudCcpO1xyXG5cclxuLy8gU2NyZWVuIGFkYXB0YXRpb24gc3RyYXRlZ3kgZm9yIENhbnZhcyArIFdpZGdldFxyXG5mdW5jdGlvbiByZXNldFdpZGdldENvbXBvbmVudCAoY2FudmFzKSB7XHJcbiAgICBsZXQgd2lkZ2V0ID0gY2FudmFzLm5vZGUuZ2V0Q29tcG9uZW50KGNjLldpZGdldCk7XHJcbiAgICBpZiAoIXdpZGdldCkge1xyXG4gICAgICAgIHdpZGdldCA9IGNhbnZhcy5ub2RlLmFkZENvbXBvbmVudChjYy5XaWRnZXQpO1xyXG4gICAgfVxyXG4gICAgd2lkZ2V0LmlzQWxpZ25Ub3AgPSB0cnVlO1xyXG4gICAgd2lkZ2V0LmlzQWxpZ25Cb3R0b20gPSB0cnVlO1xyXG4gICAgd2lkZ2V0LmlzQWxpZ25MZWZ0ID0gdHJ1ZTtcclxuICAgIHdpZGdldC5pc0FsaWduUmlnaHQgPSB0cnVlO1xyXG4gICAgd2lkZ2V0LnRvcCA9IDA7XHJcbiAgICB3aWRnZXQuYm90dG9tID0gMDtcclxuICAgIHdpZGdldC5sZWZ0ID0gMDtcclxuICAgIHdpZGdldC5yaWdodCA9IDA7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiAhI3poIOS9nOS4uiBVSSDmoLnoioLngrnvvIzkuLrmiYDmnInlrZDoioLngrnmj5Dkvpvop4bnqpflm5vovrnnmoTkvY3nva7kv6Hmga/ku6Xkvpvlr7npvZDvvIzlj6blpJbmj5DkvpvlsY/luZXpgILphY3nrZbnlaXmjqXlj6PvvIzmlrnkvr/ku47nvJbovpHlmajorr7nva7jgII8YnI+XHJcbiAqIOazqO+8mueUseS6juacrOiKgueCueeahOWwuuWvuOS8mui3n+maj+Wxj+W5leaLieS8uO+8jOaJgOS7pSBhbmNob3JQb2ludCDlj6rmlK/mjIEgKDAuNSwgMC41Ke+8jOWQpuWImemAgumFjeS4jeWQjOWxj+W5leaXtuWdkOagh+S8muacieWBj+W3ruOAglxyXG4gKlxyXG4gKiBAY2xhc3MgQ2FudmFzXHJcbiAqIEBleHRlbmRzIENvbXBvbmVudFxyXG4gKi9cclxudmFyIENhbnZhcyA9IGNjLkNsYXNzKHtcclxuICAgIG5hbWU6ICdjYy5DYW52YXMnLFxyXG4gICAgZXh0ZW5kczogQ29tcG9uZW50LFxyXG5cclxuICAgIGVkaXRvcjogQ0NfRURJVE9SICYmIHtcclxuICAgICAgICBtZW51OiAnaTE4bjpNQUlOX01FTlUuY29tcG9uZW50LnVpL0NhbnZhcycsXHJcbiAgICAgICAgaGVscDogJ2kxOG46Q09NUE9ORU5ULmhlbHBfdXJsLmNhbnZhcycsXHJcbiAgICAgICAgZXhlY3V0ZUluRWRpdE1vZGU6IHRydWUsXHJcbiAgICAgICAgZGlzYWxsb3dNdWx0aXBsZTogdHJ1ZSxcclxuICAgIH0sXHJcblxyXG4gICAgcmVzZXRJbkVkaXRvcjogQ0NfRURJVE9SICYmIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBfU2NlbmUuX2FwcGx5Q2FudmFzUHJlZmVyZW5jZXModGhpcyk7XHJcbiAgICAgICAgcmVzZXRXaWRnZXRDb21wb25lbnQodGhpcyk7XHJcbiAgICB9LFxyXG5cclxuICAgIHN0YXRpY3M6IHtcclxuICAgICAgICAvKipcclxuICAgICAgICAgKiAhI2VuIEN1cnJlbnQgYWN0aXZlIGNhbnZhcywgdGhlIHNjZW5lIHNob3VsZCBvbmx5IGhhdmUgb25lIGFjdGl2ZSBjYW52YXMgYXQgdGhlIHNhbWUgdGltZS5cclxuICAgICAgICAgKiAhI3poIOW9k+WJjea/gOa0u+eahOeUu+W4g+e7hOS7tu+8jOWcuuaZr+WQjOS4gOaXtumXtOWPquiDveacieS4gOS4qua/gOa0u+eahOeUu+W4g+OAglxyXG4gICAgICAgICAqIEBwcm9wZXJ0eSB7Q2FudmFzfSBpbnN0YW5jZVxyXG4gICAgICAgICAqIEBzdGF0aWNcclxuICAgICAgICAgKi9cclxuICAgICAgICBpbnN0YW5jZTogbnVsbFxyXG4gICAgfSxcclxuXHJcbiAgICBwcm9wZXJ0aWVzOiB7XHJcblxyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqICEjZW4gVGhlIGRlc2lnaW4gcmVzb2x1dGlvbiBmb3IgY3VycmVudCBzY2VuZS5cclxuICAgICAgICAgKiAhI3poIOW9k+WJjeWcuuaZr+iuvuiuoeWIhui+qOeOh+OAglxyXG4gICAgICAgICAqIEBwcm9wZXJ0eSB7U2l6ZX0gZGVzaWduUmVzb2x1dGlvblxyXG4gICAgICAgICAqIEBkZWZhdWx0IG5ldyBjYy5TaXplKDk2MCwgNjQwKVxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIF9kZXNpZ25SZXNvbHV0aW9uOiBjYy5zaXplKDk2MCwgNjQwKSxcclxuICAgICAgICBkZXNpZ25SZXNvbHV0aW9uOiB7XHJcbiAgICAgICAgICAgIGdldDogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGNjLnNpemUodGhpcy5fZGVzaWduUmVzb2x1dGlvbik7XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIHNldDogZnVuY3Rpb24gKHZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9kZXNpZ25SZXNvbHV0aW9uLndpZHRoID0gdmFsdWUud2lkdGg7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9kZXNpZ25SZXNvbHV0aW9uLmhlaWdodCA9IHZhbHVlLmhlaWdodDtcclxuICAgICAgICAgICAgICAgIHRoaXMuYXBwbHlTZXR0aW5ncygpO1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICB0b29sdGlwOiBDQ19ERVYgJiYgJ2kxOG46Q09NUE9ORU5ULmNhbnZhcy5kZXNpZ25fcmVzb2x1dGlvbidcclxuICAgICAgICB9LFxyXG5cclxuICAgICAgICBfZml0V2lkdGg6IGZhbHNlLFxyXG4gICAgICAgIF9maXRIZWlnaHQ6IHRydWUsXHJcblxyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqICEjZW4gVE9ET1xyXG4gICAgICAgICAqICEjemg6IOaYr+WQpuS8mOWFiOWwhuiuvuiuoeWIhui+qOeOh+mrmOW6puaSkea7oeinhuWbvumrmOW6puOAglxyXG4gICAgICAgICAqIEBwcm9wZXJ0eSB7Qm9vbGVhbn0gZml0SGVpZ2h0XHJcbiAgICAgICAgICogQGRlZmF1bHQgZmFsc2VcclxuICAgICAgICAgKi9cclxuICAgICAgICBmaXRIZWlnaHQ6IHtcclxuICAgICAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fZml0SGVpZ2h0O1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBzZXQ6IGZ1bmN0aW9uICh2YWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuX2ZpdEhlaWdodCAhPT0gdmFsdWUpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLl9maXRIZWlnaHQgPSB2YWx1ZTtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmFwcGx5U2V0dGluZ3MoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgdG9vbHRpcDogQ0NfREVWICYmICdpMThuOkNPTVBPTkVOVC5jYW52YXMuZml0X2hlaWdodCdcclxuICAgICAgICB9LFxyXG5cclxuICAgICAgICAvKipcclxuICAgICAgICAgKiAhI2VuIFRPRE9cclxuICAgICAgICAgKiAhI3poOiDmmK/lkKbkvJjlhYjlsIborr7orqHliIbovqjnjoflrr3luqbmkpHmu6Hop4blm77lrr3luqbjgIJcclxuICAgICAgICAgKiBAcHJvcGVydHkge0Jvb2xlYW59IGZpdFdpZHRoXHJcbiAgICAgICAgICogQGRlZmF1bHQgZmFsc2VcclxuICAgICAgICAgKi9cclxuICAgICAgICBmaXRXaWR0aDoge1xyXG4gICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9maXRXaWR0aDtcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgc2V0OiBmdW5jdGlvbiAodmFsdWUpIHtcclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLl9maXRXaWR0aCAhPT0gdmFsdWUpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLl9maXRXaWR0aCA9IHZhbHVlO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuYXBwbHlTZXR0aW5ncygpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICB0b29sdGlwOiBDQ19ERVYgJiYgJ2kxOG46Q09NUE9ORU5ULmNhbnZhcy5maXRfd2lkdGgnXHJcbiAgICAgICAgfVxyXG4gICAgfSxcclxuXHJcbiAgICAvLyBmaXQgY2FudmFzIG5vZGUgdG8gZGVzaWduIHJlc29sdXRpb25cclxuICAgIF9maXREZXNpZ25SZXNvbHV0aW9uOiBDQ19FRElUT1IgJiYgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIC8vIFRPRE86IHN1cHBvcnQgcGFkZGluZ3Mgb2YgbG9ja2VkIHdpZGdldFxyXG4gICAgICAgIHZhciBkZXNpZ25TaXplID0gY2MuZW5naW5lLmdldERlc2lnblJlc29sdXRpb25TaXplKCk7XHJcbiAgICAgICAgdGhpcy5ub2RlLnNldFBvc2l0aW9uKGRlc2lnblNpemUud2lkdGggKiAwLjUsIGRlc2lnblNpemUuaGVpZ2h0ICogMC41KTtcclxuICAgICAgICB0aGlzLm5vZGUuc2V0Q29udGVudFNpemUoZGVzaWduU2l6ZSk7XHJcbiAgICB9LFxyXG5cclxuICAgIF9fcHJlbG9hZDogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIGlmIChDQ19ERVYpIHtcclxuICAgICAgICAgICAgdmFyIEZsYWdzID0gY2MuT2JqZWN0LkZsYWdzO1xyXG4gICAgICAgICAgICB0aGlzLl9vYmpGbGFncyB8PSAoRmxhZ3MuSXNQb3NpdGlvbkxvY2tlZCB8IEZsYWdzLklzQW5jaG9yTG9ja2VkIHwgRmxhZ3MuSXNTaXplTG9ja2VkKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmIChDYW52YXMuaW5zdGFuY2UpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGNjLndhcm5JRCg2NzAwLFxyXG4gICAgICAgICAgICAgICAgdGhpcy5ub2RlLm5hbWUsIENhbnZhcy5pbnN0YW5jZS5ub2RlLm5hbWUpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBDYW52YXMuaW5zdGFuY2UgPSB0aGlzO1xyXG5cclxuICAgICAgICAvLyBBbGlnbiBub2RlIHRvIGZpdCB0aGUgc2NyZWVuXHJcbiAgICAgICAgdGhpcy5hcHBseVNldHRpbmdzKCk7XHJcblxyXG4gICAgICAgIC8vIFN0cmV0Y2ggdG8gbWF0Y2hlZCBzaXplIGR1cmluZyB0aGUgc2NlbmUgaW5pdGlhbGl6YXRpb25cclxuICAgICAgICBsZXQgd2lkZ2V0ID0gdGhpcy5nZXRDb21wb25lbnQoY2MuV2lkZ2V0KTtcclxuICAgICAgICBpZiAod2lkZ2V0KSB7XHJcbiAgICAgICAgICAgIHdpZGdldC51cGRhdGVBbGlnbm1lbnQoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSBpZiAoQ0NfRURJVE9SKSB7XHJcbiAgICAgICAgICAgIHRoaXMuX2ZpdERlc2lnblJlc29sdXRpb24oKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIENvbnN0YW50bHkgYWxpZ24gY2FudmFzIG5vZGUgaW4gZWRpdCBtb2RlXHJcbiAgICAgICAgaWYgKENDX0VESVRPUikge1xyXG4gICAgICAgICAgICBjYy5kaXJlY3Rvci5vbihjYy5EaXJlY3Rvci5FVkVOVF9BRlRFUl9VUERBVEUsIHRoaXMuX2ZpdERlc2lnblJlc29sdXRpb24sIHRoaXMpO1xyXG4gICAgICAgICAgICBjYy5lbmdpbmUub24oJ2Rlc2lnbi1yZXNvbHV0aW9uLWNoYW5nZWQnLCB0aGlzLl9maXREZXNpZ25SZXNvbHV0aW9uLCB0aGlzKTtcclxuICAgICAgICB9XHJcbiAgICB9LFxyXG5cclxuICAgIHN0YXJ0ICgpIHtcclxuICAgICAgICBpZiAoIUNhbWVyYS5tYWluICYmIGNjLmdhbWUucmVuZGVyVHlwZSAhPT0gY2MuZ2FtZS5SRU5ERVJfVFlQRV9DQU5WQVMpIHtcclxuICAgICAgICAgICAgLy8gQ3JlYXRlIGRlZmF1bHQgTWFpbiBDYW1lcmFcclxuICAgICAgICAgICAgbGV0IGNhbWVyYU5vZGUgPSBuZXcgY2MuTm9kZSgnTWFpbiBDYW1lcmEnKTtcclxuICAgICAgICAgICAgY2FtZXJhTm9kZS5wYXJlbnQgPSB0aGlzLm5vZGU7XHJcbiAgICAgICAgICAgIGNhbWVyYU5vZGUuc2V0U2libGluZ0luZGV4KDApO1xyXG5cclxuICAgICAgICAgICAgbGV0IGNhbWVyYSA9IGNhbWVyYU5vZGUuYWRkQ29tcG9uZW50KENhbWVyYSk7XHJcbiAgICAgICAgICAgIGxldCBDbGVhckZsYWdzID0gQ2FtZXJhLkNsZWFyRmxhZ3M7XHJcbiAgICAgICAgICAgIGNhbWVyYS5jbGVhckZsYWdzID0gQ2xlYXJGbGFncy5DT0xPUiB8IENsZWFyRmxhZ3MuREVQVEggfCBDbGVhckZsYWdzLlNURU5DSUw7XHJcbiAgICAgICAgICAgIGNhbWVyYS5kZXB0aCA9IC0xO1xyXG4gICAgICAgIH1cclxuICAgIH0sXHJcblxyXG4gICAgb25EZXN0cm95OiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgaWYgKENDX0VESVRPUikge1xyXG4gICAgICAgICAgICBjYy5kaXJlY3Rvci5vZmYoY2MuRGlyZWN0b3IuRVZFTlRfQUZURVJfVVBEQVRFLCB0aGlzLl9maXREZXNpZ25SZXNvbHV0aW9uLCB0aGlzKTtcclxuICAgICAgICAgICAgY2MuZW5naW5lLm9mZignZGVzaWduLXJlc29sdXRpb24tY2hhbmdlZCcsIHRoaXMuX2ZpdERlc2lnblJlc29sdXRpb24sIHRoaXMpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKENhbnZhcy5pbnN0YW5jZSA9PT0gdGhpcykge1xyXG4gICAgICAgICAgICBDYW52YXMuaW5zdGFuY2UgPSBudWxsO1xyXG4gICAgICAgIH1cclxuICAgIH0sXHJcblxyXG4gICAgYXBwbHlTZXR0aW5nczogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHZhciBSZXNvbHV0aW9uUG9saWN5ID0gY2MuUmVzb2x1dGlvblBvbGljeTtcclxuICAgICAgICB2YXIgcG9saWN5O1xyXG5cclxuICAgICAgICBpZiAodGhpcy5maXRIZWlnaHQgJiYgdGhpcy5maXRXaWR0aCkge1xyXG4gICAgICAgICAgICBwb2xpY3kgPSBSZXNvbHV0aW9uUG9saWN5LlNIT1dfQUxMO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIGlmICghdGhpcy5maXRIZWlnaHQgJiYgIXRoaXMuZml0V2lkdGgpIHtcclxuICAgICAgICAgICAgcG9saWN5ID0gUmVzb2x1dGlvblBvbGljeS5OT19CT1JERVI7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2UgaWYgKHRoaXMuZml0V2lkdGgpIHtcclxuICAgICAgICAgICAgcG9saWN5ID0gUmVzb2x1dGlvblBvbGljeS5GSVhFRF9XSURUSDtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7ICAgICAgLy8gZml0SGVpZ2h0XHJcbiAgICAgICAgICAgIHBvbGljeSA9IFJlc29sdXRpb25Qb2xpY3kuRklYRURfSEVJR0hUO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdmFyIGRlc2lnblJlcyA9IHRoaXMuX2Rlc2lnblJlc29sdXRpb247XHJcbiAgICAgICAgaWYgKENDX0VESVRPUikge1xyXG4gICAgICAgICAgICBjYy5lbmdpbmUuc2V0RGVzaWduUmVzb2x1dGlvblNpemUoZGVzaWduUmVzLndpZHRoLCBkZXNpZ25SZXMuaGVpZ2h0KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIGNjLnZpZXcuc2V0RGVzaWduUmVzb2x1dGlvblNpemUoZGVzaWduUmVzLndpZHRoLCBkZXNpZ25SZXMuaGVpZ2h0LCBwb2xpY3kpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufSk7XHJcblxyXG5cclxuY2MuQ2FudmFzID0gbW9kdWxlLmV4cG9ydHMgPSBDYW52YXM7XHJcbiJdLCJzb3VyY2VSb290IjoiLyJ9