
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'engine-dev/cocos2d/core/platform/CCSAXParser.js';
                    var __require = nodeEnv ? function (request) {
                        return require(request);
                    } : function (request) {
                        return __quick_compile_engine__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_engine__.registerModule(__filename, module);}"use strict";

/****************************************************************************
 Copyright (c) 2008-2010 Ricardo Quesada
 Copyright (c) 2011-2012 cocos2d-x.org
 Copyright (c) 2013-2016 Chukong Technologies Inc.
 Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.

 http://www.cocos2d-x.org

 Permission is hereby granted, free of charge, to any person obtaining a copy
 of this software and associated documentation files (the "Software"), to deal
 in the Software without restriction, including without limitation the rights
 to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 copies of the Software, and to permit persons to whom the Software is
 furnished to do so, subject to the following conditions:

 The above copyright notice and this permission notice shall be included in
 all copies or substantial portions of the Software.

 THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 THE SOFTWARE.
 ****************************************************************************/
var js = require('../platform/js');
/**
 * A SAX Parser
 * @class saxParser
 */


cc.SAXParser = function () {
  if (!(CC_EDITOR && Editor.isMainProcess) && window.DOMParser) {
    this._isSupportDOMParser = true;
    this._parser = new DOMParser();
  } else {
    this._isSupportDOMParser = false;
    this._parser = null;
  }
};

cc.SAXParser.prototype = {
  constructor: cc.SAXParser,

  /**
   * @method parse
   * @param {String} xmlTxt
   * @return {Document}
   */
  parse: function parse(xmlTxt) {
    return this._parseXML(xmlTxt);
  },
  _parseXML: function _parseXML(textxml) {
    // get a reference to the requested corresponding xml file
    var xmlDoc;

    if (this._isSupportDOMParser) {
      xmlDoc = this._parser.parseFromString(textxml, "text/xml");
    } else {
      // Internet Explorer (untested!)
      xmlDoc = new ActiveXObject("Microsoft.XMLDOM");
      xmlDoc.async = "false";
      xmlDoc.loadXML(textxml);
    }

    return xmlDoc;
  }
};
/**
 *
 * cc.plistParser is a singleton object for parsing plist files
 * @class plistParser
 * @extends SAXParser
 */

cc.PlistParser = function () {
  cc.SAXParser.call(this);
};

js.extend(cc.PlistParser, cc.SAXParser);
js.mixin(cc.PlistParser.prototype, {
  /**
   * parse a xml string as plist object.
   * @param {String} xmlTxt - plist xml contents
   * @return {*} plist object
   */
  parse: function parse(xmlTxt) {
    var xmlDoc = this._parseXML(xmlTxt);

    var plist = xmlDoc.documentElement;

    if (plist.tagName !== 'plist') {
      cc.warnID(5100);
      return {};
    } // Get first real node


    var node = null;

    for (var i = 0, len = plist.childNodes.length; i < len; i++) {
      node = plist.childNodes[i];
      if (node.nodeType === 1) break;
    }

    xmlDoc = null;
    return this._parseNode(node);
  },
  _parseNode: function _parseNode(node) {
    var data = null,
        tagName = node.tagName;

    if (tagName === "dict") {
      data = this._parseDict(node);
    } else if (tagName === "array") {
      data = this._parseArray(node);
    } else if (tagName === "string") {
      if (node.childNodes.length === 1) data = node.firstChild.nodeValue;else {
        //handle Firefox's 4KB nodeValue limit
        data = "";

        for (var i = 0; i < node.childNodes.length; i++) {
          data += node.childNodes[i].nodeValue;
        }
      }
    } else if (tagName === "false") {
      data = false;
    } else if (tagName === "true") {
      data = true;
    } else if (tagName === "real") {
      data = parseFloat(node.firstChild.nodeValue);
    } else if (tagName === "integer") {
      data = parseInt(node.firstChild.nodeValue, 10);
    }

    return data;
  },
  _parseArray: function _parseArray(node) {
    var data = [];

    for (var i = 0, len = node.childNodes.length; i < len; i++) {
      var child = node.childNodes[i];
      if (child.nodeType !== 1) continue;
      data.push(this._parseNode(child));
    }

    return data;
  },
  _parseDict: function _parseDict(node) {
    var data = {};
    var key = null;

    for (var i = 0, len = node.childNodes.length; i < len; i++) {
      var child = node.childNodes[i];
      if (child.nodeType !== 1) continue; // Grab the key, next noe should be the value

      if (child.tagName === 'key') key = child.firstChild.nodeValue;else data[key] = this._parseNode(child); // Parse the value node
    }

    return data;
  }
});
cc.saxParser = new cc.SAXParser();
/**
 * @type {PlistParser}
 * @name plistParser
 * A Plist Parser
 */

cc.plistParser = new cc.PlistParser();
module.exports = {
  saxParser: cc.saxParser,
  plistParser: cc.plistParser
};
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_engine__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImVuZ2luZS1kZXZcXGNvY29zMmRcXGNvcmVcXHBsYXRmb3JtXFxDQ1NBWFBhcnNlci5qcyJdLCJuYW1lcyI6WyJqcyIsInJlcXVpcmUiLCJjYyIsIlNBWFBhcnNlciIsIkNDX0VESVRPUiIsIkVkaXRvciIsImlzTWFpblByb2Nlc3MiLCJ3aW5kb3ciLCJET01QYXJzZXIiLCJfaXNTdXBwb3J0RE9NUGFyc2VyIiwiX3BhcnNlciIsInByb3RvdHlwZSIsImNvbnN0cnVjdG9yIiwicGFyc2UiLCJ4bWxUeHQiLCJfcGFyc2VYTUwiLCJ0ZXh0eG1sIiwieG1sRG9jIiwicGFyc2VGcm9tU3RyaW5nIiwiQWN0aXZlWE9iamVjdCIsImFzeW5jIiwibG9hZFhNTCIsIlBsaXN0UGFyc2VyIiwiY2FsbCIsImV4dGVuZCIsIm1peGluIiwicGxpc3QiLCJkb2N1bWVudEVsZW1lbnQiLCJ0YWdOYW1lIiwid2FybklEIiwibm9kZSIsImkiLCJsZW4iLCJjaGlsZE5vZGVzIiwibGVuZ3RoIiwibm9kZVR5cGUiLCJfcGFyc2VOb2RlIiwiZGF0YSIsIl9wYXJzZURpY3QiLCJfcGFyc2VBcnJheSIsImZpcnN0Q2hpbGQiLCJub2RlVmFsdWUiLCJwYXJzZUZsb2F0IiwicGFyc2VJbnQiLCJjaGlsZCIsInB1c2giLCJrZXkiLCJzYXhQYXJzZXIiLCJwbGlzdFBhcnNlciIsIm1vZHVsZSIsImV4cG9ydHMiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUEsSUFBSUEsRUFBRSxHQUFHQyxPQUFPLENBQUMsZ0JBQUQsQ0FBaEI7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7O0FBQ0FDLEVBQUUsQ0FBQ0MsU0FBSCxHQUFlLFlBQVk7QUFDdkIsTUFBSSxFQUFF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LFdBQU9QLElBQVA7QUFDSDtBQTlFOEIsQ0FBbkM7QUFpRkFuQyxFQUFFLENBQUM2QyxTQUFILEdBQWUsSUFBSTdDLEVBQUUsQ0FBQ0MsU0FBUCxFQUFmO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFDQUQsRUFBRSxDQUFDOEMsV0FBSCxHQUFpQixJQUFJOUMsRUFBRSxDQUFDb0IsV0FBUCxFQUFqQjtBQUVBMkIsTUFBTSxDQUFDQyxPQUFQLEdBQWlCO0FBQ2JILEVBQUFBLFNBQVMsRUFBRTdDLEVBQUUsQ0FBQzZDLFNBREQ7QUFFYkMsRUFBQUEsV0FBVyxFQUFFOUMsRUFBRSxDQUFDOEM7QUFGSCxDQUFqQiIsInNvdXJjZXNDb250ZW50IjpbIi8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqXHJcbiBDb3B5cmlnaHQgKGMpIDIwMDgtMjAxMCBSaWNhcmRvIFF1ZXNhZGFcclxuIENvcHlyaWdodCAoYykgMjAxMS0yMDEyIGNvY29zMmQteC5vcmdcclxuIENvcHlyaWdodCAoYykgMjAxMy0yMDE2IENodWtvbmcgVGVjaG5vbG9naWVzIEluYy5cclxuIENvcHlyaWdodCAoYykgMjAxNy0yMDE4IFhpYW1lbiBZYWppIFNvZnR3YXJlIENvLiwgTHRkLlxyXG5cclxuIGh0dHA6Ly93d3cuY29jb3MyZC14Lm9yZ1xyXG5cclxuIFBlcm1pc3Npb24gaXMgaGVyZWJ5IGdyYW50ZWQsIGZyZWUgb2YgY2hhcmdlLCB0byBhbnkgcGVyc29uIG9idGFpbmluZyBhIGNvcHlcclxuIG9mIHRoaXMgc29mdHdhcmUgYW5kIGFzc29jaWF0ZWQgZG9jdW1lbnRhdGlvbiBmaWxlcyAodGhlIFwiU29mdHdhcmVcIiksIHRvIGRlYWxcclxuIGluIHRoZSBTb2Z0d2FyZSB3aXRob3V0IHJlc3RyaWN0aW9uLCBpbmNsdWRpbmcgd2l0aG91dCBsaW1pdGF0aW9uIHRoZSByaWdodHNcclxuIHRvIHVzZSwgY29weSwgbW9kaWZ5LCBtZXJnZSwgcHVibGlzaCwgZGlzdHJpYnV0ZSwgc3VibGljZW5zZSwgYW5kL29yIHNlbGxcclxuIGNvcGllcyBvZiB0aGUgU29mdHdhcmUsIGFuZCB0byBwZXJtaXQgcGVyc29ucyB0byB3aG9tIHRoZSBTb2Z0d2FyZSBpc1xyXG4gZnVybmlzaGVkIHRvIGRvIHNvLCBzdWJqZWN0IHRvIHRoZSBmb2xsb3dpbmcgY29uZGl0aW9uczpcclxuXHJcbiBUaGUgYWJvdmUgY29weXJpZ2h0IG5vdGljZSBhbmQgdGhpcyBwZXJtaXNzaW9uIG5vdGljZSBzaGFsbCBiZSBpbmNsdWRlZCBpblxyXG4gYWxsIGNvcGllcyBvciBzdWJzdGFudGlhbCBwb3J0aW9ucyBvZiB0aGUgU29mdHdhcmUuXHJcblxyXG4gVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEIFwiQVMgSVNcIiwgV0lUSE9VVCBXQVJSQU5UWSBPRiBBTlkgS0lORCwgRVhQUkVTUyBPUlxyXG4gSU1QTElFRCwgSU5DTFVESU5HIEJVVCBOT1QgTElNSVRFRCBUTyBUSEUgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFksXHJcbiBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBTkQgTk9OSU5GUklOR0VNRU5ULiBJTiBOTyBFVkVOVCBTSEFMTCBUSEVcclxuIEFVVEhPUlMgT1IgQ09QWVJJR0hUIEhPTERFUlMgQkUgTElBQkxFIEZPUiBBTlkgQ0xBSU0sIERBTUFHRVMgT1IgT1RIRVJcclxuIExJQUJJTElUWSwgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIFRPUlQgT1IgT1RIRVJXSVNFLCBBUklTSU5HIEZST00sXHJcbiBPVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRSBTT0ZUV0FSRSBPUiBUSEUgVVNFIE9SIE9USEVSIERFQUxJTkdTIElOXHJcbiBUSEUgU09GVFdBUkUuXHJcbiAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqL1xyXG5cclxudmFyIGpzID0gcmVxdWlyZSgnLi4vcGxhdGZvcm0vanMnKTtcclxuXHJcbi8qKlxyXG4gKiBBIFNBWCBQYXJzZXJcclxuICogQGNsYXNzIHNheFBhcnNlclxyXG4gKi9cclxuY2MuU0FYUGFyc2VyID0gZnVuY3Rpb24gKCkge1xyXG4gICAgaWYgKCEoQ0NfRURJVE9SICYmIEVkaXRvci5pc01haW5Qcm9jZXNzKSAmJiB3aW5kb3cuRE9NUGFyc2VyKSB7XHJcbiAgICAgICAgdGhpcy5faXNTdXBwb3J0RE9NUGFyc2VyID0gdHJ1ZTtcclxuICAgICAgICB0aGlzLl9wYXJzZXIgPSBuZXcgRE9NUGFyc2VyKCk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAgIHRoaXMuX2lzU3VwcG9ydERPTVBhcnNlciA9IGZhbHNlO1xyXG4gICAgICAgIHRoaXMuX3BhcnNlciA9IG51bGw7XHJcbiAgICB9XHJcbn07XHJcbmNjLlNBWFBhcnNlci5wcm90b3R5cGUgPSB7XHJcbiAgICBjb25zdHJ1Y3RvcjogY2MuU0FYUGFyc2VyLFxyXG4gICAgLyoqXHJcbiAgICAgKiBAbWV0aG9kIHBhcnNlXHJcbiAgICAgKiBAcGFyYW0ge1N0cmluZ30geG1sVHh0XHJcbiAgICAgKiBAcmV0dXJuIHtEb2N1bWVudH1cclxuICAgICAqL1xyXG4gICAgcGFyc2UgOiBmdW5jdGlvbih4bWxUeHQpe1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9wYXJzZVhNTCh4bWxUeHQpO1xyXG4gICAgfSxcclxuXHJcbiAgICBfcGFyc2VYTUw6IGZ1bmN0aW9uICh0ZXh0eG1sKSB7XHJcbiAgICAgICAgLy8gZ2V0IGEgcmVmZXJlbmNlIHRvIHRoZSByZXF1ZXN0ZWQgY29ycmVzcG9uZGluZyB4bWwgZmlsZVxyXG4gICAgICAgIHZhciB4bWxEb2M7XHJcbiAgICAgICAgaWYgKHRoaXMuX2lzU3VwcG9ydERPTVBhcnNlcikge1xyXG4gICAgICAgICAgICB4bWxEb2MgPSB0aGlzLl9wYXJzZXIucGFyc2VGcm9tU3RyaW5nKHRleHR4bWwsIFwidGV4dC94bWxcIik7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgLy8gSW50ZXJuZXQgRXhwbG9yZXIgKHVudGVzdGVkISlcclxuICAgICAgICAgICAgeG1sRG9jID0gbmV3IEFjdGl2ZVhPYmplY3QoXCJNaWNyb3NvZnQuWE1MRE9NXCIpO1xyXG4gICAgICAgICAgICB4bWxEb2MuYXN5bmMgPSBcImZhbHNlXCI7XHJcbiAgICAgICAgICAgIHhtbERvYy5sb2FkWE1MKHRleHR4bWwpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4geG1sRG9jO1xyXG4gICAgfVxyXG59O1xyXG5cclxuLyoqXHJcbiAqXHJcbiAqIGNjLnBsaXN0UGFyc2VyIGlzIGEgc2luZ2xldG9uIG9iamVjdCBmb3IgcGFyc2luZyBwbGlzdCBmaWxlc1xyXG4gKiBAY2xhc3MgcGxpc3RQYXJzZXJcclxuICogQGV4dGVuZHMgU0FYUGFyc2VyXHJcbiAqL1xyXG5jYy5QbGlzdFBhcnNlciA9IGZ1bmN0aW9uICgpIHtcclxuICAgIGNjLlNBWFBhcnNlci5jYWxsKHRoaXMpO1xyXG59O1xyXG5qcy5leHRlbmQoY2MuUGxpc3RQYXJzZXIsIGNjLlNBWFBhcnNlcik7XHJcbmpzLm1peGluKGNjLlBsaXN0UGFyc2VyLnByb3RvdHlwZSwge1xyXG4gICAgLyoqXHJcbiAgICAgKiBwYXJzZSBhIHhtbCBzdHJpbmcgYXMgcGxpc3Qgb2JqZWN0LlxyXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IHhtbFR4dCAtIHBsaXN0IHhtbCBjb250ZW50c1xyXG4gICAgICogQHJldHVybiB7Kn0gcGxpc3Qgb2JqZWN0XHJcbiAgICAgKi9cclxuICAgIHBhcnNlIDogZnVuY3Rpb24gKHhtbFR4dCkge1xyXG4gICAgICAgIHZhciB4bWxEb2MgPSB0aGlzLl9wYXJzZVhNTCh4bWxUeHQpO1xyXG4gICAgICAgIHZhciBwbGlzdCA9IHhtbERvYy5kb2N1bWVudEVsZW1lbnQ7XHJcbiAgICAgICAgaWYgKHBsaXN0LnRhZ05hbWUgIT09ICdwbGlzdCcpIHtcclxuICAgICAgICAgICAgY2Mud2FybklEKDUxMDApO1xyXG4gICAgICAgICAgICByZXR1cm4ge307XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBHZXQgZmlyc3QgcmVhbCBub2RlXHJcbiAgICAgICAgdmFyIG5vZGUgPSBudWxsO1xyXG4gICAgICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSBwbGlzdC5jaGlsZE5vZGVzLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7XHJcbiAgICAgICAgICAgIG5vZGUgPSBwbGlzdC5jaGlsZE5vZGVzW2ldO1xyXG4gICAgICAgICAgICBpZiAobm9kZS5ub2RlVHlwZSA9PT0gMSlcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIH1cclxuICAgICAgICB4bWxEb2MgPSBudWxsO1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9wYXJzZU5vZGUobm9kZSk7XHJcbiAgICB9LFxyXG5cclxuICAgIF9wYXJzZU5vZGU6IGZ1bmN0aW9uIChub2RlKSB7XHJcbiAgICAgICAgdmFyIGRhdGEgPSBudWxsLCB0YWdOYW1lID0gbm9kZS50YWdOYW1lO1xyXG4gICAgICAgIGlmKHRhZ05hbWUgPT09IFwiZGljdFwiKXtcclxuICAgICAgICAgICAgZGF0YSA9IHRoaXMuX3BhcnNlRGljdChub2RlKTtcclxuICAgICAgICB9ZWxzZSBpZih0YWdOYW1lID09PSBcImFycmF5XCIpe1xyXG4gICAgICAgICAgICBkYXRhID0gdGhpcy5fcGFyc2VBcnJheShub2RlKTtcclxuICAgICAgICB9ZWxzZSBpZih0YWdOYW1lID09PSBcInN0cmluZ1wiKXtcclxuICAgICAgICAgICAgaWYgKG5vZGUuY2hpbGROb2Rlcy5sZW5ndGggPT09IDEpXHJcbiAgICAgICAgICAgICAgICBkYXRhID0gbm9kZS5maXJzdENoaWxkLm5vZGVWYWx1ZTtcclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAvL2hhbmRsZSBGaXJlZm94J3MgNEtCIG5vZGVWYWx1ZSBsaW1pdFxyXG4gICAgICAgICAgICAgICAgZGF0YSA9IFwiXCI7XHJcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG5vZGUuY2hpbGROb2Rlcy5sZW5ndGg7IGkrKylcclxuICAgICAgICAgICAgICAgICAgICBkYXRhICs9IG5vZGUuY2hpbGROb2Rlc1tpXS5ub2RlVmFsdWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9ZWxzZSBpZih0YWdOYW1lID09PSBcImZhbHNlXCIpe1xyXG4gICAgICAgICAgICBkYXRhID0gZmFsc2U7XHJcbiAgICAgICAgfWVsc2UgaWYodGFnTmFtZSA9PT0gXCJ0cnVlXCIpe1xyXG4gICAgICAgICAgICBkYXRhID0gdHJ1ZTtcclxuICAgICAgICB9ZWxzZSBpZih0YWdOYW1lID09PSBcInJlYWxcIil7XHJcbiAgICAgICAgICAgIGRhdGEgPSBwYXJzZUZsb2F0KG5vZGUuZmlyc3RDaGlsZC5ub2RlVmFsdWUpO1xyXG4gICAgICAgIH1lbHNlIGlmKHRhZ05hbWUgPT09IFwiaW50ZWdlclwiKXtcclxuICAgICAgICAgICAgZGF0YSA9IHBhcnNlSW50KG5vZGUuZmlyc3RDaGlsZC5ub2RlVmFsdWUsIDEwKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGRhdGE7XHJcbiAgICB9LFxyXG5cclxuICAgIF9wYXJzZUFycmF5OiBmdW5jdGlvbiAobm9kZSkge1xyXG4gICAgICAgIHZhciBkYXRhID0gW107XHJcbiAgICAgICAgZm9yICh2YXIgaSA9IDAsIGxlbiA9IG5vZGUuY2hpbGROb2Rlcy5sZW5ndGg7IGkgPCBsZW47IGkrKykge1xyXG4gICAgICAgICAgICB2YXIgY2hpbGQgPSBub2RlLmNoaWxkTm9kZXNbaV07XHJcbiAgICAgICAgICAgIGlmIChjaGlsZC5ub2RlVHlwZSAhPT0gMSlcclxuICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xyXG4gICAgICAgICAgICBkYXRhLnB1c2godGhpcy5fcGFyc2VOb2RlKGNoaWxkKSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBkYXRhO1xyXG4gICAgfSxcclxuXHJcbiAgICBfcGFyc2VEaWN0OiBmdW5jdGlvbiAobm9kZSkge1xyXG4gICAgICAgIHZhciBkYXRhID0ge307XHJcbiAgICAgICAgdmFyIGtleSA9IG51bGw7XHJcbiAgICAgICAgZm9yICh2YXIgaSA9IDAsIGxlbiA9IG5vZGUuY2hpbGROb2Rlcy5sZW5ndGg7IGkgPCBsZW47IGkrKykge1xyXG4gICAgICAgICAgICB2YXIgY2hpbGQgPSBub2RlLmNoaWxkTm9kZXNbaV07XHJcbiAgICAgICAgICAgIGlmIChjaGlsZC5ub2RlVHlwZSAhPT0gMSlcclxuICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xyXG5cclxuICAgICAgICAgICAgLy8gR3JhYiB0aGUga2V5LCBuZXh0IG5vZSBzaG91bGQgYmUgdGhlIHZhbHVlXHJcbiAgICAgICAgICAgIGlmIChjaGlsZC50YWdOYW1lID09PSAna2V5JylcclxuICAgICAgICAgICAgICAgIGtleSA9IGNoaWxkLmZpcnN0Q2hpbGQubm9kZVZhbHVlO1xyXG4gICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICBkYXRhW2tleV0gPSB0aGlzLl9wYXJzZU5vZGUoY2hpbGQpOyAgICAgICAgICAgICAgICAgLy8gUGFyc2UgdGhlIHZhbHVlIG5vZGVcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGRhdGE7XHJcbiAgICB9XHJcbn0pO1xyXG5cclxuY2Muc2F4UGFyc2VyID0gbmV3IGNjLlNBWFBhcnNlcigpO1xyXG4vKipcclxuICogQHR5cGUge1BsaXN0UGFyc2VyfVxyXG4gKiBAbmFtZSBwbGlzdFBhcnNlclxyXG4gKiBBIFBsaXN0IFBhcnNlclxyXG4gKi9cclxuY2MucGxpc3RQYXJzZXIgPSBuZXcgY2MuUGxpc3RQYXJzZXIoKTtcclxuXHJcbm1vZHVsZS5leHBvcnRzID0ge1xyXG4gICAgc2F4UGFyc2VyOiBjYy5zYXhQYXJzZXIsXHJcbiAgICBwbGlzdFBhcnNlcjogY2MucGxpc3RQYXJzZXJcclxufVxyXG4iXSwic291cmNlUm9vdCI6Ii8ifQ==