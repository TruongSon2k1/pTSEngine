
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'engine-dev/cocos2d/core/platform/CCInputExtension.js';
                    var __require = nodeEnv ? function (request) {
                        return require(request);
                    } : function (request) {
                        return __quick_compile_engine__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_engine__.registerModule(__filename, module);}"use strict";

/****************************************************************************
 Copyright (c) 2011-2012 cocos2d-x.org
 Copyright (c) 2013-2016 Chukong Technologies Inc.
 Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.

 http://www.cocos2d-x.org

 Permission is hereby granted, free of charge, to any person obtaining a copy
 of this software and associated documentation files (the "Software"), to deal
 in the Software without restriction, including without limitation the rights
 to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 copies of the Software, and to permit persons to whom the Software is
 furnished to do so, subject to the following conditions:

 The above copyright notice and this permission notice shall be included in
 all copies or substantial portions of the Software.

 THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 THE SOFTWARE.
 ****************************************************************************/
var eventManager = require('../event-manager');

var inputManager = require("./CCInputManager");

var PORTRAIT = 0;
var LANDSCAPE_LEFT = -90;
var PORTRAIT_UPSIDE_DOWN = 180;
var LANDSCAPE_RIGHT = 90;

var _didAccelerateFun;
/**
 * !#en the device accelerometer reports values for each axis in units of g-force.
 * !#zh 设备重力传感器传递的各个轴的数据。
 * @class Acceleration
 * @method constructor
 * @param {Number} x
 * @param {Number} y
 * @param {Number} z
 * @param {Number} timestamp
 */


cc.Acceleration = function (x, y, z, timestamp) {
  this.x = x || 0;
  this.y = y || 0;
  this.z = z || 0;
  this.timestamp = timestamp || 0;
};
/**
 * whether enable accelerometer event
 * @method setAccelerometerEnabled
 * @param {Boolean} isEnable
 */


inputManager.setAccelerometerEnabled = function (isEnable) {
  var _t = this;

  if (_t._accelEnabled === isEnable) return;
  _t._accelEnabled = isEnable;
  var scheduler = cc.director.getScheduler();
  scheduler.enableForTarget(_t);

  if (_t._accelEnabled) {
    _t._registerAccelerometerEvent();

    _t._accelCurTime = 0;
    scheduler.scheduleUpdate(_t);
  } else {
    _t._unregisterAccelerometerEvent();

    _t._accelCurTime = 0;
    scheduler.unscheduleUpdate(_t);
  }

  if (CC_JSB || CC_RUNTIME) {
    jsb.device.setMotionEnabled(isEnable);
  }
};
/**
 * set accelerometer interval value
 * @method setAccelerometerInterval
 * @param {Number} interval
 */


inputManager.setAccelerometerInterval = function (interval) {
  if (this._accelInterval !== interval) {
    this._accelInterval = interval;

    if (CC_JSB || CC_RUNTIME) {
      jsb.device.setMotionInterval(interval);
    }
  }
};

inputManager._registerKeyboardEvent = function () {
  cc.game.canvas.addEventListener("keydown", function (e) {
    eventManager.dispatchEvent(new cc.Event.EventKeyboard(e.keyCode, true));
    e.stopPropagation();
    e.preventDefault();
  }, false);
  cc.game.canvas.addEventListener("keyup", function (e) {
    eventManager.dispatchEvent(new cc.Event.EventKeyboard(e.keyCode, false));
    e.stopPropagation();
    e.preventDefault();
  }, false);
};

inputManager._registerAccelerometerEvent = function () {
  var w = window,
      _t = this;

  _t._acceleration = new cc.Acceleration();
  _t._accelDeviceEvent = w.DeviceMotionEvent || w.DeviceOrientationEvent; //TODO fix DeviceMotionEvent bug on QQ Browser version 4.1 and below.

  if (cc.sys.browserType === cc.sys.BROWSER_TYPE_MOBILE_QQ) _t._accelDeviceEvent = window.DeviceOrientationEvent;

  var _deviceEventType = _t._accelDeviceEvent === w.DeviceMotionEvent ? "devicemotion" : "deviceorientation";

  var ua = navigator.userAgent;

  if (/Android/.test(ua) || /Adr/.test(ua) && cc.sys.browserType === cc.BROWSER_TYPE_UC) {
    _t._minus = -1;
  }

  _didAccelerateFun = _t.didAccelerate.bind(_t);
  w.addEventListener(_deviceEventType, _didAccelerateFun, false);
};

inputManager._unregisterAccelerometerEvent = function () {
  var w = window,
      _t = this;

  var _deviceEventType = _t._accelDeviceEvent === w.DeviceMotionEvent ? "devicemotion" : "deviceorientation";

  if (_didAccelerateFun) {
    w.removeEventListener(_deviceEventType, _didAccelerateFun, false);
  }
};

inputManager.didAccelerate = function (eventData) {
  var _t = this,
      w = window;

  if (!_t._accelEnabled) return;
  var mAcceleration = _t._acceleration;
  var x, y, z;

  if (_t._accelDeviceEvent === window.DeviceMotionEvent) {
    var eventAcceleration = eventData["accelerationIncludingGravity"];
    x = _t._accelMinus * eventAcceleration.x * 0.1;
    y = _t._accelMinus * eventAcceleration.y * 0.1;
    z = eventAcceleration.z * 0.1;
  } else {
    x = eventData["gamma"] / 90 * 0.981;
    y = -(eventData["beta"] / 90) * 0.981;
    z = eventData["alpha"] / 90 * 0.981;
  }

  if (cc.view._isRotated) {
    var tmp = x;
    x = -y;
    y = tmp;
  }

  mAcceleration.x = x;
  mAcceleration.y = y;
  mAcceleration.z = z;
  mAcceleration.timestamp = eventData.timeStamp || Date.now();
  var tmpX = mAcceleration.x;

  if (w.orientation === LANDSCAPE_RIGHT) {
    mAcceleration.x = -mAcceleration.y;
    mAcceleration.y = tmpX;
  } else if (w.orientation === LANDSCAPE_LEFT) {
    mAcceleration.x = mAcceleration.y;
    mAcceleration.y = -tmpX;
  } else if (w.orientation === PORTRAIT_UPSIDE_DOWN) {
    mAcceleration.x = -mAcceleration.x;
    mAcceleration.y = -mAcceleration.y;
  } // fix android acc values are opposite


  if (cc.sys.os === cc.sys.OS_ANDROID && cc.sys.browserType !== cc.sys.BROWSER_TYPE_MOBILE_QQ) {
    mAcceleration.x = -mAcceleration.x;
    mAcceleration.y = -mAcceleration.y;
  }
};
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_engine__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImVuZ2luZS1kZXZcXGNvY29zMmRcXGNvcmVcXHBsYXRmb3JtXFxDQ0lucHV0RXh0ZW5zaW9uLmpzIl0sIm5hbWVzIjpbImV2ZW50TWFuYWdlciIsInJlcXVpcmUiLCJpbnB1dE1hbmFnZXIiLCJQT1JUUkFJVCIsIkxBTkRTQ0FQRV9MRUZUIiwiUE9SVFJBSVRfVVBTSURFX0RPV04iLCJMQU5EU0NBUEVfUklHSFQiLCJfZGlkQWNjZWxlcmF0ZUZ1biIsImNjIiwiQWNjZWxlcmF0aW9uIiwieCIsInkiLCJ6IiwidGltZXN0YW1wIiwic2V0QWNjZWxlcm9tZXRlckVuYWJsZWQiLCJpc0VuYWJsZSIsIl90IiwiX2FjY2VsRW5hYmxlZCIsInNjaGVkdWxlciIsImRpcmVjdG9yIiwiZ2V0U2NoZWR1bGVyIiwiZW5hYmxlRm9yVGFyZ2V0IiwiX3JlZ2lzdGVyQWNjZWxlcm9tZXRlckV2ZW50IiwiX2FjY2VsQ3VyVGltZSIsInNjaGVkdWxlVXBkYXRlIiwiX3VucmVnaXN0ZXJBY2NlbGVyb21ldGVyRXZlbnQiLCJ1bnNjaGVkdWxlVXBkYXRlIiwiQ0NfSlNCIiwiQ0NfUlVOVElNRSIsImpzYiIsImRldmljZSIsInNldE1vdGlvbkVuYWJsZWQiLCJzZXRBY2NlbGVyb21ldGVySW50ZXJ2YWwiLCJpbnRlcnZhbCIsIl9hY2NlbEludGVydmFsIiwic2V0TW90aW9uSW50ZXJ2YWwiLCJfcmVnaXN0ZXJLZXlib2FyZEV2ZW50IiwiZ2FtZSIsImNhbnZhcyIsImFkZEV2ZW50TGlzdGVuZXIiLCJlIiwiZGlzcGF0Y2hFdmVudCIsIkV2ZW50IiwiRXZlbnRLZXlib2FyZCIsImtleUNvZGUiLCJzdG9wUHJvcGFnYXRpb24iLCJwcmV2ZW50RGVmYXVsdCIsInciLCJ3aW5kb3ciLCJfYWNjZWxlcmF0aW9uIiwiX2FjY2VsRGV2aWNlRXZlbnQiLCJEZXZpY2VNb3Rpb25FdmVudCIsIkRldmljZU9yaWVudGF0aW9uRXZlbnQiLCJzeXMiLCJicm93c2VyVHlwZSIsIkJST1dTRVJfVFlQRV9NT0JJTEVfUVEiLCJfZGV2aWNlRXZlbnRUeXBlIiwidWEiLCJuYXZpZ2F0b3IiLCJ1c2VyQWdlbnQiLCJ0ZXN0IiwiQlJPV1NFUl9UWVBFX1VDIiwiX21pbnVzIiwiZGlkQWNjZWxlcmF0ZSIsImJpbmQiLCJyZW1vdmVFdmVudExpc3RlbmVyIiwiZXZlbnREYXRhIiwibUFjY2VsZXJhdGlvbiIsImV2ZW50QWNjZWxlcmF0aW9uIiwiX2FjY2VsTWludXMiLCJ2aWV3IiwiX2lzUm90YXRlZCIsInRtcCIsInRpbWVTdGFtcCIsIkRhdGUiLCJub3ciLCJ0bXBYIiwib3JpZW50YXRpb24iLCJvcyIsIk9TX0FORFJPSUQiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBLElBQU1BLFlBQVksR0FBR0MsT0FBTyxDQUFDLGtCQUFELENBQTVCOztBQUNBLElBQU1DLFlBQVksR0FBR0QsT0FBTyxDQUFDLGtCQUFELENBQTVCOztBQUVBLElBQU1FLFFBQVEsR0FBRyxDQUFqQjtBQUNBLElBQU1DLGNBQWMsR0FBRyxDQUFDLEVBQXhCO0FBQ0EsSUFBTUMsb0JBQW9CLEdBQUcsR0FBN0I7QUFDQSxJQUFNQyxlQUFlLEdBQUcsRUFBeEI7O0FBRUEsSUFBSUMsaUJBQUo7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBQ0FDLEVBQUUsQ0FBQ0MsWUFBSCxHQUFrQixVQUFVQyxDQUFWLEVBQWFDLENBQWIsRUFBZ0JDLENBQWhCLEVBQW1CQyxTQUFuQixFQUE4QjtBQUM1QyxPQUFLSCxDQUFMLEdBQVNBLENBQUMsSUFBSSxDQUFkO0FBQ0EsT0FBS0MsQ0FBTCxHQUFTQSxDQUFDLElBQUksQ0FBZDtBQUNBLE9BQUtDLENBQUwsR0FBU0EsQ0FB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QUgsQ0FBTzBCLFVBQXJCLElBQ0F2RSxFQUFFLENBQUM2QyxHQUFILENBQU9DLFdBQVAsS0FBdUI5QyxFQUFFLENBQUM2QyxHQUFILENBQU9FLHNCQURsQyxFQUMwRDtBQUN0RFksSUFBQUEsYUFBYSxDQUFDekQsQ0FBZCxHQUFrQixDQUFDeUQsYUFBYSxDQUFDekQsQ0FBakM7QUFDQXlELElBQUFBLGFBQWEsQ0FBQ3hELENBQWQsR0FBa0IsQ0FBQ3dELGFBQWEsQ0FBQ3hELENBQWpDO0FBQ0g7QUFDSixDQWhERCIsInNvdXJjZXNDb250ZW50IjpbIi8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqXHJcbiBDb3B5cmlnaHQgKGMpIDIwMTEtMjAxMiBjb2NvczJkLXgub3JnXHJcbiBDb3B5cmlnaHQgKGMpIDIwMTMtMjAxNiBDaHVrb25nIFRlY2hub2xvZ2llcyBJbmMuXHJcbiBDb3B5cmlnaHQgKGMpIDIwMTctMjAxOCBYaWFtZW4gWWFqaSBTb2Z0d2FyZSBDby4sIEx0ZC5cclxuXHJcbiBodHRwOi8vd3d3LmNvY29zMmQteC5vcmdcclxuXHJcbiBQZXJtaXNzaW9uIGlzIGhlcmVieSBncmFudGVkLCBmcmVlIG9mIGNoYXJnZSwgdG8gYW55IHBlcnNvbiBvYnRhaW5pbmcgYSBjb3B5XHJcbiBvZiB0aGlzIHNvZnR3YXJlIGFuZCBhc3NvY2lhdGVkIGRvY3VtZW50YXRpb24gZmlsZXMgKHRoZSBcIlNvZnR3YXJlXCIpLCB0byBkZWFsXHJcbiBpbiB0aGUgU29mdHdhcmUgd2l0aG91dCByZXN0cmljdGlvbiwgaW5jbHVkaW5nIHdpdGhvdXQgbGltaXRhdGlvbiB0aGUgcmlnaHRzXHJcbiB0byB1c2UsIGNvcHksIG1vZGlmeSwgbWVyZ2UsIHB1Ymxpc2gsIGRpc3RyaWJ1dGUsIHN1YmxpY2Vuc2UsIGFuZC9vciBzZWxsXHJcbiBjb3BpZXMgb2YgdGhlIFNvZnR3YXJlLCBhbmQgdG8gcGVybWl0IHBlcnNvbnMgdG8gd2hvbSB0aGUgU29mdHdhcmUgaXNcclxuIGZ1cm5pc2hlZCB0byBkbyBzbywgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnM6XHJcblxyXG4gVGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UgYW5kIHRoaXMgcGVybWlzc2lvbiBub3RpY2Ugc2hhbGwgYmUgaW5jbHVkZWQgaW5cclxuIGFsbCBjb3BpZXMgb3Igc3Vic3RhbnRpYWwgcG9ydGlvbnMgb2YgdGhlIFNvZnR3YXJlLlxyXG5cclxuIFRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCBcIkFTIElTXCIsIFdJVEhPVVQgV0FSUkFOVFkgT0YgQU5ZIEtJTkQsIEVYUFJFU1MgT1JcclxuIElNUExJRUQsIElOQ0xVRElORyBCVVQgTk9UIExJTUlURUQgVE8gVEhFIFdBUlJBTlRJRVMgT0YgTUVSQ0hBTlRBQklMSVRZLFxyXG4gRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UgQU5EIE5PTklORlJJTkdFTUVOVC4gSU4gTk8gRVZFTlQgU0hBTEwgVEhFXHJcbiBBVVRIT1JTIE9SIENPUFlSSUdIVCBIT0xERVJTIEJFIExJQUJMRSBGT1IgQU5ZIENMQUlNLCBEQU1BR0VTIE9SIE9USEVSXHJcbiBMSUFCSUxJVFksIFdIRVRIRVIgSU4gQU4gQUNUSU9OIE9GIENPTlRSQUNULCBUT1JUIE9SIE9USEVSV0lTRSwgQVJJU0lORyBGUk9NLFxyXG4gT1VUIE9GIE9SIElOIENPTk5FQ1RJT04gV0lUSCBUSEUgU09GVFdBUkUgT1IgVEhFIFVTRSBPUiBPVEhFUiBERUFMSU5HUyBJTlxyXG4gVEhFIFNPRlRXQVJFLlxyXG4gKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi9cclxuXHJcbmNvbnN0IGV2ZW50TWFuYWdlciA9IHJlcXVpcmUoJy4uL2V2ZW50LW1hbmFnZXInKTtcclxuY29uc3QgaW5wdXRNYW5hZ2VyID0gcmVxdWlyZShcIi4vQ0NJbnB1dE1hbmFnZXJcIik7XHJcblxyXG5jb25zdCBQT1JUUkFJVCA9IDA7XHJcbmNvbnN0IExBTkRTQ0FQRV9MRUZUID0gLTkwO1xyXG5jb25zdCBQT1JUUkFJVF9VUFNJREVfRE9XTiA9IDE4MDtcclxuY29uc3QgTEFORFNDQVBFX1JJR0hUID0gOTA7XHJcblxyXG5sZXQgX2RpZEFjY2VsZXJhdGVGdW47XHJcblxyXG4vKipcclxuICogISNlbiB0aGUgZGV2aWNlIGFjY2VsZXJvbWV0ZXIgcmVwb3J0cyB2YWx1ZXMgZm9yIGVhY2ggYXhpcyBpbiB1bml0cyBvZiBnLWZvcmNlLlxyXG4gKiAhI3poIOiuvuWkh+mHjeWKm+S8oOaEn+WZqOS8oOmAkueahOWQhOS4qui9tOeahOaVsOaNruOAglxyXG4gKiBAY2xhc3MgQWNjZWxlcmF0aW9uXHJcbiAqIEBtZXRob2QgY29uc3RydWN0b3JcclxuICogQHBhcmFtIHtOdW1iZXJ9IHhcclxuICogQHBhcmFtIHtOdW1iZXJ9IHlcclxuICogQHBhcmFtIHtOdW1iZXJ9IHpcclxuICogQHBhcmFtIHtOdW1iZXJ9IHRpbWVzdGFtcFxyXG4gKi9cclxuY2MuQWNjZWxlcmF0aW9uID0gZnVuY3Rpb24gKHgsIHksIHosIHRpbWVzdGFtcCkge1xyXG4gICAgdGhpcy54ID0geCB8fCAwO1xyXG4gICAgdGhpcy55ID0geSB8fCAwO1xyXG4gICAgdGhpcy56ID0geiB8fCAwO1xyXG4gICAgdGhpcy50aW1lc3RhbXAgPSB0aW1lc3RhbXAgfHwgMDtcclxufTtcclxuXHJcbi8qKlxyXG4gKiB3aGV0aGVyIGVuYWJsZSBhY2NlbGVyb21ldGVyIGV2ZW50XHJcbiAqIEBtZXRob2Qgc2V0QWNjZWxlcm9tZXRlckVuYWJsZWRcclxuICogQHBhcmFtIHtCb29sZWFufSBpc0VuYWJsZVxyXG4gKi9cclxuaW5wdXRNYW5hZ2VyLnNldEFjY2VsZXJvbWV0ZXJFbmFibGVkID0gZnVuY3Rpb24gKGlzRW5hYmxlKSB7XHJcbiAgICBsZXQgX3QgPSB0aGlzO1xyXG4gICAgaWYoX3QuX2FjY2VsRW5hYmxlZCA9PT0gaXNFbmFibGUpXHJcbiAgICAgICAgcmV0dXJuO1xyXG5cclxuICAgIF90Ll9hY2NlbEVuYWJsZWQgPSBpc0VuYWJsZTtcclxuICAgIGxldCBzY2hlZHVsZXIgPSBjYy5kaXJlY3Rvci5nZXRTY2hlZHVsZXIoKTtcclxuICAgIHNjaGVkdWxlci5lbmFibGVGb3JUYXJnZXQoX3QpO1xyXG4gICAgaWYgKF90Ll9hY2NlbEVuYWJsZWQpIHtcclxuICAgICAgICBfdC5fcmVnaXN0ZXJBY2NlbGVyb21ldGVyRXZlbnQoKTtcclxuICAgICAgICBfdC5fYWNjZWxDdXJUaW1lID0gMDtcclxuICAgICAgICBzY2hlZHVsZXIuc2NoZWR1bGVVcGRhdGUoX3QpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgICBfdC5fdW5yZWdpc3RlckFjY2VsZXJvbWV0ZXJFdmVudCgpO1xyXG4gICAgICAgIF90Ll9hY2NlbEN1clRpbWUgPSAwO1xyXG4gICAgICAgIHNjaGVkdWxlci51bnNjaGVkdWxlVXBkYXRlKF90KTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAoQ0NfSlNCIHx8IENDX1JVTlRJTUUpIHtcclxuICAgICAgICBqc2IuZGV2aWNlLnNldE1vdGlvbkVuYWJsZWQoaXNFbmFibGUpO1xyXG4gICAgfVxyXG59O1xyXG5cclxuLyoqXHJcbiAqIHNldCBhY2NlbGVyb21ldGVyIGludGVydmFsIHZhbHVlXHJcbiAqIEBtZXRob2Qgc2V0QWNjZWxlcm9tZXRlckludGVydmFsXHJcbiAqIEBwYXJhbSB7TnVtYmVyfSBpbnRlcnZhbFxyXG4gKi9cclxuaW5wdXRNYW5hZ2VyLnNldEFjY2VsZXJvbWV0ZXJJbnRlcnZhbCA9IGZ1bmN0aW9uIChpbnRlcnZhbCkge1xyXG4gICAgaWYgKHRoaXMuX2FjY2VsSW50ZXJ2YWwgIT09IGludGVydmFsKSB7XHJcbiAgICAgICAgdGhpcy5fYWNjZWxJbnRlcnZhbCA9IGludGVydmFsO1xyXG5cclxuICAgICAgICBpZiAoQ0NfSlNCIHx8IENDX1JVTlRJTUUpIHtcclxuICAgICAgICAgICAganNiLmRldmljZS5zZXRNb3Rpb25JbnRlcnZhbChpbnRlcnZhbCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59O1xyXG5cclxuaW5wdXRNYW5hZ2VyLl9yZWdpc3RlcktleWJvYXJkRXZlbnQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICBjYy5nYW1lLmNhbnZhcy5hZGRFdmVudExpc3RlbmVyKFwia2V5ZG93blwiLCBmdW5jdGlvbiAoZSkge1xyXG4gICAgICAgIGV2ZW50TWFuYWdlci5kaXNwYXRjaEV2ZW50KG5ldyBjYy5FdmVudC5FdmVudEtleWJvYXJkKGUua2V5Q29kZSwgdHJ1ZSkpO1xyXG4gICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XHJcbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgfSwgZmFsc2UpO1xyXG4gICAgY2MuZ2FtZS5jYW52YXMuYWRkRXZlbnRMaXN0ZW5lcihcImtleXVwXCIsIGZ1bmN0aW9uIChlKSB7XHJcbiAgICAgICAgZXZlbnRNYW5hZ2VyLmRpc3BhdGNoRXZlbnQobmV3IGNjLkV2ZW50LkV2ZW50S2V5Ym9hcmQoZS5rZXlDb2RlLCBmYWxzZSkpO1xyXG4gICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XHJcbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgfSwgZmFsc2UpO1xyXG59O1xyXG5cclxuaW5wdXRNYW5hZ2VyLl9yZWdpc3RlckFjY2VsZXJvbWV0ZXJFdmVudCA9IGZ1bmN0aW9uICgpIHtcclxuICAgIGxldCB3ID0gd2luZG93LCBfdCA9IHRoaXM7XHJcbiAgICBfdC5fYWNjZWxlcmF0aW9uID0gbmV3IGNjLkFjY2VsZXJhdGlvbigpO1xyXG4gICAgX3QuX2FjY2VsRGV2aWNlRXZlbnQgPSB3LkRldmljZU1vdGlvbkV2ZW50IHx8IHcuRGV2aWNlT3JpZW50YXRpb25FdmVudDtcclxuXHJcbiAgICAvL1RPRE8gZml4IERldmljZU1vdGlvbkV2ZW50IGJ1ZyBvbiBRUSBCcm93c2VyIHZlcnNpb24gNC4xIGFuZCBiZWxvdy5cclxuICAgIGlmIChjYy5zeXMuYnJvd3NlclR5cGUgPT09IGNjLnN5cy5CUk9XU0VSX1RZUEVfTU9CSUxFX1FRKVxyXG4gICAgICAgIF90Ll9hY2NlbERldmljZUV2ZW50ID0gd2luZG93LkRldmljZU9yaWVudGF0aW9uRXZlbnQ7XHJcblxyXG4gICAgbGV0IF9kZXZpY2VFdmVudFR5cGUgPSAoX3QuX2FjY2VsRGV2aWNlRXZlbnQgPT09IHcuRGV2aWNlTW90aW9uRXZlbnQpID8gXCJkZXZpY2Vtb3Rpb25cIiA6IFwiZGV2aWNlb3JpZW50YXRpb25cIjtcclxuICAgIGxldCB1YSA9IG5hdmlnYXRvci51c2VyQWdlbnQ7XHJcbiAgICBpZiAoL0FuZHJvaWQvLnRlc3QodWEpIHx8ICgvQWRyLy50ZXN0KHVhKSAmJiBjYy5zeXMuYnJvd3NlclR5cGUgPT09IGNjLkJST1dTRVJfVFlQRV9VQykpIHtcclxuICAgICAgICBfdC5fbWludXMgPSAtMTtcclxuICAgIH1cclxuXHJcbiAgICBfZGlkQWNjZWxlcmF0ZUZ1biA9IF90LmRpZEFjY2VsZXJhdGUuYmluZChfdCk7XHJcbiAgICB3LmFkZEV2ZW50TGlzdGVuZXIoX2RldmljZUV2ZW50VHlwZSwgX2RpZEFjY2VsZXJhdGVGdW4sIGZhbHNlKTtcclxufTtcclxuXHJcbmlucHV0TWFuYWdlci5fdW5yZWdpc3RlckFjY2VsZXJvbWV0ZXJFdmVudCA9IGZ1bmN0aW9uICgpIHtcclxuICAgIGxldCB3ID0gd2luZG93LCBfdCA9IHRoaXM7XHJcbiAgICBsZXQgX2RldmljZUV2ZW50VHlwZSA9IChfdC5fYWNjZWxEZXZpY2VFdmVudCA9PT0gdy5EZXZpY2VNb3Rpb25FdmVudCkgPyBcImRldmljZW1vdGlvblwiIDogXCJkZXZpY2VvcmllbnRhdGlvblwiO1xyXG4gICAgaWYgKF9kaWRBY2NlbGVyYXRlRnVuKSB7XHJcbiAgICAgICAgdy5yZW1vdmVFdmVudExpc3RlbmVyKF9kZXZpY2VFdmVudFR5cGUsIF9kaWRBY2NlbGVyYXRlRnVuLCBmYWxzZSk7XHJcbiAgICB9XHJcbn07XHJcblxyXG5pbnB1dE1hbmFnZXIuZGlkQWNjZWxlcmF0ZSA9IGZ1bmN0aW9uIChldmVudERhdGEpIHtcclxuICAgIGxldCBfdCA9IHRoaXMsIHcgPSB3aW5kb3c7XHJcbiAgICBpZiAoIV90Ll9hY2NlbEVuYWJsZWQpXHJcbiAgICAgICAgcmV0dXJuO1xyXG5cclxuICAgIGxldCBtQWNjZWxlcmF0aW9uID0gX3QuX2FjY2VsZXJhdGlvbjtcclxuXHJcbiAgICBsZXQgeCwgeSwgejtcclxuXHJcbiAgICBpZiAoX3QuX2FjY2VsRGV2aWNlRXZlbnQgPT09IHdpbmRvdy5EZXZpY2VNb3Rpb25FdmVudCkge1xyXG4gICAgICAgIGxldCBldmVudEFjY2VsZXJhdGlvbiA9IGV2ZW50RGF0YVtcImFjY2VsZXJhdGlvbkluY2x1ZGluZ0dyYXZpdHlcIl07XHJcbiAgICAgICAgeCA9IF90Ll9hY2NlbE1pbnVzICogZXZlbnRBY2NlbGVyYXRpb24ueCAqIDAuMTtcclxuICAgICAgICB5ID0gX3QuX2FjY2VsTWludXMgKiBldmVudEFjY2VsZXJhdGlvbi55ICogMC4xO1xyXG4gICAgICAgIHogPSBldmVudEFjY2VsZXJhdGlvbi56ICogMC4xO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgICB4ID0gKGV2ZW50RGF0YVtcImdhbW1hXCJdIC8gOTApICogMC45ODE7XHJcbiAgICAgICAgeSA9IC0oZXZlbnREYXRhW1wiYmV0YVwiXSAvIDkwKSAqIDAuOTgxO1xyXG4gICAgICAgIHogPSAoZXZlbnREYXRhW1wiYWxwaGFcIl0gLyA5MCkgKiAwLjk4MTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAoY2Mudmlldy5faXNSb3RhdGVkKSB7XHJcbiAgICAgICAgbGV0IHRtcCA9IHg7XHJcbiAgICAgICAgeCA9IC15O1xyXG4gICAgICAgIHkgPSB0bXA7XHJcbiAgICB9XHJcbiAgICBtQWNjZWxlcmF0aW9uLnggPSB4O1xyXG4gICAgbUFjY2VsZXJhdGlvbi55ID0geTtcclxuICAgIG1BY2NlbGVyYXRpb24ueiA9IHo7XHJcblxyXG4gICAgbUFjY2VsZXJhdGlvbi50aW1lc3RhbXAgPSBldmVudERhdGEudGltZVN0YW1wIHx8IERhdGUubm93KCk7XHJcblxyXG4gICAgbGV0IHRtcFggPSBtQWNjZWxlcmF0aW9uLng7XHJcbiAgICBpZiAody5vcmllbnRhdGlvbiA9PT0gTEFORFNDQVBFX1JJR0hUKSB7XHJcbiAgICAgICAgbUFjY2VsZXJhdGlvbi54ID0gLW1BY2NlbGVyYXRpb24ueTtcclxuICAgICAgICBtQWNjZWxlcmF0aW9uLnkgPSB0bXBYO1xyXG4gICAgfSBlbHNlIGlmICh3Lm9yaWVudGF0aW9uID09PSBMQU5EU0NBUEVfTEVGVCkge1xyXG4gICAgICAgIG1BY2NlbGVyYXRpb24ueCA9IG1BY2NlbGVyYXRpb24ueTtcclxuICAgICAgICBtQWNjZWxlcmF0aW9uLnkgPSAtdG1wWDtcclxuICAgIH0gZWxzZSBpZiAody5vcmllbnRhdGlvbiA9PT0gUE9SVFJBSVRfVVBTSURFX0RPV04pIHtcclxuICAgICAgICBtQWNjZWxlcmF0aW9uLnggPSAtbUFjY2VsZXJhdGlvbi54O1xyXG4gICAgICAgIG1BY2NlbGVyYXRpb24ueSA9IC1tQWNjZWxlcmF0aW9uLnk7XHJcbiAgICB9XHJcbiAgICAvLyBmaXggYW5kcm9pZCBhY2MgdmFsdWVzIGFyZSBvcHBvc2l0ZVxyXG4gICAgaWYgKGNjLnN5cy5vcyA9PT0gY2Muc3lzLk9TX0FORFJPSUQgJiZcclxuICAgICAgICBjYy5zeXMuYnJvd3NlclR5cGUgIT09IGNjLnN5cy5CUk9XU0VSX1RZUEVfTU9CSUxFX1FRKSB7XHJcbiAgICAgICAgbUFjY2VsZXJhdGlvbi54ID0gLW1BY2NlbGVyYXRpb24ueDtcclxuICAgICAgICBtQWNjZWxlcmF0aW9uLnkgPSAtbUFjY2VsZXJhdGlvbi55O1xyXG4gICAgfVxyXG59OyJdLCJzb3VyY2VSb290IjoiLyJ9