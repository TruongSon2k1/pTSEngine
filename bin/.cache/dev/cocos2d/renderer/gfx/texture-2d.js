
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'engine-dev/cocos2d/renderer/gfx/texture-2d.js';
                    var __require = nodeEnv ? function (request) {
                        return require(request);
                    } : function (request) {
                        return __quick_compile_engine__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_engine__.registerModule(__filename, module);}"use strict";

exports.__esModule = true;
exports["default"] = void 0;

var _texture = _interopRequireDefault(require("./texture"));

var _enums = require("./enums");

var _misc = require("./misc");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { "default": obj }; }

function _inheritsLoose(subClass, superClass) { subClass.prototype = Object.create(superClass.prototype); subClass.prototype.constructor = subClass; _setPrototypeOf(subClass, superClass); }

function _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }

/**
 * @typedef {HTMLImageElement | HTMLCanvasElement} HTMLImageSource
 * @typedef {HTMLImageSource | ArrayBufferView} ImageSource
 * @typedef {{width?: number, height?: number, minFilter?: number, magFilter?: number, mipFilter?: number, wrapS?: number, wrapT?: number, format?: number, genMipmaps?: boolean, images?: ImageSource[], image?: ImageSource, flipY?: boolean, premultiplyAlpha?: boolean, anisotropy?: number}} TextureUpdateOpts
 * @typedef {import("../gfx/device").default} Device
 */
var Texture2D = /*#__PURE__*/function (_Texture) {
  _inheritsLoose(Texture2D, _Texture);

  /**
   * @constructor
   * @param {Device} device
   * @param {TextureUpdateOpts} options
   */
  function Texture2D(device, options) {
    var _this;

    _this = _Texture.call(this, device) || this;
    var gl = _this._device._gl;
    _this._target = gl.TEXTURE_2D;
    _this._glID = gl.createTexture(); // always alloc texture in GPU when we create it.

    options.images = options.images || [null];

    _this.update(options);

    return _this;
  }
  /**
   * @method update
   * @param {TextureUpdateOpts} options
   */


  var _proto = Texture2D.prototype;

  _proto.update = function update(options) {
    var gl = this._device._gl;
    var genMipmaps = this._genMipmap;

    if (options) {
      if (options.width !== undefined) {
        this._width = options.width;
      }

      if (options.height !== undefined) {
        this._height = options.height;
      }

      if (options.anisotropy !== undefined) {
        this._anisotropy = options.anisotropy;
      }

      if (options.minFilter !== undefined) {
        this._minFilter = options.minFilter;
      }

      if (options.magFilter !== undefined) {
        this._magFilter = options.magFilter;
      }

      if (options.mipFilter !== undefined) {
        this._mipFilter = options.mipFilter;
      }

      if (options.wrapS !== undefined) {
        this._wrapS = options.wrapS;
      }

      if (options.wrapT !== undefined) {
        this._wrapT = options.wrapT;
      }

      if (options.format !== undefined) {
        this._format = options.format;
        this._compressed = this._format >= _enums.enums.TEXTURE_FMT_RGB_DXT1 && this._format <= _enums.enums.TEXTURE_FMT_RGBA_PVRTC_4BPPV1 || this._format >= _enums.enums.TEXTURE_FMT_RGB_ETC2 && this._format <= _enums.enums.TEXTURE_FMT_RGBA_ETC2;
      } // check if generate mipmap


      if (options.genMipmaps !== undefined) {
        this._genMipmap = options.genMipmaps;
        genMipmaps = options.genMipmaps;
      }

      var maxSize = this._device.caps.maxTextureSize || Number.MAX_VALUE;
      var textureMaxSize = Math.max(options.width || 0, options.height || 0);
      if (maxSize < textureMaxSize) console.warn("The current texture size " + textureMaxSize + " exceeds the maximum size [" + maxSize + "] supported on the device.");

      if (options.images !== undefined) {
        if (options.images.length > 1) {
          genMipmaps = false;
          var maxLength = options.width > options.height ? options.width : options.height;

          if (maxLength >> options.images.length - 1 !== 1) {
            console.error('texture-2d mipmap is invalid, should have a 1x1 mipmap.');
          }
        }
      }
    } // NOTE: get pot after this._width, this._height has been assigned.


    var pot = (0, _misc.isPow2)(this._width) && (0, _misc.isPow2)(this._height);

    if (!pot) {
      genMipmaps = false;
    }

    gl.activeTexture(gl.TEXTURE0);
    gl.bindTexture(gl.TEXTURE_2D, this._glID);

    if (options.images !== undefined && options.images.length > 0) {
      this._setMipmap(options.images, options.flipY, options.premultiplyAlpha);

      if (options.images.length > 1) this._genMipmap = true;
    }

    if (genMipmaps) {
      gl.hint(gl.GENERATE_MIPMAP_HINT, gl.NICEST);
      gl.generateMipmap(gl.TEXTURE_2D);
      this._genMipmap = true;
    }

    this._setTexInfo();

    this._device._restoreTexture(0);
  }
  /**
   * @method updateSubImage
   * @param {Object} options
   * @param {Number} options.x
   * @param {Number} options.y
   * @param {Number} options.width
   * @param {Number} options.height
   * @param {Number} options.level
   * @param {HTMLCanvasElement | HTMLImageElement | HTMLVideoElement | ArrayBufferView} options.image
   * @param {Boolean} options.flipY
   * @param {Boolean} options.premultiplyAlpha
   */
  ;

  _proto.updateSubImage = function updateSubImage(options) {
    var gl = this._device._gl;
    var glFmt = (0, _enums.glTextureFmt)(this._format);
    gl.activeTexture(gl.TEXTURE0);
    gl.bindTexture(gl.TEXTURE_2D, this._glID);

    this._setSubImage(glFmt, options);

    this._device._restoreTexture(0);
  }
  /**
   * @method updateImage
   * @param {Object} options
   * @param {Number} options.width
   * @param {Number} options.height
   * @param {Number} options.level
   * @param {HTMLCanvasElement | HTMLImageElement | HTMLVideoElement | ArrayBufferView} options.image
   * @param {Boolean} options.flipY
   * @param {Boolean} options.premultiplyAlpha
   */
  ;

  _proto.updateImage = function updateImage(options) {
    var gl = this._device._gl;
    var glFmt = (0, _enums.glTextureFmt)(this._format);
    gl.activeTexture(gl.TEXTURE0);
    gl.bindTexture(gl.TEXTURE_2D, this._glID);

    this._setImage(glFmt, options);

    this._device._restoreTexture(0);
  };

  _proto._setSubImage = function _setSubImage(glFmt, options) {
    var gl = this._device._gl;
    var flipY = options.flipY;
    var premultiplyAlpha = options.premultiplyAlpha;
    var img = options.image;

    if (img && !ArrayBuffer.isView(img) && !(img instanceof ArrayBuffer)) {
      if (flipY === undefined) {
        gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, true);
      } else {
        gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, flipY);
      }

      if (premultiplyAlpha === undefined) {
        gl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL, false);
      } else {
        gl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL, premultiplyAlpha);
      }

      gl.texSubImage2D(gl.TEXTURE_2D, options.level, options.x, options.y, glFmt.format, glFmt.pixelType, img);
    } else {
      if (flipY === undefined) {
        gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, false);
      } else {
        gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, flipY);
      }

      if (premultiplyAlpha === undefined) {
        gl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL, false);
      } else {
        gl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL, premultiplyAlpha);
      }

      if (this._compressed) {
        gl.compressedTexSubImage2D(gl.TEXTURE_2D, options.level, options.x, options.y, options.width, options.height, glFmt.format, img);
      } else {
        gl.texSubImage2D(gl.TEXTURE_2D, options.level, options.x, options.y, options.width, options.height, glFmt.format, glFmt.pixelType, img);
      }
    }
  };

  _proto._setImage = function _setImage(glFmt, options) {
    var gl = this._device._gl;
    var flipY = options.flipY;
    var premultiplyAlpha = options.premultiplyAlpha;
    var img = options.image;

    if (img && !ArrayBuffer.isView(img) && !(img instanceof ArrayBuffer)) {
      if (flipY === undefined) {
        gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, true);
      } else {
        gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, flipY);
      }

      if (premultiplyAlpha === undefined) {
        gl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL, false);
      } else {
        gl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL, premultiplyAlpha);
      }

      gl.texImage2D(gl.TEXTURE_2D, options.level, glFmt.internalFormat, glFmt.format, glFmt.pixelType, img);
    } else {
      if (flipY === undefined) {
        gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, false);
      } else {
        gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, flipY);
      }

      if (premultiplyAlpha === undefined) {
        gl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL, false);
      } else {
        gl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL, premultiplyAlpha);
      }

      if (this._compressed) {
        gl.compressedTexImage2D(gl.TEXTURE_2D, options.level, glFmt.internalFormat, options.width, options.height, 0, img);
      } else {
        gl.texImage2D(gl.TEXTURE_2D, options.level, glFmt.internalFormat, options.width, options.height, 0, glFmt.format, glFmt.pixelType, img);
      }
    }
  };

  _proto._setMipmap = function _setMipmap(images, flipY, premultiplyAlpha) {
    var glFmt = (0, _enums.glTextureFmt)(this._format);
    var options = {
      width: this._width,
      height: this._height,
      flipY: flipY,
      premultiplyAlpha: premultiplyAlpha,
      level: 0,
      image: null
    };

    for (var i = 0; i < images.length; ++i) {
      options.level = i;
      options.width = this._width >> i;
      options.height = this._height >> i;
      options.image = images[i];

      this._setImage(glFmt, options);
    }
  };

  _proto._setTexInfo = function _setTexInfo() {
    var gl = this._device._gl;
    var pot = (0, _misc.isPow2)(this._width) && (0, _misc.isPow2)(this._height); // WebGL1 doesn't support all wrap modes with NPOT textures

    if (!pot && (this._wrapS !== _enums.enums.WRAP_CLAMP || this._wrapT !== _enums.enums.WRAP_CLAMP)) {
      console.warn('WebGL1 doesn\'t support all wrap modes with NPOT textures');
      this._wrapS = _enums.enums.WRAP_CLAMP;
      this._wrapT = _enums.enums.WRAP_CLAMP;
    }

    var mipFilter = this._genMipmap ? this._mipFilter : -1;

    if (!pot && mipFilter !== -1) {
      console.warn('NPOT textures do not support mipmap filter');
      mipFilter = -1;
    }

    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, (0, _enums.glFilter)(gl, this._minFilter, mipFilter));
    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, (0, _enums.glFilter)(gl, this._magFilter, -1));
    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, this._wrapS);
    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, this._wrapT);

    var ext = this._device.ext('EXT_texture_filter_anisotropic');

    if (ext) {
      gl.texParameteri(gl.TEXTURE_2D, ext.TEXTURE_MAX_ANISOTROPY_EXT, this._anisotropy);
    }
  };

  return Texture2D;
}(_texture["default"]);

exports["default"] = Texture2D;
module.exports = exports["default"];
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_engine__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImVuZ2luZS1kZXZcXGNvY29zMmRcXHJlbmRlcmVyXFxnZnhcXHRleHR1cmUtMmQuanMiXSwibmFtZXMiOlsiVGV4dHVyZTJEIiwiZGV2aWNlIiwib3B0aW9ucyIsImdsIiwiX2RldmljZSIsIl9nbCIsIl90YXJnZXQiLCJURVhUVVJFXzJEIiwiX2dsSUQiLCJjcmVhdGVUZXh0dXJlIiwiaW1hZ2VzIiwidXBkYXRlIiwiZ2VuTWlwbWFwcyIsIl9nZW5NaXBtYXAiLCJ3aWR0aCIsInVuZGVmaW5lZCIsIl93aWR0aCIsImhlaWdodCIsIl9oZWlnaHQiLCJhbmlzb3Ryb3B5IiwiX2FuaXNvdHJvcHkiLCJtaW5GaWx0ZXIiLCJfbWluRmlsdGVyIiwibWFnRmlsdGVyIiwiX21hZ0ZpbHRlciIsIm1pcEZpbHRlciIsIl9taXBGaWx0ZXIiLCJ3cmFwUyIsIl93cmFwUyIsIndyYXBUIiwiX3dyYXBUIiwiZm9ybWF0IiwiX2Zvcm1hdCIsIl9jb21wcmVzc2VkIiwiZW51bXMiLCJURVhUVVJFX0ZNVF9SR0JfRFhUMSIsIlRFWFRVUkVfRk1UX1JHQkFfUFZSVENfNEJQUFYxIiwiVEVYVFVSRV9GTVRfUkdCX0VUQzIiLCJURVhUVVJFX0ZNVF9SR0JBX0VUQzIiLCJtYXhTaXplIiwiY2FwcyIsIm1heFRleHR1cmVTaXplIiwiTnVtYmVyIiwiTUFYX1ZBTFVFIiwidGV4dHVyZU1heFNpemUiLCJNYXRoIiwibWF4IiwiY29uc29sZSIsIndhcm4iLCJsZW5ndGgiLCJtYXhMZW5ndGgiLCJlcnJvciIsInBvdCIsImFjdGl2ZVRleHR1cmUiLCJURVhUVVJFMCIsImJpbmRUZXh0dXJlIiwiX3NldE1pcG1hcCIsImZsaXBZIiwicHJlbXVsdGlwbHlBbHBoYSIsImhpbnQiLCJHRU5FUkFURV9NSVBNQVBfSElOVCIsIk5JQ0VTVCIsImdlbmVyYXRlTWlwbWFwIiwiX3NldFRleEluZm8iLCJfcmVzdG9yZVRleHR1cmUiLCJ1cGRhdGVTdWJJbWFnZSIsImdsRm10IiwiX3NldFN1YkltYWdlIiwidXBkYXRlSW1hZ2UiLCJfc2V0SW1hZ2UiLCJpbWciLCJpbWFnZSIsIkFycmF5QnVmZmVyIiwiaXNWaWV3IiwicGl4ZWxTdG9yZWkiLCJVTlBBQ0tfRkxJUF9ZX1dFQkdMIiwiVU5QQUNLX1BSRU1VTFRJUExZX0FMUEhBX1dFQkdMIiwidGV4U3ViSW1hZ2UyRCIsImxldmVsIiwieCIsInkiLCJwaXhlbFR5cGUiLCJjb21wcmVzc2VkVGV4U3ViSW1hZ2UyRCIsInRleEltYWdlMkQiLCJpbnRlcm5hbEZvcm1hdCIsImNvbXByZXNzZWRUZXhJbWFnZTJEIiwiaSIsIldSQVBfQ0xBTVAiLCJ0ZXhQYXJhbWV0ZXJpIiwiVEVYVFVSRV9NSU5fRklMVEVSIiwiVEVYVFVSRV9NQUdfRklMVEVSIiwiVEVYVFVSRV9XUkFQX1MiLCJURVhUVVJFX1dSQVBfVCIsImV4dCIsIlRFWFRVUkVfTUFYX0FOSVNPVFJPUFlfRVhUIiwiVGV4dHVyZSJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7OztBQUNBOztBQUNBOztBQUNBOzs7Ozs7OztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtJQUVxQkE7OztBQUNuQjtBQUNGO0FBQ0E7QUFDQTtBQUNBO0FBQ0UscUJBQVlDLE1BQVosRUFBb0JDLE9BQXBCLEVBQTZCO0FBQUE7O0FBQzNCLGdDQUFNRCxNQUFOO0FBRUEsUUFBSUUsRUFBRSxHQUFHLE1BQUtDLE9BQUwsQ0FBYUMsR0FBdEI7QUFDQSxVQUFLQyxPQUFMLEdBQWVILEVBQUUsQ0FBQ0ksVUFBbEI7QUFDQSxVQUFLQyxLQUFMLEdBQWFMLEVBQUUsQ0FBQ00sYUFBSCxFQUFiLENBTDJCLENBTzNCOztBQUNBUCxJQUFBQSxPQUFPLENBQUNRLE1BQVIsR0FBaUJSLE9BQU8sQ0FBQ1EsTUFBUixJQUFrQixDQUFDLElBQUQsQ0FBbkM7O0FBQ0EsVUFBS0MsTUFBTCxDQUFZVCxPQUFaOztBQVQyQjtBQVU1QjtBQUVEO0FBQ0Y7QUFDQTtBQUNBOzs7OztTQUNFUyxTQUFBLGdCQUFPVCxPQUFQLEVBQWdCO0FBQ2Qs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ZW50IjpbIi8vIEB0cy1jaGVja1xyXG5pbXBvcnQgVGV4dHVyZSBmcm9tICcuL3RleHR1cmUnO1xyXG5pbXBvcnQgeyBlbnVtcywgZ2xGaWx0ZXIsIGdsVGV4dHVyZUZtdCB9IGZyb20gJy4vZW51bXMnO1xyXG5pbXBvcnQgeyBpc1BvdzIgfSBmcm9tICcuL21pc2MnO1xyXG5cclxuLyoqXHJcbiAqIEB0eXBlZGVmIHtIVE1MSW1hZ2VFbGVtZW50IHwgSFRNTENhbnZhc0VsZW1lbnR9IEhUTUxJbWFnZVNvdXJjZVxyXG4gKiBAdHlwZWRlZiB7SFRNTEltYWdlU291cmNlIHwgQXJyYXlCdWZmZXJWaWV3fSBJbWFnZVNvdXJjZVxyXG4gKiBAdHlwZWRlZiB7e3dpZHRoPzogbnVtYmVyLCBoZWlnaHQ/OiBudW1iZXIsIG1pbkZpbHRlcj86IG51bWJlciwgbWFnRmlsdGVyPzogbnVtYmVyLCBtaXBGaWx0ZXI/OiBudW1iZXIsIHdyYXBTPzogbnVtYmVyLCB3cmFwVD86IG51bWJlciwgZm9ybWF0PzogbnVtYmVyLCBnZW5NaXBtYXBzPzogYm9vbGVhbiwgaW1hZ2VzPzogSW1hZ2VTb3VyY2VbXSwgaW1hZ2U/OiBJbWFnZVNvdXJjZSwgZmxpcFk/OiBib29sZWFuLCBwcmVtdWx0aXBseUFscGhhPzogYm9vbGVhbiwgYW5pc290cm9weT86IG51bWJlcn19IFRleHR1cmVVcGRhdGVPcHRzXHJcbiAqIEB0eXBlZGVmIHtpbXBvcnQoXCIuLi9nZngvZGV2aWNlXCIpLmRlZmF1bHR9IERldmljZVxyXG4gKi9cclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFRleHR1cmUyRCBleHRlbmRzIFRleHR1cmUge1xyXG4gIC8qKlxyXG4gICAqIEBjb25zdHJ1Y3RvclxyXG4gICAqIEBwYXJhbSB7RGV2aWNlfSBkZXZpY2VcclxuICAgKiBAcGFyYW0ge1RleHR1cmVVcGRhdGVPcHRzfSBvcHRpb25zXHJcbiAgICovXHJcbiAgY29uc3RydWN0b3IoZGV2aWNlLCBvcHRpb25zKSB7XHJcbiAgICBzdXBlcihkZXZpY2UpO1xyXG5cclxuICAgIGxldCBnbCA9IHRoaXMuX2RldmljZS5fZ2w7XHJcbiAgICB0aGlzLl90YXJnZXQgPSBnbC5URVhUVVJFXzJEO1xyXG4gICAgdGhpcy5fZ2xJRCA9IGdsLmNyZWF0ZVRleHR1cmUoKTtcclxuXHJcbiAgICAvLyBhbHdheXMgYWxsb2MgdGV4dHVyZSBpbiBHUFUgd2hlbiB3ZSBjcmVhdGUgaXQuXHJcbiAgICBvcHRpb25zLmltYWdlcyA9IG9wdGlvbnMuaW1hZ2VzIHx8IFtudWxsXTtcclxuICAgIHRoaXMudXBkYXRlKG9wdGlvbnMpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQG1ldGhvZCB1cGRhdGVcclxuICAgKiBAcGFyYW0ge1RleHR1cmVVcGRhdGVPcHRzfSBvcHRpb25zXHJcbiAgICovXHJcbiAgdXBkYXRlKG9wdGlvbnMpIHtcclxuICAgIGxldCBnbCA9IHRoaXMuX2RldmljZS5fZ2w7XHJcbiAgICBsZXQgZ2VuTWlwbWFwcyA9IHRoaXMuX2dlbk1pcG1hcDtcclxuXHJcbiAgICBpZiAob3B0aW9ucykge1xyXG4gICAgICBpZiAob3B0aW9ucy53aWR0aCAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgdGhpcy5fd2lkdGggPSBvcHRpb25zLndpZHRoO1xyXG4gICAgICB9XHJcbiAgICAgIGlmIChvcHRpb25zLmhlaWdodCAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgdGhpcy5faGVpZ2h0ID0gb3B0aW9ucy5oZWlnaHQ7XHJcbiAgICAgIH1cclxuICAgICAgaWYgKG9wdGlvbnMuYW5pc290cm9weSAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgdGhpcy5fYW5pc290cm9weSA9IG9wdGlvbnMuYW5pc290cm9weTtcclxuICAgICAgfVxyXG4gICAgICBpZiAob3B0aW9ucy5taW5GaWx0ZXIgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgIHRoaXMuX21pbkZpbHRlciA9IG9wdGlvbnMubWluRmlsdGVyO1xyXG4gICAgICB9XHJcbiAgICAgIGlmIChvcHRpb25zLm1hZ0ZpbHRlciAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgdGhpcy5fbWFnRmlsdGVyID0gb3B0aW9ucy5tYWdGaWx0ZXI7XHJcbiAgICAgIH1cclxuICAgICAgaWYgKG9wdGlvbnMubWlwRmlsdGVyICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICB0aGlzLl9taXBGaWx0ZXIgPSBvcHRpb25zLm1pcEZpbHRlcjtcclxuICAgICAgfVxyXG4gICAgICBpZiAob3B0aW9ucy53cmFwUyAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgdGhpcy5fd3JhcFMgPSBvcHRpb25zLndyYXBTO1xyXG4gICAgICB9XHJcbiAgICAgIGlmIChvcHRpb25zLndyYXBUICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICB0aGlzLl93cmFwVCA9IG9wdGlvbnMud3JhcFQ7XHJcbiAgICAgIH1cclxuICAgICAgaWYgKG9wdGlvbnMuZm9ybWF0ICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICB0aGlzLl9mb3JtYXQgPSBvcHRpb25zLmZvcm1hdDtcclxuICAgICAgICB0aGlzLl9jb21wcmVzc2VkID0gXHJcbiAgICAgICAgICAodGhpcy5fZm9ybWF0ID49IGVudW1zLlRFWFRVUkVfRk1UX1JHQl9EWFQxICYmIHRoaXMuX2Zvcm1hdCA8PSBlbnVtcy5URVhUVVJFX0ZNVF9SR0JBX1BWUlRDXzRCUFBWMSkgfHwgXHJcbiAgICAgICAgICAodGhpcy5fZm9ybWF0ID49IGVudW1zLlRFWFRVUkVfRk1UX1JHQl9FVEMyICYmIHRoaXMuX2Zvcm1hdCA8PSBlbnVtcy5URVhUVVJFX0ZNVF9SR0JBX0VUQzIpXHJcbiAgICAgICAgO1xyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyBjaGVjayBpZiBnZW5lcmF0ZSBtaXBtYXBcclxuICAgICAgaWYgKG9wdGlvbnMuZ2VuTWlwbWFwcyAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgdGhpcy5fZ2VuTWlwbWFwID0gb3B0aW9ucy5nZW5NaXBtYXBzO1xyXG4gICAgICAgIGdlbk1pcG1hcHMgPSBvcHRpb25zLmdlbk1pcG1hcHM7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGxldCBtYXhTaXplID0gdGhpcy5fZGV2aWNlLmNhcHMubWF4VGV4dHVyZVNpemUgfHwgTnVtYmVyLk1BWF9WQUxVRTtcclxuICAgICAgbGV0IHRleHR1cmVNYXhTaXplID0gTWF0aC5tYXgob3B0aW9ucy53aWR0aCB8fCAwLCBvcHRpb25zLmhlaWdodCB8fCAwKTtcclxuICAgICAgaWYgKG1heFNpemUgPCB0ZXh0dXJlTWF4U2l6ZSlcclxuICAgICAgICBjb25zb2xlLndhcm4oYFRoZSBjdXJyZW50IHRleHR1cmUgc2l6ZSAke3RleHR1cmVNYXhTaXplfSBleGNlZWRzIHRoZSBtYXhpbXVtIHNpemUgWyR7bWF4U2l6ZX1dIHN1cHBvcnRlZCBvbiB0aGUgZGV2aWNlLmApO1xyXG5cclxuICAgICAgaWYgKG9wdGlvbnMuaW1hZ2VzICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICBpZiAob3B0aW9ucy5pbWFnZXMubGVuZ3RoID4gMSkge1xyXG4gICAgICAgICAgZ2VuTWlwbWFwcyA9IGZhbHNlO1xyXG4gICAgICAgICAgbGV0IG1heExlbmd0aCA9IG9wdGlvbnMud2lkdGggPiBvcHRpb25zLmhlaWdodCA/IG9wdGlvbnMud2lkdGggOiBvcHRpb25zLmhlaWdodDtcclxuICAgICAgICAgIGlmIChtYXhMZW5ndGggPj4gKG9wdGlvbnMuaW1hZ2VzLmxlbmd0aCAtIDEpICE9PSAxKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ3RleHR1cmUtMmQgbWlwbWFwIGlzIGludmFsaWQsIHNob3VsZCBoYXZlIGEgMXgxIG1pcG1hcC4nKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvLyBOT1RFOiBnZXQgcG90IGFmdGVyIHRoaXMuX3dpZHRoLCB0aGlzLl9oZWlnaHQgaGFzIGJlZW4gYXNzaWduZWQuXHJcbiAgICBsZXQgcG90ID0gaXNQb3cyKHRoaXMuX3dpZHRoKSAmJiBpc1BvdzIodGhpcy5faGVpZ2h0KTtcclxuICAgIGlmICghcG90KSB7XHJcbiAgICAgIGdlbk1pcG1hcHMgPSBmYWxzZTtcclxuICAgIH1cclxuXHJcbiAgICBnbC5hY3RpdmVUZXh0dXJlKGdsLlRFWFRVUkUwKTtcclxuICAgIGdsLmJpbmRUZXh0dXJlKGdsLlRFWFRVUkVfMkQsIHRoaXMuX2dsSUQpO1xyXG4gICAgaWYgKG9wdGlvbnMuaW1hZ2VzICE9PSB1bmRlZmluZWQgJiYgb3B0aW9ucy5pbWFnZXMubGVuZ3RoID4gMCkge1xyXG4gICAgICB0aGlzLl9zZXRNaXBtYXAob3B0aW9ucy5pbWFnZXMsIG9wdGlvbnMuZmxpcFksIG9wdGlvbnMucHJlbXVsdGlwbHlBbHBoYSk7XHJcbiAgICAgIGlmIChvcHRpb25zLmltYWdlcy5sZW5ndGggPiAxKSB0aGlzLl9nZW5NaXBtYXAgPSB0cnVlO1xyXG4gICAgfVxyXG4gICAgaWYgKGdlbk1pcG1hcHMpIHtcclxuICAgICAgZ2wuaGludChnbC5HRU5FUkFURV9NSVBNQVBfSElOVCwgZ2wuTklDRVNUKTtcclxuICAgICAgZ2wuZ2VuZXJhdGVNaXBtYXAoZ2wuVEVYVFVSRV8yRCk7XHJcbiAgICAgIHRoaXMuX2dlbk1pcG1hcCA9IHRydWU7XHJcbiAgICB9XHJcblxyXG4gICAgdGhpcy5fc2V0VGV4SW5mbygpO1xyXG4gICAgdGhpcy5fZGV2aWNlLl9yZXN0b3JlVGV4dHVyZSgwKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEBtZXRob2QgdXBkYXRlU3ViSW1hZ2VcclxuICAgKiBAcGFyYW0ge09iamVjdH0gb3B0aW9uc1xyXG4gICAqIEBwYXJhbSB7TnVtYmVyfSBvcHRpb25zLnhcclxuICAgKiBAcGFyYW0ge051bWJlcn0gb3B0aW9ucy55XHJcbiAgICogQHBhcmFtIHtOdW1iZXJ9IG9wdGlvbnMud2lkdGhcclxuICAgKiBAcGFyYW0ge051bWJlcn0gb3B0aW9ucy5oZWlnaHRcclxuICAgKiBAcGFyYW0ge051bWJlcn0gb3B0aW9ucy5sZXZlbFxyXG4gICAqIEBwYXJhbSB7SFRNTENhbnZhc0VsZW1lbnQgfCBIVE1MSW1hZ2VFbGVtZW50IHwgSFRNTFZpZGVvRWxlbWVudCB8IEFycmF5QnVmZmVyVmlld30gb3B0aW9ucy5pbWFnZVxyXG4gICAqIEBwYXJhbSB7Qm9vbGVhbn0gb3B0aW9ucy5mbGlwWVxyXG4gICAqIEBwYXJhbSB7Qm9vbGVhbn0gb3B0aW9ucy5wcmVtdWx0aXBseUFscGhhXHJcbiAgICovXHJcbiAgdXBkYXRlU3ViSW1hZ2Uob3B0aW9ucykge1xyXG4gICAgbGV0IGdsID0gdGhpcy5fZGV2aWNlLl9nbDtcclxuICAgIGxldCBnbEZtdCA9IGdsVGV4dHVyZUZtdCh0aGlzLl9mb3JtYXQpO1xyXG5cclxuICAgIGdsLmFjdGl2ZVRleHR1cmUoZ2wuVEVYVFVSRTApO1xyXG4gICAgZ2wuYmluZFRleHR1cmUoZ2wuVEVYVFVSRV8yRCwgdGhpcy5fZ2xJRCk7XHJcbiAgICB0aGlzLl9zZXRTdWJJbWFnZShnbEZtdCwgb3B0aW9ucyk7XHJcbiAgICB0aGlzLl9kZXZpY2UuX3Jlc3RvcmVUZXh0dXJlKDApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQG1ldGhvZCB1cGRhdGVJbWFnZVxyXG4gICAqIEBwYXJhbSB7T2JqZWN0fSBvcHRpb25zXHJcbiAgICogQHBhcmFtIHtOdW1iZXJ9IG9wdGlvbnMud2lkdGhcclxuICAgKiBAcGFyYW0ge051bWJlcn0gb3B0aW9ucy5oZWlnaHRcclxuICAgKiBAcGFyYW0ge051bWJlcn0gb3B0aW9ucy5sZXZlbFxyXG4gICAqIEBwYXJhbSB7SFRNTENhbnZhc0VsZW1lbnQgfCBIVE1MSW1hZ2VFbGVtZW50IHwgSFRNTFZpZGVvRWxlbWVudCB8IEFycmF5QnVmZmVyVmlld30gb3B0aW9ucy5pbWFnZVxyXG4gICAqIEBwYXJhbSB7Qm9vbGVhbn0gb3B0aW9ucy5mbGlwWVxyXG4gICAqIEBwYXJhbSB7Qm9vbGVhbn0gb3B0aW9ucy5wcmVtdWx0aXBseUFscGhhXHJcbiAgICovXHJcbiAgdXBkYXRlSW1hZ2Uob3B0aW9ucykge1xyXG4gICAgbGV0IGdsID0gdGhpcy5fZGV2aWNlLl9nbDtcclxuICAgIGxldCBnbEZtdCA9IGdsVGV4dHVyZUZtdCh0aGlzLl9mb3JtYXQpO1xyXG5cclxuICAgIGdsLmFjdGl2ZVRleHR1cmUoZ2wuVEVYVFVSRTApO1xyXG4gICAgZ2wuYmluZFRleHR1cmUoZ2wuVEVYVFVSRV8yRCwgdGhpcy5fZ2xJRCk7XHJcbiAgICB0aGlzLl9zZXRJbWFnZShnbEZtdCwgb3B0aW9ucyk7XHJcbiAgICB0aGlzLl9kZXZpY2UuX3Jlc3RvcmVUZXh0dXJlKDApO1xyXG4gIH1cclxuXHJcbiAgX3NldFN1YkltYWdlKGdsRm10LCBvcHRpb25zKSB7XHJcbiAgICBsZXQgZ2wgPSB0aGlzLl9kZXZpY2UuX2dsO1xyXG4gICAgbGV0IGZsaXBZID0gb3B0aW9ucy5mbGlwWTtcclxuICAgIGxldCBwcmVtdWx0aXBseUFscGhhID0gb3B0aW9ucy5wcmVtdWx0aXBseUFscGhhO1xyXG4gICAgbGV0IGltZyA9IG9wdGlvbnMuaW1hZ2U7XHJcblxyXG4gICAgaWYgKGltZyAmJiAhQXJyYXlCdWZmZXIuaXNWaWV3KGltZykgJiYgIShpbWcgaW5zdGFuY2VvZiBBcnJheUJ1ZmZlcikpIHtcclxuICAgICAgaWYgKGZsaXBZID09PSB1bmRlZmluZWQpIHtcclxuICAgICAgICBnbC5waXhlbFN0b3JlaShnbC5VTlBBQ0tfRkxJUF9ZX1dFQkdMLCB0cnVlKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICBnbC5waXhlbFN0b3JlaShnbC5VTlBBQ0tfRkxJUF9ZX1dFQkdMLCBmbGlwWSk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGlmIChwcmVtdWx0aXBseUFscGhhID09PSB1bmRlZmluZWQpIHtcclxuICAgICAgICBnbC5waXhlbFN0b3JlaShnbC5VTlBBQ0tfUFJFTVVMVElQTFlfQUxQSEFfV0VCR0wsIGZhbHNlKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICBnbC5waXhlbFN0b3JlaShnbC5VTlBBQ0tfUFJFTVVMVElQTFlfQUxQSEFfV0VCR0wsIHByZW11bHRpcGx5QWxwaGEpO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBnbC50ZXhTdWJJbWFnZTJEKGdsLlRFWFRVUkVfMkQsIG9wdGlvbnMubGV2ZWwsIG9wdGlvbnMueCwgb3B0aW9ucy55LCBnbEZtdC5mb3JtYXQsIGdsRm10LnBpeGVsVHlwZSwgaW1nKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIGlmIChmbGlwWSA9PT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgZ2wucGl4ZWxTdG9yZWkoZ2wuVU5QQUNLX0ZMSVBfWV9XRUJHTCwgZmFsc2UpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGdsLnBpeGVsU3RvcmVpKGdsLlVOUEFDS19GTElQX1lfV0VCR0wsIGZsaXBZKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgaWYgKHByZW11bHRpcGx5QWxwaGEgPT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgIGdsLnBpeGVsU3RvcmVpKGdsLlVOUEFDS19QUkVNVUxUSVBMWV9BTFBIQV9XRUJHTCwgZmFsc2UpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGdsLnBpeGVsU3RvcmVpKGdsLlVOUEFDS19QUkVNVUxUSVBMWV9BTFBIQV9XRUJHTCwgcHJlbXVsdGlwbHlBbHBoYSk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGlmICh0aGlzLl9jb21wcmVzc2VkKSB7XHJcbiAgICAgICAgZ2wuY29tcHJlc3NlZFRleFN1YkltYWdlMkQoZ2wuVEVYVFVSRV8yRCxcclxuICAgICAgICAgIG9wdGlvbnMubGV2ZWwsXHJcbiAgICAgICAgICBvcHRpb25zLngsXHJcbiAgICAgICAgICBvcHRpb25zLnksXHJcbiAgICAgICAgICBvcHRpb25zLndpZHRoLFxyXG4gICAgICAgICAgb3B0aW9ucy5oZWlnaHQsXHJcbiAgICAgICAgICBnbEZtdC5mb3JtYXQsXHJcbiAgICAgICAgICBpbWdcclxuICAgICAgICApO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGdsLnRleFN1YkltYWdlMkQoXHJcbiAgICAgICAgICBnbC5URVhUVVJFXzJELFxyXG4gICAgICAgICAgb3B0aW9ucy5sZXZlbCxcclxuICAgICAgICAgIG9wdGlvbnMueCxcclxuICAgICAgICAgIG9wdGlvbnMueSxcclxuICAgICAgICAgIG9wdGlvbnMud2lkdGgsXHJcbiAgICAgICAgICBvcHRpb25zLmhlaWdodCxcclxuICAgICAgICAgIGdsRm10LmZvcm1hdCxcclxuICAgICAgICAgIGdsRm10LnBpeGVsVHlwZSxcclxuICAgICAgICAgIGltZ1xyXG4gICAgICAgICk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcblxyXG4gIF9zZXRJbWFnZShnbEZtdCwgb3B0aW9ucykge1xyXG4gICAgbGV0IGdsID0gdGhpcy5fZGV2aWNlLl9nbDtcclxuICAgIGxldCBmbGlwWSA9IG9wdGlvbnMuZmxpcFk7XHJcbiAgICBsZXQgcHJlbXVsdGlwbHlBbHBoYSA9IG9wdGlvbnMucHJlbXVsdGlwbHlBbHBoYTtcclxuICAgIGxldCBpbWcgPSBvcHRpb25zLmltYWdlO1xyXG5cclxuICAgIGlmIChpbWcgJiYgIUFycmF5QnVmZmVyLmlzVmlldyhpbWcpICYmICEoaW1nIGluc3RhbmNlb2YgQXJyYXlCdWZmZXIpKSB7XHJcbiAgICAgIGlmIChmbGlwWSA9PT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgZ2wucGl4ZWxTdG9yZWkoZ2wuVU5QQUNLX0ZMSVBfWV9XRUJHTCwgdHJ1ZSk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgZ2wucGl4ZWxTdG9yZWkoZ2wuVU5QQUNLX0ZMSVBfWV9XRUJHTCwgZmxpcFkpO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBpZiAocHJlbXVsdGlwbHlBbHBoYSA9PT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgZ2wucGl4ZWxTdG9yZWkoZ2wuVU5QQUNLX1BSRU1VTFRJUExZX0FMUEhBX1dFQkdMLCBmYWxzZSk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgZ2wucGl4ZWxTdG9yZWkoZ2wuVU5QQUNLX1BSRU1VTFRJUExZX0FMUEhBX1dFQkdMLCBwcmVtdWx0aXBseUFscGhhKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgZ2wudGV4SW1hZ2UyRChcclxuICAgICAgICBnbC5URVhUVVJFXzJELFxyXG4gICAgICAgIG9wdGlvbnMubGV2ZWwsXHJcbiAgICAgICAgZ2xGbXQuaW50ZXJuYWxGb3JtYXQsXHJcbiAgICAgICAgZ2xGbXQuZm9ybWF0LFxyXG4gICAgICAgIGdsRm10LnBpeGVsVHlwZSxcclxuICAgICAgICBpbWdcclxuICAgICAgKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIGlmIChmbGlwWSA9PT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgZ2wucGl4ZWxTdG9yZWkoZ2wuVU5QQUNLX0ZMSVBfWV9XRUJHTCwgZmFsc2UpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGdsLnBpeGVsU3RvcmVpKGdsLlVOUEFDS19GTElQX1lfV0VCR0wsIGZsaXBZKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgaWYgKHByZW11bHRpcGx5QWxwaGEgPT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgIGdsLnBpeGVsU3RvcmVpKGdsLlVOUEFDS19QUkVNVUxUSVBMWV9BTFBIQV9XRUJHTCwgZmFsc2UpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGdsLnBpeGVsU3RvcmVpKGdsLlVOUEFDS19QUkVNVUxUSVBMWV9BTFBIQV9XRUJHTCwgcHJlbXVsdGlwbHlBbHBoYSk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGlmICh0aGlzLl9jb21wcmVzc2VkKSB7XHJcbiAgICAgICAgZ2wuY29tcHJlc3NlZFRleEltYWdlMkQoXHJcbiAgICAgICAgICBnbC5URVhUVVJFXzJELFxyXG4gICAgICAgICAgb3B0aW9ucy5sZXZlbCxcclxuICAgICAgICAgIGdsRm10LmludGVybmFsRm9ybWF0LFxyXG4gICAgICAgICAgb3B0aW9ucy53aWR0aCxcclxuICAgICAgICAgIG9wdGlvbnMuaGVpZ2h0LFxyXG4gICAgICAgICAgMCxcclxuICAgICAgICAgIGltZ1xyXG4gICAgICAgICk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgZ2wudGV4SW1hZ2UyRChcclxuICAgICAgICAgIGdsLlRFWFRVUkVfMkQsXHJcbiAgICAgICAgICBvcHRpb25zLmxldmVsLFxyXG4gICAgICAgICAgZ2xGbXQuaW50ZXJuYWxGb3JtYXQsXHJcbiAgICAgICAgICBvcHRpb25zLndpZHRoLFxyXG4gICAgICAgICAgb3B0aW9ucy5oZWlnaHQsXHJcbiAgICAgICAgICAwLFxyXG4gICAgICAgICAgZ2xGbXQuZm9ybWF0LFxyXG4gICAgICAgICAgZ2xGbXQucGl4ZWxUeXBlLFxyXG4gICAgICAgICAgaW1nXHJcbiAgICAgICAgKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgX3NldE1pcG1hcChpbWFnZXMsIGZsaXBZLCBwcmVtdWx0aXBseUFscGhhKSB7XHJcbiAgICBsZXQgZ2xGbXQgPSBnbFRleHR1cmVGbXQodGhpcy5fZm9ybWF0KTtcclxuICAgIGxldCBvcHRpb25zID0ge1xyXG4gICAgICB3aWR0aDogdGhpcy5fd2lkdGgsXHJcbiAgICAgIGhlaWdodDogdGhpcy5faGVpZ2h0LFxyXG4gICAgICBmbGlwWTogZmxpcFksXHJcbiAgICAgIHByZW11bHRpcGx5QWxwaGE6IHByZW11bHRpcGx5QWxwaGEsXHJcbiAgICAgIGxldmVsOiAwLFxyXG4gICAgICBpbWFnZTogbnVsbFxyXG4gICAgfTtcclxuXHJcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGltYWdlcy5sZW5ndGg7ICsraSkge1xyXG4gICAgICBvcHRpb25zLmxldmVsID0gaTtcclxuICAgICAgb3B0aW9ucy53aWR0aCA9IHRoaXMuX3dpZHRoID4+IGk7XHJcbiAgICAgIG9wdGlvbnMuaGVpZ2h0ID0gdGhpcy5faGVpZ2h0ID4+IGk7XHJcbiAgICAgIG9wdGlvbnMuaW1hZ2UgPSBpbWFnZXNbaV07XHJcbiAgICAgIHRoaXMuX3NldEltYWdlKGdsRm10LCBvcHRpb25zKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIF9zZXRUZXhJbmZvKCkge1xyXG4gICAgbGV0IGdsID0gdGhpcy5fZGV2aWNlLl9nbDtcclxuICAgIGxldCBwb3QgPSBpc1BvdzIodGhpcy5fd2lkdGgpICYmIGlzUG93Mih0aGlzLl9oZWlnaHQpO1xyXG5cclxuICAgIC8vIFdlYkdMMSBkb2Vzbid0IHN1cHBvcnQgYWxsIHdyYXAgbW9kZXMgd2l0aCBOUE9UIHRleHR1cmVzXHJcbiAgICBpZiAoIXBvdCAmJiAodGhpcy5fd3JhcFMgIT09IGVudW1zLldSQVBfQ0xBTVAgfHwgdGhpcy5fd3JhcFQgIT09IGVudW1zLldSQVBfQ0xBTVApKSB7XHJcbiAgICAgIGNvbnNvbGUud2FybignV2ViR0wxIGRvZXNuXFwndCBzdXBwb3J0IGFsbCB3cmFwIG1vZGVzIHdpdGggTlBPVCB0ZXh0dXJlcycpO1xyXG4gICAgICB0aGlzLl93cmFwUyA9IGVudW1zLldSQVBfQ0xBTVA7XHJcbiAgICAgIHRoaXMuX3dyYXBUID0gZW51bXMuV1JBUF9DTEFNUDtcclxuICAgIH1cclxuXHJcbiAgICBsZXQgbWlwRmlsdGVyID0gdGhpcy5fZ2VuTWlwbWFwID8gdGhpcy5fbWlwRmlsdGVyIDogLTE7XHJcbiAgICBpZiAoIXBvdCAmJiBtaXBGaWx0ZXIgIT09IC0xKSB7XHJcbiAgICAgIGNvbnNvbGUud2FybignTlBPVCB0ZXh0dXJlcyBkbyBub3Qgc3VwcG9ydCBtaXBtYXAgZmlsdGVyJyk7XHJcbiAgICAgIG1pcEZpbHRlciA9IC0xO1xyXG4gICAgfVxyXG5cclxuICAgIGdsLnRleFBhcmFtZXRlcmkoZ2wuVEVYVFVSRV8yRCwgZ2wuVEVYVFVSRV9NSU5fRklMVEVSLCBnbEZpbHRlcihnbCwgdGhpcy5fbWluRmlsdGVyLCBtaXBGaWx0ZXIpKTtcclxuICAgIGdsLnRleFBhcmFtZXRlcmkoZ2wuVEVYVFVSRV8yRCwgZ2wuVEVYVFVSRV9NQUdfRklMVEVSLCBnbEZpbHRlcihnbCwgdGhpcy5fbWFnRmlsdGVyLCAtMSkpO1xyXG4gICAgZ2wudGV4UGFyYW1ldGVyaShnbC5URVhUVVJFXzJELCBnbC5URVhUVVJFX1dSQVBfUywgdGhpcy5fd3JhcFMpO1xyXG4gICAgZ2wudGV4UGFyYW1ldGVyaShnbC5URVhUVVJFXzJELCBnbC5URVhUVVJFX1dSQVBfVCwgdGhpcy5fd3JhcFQpO1xyXG5cclxuICAgIGxldCBleHQgPSB0aGlzLl9kZXZpY2UuZXh0KCdFWFRfdGV4dHVyZV9maWx0ZXJfYW5pc290cm9waWMnKTtcclxuICAgIGlmIChleHQpIHtcclxuICAgICAgZ2wudGV4UGFyYW1ldGVyaShnbC5URVhUVVJFXzJELCBleHQuVEVYVFVSRV9NQVhfQU5JU09UUk9QWV9FWFQsIHRoaXMuX2FuaXNvdHJvcHkpO1xyXG4gICAgfVxyXG4gIH1cclxufSJdLCJzb3VyY2VSb290IjoiLyJ9